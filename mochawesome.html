<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:53,&quot;tests&quot;:236,&quot;passes&quot;:109,&quot;pending&quot;:0,&quot;failures&quot;:127,&quot;start&quot;:&quot;2025-04-06T14:13:09.967Z&quot;,&quot;end&quot;:&quot;2025-04-06T14:16:58.354Z&quot;,&quot;duration&quot;:228387,&quot;testsRegistered&quot;:246,&quot;passPercent&quot;:44.3089430894309,&quot;pendingPercent&quot;:0,&quot;other&quot;:4,&quot;hasOther&quot;:true,&quot;skipped&quot;:10,&quot;hasSkipped&quot;:true},&quot;results&quot;:[{&quot;uuid&quot;:&quot;57f5b4cc-a244-4526-9f0a-7eb2ed0e6c8e&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;eb254adb-25a4-4ddc-97bd-5a30f8532fd5&quot;,&quot;title&quot;:&quot;Get Balance Successfully after Transactions&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/accountManagement/AccountBalance.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/accountManagement/AccountBalance.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Get Balance Successfully after Transactions\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Balance Successfully after Transactions \&quot;before all\&quot; hook in \&quot;Get Balance Successfully after Transactions\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;88a71f05-5755-4c34-a1fb-cc2cfee73e12&quot;,&quot;parentUUID&quot;:&quot;eb254adb-25a4-4ddc-97bd-5a30f8532fd5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook for \&quot;should show balance correctly after multiple transactions\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Balance Successfully after Transactions \&quot;before each\&quot; hook for \&quot;should show balance correctly after multiple transactions\&quot;&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:2000,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nconst userId1 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\nconst userId2 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01711106485\&quot;,\n  },\n});\nconst userId3 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577238\&quot;,\n  },\n});\ntokenUser1 = generateUserToken(userId1.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\ntokenUser2 = generateUserToken(userId2.id, \&quot;01711106485\&quot;, \&quot;USER\&quot;);\ntokenUser3 = generateUserToken(userId3.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\nconst customer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\nawait setupTransactionTypes(chartOfAccounts);\ntype = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;1002\&quot; },\n});\nawait createUserAccounts(chartOfAccounts);\ncustomerAccount1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\ncustomerAccount2 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\ncustomerAccount3 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577238\&quot; },\n});&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/accounting/accountManagement/AccountBalance.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/accounting/accountManagement/AccountBalance.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;a846c48c-efe6-406a-b199-52c3b9b5a7ce&quot;,&quot;parentUUID&quot;:&quot;eb254adb-25a4-4ddc-97bd-5a30f8532fd5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Get Balance Successfully after Transactions\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Balance Successfully after Transactions \&quot;after all\&quot; hook in \&quot;Get Balance Successfully after Transactions\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:586,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1c56cefe-dde1-4879-8b8b-3df086fdbb3b&quot;,&quot;parentUUID&quot;:&quot;eb254adb-25a4-4ddc-97bd-5a30f8532fd5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should show account balance after initial Transaction&quot;,&quot;fullTitle&quot;:&quot;Get Balance Successfully after Transactions should show account balance after initial Transaction&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1952,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addInitialBalance(customerAccount1, 10000);\nawait addInitialBalance(customerAccount2, 10000);\nawait addInitialBalance(customerAccount3, 10000);\nconst responseBalanceForAcc1 = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountbalance}`)\n  .withBearerToken(tokenUser1)\n  .expectStatus(200);\nconst responseBalanceForAcc2 = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountbalance}`)\n  .withBearerToken(tokenUser2)\n  .expectStatus(200);\nconst responseBalanceForAcc3 = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountbalance}`)\n  .withBearerToken(tokenUser3)\n  .expectStatus(200);\nexpect(responseBalanceForAcc1.body.balance).to.equal(10000);\nexpect(responseBalanceForAcc2.body.balance).to.equal(10000);\nexpect(responseBalanceForAcc3.body.balance).to.equal(10000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;160fabf7-a468-4cd0-ae66-24b57018f215&quot;,&quot;parentUUID&quot;:&quot;eb254adb-25a4-4ddc-97bd-5a30f8532fd5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show balance correctly after multiple transactions&quot;,&quot;fullTitle&quot;:&quot;Get Balance Successfully after Transactions should show balance correctly after multiple transactions&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;let initialAmount = 1000;\nawait addInitialBalance(customerAccount1, initialAmount);\nawait addInitialBalance(customerAccount2, initialAmount);\nawait addInitialBalance(customerAccount3, initialAmount);\nlet amounts = [100, 100, 50, 65, 88];\nlet acc1balance = 597;\nlet acc2balance = 1403;\nconst transactionsFromAcc1toAcc2 = await CreateTransactions(\n  customerAccount1,\n  customerAccount2,\n  amounts,\n  type\n);\nawait createLedgerEntries(transactionsFromAcc1toAcc2);\nconst responseBalanceForAcc1 = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountbalance}`)\n  .withBearerToken(tokenUser1)\n  .expectStatus(200);\nexpect(responseBalanceForAcc1.body.balance).to.equal(597);\nconst responseBalanceForAcc2 = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountbalance}`)\n  .withBearerToken(tokenUser2)\n  .expectStatus(200);\nexpect(responseBalanceForAcc2.body.balance).to.equal(1403);\nlet amounts2 = [50, 300, 200, 20, 10];\nlet newBalanceForAcc2 = 1983;\nlet newBalanceForAcc3 = 420;\nconst transactionsFromAcc3toAcc2 = await CreateTransactions(\n  customerAccount3,\n  customerAccount2,\n  amounts2,\n  type\n);\nawait createLedgerEntries(transactionsFromAcc3toAcc2);\nconst responseBalanceForAcc2afterTrxn = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountbalance}`)\n  .withBearerToken(tokenUser2)\n  .expectStatus(200);\nexpect(responseBalanceForAcc2afterTrxn.body.balance).to.equal(2386);\nconst responseBalanceForAcc3 = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountbalance}`)\n  .withBearerToken(tokenUser3)\n  .expectStatus(200);\nexpect(responseBalanceForAcc3.body.balance).to.equal(420);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2aabe947-5ab7-4e89-b0e4-b7a98c3e07ca&quot;,&quot;parentUUID&quot;:&quot;eb254adb-25a4-4ddc-97bd-5a30f8532fd5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;160fabf7-a468-4cd0-ae66-24b57018f215&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;2aabe947-5ab7-4e89-b0e4-b7a98c3e07ca&quot;],&quot;duration&quot;:1952,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;44a37bae-e0a1-44c1-9ed4-95d756050355&quot;,&quot;title&quot;:&quot;Account Change Status PUT API&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/accountManagement/changeAccountStatus.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/accountManagement/changeAccountStatus.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Account Change Status PUT API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Change Status PUT API \&quot;before all\&quot; hook in \&quot;Account Change Status PUT API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5eefb24f-5f03-4e06-bd3e-a5023e34f774&quot;,&quot;parentUUID&quot;:&quot;44a37bae-e0a1-44c1-9ed4-95d756050355&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook for \&quot;should show error upon updating status from anywhere except admin panel\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Change Status PUT API \&quot;before each\&quot; hook for \&quot;should show error upon updating status from anywhere except admin panel\&quot;&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:2000,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.Ledger.deleteMany({});\nawait prismaAccounting.Transaction.deleteMany({});\nawait prismaAccounting.TransactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.TransactionType.deleteMany({});\nawait prismaAccounting. transactionLegLog.deleteMany({});\nawait prismaAccounting.TransactionLeg.deleteMany({});\nawait prismaAccounting.UserAccount.deleteMany({});\nawait prismaAccounting.AccountLog.deleteMany({});\nawait prismaAccounting.ChartOfAccountLog.deleteMany({});\nawait prismaAccounting.ChartOfAccount.deleteMany({});&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/accounting/accountManagement/changeAccountStatus.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/accounting/accountManagement/changeAccountStatus.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;e746b05c-c732-4dc9-b5c8-8c7913d9570e&quot;,&quot;parentUUID&quot;:&quot;44a37bae-e0a1-44c1-9ed4-95d756050355&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Account Change Status PUT API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Change Status PUT API \&quot;after all\&quot; hook in \&quot;Account Change Status PUT API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:298,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;39ae1e47-98bb-4d57-91ec-13985652c7d1&quot;,&quot;parentUUID&quot;:&quot;44a37bae-e0a1-44c1-9ed4-95d756050355&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should change account status successfully&quot;,&quot;fullTitle&quot;:&quot;Account Change Status PUT API should change account status successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1725,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst appUser = {\n  phoneNumber: \&quot;01747538382\&quot;\n};\n   let token2 = generateUserToken(1, appUser.phoneNumber, \&quot;USER\&quot;);\n\nconst chartOfAccountData = {\n  name: \&quot;Sample Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: false,\n};\nconst chartOfAccount = await prismaAccounting.ChartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst CoAID = chartOfAccount.id;\nconst testData = {\n  accountName: \&quot;John\&quot;,\n  identifier: \&quot;01711699870\&quot;,\n  status: \&quot;FULL_ACTIVE\&quot;,\n  chartOfAccount: {\n    connect: {\n      id: CoAID,\n    },\n  },\n};\nconst createdAccount = await prismaAccounting.UserAccount.create({\n  data: testData,\n});\nconst accountID = createdAccount.id;\nconst AccountStatusChangeData = {\n  status: \&quot;LIMITED_ACTIVE\&quot;,\n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;PUT\&quot;)\n  .withPath(\n    `${ApiUrls.apiBaseUrl}${ApiUrls.changeAccountStatus}${accountID}/status-update`\n  )\n  .withBearerToken(token)\n  .withJson(AccountStatusChangeData)\n  .expectStatus(200);\nconst updatedAccountStatus = await prismaAccounting.UserAccount.findUnique({\n  where: { id: accountID },\n});\nexpect(updatedAccountStatus).to.not.be.null;\nexpect(updatedAccountStatus.status).to.equal(\n  AccountStatusChangeData.status\n);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 200\n\n500 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 200\n\n500 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 200\n&quot;},&quot;uuid&quot;:&quot;f835bd87-6b4a-467a-99f0-92de96f6ca0e&quot;,&quot;parentUUID&quot;:&quot;44a37bae-e0a1-44c1-9ed4-95d756050355&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should check logs for updating status&quot;,&quot;fullTitle&quot;:&quot;Account Change Status PUT API should check logs for updating status&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1874,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst chartOfAccountData = {\n  name: \&quot;Sample Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: false,\n};\nconst chartOfAccount = await prismaAccounting.ChartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst CoAID = chartOfAccount.id;\nconst testData = {\n  accountName: \&quot;John\&quot;,\n  identifier: \&quot;01711699870\&quot;,\n  status: \&quot;LIMITED_ACTIVE\&quot;,\n  chartOfAccount: {\n    connect: {\n      id: CoAID,\n    },\n  },\n};\nconst createdAccount = await prismaAccounting.UserAccount.create({\n  data: testData,\n});\nconst accountID = createdAccount.id;\nconst AccountStatusChangeData = {\n  status: \&quot;FULL_ACTIVE\&quot;,\n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;PUT\&quot;)\n  .withPath(\n    `${ApiUrls.apiBaseUrl}${ApiUrls.changeAccountStatus}${accountID}/status-update`\n  )\n  .withBearerToken(token)\n  .withJson(AccountStatusChangeData)\n  .expectStatus(200);\nawait new Promise(resolve =&gt; setTimeout(resolve, 50));\nconst logs = await prismaAccounting.AccountLog.findMany({\n  where: {\n    accountId: BigInt(accountID),\n  },\n  orderBy: {\n    createdAt: \&quot;desc\&quot;,\n  },\n  take: 1,\n});\nexpect(logs).to.not.be.empty;\nconst lastLog = logs[0];\nexpect(lastLog).to.not.be.null;\nexpect(lastLog).to.have.property(\&quot;accountId\&quot;);\nexpect(lastLog.accountId.toString()).to.equal(accountID.toString());\nexpect(lastLog).to.have.property(\&quot;status\&quot;);\nexpect(lastLog.status).to.equal(AccountStatusChangeData.status);\nconst updatedAccount = await prismaAccounting.UserAccount.findUnique({\n  where: { id: accountID },\n});\nexpect(updatedAccount.status).to.equal(AccountStatusChangeData.status);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 200\n\n500 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 200\n\n500 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 200\n&quot;},&quot;uuid&quot;:&quot;bcbf299a-1e95-4b2c-8f62-55aa187b4c30&quot;,&quot;parentUUID&quot;:&quot;44a37bae-e0a1-44c1-9ed4-95d756050355&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error upon updating status from anywhere except admin panel&quot;,&quot;fullTitle&quot;:&quot;Account Change Status PUT API should show error upon updating status from anywhere except admin panel&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const appUser1Data = {\n  phoneNumber: \&quot;01747538382\&quot;,\n};\nconst tokenforUserAccount = generateUserToken(\n  1,\n  appUser1Data.phoneNumber,\n  \&quot;USER\&quot;\n);\nconst chartOfAccountData = {\n  name: \&quot;Sample Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: false,\n};\nconst chartOfAccount = await prismaAccounting.ChartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst CoAID = chartOfAccount.id;\nconst testData = {\n  accountName: \&quot;John\&quot;,\n  identifier: \&quot;01711699870\&quot;,\n  status: \&quot;LIMITED_ACTIVE\&quot;,\n  chartOfAccount: {\n    connect: {\n      id: CoAID,\n    },\n  },\n};\nconst createdAccount = await prismaAccounting.UserAccount.create({\n  data: testData,\n});\nconst accountID = createdAccount.id;\nconst AccountStatusChangeData = {\n  status: \&quot;FULL_ACTIVE\&quot;,\n};\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;PUT\&quot;)\n  .withPath(\n    `${ApiUrls.apiBaseUrl}${ApiUrls.changeAccountStatus}${accountID}/status-update`\n  )\n  .withBearerToken(tokenforUserAccount)\n  .withJson(AccountStatusChangeData)\n  .expectStatus(401);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ab31cfd8-c822-444a-b7f2-9643098dbc13&quot;,&quot;parentUUID&quot;:&quot;44a37bae-e0a1-44c1-9ed4-95d756050355&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should show error upon updating the status to current status&quot;,&quot;fullTitle&quot;:&quot;Account Change Status PUT API should show error upon updating the status to current status&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst chartOfAccountData = {\n  name: \&quot;Sample Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: false,\n};\nconst chartOfAccount = await prismaAccounting.ChartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst CoAID = chartOfAccount.id;\nconst testData = {\n  accountName: \&quot;John\&quot;,\n  identifier: \&quot;01711699870\&quot;,\n  status: \&quot;LIMITED_ACTIVE\&quot;,\n  chartOfAccount: {\n    connect: {\n      id: CoAID,\n    },\n  },\n};\nconst createdAccount = await prismaAccounting.UserAccount.create({\n  data: testData,\n});\nconst accountID = createdAccount.id;\nconst AccountStatusChangeData = {\n  status: \&quot;LIMITED_ACTIVE\&quot;,\n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;PUT\&quot;)\n  .withPath(\n    `${ApiUrls.apiBaseUrl}${ApiUrls.changeAccountStatus}${accountID}/status-update`\n  )\n  .withBearerToken(token)\n  .withJson(AccountStatusChangeData)\n  .expectStatus(400);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;746b5ff3-8bde-4e73-a1ee-602bfa026e09&quot;,&quot;parentUUID&quot;:&quot;44a37bae-e0a1-44c1-9ed4-95d756050355&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should show error when trying to change status of a system account&quot;,&quot;fullTitle&quot;:&quot;Account Change Status PUT API should show error when trying to change status of a system account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst chartOfAccountData = {\n  name: \&quot;System Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: true,\n};\nconst chartOfAccount = await prismaAccounting.ChartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst CoAID = chartOfAccount.id;\nconst testData = {\n  accountName: \&quot;System Account\&quot;,\n  identifier: \&quot;ACC-001\&quot;,\n  status: \&quot;FULL_ACTIVE\&quot;,\n  chartOfAccount: {\n    connect: {\n      id: CoAID,\n    },\n  },\n};\nconst createdAccount = await prismaAccounting.UserAccount.create({\n  data: testData,\n});\nconst accountID = createdAccount.id;\nconst AccountStatusChangeData = {\n  status: \&quot;LIMITED_ACTIVE\&quot;,\n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;PUT\&quot;)\n  .withPath(\n    `${ApiUrls.apiBaseUrl}${ApiUrls.changeAccountStatus}${accountID}/status-update`\n  )\n  .withBearerToken(token)\n  .withJson(AccountStatusChangeData)\n  .expectStatus(404);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7b799989-83cb-45df-92a9-7b5e75da94d7&quot;,&quot;parentUUID&quot;:&quot;44a37bae-e0a1-44c1-9ed4-95d756050355&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;f835bd87-6b4a-467a-99f0-92de96f6ca0e&quot;,&quot;bcbf299a-1e95-4b2c-8f62-55aa187b4c30&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;ab31cfd8-c822-444a-b7f2-9643098dbc13&quot;,&quot;746b5ff3-8bde-4e73-a1ee-602bfa026e09&quot;,&quot;7b799989-83cb-45df-92a9-7b5e75da94d7&quot;],&quot;duration&quot;:3599,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c3ab6f48-682a-4939-991f-a99546acdb5f&quot;,&quot;title&quot;:&quot;Account Details GET API: apiUrl&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/accountManagement/getAccountDetails.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/accountManagement/getAccountDetails.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Account Details GET API: apiUrl\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Details GET API: apiUrl \&quot;before all\&quot; hook in \&quot;Account Details GET API: apiUrl\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bfb7c6e5-7c3c-4ddf-89ac-c508804a2776&quot;,&quot;parentUUID&quot;:&quot;c3ab6f48-682a-4939-991f-a99546acdb5f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Account Details GET API: apiUrl\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Details GET API: apiUrl \&quot;before each\&quot; hook in \&quot;Account Details GET API: apiUrl\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:182,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.Ledger.deleteMany({});\nawait prismaAccounting.Transaction.deleteMany({});\nawait prismaAccounting.TransactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.TransactionType.deleteMany({});\nawait prismaAccounting. transactionLegLog.deleteMany({});\nawait prismaAccounting.TransactionLeg.deleteMany({});\nawait prismaAccounting.UserAccount.deleteMany({});\nawait prismaAccounting.ChartOfAccountLog.deleteMany({});\nawait prismaAccounting.ChartOfAccount.deleteMany({});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;98eee0e1-32d5-4f2e-a56c-8c36cd5ca19f&quot;,&quot;parentUUID&quot;:&quot;c3ab6f48-682a-4939-991f-a99546acdb5f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Account Details GET API: apiUrl\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Details GET API: apiUrl \&quot;after all\&quot; hook in \&quot;Account Details GET API: apiUrl\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;36b3ea7e-05ba-4b81-a943-a4fbeef9cf29&quot;,&quot;parentUUID&quot;:&quot;c3ab6f48-682a-4939-991f-a99546acdb5f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get user details successfully&quot;,&quot;fullTitle&quot;:&quot;Account Details GET API: apiUrl should get user details successfully&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:2001,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst chartOfAccountData = {\n  name: \&quot;Sample Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: false,\n};\nconst chartOfAccount = await prismaAccounting.ChartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst CoAID = chartOfAccount.id;\nconst testData = {\n  accountName: \&quot;John\&quot;,\n  identifier: \&quot;01711699870\&quot;,\n  status: \&quot;FULL_ACTIVE\&quot;,\n  chartOfAccount: {\n    connect: {\n      id: CoAID,\n    },\n  },\n  dailyLimitCount: 100,\n  monthlyLimitCount: 1000,\n  dailyLimitAmount: 100000,\n  monthlyLimitAmount: 1000000,\n  weeklyLimitAmount: 500,\n  weeklyLimitCount: 50,\n  maxWalletAmount: 1000,\n  minWalletAmount: 0,\n};\nconst createdAccount = await prismaAccounting.UserAccount.create({\n  data: testData,\n});\nconst accountID = createdAccount.id;\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountDetails}${accountID}`)\n  .withBearerToken(token)\n  .expectStatus(200);\n  console.log\nexpect(response.body.id).to.equal(accountID);\nexpect(response.body.name).to.equal(createdAccount.accountName);\nexpect(response.body.identifier).to.equal(createdAccount.identifier);\nexpect(response.body.status).to.equal(createdAccount.status);\nexpect(response.body.chartofaccount.id).to.equal(CoAID);\nexpect(response.body.dailylimit.count).to.equal(createdAccount.dailyLimitCount);\nexpect(response.body.monthlylimit.count).to.equal(createdAccount.monthlyLimitCount);\nexpect(response.body.dailylimit.amount).to.equal(createdAccount.dailyLimitAmount);\nexpect(response.body.monthlylimit.amount).to.equal(createdAccount.monthlyLimitAmount);\nexpect(response.body.minwalletamount).to.equal(createdAccount.minWalletAmount);\nexpect(response.body.weeklylimit.count).to.equal(createdAccount.weeklyLimitCount);\nexpect(response.body.weeklylimit.amount).to.equal(createdAccount.weeklyLimitAmount);\nexpect(response.body.maxwalletamount).to.equal(createdAccount.maxWalletAmount);\nexpect(createdAccount.aitPercentage).to.equal(2.5);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/accounting/accountManagement/getAccountDetails.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/accounting/accountManagement/getAccountDetails.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;a088a874-3156-469f-b2dd-2842fa0dd0ad&quot;,&quot;parentUUID&quot;:&quot;c3ab6f48-682a-4939-991f-a99546acdb5f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if the user is not logged in&quot;,&quot;fullTitle&quot;:&quot;Account Details GET API: apiUrl should show error if the user is not logged in&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:235,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const chartOfAccountData = {\n  name: \&quot;Sample Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: false,\n};\nconst chartOfAccount = await prismaAccounting.ChartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst CoAID = chartOfAccount.id;\nconst testData = {\n  accountName: \&quot;John\&quot;,\n  identifier: \&quot;01711699870\&quot;,\n  status: \&quot;FULL_ACTIVE\&quot;,\n  chartOfAccount: {\n    connect: {\n      id: CoAID,\n    },\n  },\n};\nconst createdAccount = await prismaAccounting.UserAccount.create({\n  data: testData,\n});\nconst accountID = createdAccount.id;\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountDetails}${accountID}`)\n  .expectStatus(403);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b1b73b26-1bf3-42ff-9ac9-4e64dd0dbc21&quot;,&quot;parentUUID&quot;:&quot;c3ab6f48-682a-4939-991f-a99546acdb5f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if the account ID does not exist&quot;,&quot;fullTitle&quot;:&quot;Account Details GET API: apiUrl should show error if the account ID does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst accountID = 111;\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountDetails}${accountID}`)\n  .withBearerToken(token)\n  .expectStatus(404);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;14a5de80-64cf-4d38-91b1-454ba7fcaf11&quot;,&quot;parentUUID&quot;:&quot;c3ab6f48-682a-4939-991f-a99546acdb5f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b1b73b26-1bf3-42ff-9ac9-4e64dd0dbc21&quot;,&quot;14a5de80-64cf-4d38-91b1-454ba7fcaf11&quot;],&quot;failures&quot;:[&quot;a088a874-3156-469f-b2dd-2842fa0dd0ad&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2256,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;83fc42df-1d16-45e2-a708-695146c1f8ba&quot;,&quot;title&quot;:&quot;Account LIST GET API: apiUrl&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/accountManagement/getAccountList.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/accountManagement/getAccountList.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Account LIST GET API: apiUrl\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account LIST GET API: apiUrl \&quot;before all\&quot; hook in \&quot;Account LIST GET API: apiUrl\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b798b85f-568b-4d7e-9644-5b4c4a392567&quot;,&quot;parentUUID&quot;:&quot;83fc42df-1d16-45e2-a708-695146c1f8ba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Account LIST GET API: apiUrl\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account LIST GET API: apiUrl \&quot;before each\&quot; hook in \&quot;Account LIST GET API: apiUrl\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:265,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.Ledger.deleteMany({});\nawait prismaAccounting.Transaction.deleteMany({});\nawait prismaAccounting.TransactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.TransactionType.deleteMany({});\nawait prismaAccounting. transactionLegLog.deleteMany({});\nawait prismaAccounting.TransactionLeg.deleteMany({});\nawait prismaAccounting.UserAccount.deleteMany({});\nawait prismaAccounting.ChartOfAccountLog.deleteMany({});\nawait prismaAccounting.ChartOfAccount.deleteMany({});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;29325fbd-f49c-4e54-8c2c-d99b7497959a&quot;,&quot;parentUUID&quot;:&quot;83fc42df-1d16-45e2-a708-695146c1f8ba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Account LIST GET API: apiUrl\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account LIST GET API: apiUrl \&quot;after all\&quot; hook in \&quot;Account LIST GET API: apiUrl\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;09aa8e2d-e200-43a0-a2e3-af55b12d6e24&quot;,&quot;parentUUID&quot;:&quot;83fc42df-1d16-45e2-a708-695146c1f8ba&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get user accounts LIST successfully&quot;,&quot;fullTitle&quot;:&quot;Account LIST GET API: apiUrl should get user accounts LIST successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:279,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst chartOfAccountData = {\n  name: \&quot;Sample Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: false,\n};\nconst chartOfAccount = await prismaAccounting.ChartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst CoAID = chartOfAccount.id;\nconst testData1 = {\n  accountName: \&quot;John\&quot;,\n  identifier: \&quot;01711699870\&quot;,\n  status: \&quot;FULL_ACTIVE\&quot;,\n  chartOfAccount_id: CoAID,\n};\nconst testData2 = {\n  accountName: \&quot;John Doe\&quot;,\n  identifier: \&quot;01711699871\&quot;,\n  status: \&quot;FULL_ACTIVE\&quot;,\n  chartOfAccount_id: CoAID,\n};\nconst testData3 = {\n  accountName: \&quot;Johny Depp\&quot;,\n  identifier: \&quot;01711699879\&quot;,\n  status: \&quot;FULL_ACTIVE\&quot;,\n  chartOfAccount_id: CoAID,\n};\nawait prismaAccounting.UserAccount.createMany({\n  data: [testData1, testData2, testData3],\n});\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountList}`)\n  .withBearerToken(token)\n  .expectStatus(200);\nexpect(response.body.accounts).to.have.lengthOf(3);\nexpect(response.body.accounts[0].name).to.equal(\&quot;John\&quot;);\nexpect(response.body.accounts[0].identifier).to.equal(\&quot;01711699870\&quot;);\nexpect(response.body.accounts[0].chartofaccount.id).to.equal(CoAID);\nexpect(response.body.accounts[0].chartofaccount.name).to.equal(\n  \&quot;Sample Account Name\&quot;\n);\nexpect(response.body.accounts[0].status).to.equal(\&quot;FULL_ACTIVE\&quot;);\nexpect(response.body.accounts[1].name).to.equal(\&quot;John Doe\&quot;);\nexpect(response.body.accounts[1].identifier).to.equal(\&quot;01711699871\&quot;);\nexpect(response.body.accounts[1].chartofaccount.name).to.equal(\n  \&quot;Sample Account Name\&quot;\n);\nexpect(response.body.accounts[1].status).to.equal(\&quot;FULL_ACTIVE\&quot;);\nexpect(response.body.accounts[2].name).to.equal(\&quot;Johny Depp\&quot;);\nexpect(response.body.accounts[2].identifier).to.equal(\&quot;01711699879\&quot;);\nexpect(response.body.accounts[2].chartofaccount.name).to.equal(\n  \&quot;Sample Account Name\&quot;\n);\nexpect(response.body.accounts[2].status).to.equal(\&quot;FULL_ACTIVE\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e1ac1ee7-71ce-4db6-bf4a-5bbdc0cd2ebb&quot;,&quot;parentUUID&quot;:&quot;83fc42df-1d16-45e2-a708-695146c1f8ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if the user is not logged in&quot;,&quot;fullTitle&quot;:&quot;Account LIST GET API: apiUrl should show error if the user is not logged in&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:273,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const chartOfAccountData = {\n  name: \&quot;Sample Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: false,\n};\nconst chartOfAccount = await prismaAccounting.ChartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst CoAID = chartOfAccount.id;\nconst testData = {\n  accountName: \&quot;John\&quot;,\n  identifier: \&quot;01711699870\&quot;,\n  chartOfAccount_id: CoAID,\n};\nawait prismaAccounting.UserAccount.createMany({\n  data: testData,\n});\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountList}`)\n  .expectStatus(403);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;31a2d3f4-2998-4c19-af05-b43e030f62ed&quot;,&quot;parentUUID&quot;:&quot;83fc42df-1d16-45e2-a708-695146c1f8ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show only 10 accounts in the account List &quot;,&quot;fullTitle&quot;:&quot;Account LIST GET API: apiUrl should show only 10 accounts in the account List &quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:546,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await userAccountsDb();\nconst users = await prismaAccounting.UserAccount.findMany({});\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountList}`)\n  .withBearerToken(token)\n  .expectStatus(200);\nexpect(response.body.accounts).to.have.lengthOf(10);\nexpect(response.body.pagination.currentpage).to.equal(0);\nexpect(response.body.pagination.currentpagetotalcount).to.equal(10);\nexpect(response.body.pagination.hasnext).to.equal(true);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0547ebf8-7a00-4032-a783-01774cdf8346&quot;,&quot;parentUUID&quot;:&quot;83fc42df-1d16-45e2-a708-695146c1f8ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show the remaining accounts in next page when the account list exceeds the count shown in one page&quot;,&quot;fullTitle&quot;:&quot;Account LIST GET API: apiUrl should show the remaining accounts in next page when the account list exceeds the count shown in one page&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:445,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await userAccountsDb();\nconst users = await prismaAccounting.UserAccount.findMany({});\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getAccountList}?page=1`)\n  .withBearerToken(token)\n  .expectStatus(200);\nexpect(response.body.accounts).to.have.lengthOf(2);\nexpect(response.body.pagination.currentpage).to.equal(1);\nexpect(response.body.pagination.currentpagetotalcount).to.equal(2);\nexpect(response.body.pagination.hasnext).to.equal(false);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;60754970-9265-40ee-b747-ea681643512a&quot;,&quot;parentUUID&quot;:&quot;83fc42df-1d16-45e2-a708-695146c1f8ba&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e1ac1ee7-71ce-4db6-bf4a-5bbdc0cd2ebb&quot;,&quot;31a2d3f4-2998-4c19-af05-b43e030f62ed&quot;,&quot;0547ebf8-7a00-4032-a783-01774cdf8346&quot;,&quot;60754970-9265-40ee-b747-ea681643512a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1543,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7f36d066-9a58-4944-b558-8df4a48ee99b&quot;,&quot;title&quot;:&quot;Account Details Update API&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/accountManagement/updateAccountDetails.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/accountManagement/updateAccountDetails.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Account Details Update API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Details Update API \&quot;before all\&quot; hook in \&quot;Account Details Update API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fcae2586-71fd-4ac5-8485-0af2b71f7581&quot;,&quot;parentUUID&quot;:&quot;7f36d066-9a58-4944-b558-8df4a48ee99b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Account Details Update API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Details Update API \&quot;before each\&quot; hook in \&quot;Account Details Update API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:409,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.Ledger.deleteMany({});\nawait prismaAccounting.Transaction.deleteMany({});\nawait prismaAccounting.TransactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.TransactionType.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.TransactionLeg.deleteMany({});\nawait prismaAccounting.UserAccount.deleteMany({});\nawait prismaAccounting.AccountLog.deleteMany({});\nawait prismaAccounting.ChartOfAccountLog.deleteMany({});\nawait prismaAccounting.ChartOfAccount.deleteMany({});\nconst chartOfAccountData = {\n  name: \&quot;Sample Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: false,\n};\nconst chartOfAccount = await prismaAccounting.ChartOfAccount.create({\n  data: chartOfAccountData,\n});\nCoAID = chartOfAccount.id;\nconst initialAccountData = {\n  accountName: \&quot;John\&quot;,\n  identifier: \&quot;01747538382\&quot;,\n  status: \&quot;LIMITED_ACTIVE\&quot;,\n  chartOfAccount: {\n    connect: {\n      id: CoAID,\n    },\n  },\n  minWalletAmount: 100,\n  dailyLimitCount: 10,\n  dailyLimitAmount: 1000,\n  monthlyLimitCount: 100,\n  monthlyLimitAmount: 1000,\n  maxWalletAmount: 1000,\n  weeklyLimitCount: 10,\n  weeklyLimitAmount: 100,\n  aitPercentage: 2.5\n};\nconst createdAccount = await prismaAccounting.UserAccount.create({\n  data: initialAccountData,\n});\naccountID = createdAccount.id;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4e22c695-7316-4ec9-b2b4-8fb8a2ad0dae&quot;,&quot;parentUUID&quot;:&quot;7f36d066-9a58-4944-b558-8df4a48ee99b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Account Details Update API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Details Update API \&quot;after all\&quot; hook in \&quot;Account Details Update API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:135,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\n  await prismaAccounting.AccountLog.deleteMany({});\n  await prismaAccounting.UserAccount.deleteMany({});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8c5d580c-53ae-4062-89f7-d559fbb6d6aa&quot;,&quot;parentUUID&quot;:&quot;7f36d066-9a58-4944-b558-8df4a48ee99b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should update user details successfully&quot;,&quot;fullTitle&quot;:&quot;Account Details Update API should update user details successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:149,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const updatedAccountData = {\n  accountName: \&quot;cccccccccc\&quot;,\n  minWalletAmount: 500,\n  dailyLimit: {\n    count: 50,\n    amount: 5000,\n  },\n  monthlyLimit: {\n    count: 500,\n    amount: 5000,\n  },\n  weeklyLimit: {\n    count: 500,\n    amount: 5000,\n  },\n  maxWalletAmount: 5000,\n  aitPercentage: 3.5\n};\nconst adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;PUT\&quot;)\n  .withPath(\n    `${ApiUrls.apiBaseUrl}${ApiUrls.updateAccountDetails}${accountID}/limit-update`\n  )\n  .withBearerToken(token)\n  .withJson(updatedAccountData)\n  .expectStatus(200);\nawait new Promise((resolve) =&gt; setTimeout(resolve, 500));\nconst updatedAccount = await prismaAccounting.UserAccount.findUnique({\n  where: { id: accountID },\n});\nexpect(updatedAccount).to.not.be.null;\nexpect(updatedAccount.accountName).to.equal(updatedAccountData.accountName);\nexpect(updatedAccount.minWalletAmount).to.equal(\n  updatedAccountData.minWalletAmount\n);\nexpect(updatedAccount.maxWalletAmount).to.equal(\n  updatedAccountData.maxWalletAmount\n);\nexpect(updatedAccount.dailyLimitAmount).to.equal(\n  updatedAccountData.dailyLimit.amount\n);\nexpect(updatedAccount.dailyLimitCount).to.equal(\n  updatedAccountData.dailyLimit.count\n);\nexpect(updatedAccount.weeklyLimitAmount).to.equal(\n  updatedAccountData.weeklyLimit.amount\n);\nexpect(updatedAccount.weeklyLimitCount).to.equal(\n  updatedAccountData.weeklyLimit.count\n);\nexpect(updatedAccount.monthlyLimitAmount).to.equal(\n  updatedAccountData.monthlyLimit.amount\n);\nexpect(updatedAccount.monthlyLimitCount).to.equal(\n  updatedAccountData.monthlyLimit.count\n);\nexpect(updatedAccount.chartOfAccount_id).to.equal(CoAID);\nexpect(updatedAccount.aitPercentage).to.equal(updatedAccountData.aitPercentage);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 200\n\n500 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 200\n\n500 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 200\n&quot;},&quot;uuid&quot;:&quot;5cd0704c-f1e4-41c4-bce8-d02b10d67889&quot;,&quot;parentUUID&quot;:&quot;7f36d066-9a58-4944-b558-8df4a48ee99b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if the user is not logged in&quot;,&quot;fullTitle&quot;:&quot;Account Details Update API should show error if the user is not logged in&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const updatedAccountData = {\n      accountName: \&quot;bbbbbbb\&quot;,\n      minWalletAmount: 100,\n      dailyLimit: {\n        count: 10,\n      },\n      monthlyLimit: {\n        count: 100,\n      },\n    };\n    const response = await pactum\n      .spec()\n      .withMethod(\&quot;PUT\&quot;)\n      .withPath(\n        `${ApiUrls.apiBaseUrl}${ApiUrls.updateAccountDetails}${accountID}/limit-update`\n      )\n      .withJson(updatedAccountData)\n      .expectStatus(403);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;42fcd2a1-3a80-4d68-a5c8-be3ced54f710&quot;,&quot;parentUUID&quot;:&quot;7f36d066-9a58-4944-b558-8df4a48ee99b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if the account ID does not exist&quot;,&quot;fullTitle&quot;:&quot;Account Details Update API should show error if the account ID does not exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:128,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst accountID = 1111111;\nconst updatedAccountData = {\n  accountName: \&quot;bbbbbbb\&quot;,\n  minWalletAmount: 100,\n  dailyLimit: {\n    count: 10,\n    amount: 5000,\n  },\n  monthlyLimit: {\n    count: 100,\n    amount: 5000,\n  },\n  weeklyLimit: {\n    count: 500,\n    amount: 5000,\n  },\n};\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;PUT\&quot;)\n  .withPath(\n    `${ApiUrls.apiBaseUrl}${ApiUrls.updateAccountDetails}${accountID}/limit-update`\n  )\n  .withJson(updatedAccountData)\n  .withBearerToken(token)\n  .expectStatus(404);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 404\n\n500 !== 404\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 404\n\n500 !== 404\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 404\n&quot;},&quot;uuid&quot;:&quot;b9a1c77d-0172-4a07-a905-d71e354621fa&quot;,&quot;parentUUID&quot;:&quot;7f36d066-9a58-4944-b558-8df4a48ee99b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should check logs for updating account&quot;,&quot;fullTitle&quot;:&quot;Account Details Update API should check logs for updating account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:177,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const updatedAccountData = {\n      accountName: \&quot;John\&quot;,\n      dailyLimit: { count: 50, amount: 5000 },\n      monthlyLimit: { count: 500, amount: 5000 },\n      weeklyLimit: { count: 500, amount: 5000 },\n      maxWalletAmount: 5000,\n      minWalletAmount: 600,\n    };\n    const adminUser = {\n      email: \&quot;admin@ppay.com\&quot;,\n      roles: \&quot;Admin\&quot;,\n      adminRole: \&quot;ADMIN\&quot;,\n    };\n    token = generateToken(\n      1,\n      adminUser.email,\n      adminUser.roles,\n      adminUser.adminRole\n    );\n    const response = await pactum\n      .spec()\n      .withMethod(\&quot;PUT\&quot;)\n      .withPath(\n        `${ApiUrls.apiBaseUrl}${ApiUrls.updateAccountDetails}${accountID}/limit-update`\n      )\n      .withBearerToken(token)\n      .withJson(updatedAccountData)\n      .expectStatus(200);\n    await new Promise((resolve) =&gt; setTimeout(resolve, 500));\n    const updatedAccount = await prismaAccounting.UserAccount.findUnique({\n      where: { id: accountID },\n    });\n    const logEntry = await prismaAccounting.AccountLog.findMany({\n      where: {\n        accountId: BigInt(accountID),\n      },\n      orderBy: {\n        createdAt: \&quot;desc\&quot;,\n      },\n    });\n    expect(logEntry[0].accountName).to.equal(\&quot;John\&quot;);\n    expect(Number(logEntry[0].minWalletAmount)).to.equal(600);\n    expect(Number(logEntry[0].dailyLimitCount)).to.equal(50);\n    expect(Number(logEntry[0].dailyLimitAmount)).to.equal(5000);\n    expect(Number(logEntry[0].weeklyLimitCount)).to.equal(500);\n    expect(Number(logEntry[0].weeklyLimitAmount)).to.equal(5000);\n    expect(Number(logEntry[0].monthlyLimitCount)).to.equal(500);\n    expect(Number(logEntry[0].monthlyLimitAmount)).to.equal(5000);\n    expect(Number(logEntry[0].maxWalletAmount)).to.equal(5000);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 200\n\n500 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 200\n\n500 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 200\n&quot;},&quot;uuid&quot;:&quot;7c2bf84e-841c-4614-9b74-2569b891c523&quot;,&quot;parentUUID&quot;:&quot;7f36d066-9a58-4944-b558-8df4a48ee99b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;42fcd2a1-3a80-4d68-a5c8-be3ced54f710&quot;],&quot;failures&quot;:[&quot;5cd0704c-f1e4-41c4-bce8-d02b10d67889&quot;,&quot;b9a1c77d-0172-4a07-a905-d71e354621fa&quot;,&quot;7c2bf84e-841c-4614-9b74-2569b891c523&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:465,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ec5c8284-bd75-4e25-87e6-a64de58eab20&quot;,&quot;title&quot;:&quot;Create Chart of Account API Tests (POST /v1/chart-of-account)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/chartOfAccount/createChartOfAccount.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/chartOfAccount/createChartOfAccount.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Create Chart of Account API Tests (POST /v1/chart-of-account)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Create Chart of Account API Tests (POST /v1/chart-of-account) \&quot;before all\&quot; hook in \&quot;Create Chart of Account API Tests (POST /v1/chart-of-account)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await Promise.all([prismaAuth.$connect(), prismaAccounting.$connect()]);\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;22e6ec96-fa3c-4e2e-8250-946e8fe7dca4&quot;,&quot;parentUUID&quot;:&quot;ec5c8284-bd75-4e25-87e6-a64de58eab20&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Create Chart of Account API Tests (POST /v1/chart-of-account)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Create Chart of Account API Tests (POST /v1/chart-of-account) \&quot;before each\&quot; hook in \&quot;Create Chart of Account API Tests (POST /v1/chart-of-account)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$transaction([\n  prismaAccounting.ledger.deleteMany(),\n  prismaAccounting.transaction.deleteMany(),\n  prismaAccounting. transactionLegLog.deleteMany(),\n  prismaAccounting. transactionLeg.deleteMany(),\n  prismaAccounting.transactionTypeChangeLog.deleteMany(),\n  prismaAccounting.transactionType.deleteMany(),\n  prismaAccounting.userAccount.deleteMany(),\n  prismaAccounting.chartOfAccountLog.deleteMany(),\n  prismaAccounting.chartOfAccount.deleteMany(),\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;29444238-c7bf-46c1-ac31-d663abe12a4b&quot;,&quot;parentUUID&quot;:&quot;ec5c8284-bd75-4e25-87e6-a64de58eab20&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Create Chart of Account API Tests (POST /v1/chart-of-account)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Create Chart of Account API Tests (POST /v1/chart-of-account) \&quot;after all\&quot; hook in \&quot;Create Chart of Account API Tests (POST /v1/chart-of-account)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await Promise.all([\n  prismaAuth.$disconnect(),\n  prismaAccounting.$disconnect(),\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0f62fd59-c051-4aba-a0b6-42c00705659c&quot;,&quot;parentUUID&quot;:&quot;ec5c8284-bd75-4e25-87e6-a64de58eab20&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create a new chart of account&quot;,&quot;fullTitle&quot;:&quot;Create Chart of Account API Tests (POST /v1/chart-of-account) should create a new chart of account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:171,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await makeRequest(sampleCharOfAccount).expectStatus(201);\nconst createdCoA = await prismaAccounting.chartOfAccount.findFirst({\n  where: { code: sampleCharOfAccount.code },\n});\nexpect(createdCoA).to.not.be.null;\nexpect(createdCoA).to.include({\n  name: sampleCharOfAccount.name,\n  description: sampleCharOfAccount.description,\n  transactionType: sampleCharOfAccount.transactionType,\n  headType: sampleCharOfAccount.headType,\n  code: sampleCharOfAccount.code,\n  onlyParent: sampleCharOfAccount.onlyParent,\n  minWalletAmount: sampleCharOfAccount.minWalletAmount,\n  maxWalletAmount: sampleCharOfAccount.maxWalletAmount,\n});\nexpect(createdCoA.dailyLimitCount).to.deep.equal(\n  sampleCharOfAccount.dailyLimit.count\n);\nexpect(createdCoA.weeklyLimitCount).to.deep.equal(\n  sampleCharOfAccount.weeklyLimit.count\n);\nexpect(createdCoA.monthlyLimitCount).to.deep.equal(\n  sampleCharOfAccount.monthlyLimit.count\n);\nexpect(createdCoA.dailyLimitAmount).to.deep.equal(\n  sampleCharOfAccount.dailyLimit.amount\n);\nexpect(createdCoA.weeklyLimitAmount).to.deep.equal(\n  sampleCharOfAccount.weeklyLimit.amount\n);\nexpect(createdCoA.monthlyLimitAmount).to.deep.equal(\n  sampleCharOfAccount.monthlyLimit.amount\n);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected null not to be null&quot;,&quot;estack&quot;:&quot;AssertionError: expected null not to be null\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/accounting/chartOfAccount/createChartOfAccount.test.js:103:33)&quot;},&quot;uuid&quot;:&quot;41281f56-f27e-4a1e-b5e5-0ef8e78ee9ef&quot;,&quot;parentUUID&quot;:&quot;ec5c8284-bd75-4e25-87e6-a64de58eab20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should create a new chart of account when limits are not inserted&quot;,&quot;fullTitle&quot;:&quot;Create Chart of Account API Tests (POST /v1/chart-of-account) should create a new chart of account when limits are not inserted&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:482,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const sampleCoA2 = {\n  name: \&quot;Sample Account Name\&quot;,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-4002\&quot;,\n  onlyParent: false,\n};\nawait makeRequest(sampleCoA2).expectStatus(201);\nconst createdCoA = await prismaAccounting.chartOfAccount.findFirst({\n  where: { code: sampleCharOfAccount.code },\n});\nexpect(createdCoA).to.not.be.null;\nexpect(createdCoA).to.include({\n  name: sampleCharOfAccount.name,\n  description: sampleCharOfAccount.description,\n  transactionType: sampleCharOfAccount.transactionType,\n  headType: sampleCharOfAccount.headType,\n  code: sampleCharOfAccount.code,\n  onlyParent: sampleCharOfAccount.onlyParent\n});\nexpect(createdCoA.minWalletAmount).to.be.null;\nexpect(createdCoA.maxWalletAmount).to.be.null;\nexpect(createdCoA.dailyLimitCount).to.be.null;\nexpect(createdCoA.weeklyLimitCount).to.be.null;\nexpect(createdCoA.monthlyLimitCount).to.be.null;\nexpect(createdCoA.dailyLimitAmount).to.be.null;\nexpect(createdCoA.weeklyLimitAmount).to.be.null;\nexpect(createdCoA.monthlyLimitAmount).to.be.null;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e37d1adb-6d94-4bb1-980a-b2a45c6305c1&quot;,&quot;parentUUID&quot;:&quot;ec5c8284-bd75-4e25-87e6-a64de58eab20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for negative values input in CoA&quot;,&quot;fullTitle&quot;:&quot;Create Chart of Account API Tests (POST /v1/chart-of-account) should return 400 for negative values input in CoA&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const invalidInput = {\n  ...sampleCharOfAccount,\n  dailyLimit: {\n    count: -20,\n    amount: -30,\n  },\n  monthlyLimit: {\n    count: -20,\n    amount: -30,\n  },\n  weeklyLimit: {\n    count: -20,\n    amount: -30,\n  },\n  minWalletAmount: -600,\n  maxWalletAmount: -1200,\n};\nawait makeRequest(invalidInput).expectStatus(400);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a3780fee-0cd8-4e9e-884e-697b12ecd308&quot;,&quot;parentUUID&quot;:&quot;ec5c8284-bd75-4e25-87e6-a64de58eab20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 409 if the code is already taken&quot;,&quot;fullTitle&quot;:&quot;Create Chart of Account API Tests (POST /v1/chart-of-account) should return 409 if the code is already taken&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:194,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.chartOfAccount.create({\n  data: getPrismaData(sampleCharOfAccount),\n});\nawait makeRequest(sampleCharOfAccount).expectStatus(409);\nconst accounts = await prismaAccounting.chartOfAccount.findMany({\n  where: { code: sampleCharOfAccount.code },\n});\nexpect(accounts).to.have.lengthOf(1);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 409\n\n201 !== 409\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 409\n\n201 !== 409\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 409\n&quot;},&quot;uuid&quot;:&quot;a0ba2999-b715-4af8-b2e1-36459d90f16e&quot;,&quot;parentUUID&quot;:&quot;ec5c8284-bd75-4e25-87e6-a64de58eab20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should create chart of account and user account when onlyParent is true&quot;,&quot;fullTitle&quot;:&quot;Create Chart of Account API Tests (POST /v1/chart-of-account) should create chart of account and user account when onlyParent is true&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:539,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const chartData = { ...sampleCharOfAccount, onlyParent: true };\nawait makeRequest(chartData).expectStatus(201);\nconst createdCoA = await prismaAccounting.chartOfAccount.findFirst({\n  where: { code: chartData.code },\n});\nexpect(createdCoA).to.not.be.null;\nconst userAccount = await prismaAccounting.userAccount.findFirst({\n  where: { chartOfAccount_id: createdCoA.id },\n});\nexpect(userAccount).to.not.be.null;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1df200d7-5c3a-4ba8-a455-079e6ba5b04b&quot;,&quot;parentUUID&quot;:&quot;ec5c8284-bd75-4e25-87e6-a64de58eab20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not create user account when onlyParent is false&quot;,&quot;fullTitle&quot;:&quot;Create Chart of Account API Tests (POST /v1/chart-of-account) should not create user account when onlyParent is false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:148,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await makeRequest(sampleCharOfAccount).expectStatus(201);\nconst createdCoA = await prismaAccounting.chartOfAccount.findFirst({\n  where: { code: sampleCharOfAccount.code },\n});\nexpect(createdCoA).to.not.be.null;\nconst userAccount = await prismaAccounting.userAccount.findFirst({\n  where: { chartOfAccount_id: createdCoA.id },\n});\nexpect(userAccount).to.be.null;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected null not to be null&quot;,&quot;estack&quot;:&quot;AssertionError: expected null not to be null\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/accounting/chartOfAccount/createChartOfAccount.test.js:230:33)&quot;},&quot;uuid&quot;:&quot;6ba5a63d-a094-4286-82bf-948b663ea3d7&quot;,&quot;parentUUID&quot;:&quot;ec5c8284-bd75-4e25-87e6-a64de58eab20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should create appropriate logs for new chart of account&quot;,&quot;fullTitle&quot;:&quot;Create Chart of Account API Tests (POST /v1/chart-of-account) should create appropriate logs for new chart of account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:313,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await makeRequest(sampleCharOfAccount).expectStatus(201);\nconst logEntry = await prismaAccounting.chartOfAccountLog.findFirst({\n  where: { createdByAdminId: 1 },\n});\nexpect(logEntry).to.include({\n  changeType: \&quot;CREATE\&quot;,\n  oldValue: null,\n});\nexpect(logEntry.newValue).to.not.be.null;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3460fe17-7278-47fa-b262-365e44ef8c26&quot;,&quot;parentUUID&quot;:&quot;ec5c8284-bd75-4e25-87e6-a64de58eab20&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e37d1adb-6d94-4bb1-980a-b2a45c6305c1&quot;,&quot;a3780fee-0cd8-4e9e-884e-697b12ecd308&quot;,&quot;1df200d7-5c3a-4ba8-a455-079e6ba5b04b&quot;,&quot;3460fe17-7278-47fa-b262-365e44ef8c26&quot;],&quot;failures&quot;:[&quot;41281f56-f27e-4a1e-b5e5-0ef8e78ee9ef&quot;,&quot;a0ba2999-b715-4af8-b2e1-36459d90f16e&quot;,&quot;6ba5a63d-a094-4286-82bf-948b663ea3d7&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1862,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;892b8797-094d-4d4b-b1ee-d13275650727&quot;,&quot;title&quot;:&quot;GET Chart of Account API Tests (GET :/v1/chart-of-account)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/chartOfAccount/getChartOfAccount.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/chartOfAccount/getChartOfAccount.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;GET Chart of Account API Tests (GET :/v1/chart-of-account)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Chart of Account API Tests (GET :/v1/chart-of-account) \&quot;before all\&quot; hook in \&quot;GET Chart of Account API Tests (GET :/v1/chart-of-account)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await Promise.all([prismaAuth.$connect(), prismaAccounting.$connect()]);\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;da160359-144d-46a3-a1e0-133a007facef&quot;,&quot;parentUUID&quot;:&quot;892b8797-094d-4d4b-b1ee-d13275650727&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;GET Chart of Account API Tests (GET :/v1/chart-of-account)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Chart of Account API Tests (GET :/v1/chart-of-account) \&quot;before each\&quot; hook in \&quot;GET Chart of Account API Tests (GET :/v1/chart-of-account)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:192,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$transaction([\n  prismaAccounting.userAccount.deleteMany(),\n  prismaAccounting.chartOfAccount.deleteMany(),\n]);\nconst charOfAccounts = [\n  sampleCharOfAccount,\n  {\n    ...sampleCharOfAccount,\n    name: \&quot;Account B\&quot;,\n    code: \&quot;002\&quot;,\n    onlyParent: true,\n    adminId: 1,\n    description: \&quot;Description for Account 2\&quot;,\n  },\n];\nawait prismaAccounting.chartOfAccount.createMany({\n  data: charOfAccounts,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9a1cfce6-9561-44f3-8e17-6bc642f6ff88&quot;,&quot;parentUUID&quot;:&quot;892b8797-094d-4d4b-b1ee-d13275650727&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;GET Chart of Account API Tests (GET :/v1/chart-of-account)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Chart of Account API Tests (GET :/v1/chart-of-account) \&quot;after all\&quot; hook in \&quot;GET Chart of Account API Tests (GET :/v1/chart-of-account)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await Promise.all([\n  prismaAccounting.$disconnect(),\n  prismaAuth.$disconnect(),\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;49e7db39-2b42-4a9c-a346-ab2520e56a29&quot;,&quot;parentUUID&quot;:&quot;892b8797-094d-4d4b-b1ee-d13275650727&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return all Chart of Accounts&quot;,&quot;fullTitle&quot;:&quot;GET Chart of Account API Tests (GET :/v1/chart-of-account) should return all Chart of Accounts&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:31,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await makeGetRequest().expectStatus(200);\nconst dbAccounts = await prismaAccounting.chartOfAccount.findMany();\nexpect(response.body.chartofaccounts).to.have.lengthOf(dbAccounts.length);\ndbAccounts.forEach((account, index) =&gt; {\n  expect(response.body.chartofaccounts[index]).to.deep.include({\n    name: account.name,\n    description: account.description,\n    transactiontype: account.transactionType,\n    headtype: account.headType,\n    code: account.code,\n    onlyparent: account.onlyParent,\n  });\n});\nexpect(response.body.chartofaccounts[0].name).to.equal(sampleCharOfAccount.name);\nexpect(response.body.chartofaccounts[1].name).to.equal(\&quot;Account B\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b2a4947e-8366-4658-b059-8965b704d7e0&quot;,&quot;parentUUID&quot;:&quot;892b8797-094d-4d4b-b1ee-d13275650727&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b2a4947e-8366-4658-b059-8965b704d7e0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:31,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;c783a47e-beb3-4ad1-a88f-f34995322d09&quot;,&quot;title&quot;:&quot;GET Chart of Account Details API Tests (GET :/v1/chart-of-account/:id)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/chartOfAccount/getChartOfAccountDetail.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/chartOfAccount/getChartOfAccountDetail.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;GET Chart of Account Details API Tests (GET :/v1/chart-of-account/:id)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Chart of Account Details API Tests (GET :/v1/chart-of-account/:id) \&quot;before all\&quot; hook in \&quot;GET Chart of Account Details API Tests (GET :/v1/chart-of-account/:id)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await Promise.all([prismaAuth.$connect(), prismaAccounting.$connect()]);\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3882c02b-8598-4296-8aa3-c69ff3991470&quot;,&quot;parentUUID&quot;:&quot;c783a47e-beb3-4ad1-a88f-f34995322d09&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;GET Chart of Account Details API Tests (GET :/v1/chart-of-account/:id)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Chart of Account Details API Tests (GET :/v1/chart-of-account/:id) \&quot;before each\&quot; hook in \&quot;GET Chart of Account Details API Tests (GET :/v1/chart-of-account/:id)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:72,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$transaction([\n  prismaAccounting.userAccount.deleteMany(),\n  prismaAccounting.chartOfAccount.deleteMany(),\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7587eaae-e462-4ea7-a239-d9e0744ef790&quot;,&quot;parentUUID&quot;:&quot;c783a47e-beb3-4ad1-a88f-f34995322d09&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;GET Chart of Account Details API Tests (GET :/v1/chart-of-account/:id)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Chart of Account Details API Tests (GET :/v1/chart-of-account/:id) \&quot;after all\&quot; hook in \&quot;GET Chart of Account Details API Tests (GET :/v1/chart-of-account/:id)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await Promise.all([\n  prismaAuth.$disconnect(),\n  prismaAccounting.$disconnect(),\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;de19e309-7cb5-4355-9aa3-947452c36441&quot;,&quot;parentUUID&quot;:&quot;c783a47e-beb3-4ad1-a88f-f34995322d09&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return details of a Chart of Account&quot;,&quot;fullTitle&quot;:&quot;GET Chart of Account Details API Tests (GET :/v1/chart-of-account/:id) should return details of a Chart of Account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:136,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const dbCoA = await prismaAccounting.chartOfAccount.create({\n  data: sampleAccount,\n});\nconst response = await makeGetDetailsRequest(dbCoA.id).expectStatus(200);\nconst dbAccount = await prismaAccounting.chartOfAccount.findUnique({\n  where: { id: dbCoA.id },\n});\nexpect(response.body).to.include({\n  name: sampleAccount.name,\n  description: sampleAccount.description,\n  transactiontype: sampleAccount.transactionType,\n  headtype: sampleAccount.headType,\n  code: sampleAccount.code,\n  onlyparent: sampleAccount.onlyParent,\n  minwalletamount: sampleAccount.minWalletAmount,\n  maxwalletamount: sampleAccount.maxWalletAmount,\n});\nexpect(dbAccount.dailyLimitCount).to.equal(response.body.dailylimit.count);\nexpect(dbAccount.monthlyLimitCount).to.equal(response.body.monthlylimit.count);\nexpect(dbAccount.weeklyLimitCount).to.equal(response.body.weeklylimit.count);\nexpect(dbAccount.dailyLimitAmount).to.equal(response.body.dailylimit.amount);\nexpect(dbAccount.monthlyLimitAmount).to.equal(response.body.monthlylimit.amount);\nexpect(dbAccount.weeklyLimitAmount).to.equal(response.body.weeklylimit.amount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4d72817a-941c-4296-b46c-6ff57eb72f4e&quot;,&quot;parentUUID&quot;:&quot;c783a47e-beb3-4ad1-a88f-f34995322d09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4d72817a-941c-4296-b46c-6ff57eb72f4e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:136,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;856a4cba-9bd0-4416-9101-d668883d1458&quot;,&quot;title&quot;:&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/chartOfAccount/updateChartsOfAccount.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/chartOfAccount/updateChartsOfAccount.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account) \&quot;before all\&quot; hook in \&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await Promise.all([prismaAuth.$connect(), prismaAccounting.$connect()]);\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7cc259a9-3447-4c99-aa92-22b785a22804&quot;,&quot;parentUUID&quot;:&quot;856a4cba-9bd0-4416-9101-d668883d1458&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account) \&quot;before each\&quot; hook in \&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$transaction([\n  prismaAccounting.chartOfAccountLog.deleteMany(),\n  prismaAccounting.chartOfAccount.deleteMany(),\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;811519e9-2725-4511-a4ac-a3d25b7cdf9d&quot;,&quot;parentUUID&quot;:&quot;856a4cba-9bd0-4416-9101-d668883d1458&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account) \&quot;after all\&quot; hook in \&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await Promise.all([\n  prismaAccounting.$disconnect(),\n  prismaAuth.$disconnect(),\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;119e5c00-f3c2-4c3d-8270-b9133a33f479&quot;,&quot;parentUUID&quot;:&quot;856a4cba-9bd0-4416-9101-d668883d1458&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should update chart of account with valid fields&quot;,&quot;fullTitle&quot;:&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account) should update chart of account with valid fields&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:326,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const createdCoA = await createChartOfAccount(initialCoA);\nawait makeUpdateRequest(createdCoA.id, updatedFields).expectStatus(200);\nconst updatedCoADb = await prismaAccounting.chartOfAccount.findUnique({\n  where: { id: createdCoA.id },\n  select: {\n    name: true,\n    description: true,\n    code: true,\n    dailyLimitCount: true,\n    dailyLimitAmount: true,\n    monthlyLimitCount: true,\n    monthlyLimitAmount: true,\n    weeklyLimitCount:true,\n    weeklyLimitAmount:true,\n    minWalletAmount: true,\n    maxWalletAmount: true,\n  },\n});\n \nexpect(updatedCoADb.name).to.equal(updatedFields.name);\nexpect(updatedCoADb.description).to.equal(updatedFields.description);\nexpect(updatedCoADb.code).to.equal(updatedFields.code);\nexpect(updatedCoADb.dailyLimitCount).to.equal(updatedFields.dailyLimit.count);\nexpect(updatedCoADb.dailyLimitAmount).to.equal(updatedFields.dailyLimit.amount);\nexpect(updatedCoADb.weeklyLimitCount).to.equal(updatedFields.weeklyLimit.count);\nexpect(updatedCoADb.weeklyLimitAmount).to.equal(updatedFields.weeklyLimit.amount);\nexpect(updatedCoADb.monthlyLimitCount).to.equal(updatedFields.monthlyLimit.count);\nexpect(updatedCoADb.monthlyLimitAmount).to.equal(updatedFields.monthlyLimit.amount);\nexpect(updatedCoADb.minWalletAmount).to.equal(updatedFields.minWalletAmount);\nexpect(updatedCoADb.maxWalletAmount).to.equal(updatedFields.maxWalletAmount);\nconst duplicateCoA = await prismaAccounting.chartOfAccount.findMany({\n  where: { code: updatedFields.code },\n});\nexpect(duplicateCoA).to.have.lengthOf(1);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 200\n\n201 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 200\n\n201 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 200\n&quot;},&quot;uuid&quot;:&quot;9528adcd-183d-4947-b22b-f68d72c9bd24&quot;,&quot;parentUUID&quot;:&quot;856a4cba-9bd0-4416-9101-d668883d1458&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let user update CoA limits with negative values&quot;,&quot;fullTitle&quot;:&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account) should not let user update CoA limits with negative values&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:204,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const createdCoA = await createChartOfAccount(initialCoA);\nconst negFieldsForCoA = {\n  name: \&quot;Updated Account Name\&quot;,\n  description: \&quot;This is an updated description for the chart of account.\&quot;,\n  code: \&quot;ACC-002\&quot;,\n  dailyLimit: {\n    count: -10,\n    amount: -60,\n  },\n  monthlyLimit: {\n    count: -30,\n    amount: -50,\n  },\n  weeklyLimit: {\n    count: -20,\n    amount:- 30\n},\n  minWalletAmount: -300,\n  maxWalletAmount: -1500,\n};\nawait makeUpdateRequest(createdCoA.id, negFieldsForCoA).expectStatus(400);\nconst updatedCoADb = await prismaAccounting.chartOfAccount.findUnique({\n  where: { id: createdCoA.id },\n  select: {\n    name: true,\n    description: true,\n    code: true,\n    dailyLimitCount: true,\n    dailyLimitAmount: true,\n    monthlyLimitCount: true,\n    monthlyLimitAmount: true,\n    weeklyLimitCount:true,\n    weeklyLimitAmount:true,\n    minWalletAmount: true,\n    maxWalletAmount: true,\n  },\n});\n \nexpect(updatedCoADb.name).to.equal(initialCoA.name);\nexpect(updatedCoADb.description).to.equal(initialCoA.description);\nexpect(updatedCoADb.code).to.equal(initialCoA.code);\nexpect(updatedCoADb.dailyLimitCount).to.equal(initialCoA.dailyLimitCount);\nexpect(updatedCoADb.dailyLimitAmount).to.equal(initialCoA.dailyLimitAmount);\nexpect(updatedCoADb.weeklyLimitCount).to.equal(initialCoA.weeklyLimitCount);\nexpect(updatedCoADb.weeklyLimitAmount).to.equal(initialCoA.weeklyLimitAmount);\nexpect(updatedCoADb.monthlyLimitCount).to.equal(initialCoA.monthlyLimitCount);\nexpect(updatedCoADb.monthlyLimitAmount).to.equal(initialCoA.monthlyLimitAmount);\nexpect(updatedCoADb.minWalletAmount).to.equal(initialCoA.minWalletAmount);\nexpect(updatedCoADb.maxWalletAmount).to.equal(initialCoA.maxWalletAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1e821fe5-ac62-4985-afab-dbda334f9a7b&quot;,&quot;parentUUID&quot;:&quot;856a4cba-9bd0-4416-9101-d668883d1458&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get 200 if the user does not insert limits in CoA&quot;,&quot;fullTitle&quot;:&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account) should get 200 if the user does not insert limits in CoA&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:368,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const createdCoA = await createChartOfAccount(initialCoA);\nconst coAFieldsWithoutLimits = {\n  name: \&quot;Updated Account Name\&quot;,\n  description: \&quot;This is an updated description for the chart of account.\&quot;,\n  code: \&quot;ACC-002\&quot;,\n  dailyLimitCount: null,\n  dailyLimitAmount: null,\n  monthlyLimitAmount: null,\n  monthlyLimitCount: null,\n  weeklyLimitAmount: null,\n  weeklyLimitCount: null,\n  minWalletAmount: null,\n  maxWalletAmount: null,\n};\nawait makeUpdateRequest(createdCoA.id, coAFieldsWithoutLimits).expectStatus(200);\nconst updatedCoADb = await prismaAccounting.chartOfAccount.findUnique({\n  where: { id: createdCoA.id },\n  select: {\n    name: true,\n    description: true,\n    code: true,\n    dailyLimitCount: true,\n    dailyLimitAmount: true,\n    monthlyLimitCount: true,\n    monthlyLimitAmount: true,\n    weeklyLimitCount:true,\n    weeklyLimitAmount:true,\n    minWalletAmount: true,\n    maxWalletAmount: true,\n  },\n});\n \nexpect(updatedCoADb.name).to.equal(coAFieldsWithoutLimits.name);\nexpect(updatedCoADb.description).to.equal(coAFieldsWithoutLimits.description);\nexpect(updatedCoADb.code).to.equal(coAFieldsWithoutLimits.code);\nexpect(updatedCoADb.dailyLimitCount).to.be.null;\nexpect(updatedCoADb.dailyLimitAmount).to.be.null;\nexpect(updatedCoADb.weeklyLimitCount).to.be.null;\nexpect(updatedCoADb.weeklyLimitAmount).to.be.null;\nexpect(updatedCoADb.monthlyLimitCount).to.be.null;\nexpect(updatedCoADb.monthlyLimitAmount).to.be.null;\nexpect(updatedCoADb.minWalletAmount).to.be.null;\nexpect(updatedCoADb.maxWalletAmount).to.be.null;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 200\n\n201 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 200\n\n201 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 200\n&quot;},&quot;uuid&quot;:&quot;093a8a63-5a92-43ae-8278-da0d6de83169&quot;,&quot;parentUUID&quot;:&quot;856a4cba-9bd0-4416-9101-d668883d1458&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should create log entry after update&quot;,&quot;fullTitle&quot;:&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account) should create log entry after update&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const createdCoA = await createChartOfAccount(initialCoA);\nawait makeUpdateRequest(createdCoA.id, updatedFields).expectStatus(200);\nconst logEntry = await prismaAccounting.chartOfAccountLog.findFirst({\n  where: { createdByAdminId: 1 },\n});\nexpect(logEntry).to.include({\n  changeType: \&quot;UPDATE\&quot;,\n});\nexpect(logEntry.oldValue).to.not.be.null;\nexpect(logEntry.newValue).to.not.be.null;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 200\n\n201 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 200\n\n201 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 200\n&quot;},&quot;uuid&quot;:&quot;23f4d75f-61bb-4928-8742-0bd15d1b90db&quot;,&quot;parentUUID&quot;:&quot;856a4cba-9bd0-4416-9101-d668883d1458&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non-allowed field updates&quot;,&quot;fullTitle&quot;:&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account) should return 400 for non-allowed field updates&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const createdCoA = await createChartOfAccount(initialCoA);\nconst nonAllowedUpdates = {\n  onlyParent: true,\n  headType: \&quot;ASSET\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n};\nawait makeUpdateRequest(createdCoA.id, nonAllowedUpdates).expectStatus(200);\nconst unchanged = await prismaAccounting.chartOfAccount.findUnique({\n  where: { id: createdCoA.id },\n});\nexpect(unchanged.onlyParent).to.equal(initialCoA.onlyParent);\nexpect(unchanged.headType).to.equal(initialCoA.headType);\nexpect(unchanged.transactionType).to.equal(initialCoA.transactionType);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 200\n\n201 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 200\n\n201 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 200\n&quot;},&quot;uuid&quot;:&quot;ad19e2fb-8c30-4e22-b761-470f221eeefd&quot;,&quot;parentUUID&quot;:&quot;856a4cba-9bd0-4416-9101-d668883d1458&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 404 for non-existent chart of account&quot;,&quot;fullTitle&quot;:&quot;Update Chart of Account API Tests (PATCH :/v1/chart-of-account) should return 404 for non-existent chart of account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const nonExistentId = 99999;\nawait makeUpdateRequest(nonExistentId, updatedFields).expectStatus(404);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 404\n\n201 !== 404\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 404\n\n201 !== 404\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 404\n&quot;},&quot;uuid&quot;:&quot;46003311-13fb-470d-80ee-d586b422e774&quot;,&quot;parentUUID&quot;:&quot;856a4cba-9bd0-4416-9101-d668883d1458&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1e821fe5-ac62-4985-afab-dbda334f9a7b&quot;],&quot;failures&quot;:[&quot;9528adcd-183d-4947-b22b-f68d72c9bd24&quot;,&quot;093a8a63-5a92-43ae-8278-da0d6de83169&quot;,&quot;23f4d75f-61bb-4928-8742-0bd15d1b90db&quot;,&quot;ad19e2fb-8c30-4e22-b761-470f221eeefd&quot;,&quot;46003311-13fb-470d-80ee-d586b422e774&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:964,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3c4ab817-2e42-4996-8df8-22d9b2561e25&quot;,&quot;title&quot;:&quot;Enable or Disable Trxn Leg API Tests (PUT :v1/trxn-leg/change-status)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/transactionLeg/changeTrxLegStatus.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/transactionLeg/changeTrxLegStatus.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Enable or Disable Trxn Leg API Tests (PUT :v1/trxn-leg/change-status)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Enable or Disable Trxn Leg API Tests (PUT :v1/trxn-leg/change-status) \&quot;before all\&quot; hook in \&quot;Enable or Disable Trxn Leg API Tests (PUT :v1/trxn-leg/change-status)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3f30289d-4329-4336-b531-04774204e766&quot;,&quot;parentUUID&quot;:&quot;3c4ab817-2e42-4996-8df8-22d9b2561e25&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Enable or Disable Trxn Leg API Tests (PUT :v1/trxn-leg/change-status)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Enable or Disable Trxn Leg API Tests (PUT :v1/trxn-leg/change-status) \&quot;before each\&quot; hook in \&quot;Enable or Disable Trxn Leg API Tests (PUT :v1/trxn-leg/change-status)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAccounting.chartOfAccount.createMany({\n  data: [\n    {\n      name: \&quot;Account 1\&quot;,\n      description: \&quot;Description for Account 1\&quot;,\n      transactionType: \&quot;SYSTEM\&quot;,\n      headType: \&quot;ASSET\&quot;,\n      code: \&quot;001\&quot;,\n      onlyParent: false,\n      adminId: 1,\n    },\n    {\n      name: \&quot;Account 2\&quot;,\n      description: \&quot;Description for Account 2\&quot;,\n      transactionType: \&quot;SYSTEM\&quot;,\n      headType: \&quot;ASSET\&quot;,\n      code: \&quot;002\&quot;,\n      onlyParent: true,\n      adminId: 1,\n    },\n  ],\n});\nconst account1 = await prismaAccounting.chartOfAccount.findUnique({\n  where: {\n    code: \&quot;001\&quot;,\n  },\n});\nconst account2 = await prismaAccounting.chartOfAccount.findUnique({\n  where: {\n    code: \&quot;002\&quot;,\n  },\n});\nconst typeA = await prismaAccounting.transactionType.create({\n  data: {\n    transactionCode: \&quot;223\&quot;,\n    name: \&quot;TypeA\&quot;,\n    description: \&quot;qqqqqqqqqqqqqqqqq\&quot;,\n    minAmount: 66,\n    maxAmount: 666,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: \&quot;11\&quot;,\n    isActive: true,\n    fromChartOfAccountId: account1.id,\n    toChartOfAccountId: account2.id,\n  },\n});\nconst typeB = await prismaAccounting.transactionType.create({\n  data: {\n    transactionCode: \&quot;224\&quot;,\n    name: \&quot;TypeB\&quot;,\n    description: \&quot;qqqqqqqqqqqqqqqqq\&quot;,\n    minAmount: 66,\n    maxAmount: 666,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: \&quot;11\&quot;,\n    isActive: true,\n    fromChartOfAccountId: account1.id,\n    toChartOfAccountId: account2.id,\n  },\n});\nawait prismaAccounting. transactionLeg.create({\n  data: {\n    name: \&quot;Public\&quot;,\n    description: \&quot;Initial description\&quot;,\n    type: \&quot;FEE\&quot;,\n    isEnable: true,\n    originalTransactionTypeId: typeA.id,\n    generatedTransactionTypeId: typeB.id,\n    chargeType: \&quot;FIXED\&quot;,\n    fixedAmount: 100,\n    minAmount: 10,\n    maxAmount: 200,\n    percentageAmount: 5,\n  },\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5650d752-6a85-402b-92e2-d0be338ffd36&quot;,&quot;parentUUID&quot;:&quot;3c4ab817-2e42-4996-8df8-22d9b2561e25&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Enable or Disable Trxn Leg API Tests (PUT :v1/trxn-leg/change-status)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Enable or Disable Trxn Leg API Tests (PUT :v1/trxn-leg/change-status) \&quot;after all\&quot; hook in \&quot;Enable or Disable Trxn Leg API Tests (PUT :v1/trxn-leg/change-status)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c0c793cb-0f70-4fa3-b6a2-a93f5f4cd467&quot;,&quot;parentUUID&quot;:&quot;3c4ab817-2e42-4996-8df8-22d9b2561e25&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should disable a leg and change log&quot;,&quot;fullTitle&quot;:&quot;Enable or Disable Trxn Leg API Tests (PUT :v1/trxn-leg/change-status) should disable a leg and change log&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:69,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\nconst token = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst testFee = await prismaAccounting. transactionLeg.findMany({});\nconst feeId = testFee[0].id;\nawait pactum\n  .spec()\n  .put(`${ApiUrls.apiBaseUrl}${ApiUrls.enableDisableLeg}${feeId}`)\n  .withBearerToken(token)\n  .withJson({\n    isEnable: false,\n  })\n  .expectStatus(200);\nconst updatedFeeRecord = await prismaAccounting.transactionLeg.findUnique({\n  where: { id: feeId },\n});\nexpect(updatedFeeRecord.isEnable).to.be.false;\nconst logEntry = await prismaAccounting.transactionLegLog.findMany({\n  where: {\n    transactionLegId: feeId,\n    changeType: \&quot;CHANGE_STATUS\&quot;,\n  }\n});\nexpect(logEntry).to.not.be.null;\nexpect(logEntry.changeType).to.equal(\&quot;CHANGE_STATUS\&quot;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected undefined to equal &#x27;CHANGE_STATUS&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected undefined to equal &#x27;CHANGE_STATUS&#x27;\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/accounting/transactionLeg/changeTrxLegStatus.test.js:146:36)&quot;},&quot;uuid&quot;:&quot;ae352f32-6196-4421-be30-e95251249ee9&quot;,&quot;parentUUID&quot;:&quot;3c4ab817-2e42-4996-8df8-22d9b2561e25&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;ae352f32-6196-4421-be30-e95251249ee9&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:69,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;title&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/transactionLeg/createTrxnLeg.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/transactionLeg/createTrxnLeg.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) \&quot;before all\&quot; hook in \&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7523378b-6e8e-4655-9995-29bc20c6494e&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) \&quot;before each\&quot; hook in \&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\n    await prismaAccounting.transaction.deleteMany({});\n    await prismaAccounting.transactionLegLog.deleteMany({});\n    await prismaAccounting.transactionLeg.deleteMany({});\n    await prismaAccounting.transactionTypeChangeLog.deleteMany({});\n    await prismaAccounting.transactionType.deleteMany({});\n    await prismaAccounting.userAccount.deleteMany({});\n    await prismaAccounting.chartOfAccountLog.deleteMany({});\n    await prismaAccounting.chartOfAccount.deleteMany({});\n    \n    await prismaAccounting.chartOfAccount.createMany({\n      data: [\n        {\n          name: \&quot;Account 1\&quot;,\n          description: \&quot;Description for Account 1\&quot;,\n          transactionType: \&quot;SYSTEM\&quot;,\n          headType: \&quot;ASSET\&quot;,\n          code: \&quot;001\&quot;,\n          onlyParent: false,\n          adminId: 1,\n        },\n        {\n          name: \&quot;Account 2\&quot;,\n          description: \&quot;Description for Account 2\&quot;,\n          transactionType: \&quot;SYSTEM\&quot;,\n          headType: \&quot;ASSET\&quot;,\n          code: \&quot;002\&quot;,\n          onlyParent: true,\n          adminId: 1,\n        },\n      ],\n    });\n    const account1 = await prismaAccounting.chartOfAccount.findUnique({\n      where: {\n        code: \&quot;001\&quot;,\n      },\n    });\n    const account2 = await prismaAccounting.chartOfAccount.findUnique({\n      where: {\n        code: \&quot;002\&quot;,\n      },\n    });\n    typeA = await prismaAccounting.transactionType.create({\n      data: {\n        transactionCode: \&quot;223\&quot;,\n        name: \&quot;TypeA\&quot;,\n        description: \&quot;qqqqqqqqqqqqqqqqq\&quot;,\n        minAmount: 66,\n        maxAmount: 666,\n        createdByAdminId: 1,\n        createdByAdminIdentifier: \&quot;11\&quot;,\n        isActive: true,\n        fromChartOfAccountId: account1.id,\n        toChartOfAccountId: account2.id,\n      },\n    });\n    typeB = await prismaAccounting.transactionType.create({\n      data: {\n        transactionCode: \&quot;224\&quot;,\n        name: \&quot;TypeB\&quot;,\n        description: \&quot;qqqqqqqqqqqqqqqqq\&quot;,\n        minAmount: 66,\n        maxAmount: 666,\n        createdByAdminId: 1,\n        createdByAdminIdentifier: \&quot;11\&quot;,\n        isActive: true,\n        fromChartOfAccountId: account1.id,\n        toChartOfAccountId: account2.id,\n      },\n    });\n    const adminUser = {\n      email: \&quot;admin@ppay.com\&quot;,\n      roles: \&quot;Admin\&quot;,\n      adminRole: \&quot;ADMIN\&quot;,\n    };\n    token = generateToken(\n      1,\n      adminUser.email,\n      adminUser.roles,\n      adminUser.adminRole\n    );&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;457ecdd4-19d4-4379-b103-d6c1ceb80901&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) \&quot;after all\&quot; hook in \&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8b9cfad2-f749-4846-97e4-abcef642c535&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create a new leg&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) should create a new leg&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createLeg}`)\n  .withJson({\n    name: \&quot;Send Money Fee\&quot;,\n    description: \&quot;Corporate description\&quot;,\n    type: \&quot;FEE\&quot;,\n    isEnable: true,\n    originalTransactionType: typeA.id.toString(),\n    generatedTransactionType: typeB.id.toString(),\n    chargeType: \&quot;Percentage\&quot;,\n    amount: 30,\n    minAmount: 30,\n    maxAmount: 100,\n  })\n  .expectStatus(201);\nconst createdFee = await prismaAccounting.transactionLeg.findMany({\n  where: { name: \&quot;Corporate\&quot; },\n});\nexpect(createdFee).to.not.be.null;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e456fe75-de21-423f-8aad-b5f2df157be4&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for invalid input of fee&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) should return 400 for invalid input of fee&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const invalidFee = {\n  name: \&quot;\&quot;,\n  description: \&quot;Invalid description\&quot;,\n  type: \&quot;Type C\&quot;,\n  isEnable: true,\n  originalTransactionType: 1,\n  generatedTransactionType: 2,\n  chargeType: \&quot;Charge Invalid\&quot;,\n  amount: -100,\n  minAmount: -50,\n  maxAmount: -200,\n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createLeg}`)\n  .withJson({\n    name: \&quot;\&quot;,\n    description: \&quot;Invalid description\&quot;,\n    type: \&quot;Type C\&quot;,\n    isEnable: true,\n    originalTransactionType: 1,\n    generatedTransactionType: 2,\n    chargeType: \&quot;Charge Invalid\&quot;,\n    amount: -100,\n    minAmount: -50,\n    maxAmount: -200,\n  })\n  .expectStatus(400);\nconst dbFees = await prismaAccounting.transactionLeg.findMany({});\nexpect(dbFees).to.have.lengthOf(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;afe74d5b-2236-482d-ad5c-342806d50f9d&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 419 if the fee already exists and cannot be created again&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) should return 419 if the fee already exists and cannot be created again&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.transactionLeg.create({\n   data: {\n     name: \&quot;Public\&quot;,\n     description: \&quot;Initial description\&quot;,\n     type: \&quot;FEE\&quot;,\n     isEnable: true,\n     originalTransactionTypeId: typeA.id,\n     generatedTransactionTypeId: typeB.id,\n     chargeType: \&quot;FIXED\&quot;,\n     fixedAmount: 100,\n     minAmount: 10,\n     maxAmount: 200,\n     percentageAmount: 5,\n   },\n });\n const existingFee = {\n   name: \&quot;Public\&quot;,\n   description: \&quot;Initial description\&quot;,\n   type: \&quot;FEE\&quot;,\n   isEnable: true,\n   originalTransactionTypeId: typeA.id,\n   generatedTransactionTypeId: typeB.id,\n   chargeType: \&quot;FIXED\&quot;,\n   fixedAmount: 100,\n   minAmount: 10,\n   maxAmount: 200,\n   percentageAmount: 5,\n };\n await pactum\n   .spec()\n   .withMethod(\&quot;POST\&quot;)\n   .withBearerToken(token)\n   .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createLeg}`)\n   .withJson({\n     name: \&quot;Corporate\&quot;,\n     description: \&quot;Corporate description\&quot;,\n     type: \&quot;FEE\&quot;,\n     isEnable: true,\n     originalTransactionType: typeA.id.toString(),\n     generatedTransactionType: typeB.id.toString(),\n     chargeType: \&quot;Percentage\&quot;,\n     amount: 30,\n     minAmount: 30,\n     maxAmount: 100,\n   })\n   .expectStatus(400);\n const dbFees = await prismaAccounting.transactionLeg.findMany({\n   where: {\n     name: existingFee.name,\n     description: existingFee.description,\n     type: existingFee.type,\n     isEnable: existingFee.isEnable,\n     originalTransactionType: existingFee.originalTransactionType,\n     generatedTransactionType: existingFee.generatedTransactionType,\n     chargeType: existingFee.chargeType,\n     amount: existingFee.amount,\n     minAmount: existingFee.minAmount,\n     maxAmount: existingFee.maxAmount,\n   },\n });\n const feeRecord = dbFees[0];\n expect(feeRecord).to.exist;\n expect(feeRecord.name).to.equal(existingFee.name);\n expect(feeRecord.description).to.equal(existingFee.description);\n expect(feeRecord.type).to.equal(existingFee.type);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 400\n\n201 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 400\n\n201 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 400\n&quot;},&quot;uuid&quot;:&quot;81d81af6-8551-4cf2-833c-e09e05f6308b&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for multiple missing mandatory fields&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) should return 400 for multiple missing mandatory fields&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createLeg}`)\n  .withJson({\n    description: \&quot;Test description\&quot;,\n    type: \&quot;FEE\&quot;,\n    originalTransactionType: 1,\n    chargeType: \&quot;Percentage\&quot;,\n    amount: 100,\n  })\n  .expectStatus(400);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 400\n\n500 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 400\n\n500 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 400\n&quot;},&quot;uuid&quot;:&quot;0ff486b6-0105-4473-8c52-6155cfb50ad2&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if originalTransactionType and generatedTransactionType are the same&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) should return 400 if originalTransactionType and generatedTransactionType are the same&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const feeWithSameTypes = {\n  name: \&quot;Public\&quot;,\n  description: \&quot;Initial description\&quot;,\n  type: \&quot;FEE\&quot;,\n  isEnable: true,\n  originalTransactionType: typeA.id,\n  generatedTransactionType: typeA.id,\n  chargeType: \&quot;FIXED\&quot;,\n  fixedAmount: 100,\n  minAmount: 10,\n  maxAmount: 200,\n  percentageAmount: 5,\n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createLeg}`)\n  .withJson({\n    name: \&quot;Public\&quot;,\n    description: \&quot;Initial description\&quot;,\n    type: \&quot;FEE\&quot;,\n    isEnable: true,\n    originalTransactionType: typeA.id.toString(),\n    generatedTransactionType: typeA.id.toString(),\n    chargeType: \&quot;FIXED\&quot;,\n    fixedAmount: 100,\n    minAmount: 10,\n    maxAmount: 200,\n    percentageAmount: 5,\n  })\n  .expectStatus(400);\nconst dbFees = await prismaAccounting.transactionLeg.findMany({\n  where: {\n    originalTransactionTypeId: feeWithSameTypes.originalTransactionType,\n    generatedTransactionTypeId: feeWithSameTypes.generatedTransactionType,\n  },\n});\nexpect(dbFees).to.have.lengthOf(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 400\n\n201 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 400\n\n201 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 400\n&quot;},&quot;uuid&quot;:&quot;8af10e06-7d4a-483d-a1f0-6d854f0eaea0&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if type is AIT and charge type is anything but No Charge&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) should return 400 if type is AIT and charge type is anything but No Charge&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const feeWithSameTypes = {\n      name: \&quot;Public\&quot;,\n      description: \&quot;Initial description\&quot;,\n      type: \&quot;AIT\&quot;,\n      isEnable: true,\n      originalTransactionType: typeA.id.toString(),\n      generatedTransactionType: typeA.id.toString(),\n      chargeType: \&quot;FIXED\&quot;,\n      fixedAmount: 100,\n      minAmount: 10,\n      maxAmount: 200,\n      percentageAmount: 5,\n    };\n    await pactum\n      .spec()\n      .withMethod(\&quot;POST\&quot;)\n      .withBearerToken(token)\n      .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createLeg}`)\n      .withJson(feeWithSameTypes)\n      .expectStatus(400);\n    const dbFees = await prismaAccounting.transactionLeg.findMany({\n      where: {\n        originalTransactionTypeId: feeWithSameTypes.originalTransactionType,\n        generatedTransactionTypeId: feeWithSameTypes.generatedTransactionType,\n      },\n    });\n    expect(dbFees).to.have.lengthOf(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;40987898-2b19-4fd5-803d-837b8a2986cd&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if type is VAT and charge type is anything but Percentage&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) should return 400 if type is VAT and charge type is anything but Percentage&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const feeWithSameTypes = {\n      name: \&quot;Public\&quot;,\n      description: \&quot;Initial description\&quot;,\n      type: \&quot;VAT\&quot;,\n      isEnable: true,\n      originalTransactionType: typeA.id.toString(),\n      generatedTransactionType: typeA.id.toString(),\n      chargeType: \&quot;FIXED\&quot;,\n      fixedAmount: 100,\n      minAmount: 10,\n      maxAmount: 200,\n      percentageAmount: 5,\n    };\n    await pactum\n      .spec()\n      .withMethod(\&quot;POST\&quot;)\n      .withBearerToken(token)\n      .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createLeg}`)\n      .withJson(feeWithSameTypes)\n      .expectStatus(400);\n    const dbFees = await prismaAccounting.transactionLeg.findMany({\n      where: {\n        originalTransactionTypeId: feeWithSameTypes.originalTransactionType,\n        generatedTransactionTypeId: feeWithSameTypes.generatedTransactionType,\n      },\n    });\n    expect(dbFees).to.have.lengthOf(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 400\n\n201 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 400\n\n201 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 400\n&quot;},&quot;uuid&quot;:&quot;092c7b6b-f706-444c-b10f-d19865cdd7f1&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if maxAmount is less than or equal to minAmount&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) should return 400 if maxAmount is less than or equal to minAmount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const feeWithInvalidMaxAmount = {\n  name: \&quot;Public\&quot;,\n  description: \&quot;Initial description\&quot;,\n  type: \&quot;FEE\&quot;,\n  isEnable: true,\n  originalTransactionTypeId: typeA.id,\n  generatedTransactionTypeId: typeB.id,\n  chargeType: \&quot;FIXED\&quot;,\n  fixedAmount: 100,\n  minAmount: 10,\n  maxAmount: 10,\n  percentageAmount: 5,\n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createLeg}`)\n  .withJson({\n    name: \&quot;Public\&quot;,\n    description: \&quot;Initial description\&quot;,\n    type: \&quot;FEE\&quot;,\n    isEnable: true,\n    originalTransactionTypeId: typeA.id.toString(),\n    generatedTransactionTypeId: typeB.id.toString(),\n    chargeType: \&quot;FIXED\&quot;,\n    fixedAmount: 100,\n    minAmount: 10,\n    maxAmount: 10,\n    percentageAmount: 5,\n  })\n  .expectStatus(400);\nconst dbFees = await prismaAccounting.transactionLeg.findMany({\n  where: {\n    name: feeWithInvalidMaxAmount.name,\n  },\n});\nexpect(dbFees).to.have.lengthOf(0);\nconst feeRecord = dbFees[0];\nif (feeRecord) {\n  expect(feeRecord.minAmount).to.be.at.most(feeRecord.maxAmount);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;91860c8a-4d2e-49c2-b2b0-e40c62ddd0d0&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if amount exceeds 100&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) should return 400 if amount exceeds 100&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const feeWithInvalidMaxAmount = {\n      name: \&quot;Public\&quot;,\n      description: \&quot;Initial description\&quot;,\n      type: \&quot;FEE\&quot;,\n      isEnable: true,\n      originalTransactionTypeId: typeA.id,\n      generatedTransactionTypeId: typeB.id,\n      chargeType: \&quot;FIXED\&quot;,\n      fixedAmount: 1000,\n      minAmount: 10,\n      maxAmount: 200,\n      percentageAmount: 5,\n    };\n    await pactum\n      .spec()\n      .withMethod(\&quot;POST\&quot;)\n      .withBearerToken(token)\n      .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createLeg}`)\n      .withJson({\n        name: \&quot;Public\&quot;,\n        description: \&quot;Initial description\&quot;,\n        type: \&quot;FEE\&quot;,\n        isEnable: true,\n        originalTransactionType: typeA.id.toString(),\n        generatedTransactionType: typeB.id.toString(),\n        chargeType: \&quot;FIXED\&quot;,\n        fixedAmount: 1000,\n        minAmount: 10,\n        maxAmount: 200,\n        percentageAmount: 5,\n      })\n      .expectStatus(400);\n    const dbFees = await prismaAccounting.transactionLeg.findMany({\n      where: {\n        name: feeWithInvalidMaxAmount.name,\n      },\n    });\n    expect(dbFees).to.have.lengthOf(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 400\n\n201 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 400\n\n201 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 400\n&quot;},&quot;uuid&quot;:&quot;f648b3b2-11ff-46f5-a8ef-472911dd277e&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should store null in database min and max value if type is Fixed&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) should store null in database min and max value if type is Fixed&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:105,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const feeWithFixedType = {\n  name: \&quot;Public\&quot;,\n  description: \&quot;Initial description\&quot;,\n  type: \&quot;FEE\&quot;,\n  isEnable: true,\n  originalTransactionTypeId: typeA.id,\n  generatedTransactionTypeId: typeB.id,\n  chargeType: \&quot;FIXED\&quot;,\n  fixedAmount: 50,\n  minAmount: 10,\n  maxAmount: 200,\n  amount: 5,\n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createLeg}`)\n  .withJson({\n    name: feeWithFixedType.name,\n    description: feeWithFixedType.description,\n    type: feeWithFixedType.type,\n    isEnable: feeWithFixedType.isEnable,\n    originalTransactionType:\n      feeWithFixedType.originalTransactionTypeId.toString(),\n    generatedTransactionType:\n      feeWithFixedType.generatedTransactionTypeId.toString(),\n    chargeType: feeWithFixedType.chargeType,\n    amount: 50,\n    percentageAmount: 0,\n  })\n  .expectStatus(201);\nconst dbFees = await prismaAccounting.transactionLeg.findMany({\n  where: { name: feeWithFixedType.name },\n});\nexpect(dbFees).to.have.lengthOf(1);\nconst feeRecord = dbFees[0];\nexpect(feeRecord.minAmount).to.be.null;\nexpect(feeRecord.maxAmount).to.be.null;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d287591b-d437-4b99-beb5-9f4f5ca8c279&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should check the logs for creating a fee&quot;,&quot;fullTitle&quot;:&quot;Create Trxn Fee API Tests (POST fee:/v1/trxn-leg) should check the logs for creating a fee&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createLeg}`)\n  .withJson({\n    name: \&quot;Corporate\&quot;,\n    description: \&quot;Corporate description\&quot;,\n    type: \&quot;FEE\&quot;,\n    isEnable: true,\n    originalTransactionType: typeA.id.toString(),\n    generatedTransactionType: typeB.id.toString(),\n    chargeType: \&quot;Percentage\&quot;,\n    amount: 30,\n    minAmount: 30,\n    maxAmount: 100,\n  });\nconst createdFee = await prismaAccounting.transactionLeg.findMany({\n  where: { name: \&quot;Corporate\&quot; },\n});\nconst logEntry = await prismaAccounting.transactionLegLog.findMany({\n  where: { transactionLegId: createdFee[0].id },\n});\nexpect(logEntry).to.be.an(\&quot;array\&quot;).that.is.not.empty;\nexpect(logEntry[0]).to.have.property(\&quot;changeType\&quot;).to.equal(\&quot;CREATE\&quot;);\nexpect(logEntry[0]).to.have.property(\&quot;oldValue\&quot;).to.be.null;\nexpect(logEntry[0]).to.have.property(\&quot;newValue\&quot;).not.to.be.null;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;id&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/accounting/transactionLeg/createTrxnLeg.test.js:544:48)&quot;},&quot;uuid&quot;:&quot;66175db8-4c71-4d71-a582-4dd6311e1d5c&quot;,&quot;parentUUID&quot;:&quot;bceef61d-6676-4201-a53d-91e2df01e598&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e456fe75-de21-423f-8aad-b5f2df157be4&quot;,&quot;afe74d5b-2236-482d-ad5c-342806d50f9d&quot;,&quot;40987898-2b19-4fd5-803d-837b8a2986cd&quot;,&quot;91860c8a-4d2e-49c2-b2b0-e40c62ddd0d0&quot;,&quot;d287591b-d437-4b99-beb5-9f4f5ca8c279&quot;],&quot;failures&quot;:[&quot;81d81af6-8551-4cf2-833c-e09e05f6308b&quot;,&quot;0ff486b6-0105-4473-8c52-6155cfb50ad2&quot;,&quot;8af10e06-7d4a-483d-a1f0-6d854f0eaea0&quot;,&quot;092c7b6b-f706-444c-b10f-d19865cdd7f1&quot;,&quot;f648b3b2-11ff-46f5-a8ef-472911dd277e&quot;,&quot;66175db8-4c71-4d71-a582-4dd6311e1d5c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:316,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;5d5a643f-057d-4ec9-98db-d193a443c526&quot;,&quot;title&quot;:&quot;GET Trxn Leg API Tests (:GET /v1/transaction-leg)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/transactionLeg/getTrxnLeg.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/transactionLeg/getTrxnLeg.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;GET Trxn Leg API Tests (:GET /v1/transaction-leg)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Leg API Tests (:GET /v1/transaction-leg) \&quot;before all\&quot; hook in \&quot;GET Trxn Leg API Tests (:GET /v1/transaction-leg)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6b6fa6fd-a20d-40d9-b3da-e105f216ed0e&quot;,&quot;parentUUID&quot;:&quot;5d5a643f-057d-4ec9-98db-d193a443c526&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;GET Trxn Leg API Tests (:GET /v1/transaction-leg)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Leg API Tests (:GET /v1/transaction-leg) \&quot;before each\&quot; hook in \&quot;GET Trxn Leg API Tests (:GET /v1/transaction-leg)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAccounting.chartOfAccount.createMany({\n  data: [\n    {\n      name: &#x27;Account 1&#x27;,\n      description: &#x27;Description for Account 1&#x27;,\n      transactionType: &#x27;SYSTEM&#x27;,\n      headType: &#x27;ASSET&#x27;,\n      code: &#x27;001&#x27;,\n      onlyParent: false,\n      adminId: 1\n    },\n    {\n      name: &#x27;Account 2&#x27;,\n      description: &#x27;Description for Account 2&#x27;,\n      transactionType: &#x27;SYSTEM&#x27;,\n      headType: &#x27;ASSET&#x27;,\n      code: &#x27;002&#x27;,\n      onlyParent: true,\n      adminId: 1\n    }\n  ]\n});\nconst account1 = await prismaAccounting.chartOfAccount.findUnique({\n  where: {\n    code: &#x27;001&#x27;\n  }\n});\nconst account2 = await prismaAccounting.chartOfAccount.findUnique({\n  where: {\n    code: &#x27;002&#x27;\n  }\n});\n\nconst typeA = await prismaAccounting.transactionType.create({\n  data: {\n    transactionCode: &#x27;223&#x27;,\n    name: &#x27;TypeA&#x27;,\n    description: &#x27;qqqqqqqqqqqqqqqqq&#x27;,\n    minAmount: 66,\n    maxAmount: 666,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: &#x27;11&#x27;,\n    isActive: true,\n    fromChartOfAccountId: account1.id,\n    toChartOfAccountId: account2.id,\n  },\n});\nconst typeB = await prismaAccounting.transactionType.create({\n  data: {\n    transactionCode: &#x27;224&#x27;,\n    name: &#x27;TypeB&#x27;,\n    description: &#x27;qqqqqqqqqqqqqqqqq&#x27;,\n    minAmount: 66,\n    maxAmount: 666,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: &#x27;11&#x27;,\n    isActive: true,\n    fromChartOfAccountId: account1.id,\n    toChartOfAccountId: account2.id,\n  },\n});\nawait prismaAccounting. transactionLeg.create({\n  data: {\n    name: &#x27;Public&#x27;,\n    description: &#x27;Initial description&#x27;,\n    type: &#x27;FEE&#x27;,\n    isEnable: true,\n    originalTransactionTypeId: typeA.id,\n    generatedTransactionTypeId: typeB.id,\n    chargeType: \&quot;FIXED\&quot;,\n    fixedAmount: 100,\n    minAmount: 10,\n    maxAmount: 200,\n    percentageAmount: 5,\n  },\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ab384fa4-4221-4137-ad2d-631442305e4b&quot;,&quot;parentUUID&quot;:&quot;5d5a643f-057d-4ec9-98db-d193a443c526&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;GET Trxn Leg API Tests (:GET /v1/transaction-leg)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Leg API Tests (:GET /v1/transaction-leg) \&quot;after all\&quot; hook in \&quot;GET Trxn Leg API Tests (:GET /v1/transaction-leg)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;25e50e74-f3cc-4d58-bd35-ec2d13ce0962&quot;,&quot;parentUUID&quot;:&quot;5d5a643f-057d-4ec9-98db-d193a443c526&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return all fees&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Leg API Tests (:GET /v1/transaction-leg) should return all fees&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;\n};\ntoken = generateToken(1, adminUser.email, adminUser.roles, adminUser.adminRole);\nconst response = await pactum\n  .spec()\n  .withMethod(&#x27;GET&#x27;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getLegs}`)\n  .expectStatus(200);\nconst feeDb = await prismaAccounting. transactionLeg.findMany({});\nexpect(response.body.transactionlegs).to.be.an(&#x27;array&#x27;);\nexpect(response.body.transactionlegs.name).to.equal(feeDb.name);\nexpect(response.body.transactionlegs.description).to.equal(feeDb.description);\nexpect(response.body.transactionlegs.id).to.equal(feeDb.id);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a3785cd8-084a-4332-8199-a158ef1d8f2c&quot;,&quot;parentUUID&quot;:&quot;5d5a643f-057d-4ec9-98db-d193a443c526&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a3785cd8-084a-4332-8199-a158ef1d8f2c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;81f1cb69-fecd-4fd7-ac4c-65e97015e2c5&quot;,&quot;title&quot;:&quot;GET Trxn Fee Details API Tests (:GET /v1/transaction-type)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/transactionLeg/getTRxnLegDetails.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/transactionLeg/getTRxnLegDetails.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;GET Trxn Fee Details API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Fee Details API Tests (:GET /v1/transaction-type) \&quot;before all\&quot; hook in \&quot;GET Trxn Fee Details API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3e33acb7-fd53-401d-8592-06ad50cd29fd&quot;,&quot;parentUUID&quot;:&quot;81f1cb69-fecd-4fd7-ac4c-65e97015e2c5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;GET Trxn Fee Details API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Fee Details API Tests (:GET /v1/transaction-type) \&quot;before each\&quot; hook in \&quot;GET Trxn Fee Details API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAccounting.chartOfAccount.createMany({\n  data: [\n    {\n      name: \&quot;Account 1\&quot;,\n      description: \&quot;Description for Account 1\&quot;,\n      transactionType: \&quot;SYSTEM\&quot;,\n      headType: \&quot;ASSET\&quot;,\n      code: \&quot;001\&quot;,\n      onlyParent: false,\n      adminId: 1,\n    },\n    {\n      name: \&quot;Account 2\&quot;,\n      description: \&quot;Description for Account 2\&quot;,\n      transactionType: \&quot;SYSTEM\&quot;,\n      headType: \&quot;ASSET\&quot;,\n      code: \&quot;002\&quot;,\n      onlyParent: true,\n      adminId: 1,\n    },\n  ],\n});\nconst account1 = await prismaAccounting.chartOfAccount.findUnique({\n  where: {\n    code: \&quot;001\&quot;,\n  },\n});\nconst account2 = await prismaAccounting.chartOfAccount.findUnique({\n  where: {\n    code: \&quot;002\&quot;,\n  },\n});\nconst typeA = await prismaAccounting.transactionType.create({\n  data: {\n    transactionCode: \&quot;223\&quot;,\n    name: \&quot;TypeA\&quot;,\n    description: \&quot;qqqqqqqqqqqqqqqqq\&quot;,\n    minAmount: 66,\n    maxAmount: 666,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: \&quot;11\&quot;,\n    isActive: true,\n    fromChartOfAccountId: account1.id,\n    toChartOfAccountId: account2.id,\n  },\n});\nconst typeB = await prismaAccounting.transactionType.create({\n  data: {\n    transactionCode: \&quot;224\&quot;,\n    name: \&quot;TypeB\&quot;,\n    description: \&quot;qqqqqqqqqqqqqqqqq\&quot;,\n    minAmount: 66,\n    maxAmount: 666,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: \&quot;11\&quot;,\n    isActive: true,\n    fromChartOfAccountId: account1.id,\n    toChartOfAccountId: account2.id,\n  },\n});\nawait prismaAccounting. transactionLeg.create({\n  data: {\n    name: \&quot;Public\&quot;,\n    description: \&quot;Initial description\&quot;,\n    type: \&quot;FEE\&quot;,\n    isEnable: true,\n    originalTransactionTypeId: typeA.id,\n    generatedTransactionTypeId: typeB.id,\n    chargeType: \&quot;FIXED\&quot;,\n    fixedAmount: 100,\n    minAmount: 10,\n    maxAmount: 200,\n    percentageAmount: 5,\n  },\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1af40a38-6009-4471-90c5-89be9300c838&quot;,&quot;parentUUID&quot;:&quot;81f1cb69-fecd-4fd7-ac4c-65e97015e2c5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;GET Trxn Fee Details API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Fee Details API Tests (:GET /v1/transaction-type) \&quot;after all\&quot; hook in \&quot;GET Trxn Fee Details API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;059b00b5-a9ad-4fd3-80d2-859524bdf9e9&quot;,&quot;parentUUID&quot;:&quot;81f1cb69-fecd-4fd7-ac4c-65e97015e2c5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return a fee details&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Fee Details API Tests (:GET /v1/transaction-type) should return a fee details&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const fee = await prismaAccounting. transactionLeg.findMany({\n  where: {\n    name: \&quot;Public\&quot;,\n  },\n});\nconst adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst response = await pactum\n  .spec()\n  .get(`${ApiUrls.apiBaseUrl}${ApiUrls.getLegs}/${fee[0].id}`)\n  .withBearerToken(token)\n  .expectStatus(200);\nconst feeDb = await prismaAccounting. transactionLeg.findUnique({\n  where: {\n    id: fee[0].id,\n  },\n});\nexpect(response.body).to.be.an(\&quot;object\&quot;);\nexpect(response.body.name).to.equal(feeDb.name);\nexpect(response.body.description).to.equal(feeDb.description);\nexpect(Number(response.body.id)).to.equal(Number(feeDb.id));\nexpect(response.body.amount).to.equal(Number(feeDb.fixedAmount));\nexpect(response.body.minamount).to.equal(Number(feeDb.minAmount));\nexpect(response.body.maxamount).to.equal(Number(feeDb.maxAmount));\nexpect(response.body.chargetype.toUpperCase()).to.equal(feeDb.chargeType);\nexpect(response.body.type.toUpperCase()).to.equal(feeDb.type);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;61fbf99e-4a40-4b77-af54-06fc456998ee&quot;,&quot;parentUUID&quot;:&quot;81f1cb69-fecd-4fd7-ac4c-65e97015e2c5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;61fbf99e-4a40-4b77-af54-06fc456998ee&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:21,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7f230fb9-2dfb-433c-8163-07b759633ed4&quot;,&quot;title&quot;:&quot;Update Trxn Fee API Tests (PATCH  :/v1/trxn-fee/)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/transactionLeg/updateTrxnLeg.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/transactionLeg/updateTrxnLeg.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Update Trxn Fee API Tests (PATCH  :/v1/trxn-fee/)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Update Trxn Fee API Tests (PATCH  :/v1/trxn-fee/) \&quot;before all\&quot; hook in \&quot;Update Trxn Fee API Tests (PATCH  :/v1/trxn-fee/)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c857754a-31d1-4fdf-8ce2-4e753ce19240&quot;,&quot;parentUUID&quot;:&quot;7f230fb9-2dfb-433c-8163-07b759633ed4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Update Trxn Fee API Tests (PATCH  :/v1/trxn-fee/)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Update Trxn Fee API Tests (PATCH  :/v1/trxn-fee/) \&quot;before each\&quot; hook in \&quot;Update Trxn Fee API Tests (PATCH  :/v1/trxn-fee/)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAccounting.chartOfAccount.createMany({\n  data: [\n    {\n      name: &#x27;Account 1&#x27;,\n      description: &#x27;Description for Account 1&#x27;,\n      transactionType: &#x27;SYSTEM&#x27;,\n      headType: &#x27;ASSET&#x27;,\n      code: &#x27;001&#x27;,\n      onlyParent: false,\n      adminId: 1\n    },\n    {\n      name: &#x27;Account 2&#x27;,\n      description: &#x27;Description for Account 2&#x27;,\n      transactionType: &#x27;SYSTEM&#x27;,\n      headType: &#x27;ASSET&#x27;,\n      code: &#x27;002&#x27;,\n      onlyParent: true,\n      adminId: 1\n    }\n  ]\n});\nconst account1 = await prismaAccounting.chartOfAccount.findUnique({\n  where: {\n    code: &#x27;001&#x27;\n  }\n});\nconst account2 = await prismaAccounting.chartOfAccount.findUnique({\n  where: {\n    code: &#x27;002&#x27;\n  }\n});\nconst typeA = await prismaAccounting.transactionType.create({\n  data: {\n    transactionCode: &#x27;223&#x27;,\n    name: &#x27;TypeA&#x27;,\n    description: &#x27;qqqqqqqqqqqqqqqqq&#x27;,\n    minAmount: 66,\n    maxAmount: 666,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: &#x27;11&#x27;,\n    isActive: true,\n    fromChartOfAccountId: account1.id,\n    toChartOfAccountId: account2.id,\n  },\n});\nconst typeB = await prismaAccounting.transactionType.create({\n  data: {\n    transactionCode: &#x27;224&#x27;,\n    name: &#x27;TypeB&#x27;,\n    description: &#x27;qqqqqqqqqqqqqqqqq&#x27;,\n    minAmount: 66,\n    maxAmount: 666,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: &#x27;11&#x27;,\n    isActive: true,\n    fromChartOfAccountId: account1.id,\n    toChartOfAccountId: account2.id,\n  },\n});\nconst fee = await prismaAccounting. transactionLeg.create({\n  data: {\n    name: &#x27;Public&#x27;,\n    description: &#x27;Initial description&#x27;,\n    type: &#x27;FEE&#x27;,\n    isEnable: true,\n    originalTransactionTypeId: typeA.id,\n    generatedTransactionTypeId: typeB.id,\n    chargeType: \&quot;FIXED\&quot;,\n    fixedAmount: 100,\n    minAmount: 10,\n    maxAmount: 200,\n    percentageAmount: 5,\n  },\n});\nconst adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;\n};\ntoken = generateToken(1, adminUser.email, adminUser.roles, adminUser.adminRole);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b41fa402-9b14-45df-85d2-dd24d45fc334&quot;,&quot;parentUUID&quot;:&quot;7f230fb9-2dfb-433c-8163-07b759633ed4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Update Trxn Fee API Tests (PATCH  :/v1/trxn-fee/)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Update Trxn Fee API Tests (PATCH  :/v1/trxn-fee/) \&quot;after all\&quot; hook in \&quot;Update Trxn Fee API Tests (PATCH  :/v1/trxn-fee/)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2004b7ea-b065-4172-ab64-894f258546b3&quot;,&quot;parentUUID&quot;:&quot;7f230fb9-2dfb-433c-8163-07b759633ed4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should update a fee with valid name, description&quot;,&quot;fullTitle&quot;:&quot;Update Trxn Fee API Tests (PATCH  :/v1/trxn-fee/) should update a fee with valid name, description&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const fee = await prismaAccounting. transactionLeg.findMany({\n    where: {\n      name: &#x27;Public&#x27;,\n    },\n  });\n  \n  const feeId = fee[0].id;\n  \n  const feeToUpdate = {\n    name: \&quot;Updated Fee Name\&quot;,\n    description: \&quot;Updated description\&quot;\n  };\n  await pactum\n    .spec()\n    .withMethod(&#x27;PATCH&#x27;)\n    .withBearerToken(token)\n    .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.updateLegs}${feeId}`)\n    .withJson(feeToUpdate)\n    .expectStatus(200);\n  const updatedFeeRecord = await prismaAccounting. transactionLeg.findUnique({\n    where: { id: feeId }\n  });\n  expect(updatedFeeRecord).to.not.be.null;\n  expect(updatedFeeRecord.name).to.equal(feeToUpdate.name);\n  expect(updatedFeeRecord.description).to.equal(feeToUpdate.description);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 200\n\n500 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 200\n\n500 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 200\n&quot;},&quot;uuid&quot;:&quot;22c66237-f6c7-41b4-bf2e-22ab2e6d4801&quot;,&quot;parentUUID&quot;:&quot;7f230fb9-2dfb-433c-8163-07b759633ed4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if attempting to update non-allowed fields like type, original and generated transaction type&quot;,&quot;fullTitle&quot;:&quot;Update Trxn Fee API Tests (PATCH  :/v1/trxn-fee/) should return 400 if attempting to update non-allowed fields like type, original and generated transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const fee = await prismaAccounting. transactionLeg.findMany({\n  where: {\n    name: &#x27;Public&#x27;,\n  },\n});\nconst feeId = fee[0].id;\nconst feeWithInvalidFields  = {\n  type: \&quot;AIT\&quot;,\n  originalTransactionType: 55,\n  generatedTransactionType: 55,\n};\nawait pactum\n  .spec()\n  .withMethod(&#x27;PATCH&#x27;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.updateLegs}${feeId}`)\n  .withJson(feeWithInvalidFields)\n  .expectStatus(200);\nconst feeRecord = await prismaAccounting. transactionLeg.findUnique({\n  where: { id: feeId }\n});\nexpect(feeRecord).to.not.be.null;\nexpect(feeRecord.type).to.not.equal(feeWithInvalidFields.type);\nexpect(feeRecord.originalTransactionTypeId).to.not.equal(feeWithInvalidFields.originalTransactionType);\nexpect(feeRecord.generatedTransactionTypeId).to.not.equal(feeWithInvalidFields.generatedTransactionType);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 200\n\n500 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 200\n\n500 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 200\n&quot;},&quot;uuid&quot;:&quot;ce6791a6-55f0-4119-a36f-a197c3d91bfd&quot;,&quot;parentUUID&quot;:&quot;7f230fb9-2dfb-433c-8163-07b759633ed4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should check the logs for updating a fee&quot;,&quot;fullTitle&quot;:&quot;Update Trxn Fee API Tests (PATCH  :/v1/trxn-fee/) should check the logs for updating a fee&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const fee = await prismaAccounting. transactionLeg.findMany({\n      where: {\n        name: &#x27;Public&#x27;\n      },\n    });\n    const feeId = fee[0].id;\n    const feeToUpdate = {\n      name: \&quot;Updated Fee Name\&quot;,\n    };\n    await pactum\n      .spec()\n      .withMethod(&#x27;PATCH&#x27;)\n      .withBearerToken(token)\n      .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.updateLegs}${feeId}`)\n      .withJson(feeToUpdate);\n    const updatedFeeRecord = await prismaAccounting. transactionLeg.findMany({\n      where: { id: feeId }\n    });\n    const logEntry = await prismaAccounting. transactionLegLog.findMany({\n      where: { transactionLeg_id: updatedFeeRecord.id }\n    });\n    expect(logEntry[0]).to.have.property(&#x27;changeType&#x27;).to.equal(&#x27;UPDATE&#x27;);\n    expect(logEntry[0]).to.have.property(&#x27;oldValue&#x27;).not.to.be.null;\n    expect(logEntry[0]).to.have.property(&#x27;oldValue&#x27;).not.to.be.null;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: Target cannot be null or undefined.&quot;,&quot;estack&quot;:&quot;AssertionError: Target cannot be null or undefined.\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/accounting/transactionLeg/updateTrxnLeg.test.js:214:33)&quot;},&quot;uuid&quot;:&quot;756ab8d2-d200-42b0-b8e5-c15d31ec0f11&quot;,&quot;parentUUID&quot;:&quot;7f230fb9-2dfb-433c-8163-07b759633ed4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;22c66237-f6c7-41b4-bf2e-22ab2e6d4801&quot;,&quot;ce6791a6-55f0-4119-a36f-a197c3d91bfd&quot;,&quot;756ab8d2-d200-42b0-b8e5-c15d31ec0f11&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:54,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;44d16b7b-8cbe-403f-b61f-5d8741862ab2&quot;,&quot;title&quot;:&quot;Refund Transaction API Balance Check (POST)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/transactions/refundTransaction.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/transactions/refundTransaction.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Refund Transaction API Balance Check (POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Refund Transaction API Balance Check (POST) \&quot;before all\&quot; hook in \&quot;Refund Transaction API Balance Check (POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4e2f10e7-88a9-4b45-bd5c-04a2aec05039&quot;,&quot;parentUUID&quot;:&quot;44d16b7b-8cbe-403f-b61f-5d8741862ab2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Refund Transaction API Balance Check (POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Refund Transaction API Balance Check (POST) \&quot;before each\&quot; hook in \&quot;Refund Transaction API Balance Check (POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAccounting.chartOfAccount.createMany({\n  data: [\n    {\n      name: \&quot;Chart of Account 1\&quot;,\n      description: \&quot;Description for Account 1\&quot;,\n      transactionType: \&quot;SYSTEM\&quot;,\n      headType: \&quot;ASSET\&quot;,\n      code: \&quot;001\&quot;,\n      onlyParent: true,\n      adminId: 1,\n    },\n    {\n      name: \&quot;Chart of Account 2\&quot;,\n      description: \&quot;Description for Account 2\&quot;,\n      transactionType: \&quot;SYSTEM\&quot;,\n      headType: \&quot;ASSET\&quot;,\n      code: \&quot;002\&quot;,\n      onlyParent: true,\n      adminId: 1,\n    },\n  ],\n});\nconst coA1 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;001\&quot; },\n});\nconst coA2 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;002\&quot; },\n});\nconst createdType = await prismaAccounting.transactionType.create({\n  data: {\n    transactionCode: \&quot;223\&quot;,\n    name: \&quot;Send Money\&quot;,\n    description: \&quot;qqqqqqqqqqqqqqqqq\&quot;,\n    minAmount: 66,\n    maxAmount: 666,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: \&quot;11\&quot;,\n    isActive: true,\n    fromChartOfAccount: {\n      connect: { id: coA1.id },\n    },\n    toChartOfAccount: {\n      connect: { id: coA2.id },\n    },\n  },\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;691386a2-72b7-416d-b8b1-b612cb49193d&quot;,&quot;parentUUID&quot;:&quot;44d16b7b-8cbe-403f-b61f-5d8741862ab2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Refund Transaction API Balance Check (POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Refund Transaction API Balance Check (POST) \&quot;after all\&quot; hook in \&quot;Refund Transaction API Balance Check (POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;177bc146-37a6-4a10-acfe-a8655320c517&quot;,&quot;parentUUID&quot;:&quot;44d16b7b-8cbe-403f-b61f-5d8741862ab2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 200 for successful transaction refund where both sender and receiver is FULL_ACTIVE&quot;,&quot;fullTitle&quot;:&quot;Refund Transaction API Balance Check (POST) should return 200 for successful transaction refund where both sender and receiver is FULL_ACTIVE&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const coA1 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;001\&quot; },\n});\nconst coA2 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;002\&quot; },\n});\nawait prismaAccounting.userAccount.createMany({\n  data: [\n    {\n      accountName: \&quot;Jarin\&quot;,\n      identifier: \&quot;01317577237\&quot;,\n      status: \&quot;FULL_ACTIVE\&quot;,\n      dailyLimitAmount: 50000,\n      dailyLimitCount: 200000,\n      monthlyLimitAmount: 5000000,\n      monthlyLimitCount: 600000000,\n      maxWalletAmount: 1000000000,\n      minWalletAmount: 500,\n      chartOfAccount_id: coA1.id,\n    },\n    {\n      accountName: \&quot;Sultana\&quot;,\n      identifier: \&quot;01711106485\&quot;,\n      dailyLimitAmount: 50000,\n      dailyLimitCount: 200000,\n      monthlyLimitAmount: 5000000,\n      monthlyLimitCount: 600000000,\n      maxWalletAmount: 1000000000,\n      minWalletAmount: 500,\n      status: \&quot;FULL_ACTIVE\&quot;,\n      chartOfAccount_id: coA2.id,\n    },\n  ],\n});\nconst adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\naccount1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\naccount2 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\ncreatedType = await prismaAccounting.transactionType.findMany({\n  where: { createdByAdminIdentifier: \&quot;11\&quot; },\n});\nconst addMoneyTransaction = await prismaAccounting.transaction.create({\n  data: {\n    fromAccountId: account1.id,\n    toAccountId: account2.id,\n    transactionTypeId: createdType[0].id,\n    amount: 1000,\n    referenceNo: \&quot;qqqqqqqqqq\&quot;,\n    note: \&quot;send money\&quot;,\n  },\n});\nawait prismaAccounting.ledger.createMany({\n  data: [\n    {\n      accountId: account1.id,\n      transactionId: addMoneyTransaction.id,\n      amount: 1000,\n      description: \&quot;send money transaction\&quot;,\n      type: \&quot;DEBIT\&quot;,\n    },\n    {\n      accountId: account2.id,\n      transactionId: addMoneyTransaction.id,\n      amount: 1000,\n      description: \&quot;send money transaction\&quot;,\n      type: \&quot;CREDIT\&quot;,\n    },\n  ],\n});\nconst transaction = await prismaAccounting.transaction.findMany({\n  where: { referenceNo: \&quot;qqqqqqqqqq\&quot; },\n});\nconst referenceNo = transaction[0]?.referenceNo;\nconst transactionId = transaction[0]?.id;\nconst legderBeforeRefund = await prismaAccounting.ledger.findMany({\n  where: {\n    transactionId: transactionId,\n  },\n});\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.refundTransaction}`)\n  .withJson({\n    code: referenceNo,\n  })\n  .expectStatus(200);\nconst refundedTransaction = await prismaAccounting.transaction.findMany({\n  where: { mainTransactionId: transactionId },\n});\nexpect(refundedTransaction).to.exist;\nexpect(refundedTransaction[0].isRefunded).to.be.true;\nconst legderAfterRefund = await prismaAccounting.ledger.findMany({\n  where: {\n    transactionId: refundedTransaction[0].id,\n  },\n});\nexpect(legderBeforeRefund).to.exist;\nexpect(legderBeforeRefund).to.have.lengthOf(2);\nexpect(legderBeforeRefund[0].amount).to.equal(1000);\nexpect(legderBeforeRefund[0].type).to.equal(&#x27;DEBIT&#x27;);\nexpect(legderBeforeRefund[0].accountId).to.equal(account1.id);\nexpect(legderBeforeRefund[1].amount).to.equal(1000);\nexpect(legderBeforeRefund[1].type).to.equal(&#x27;CREDIT&#x27;);\nexpect(legderBeforeRefund[1].accountId).to.equal(account2.id);\nexpect(legderAfterRefund).to.exist;\nexpect(legderAfterRefund).to.have.lengthOf(2);\nexpect(legderAfterRefund[0].amount).to.equal(1000);\nexpect(legderAfterRefund[0].type).to.equal(&#x27;DEBIT&#x27;);\nexpect(legderAfterRefund[0].accountId).to.equal(account2.id);\nexpect(legderAfterRefund[1].amount).to.equal(1000);\nexpect(legderAfterRefund[1].type).to.equal(&#x27;CREDIT&#x27;);\nexpect(legderAfterRefund[1].accountId).to.equal(account1.id);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 200\n\n201 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 200\n\n201 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 200\n&quot;},&quot;uuid&quot;:&quot;c41a1bc5-6c91-43d0-bf30-94c97249a9b6&quot;,&quot;parentUUID&quot;:&quot;44d16b7b-8cbe-403f-b61f-5d8741862ab2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for successful transaction refund where sender is FULL_ACTIVE and receiver is LIMITED_ACTIVE&quot;,&quot;fullTitle&quot;:&quot;Refund Transaction API Balance Check (POST) should return 200 for successful transaction refund where sender is FULL_ACTIVE and receiver is LIMITED_ACTIVE&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:65,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const coA1 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;001\&quot; },\n});\nconst coA2 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;002\&quot; },\n});\nawait prismaAccounting.userAccount.createMany({\n  data: [\n    {\n      accountName: \&quot;Jarin\&quot;,\n      identifier: \&quot;01317577237\&quot;,\n      status: \&quot;FULL_ACTIVE\&quot;,\n      dailyLimitAmount: 50000,\n      dailyLimitCount: 200000,\n      monthlyLimitAmount: 5000000,\n      monthlyLimitCount: 600000000,\n      maxWalletAmount: 1000000000,\n      minWalletAmount: 500,\n      chartOfAccount_id: coA1.id,\n    },\n    {\n      accountName: \&quot;Sultana\&quot;,\n      identifier: \&quot;01711106485\&quot;,\n      dailyLimitAmount: 50000,\n      dailyLimitCount: 200000,\n      monthlyLimitAmount: 5000000,\n      monthlyLimitCount: 600000000,\n      maxWalletAmount: 1000000000,\n      minWalletAmount: 500,\n      status: \&quot;LIMITED_ACTIVE\&quot;,\n      chartOfAccount_id: coA2.id,\n    },\n  ],\n});\nconst adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\naccount1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\naccount2 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\ncreatedType = await prismaAccounting.transactionType.findMany({\n  where: { createdByAdminIdentifier: \&quot;11\&quot; },\n});\nconst addMoneyTransaction = await prismaAccounting.transaction.create({\n  data: {\n    fromAccountId: account1.id,\n    toAccountId: account2.id,\n    transactionTypeId: createdType[0].id,\n    amount: 1000,\n    referenceNo: \&quot;qqqqqqqqqq\&quot;,\n    note: \&quot;send money\&quot;,\n  },\n});\nawait prismaAccounting.ledger.createMany({\n  data: [\n    {\n      accountId: account1.id,\n      transactionId: addMoneyTransaction.id,\n      amount: 1000,\n      description: \&quot;send money transaction\&quot;,\n      type: \&quot;DEBIT\&quot;,\n    },\n    {\n      accountId: account2.id,\n      transactionId: addMoneyTransaction.id,\n      amount: 1000,\n      description: \&quot;send money transaction\&quot;,\n      type: \&quot;CREDIT\&quot;,\n    },\n  ],\n});\nconst transaction = await prismaAccounting.transaction.findMany({\n  where: { referenceNo: \&quot;qqqqqqqqqq\&quot; },\n});\nconst referenceNo = transaction[0]?.referenceNo;\nconst transactionId = transaction[0]?.id;\nconst legderBeforeRefund = await prismaAccounting.ledger.findMany({\n  where: {\n    transactionId: transactionId,\n  },\n});\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.refundTransaction}`)\n  .withJson({\n    code: referenceNo,\n  })\n  .expectStatus(200);\nconst refundedTransaction = await prismaAccounting.transaction.findMany({\n  where: { mainTransactionId: transactionId },\n});\nconst legderAfterRefund = await prismaAccounting.ledger.findMany({\n  where: {\n    transactionId: refundedTransaction[0].id,\n  },\n});\nexpect(legderBeforeRefund).to.exist;\nexpect(legderBeforeRefund).to.have.lengthOf(2);\nexpect(legderBeforeRefund[0].amount).to.equal(1000);\nexpect(legderBeforeRefund[0].type).to.equal(&#x27;DEBIT&#x27;);\nexpect(legderBeforeRefund[0].accountId).to.equal(account1.id);\nexpect(legderBeforeRefund[1].amount).to.equal(1000);\nexpect(legderBeforeRefund[1].type).to.equal(&#x27;CREDIT&#x27;);\nexpect(legderBeforeRefund[1].accountId).to.equal(account2.id);\nexpect(legderAfterRefund).to.exist;\nexpect(legderAfterRefund).to.have.lengthOf(2);\nexpect(legderAfterRefund[0].amount).to.equal(1000);\nexpect(legderAfterRefund[0].type).to.equal(&#x27;DEBIT&#x27;);\nexpect(legderAfterRefund[0].accountId).to.equal(account2.id);\nexpect(legderAfterRefund[1].amount).to.equal(1000);\nexpect(legderAfterRefund[1].type).to.equal(&#x27;CREDIT&#x27;);\nexpect(legderAfterRefund[1].accountId).to.equal(account1.id);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6b9b6dc7-6ec1-42e2-89f4-6a63e5ae6bab&quot;,&quot;parentUUID&quot;:&quot;44d16b7b-8cbe-403f-b61f-5d8741862ab2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not refund a transaction that was refunded before&quot;,&quot;fullTitle&quot;:&quot;Refund Transaction API Balance Check (POST) should not refund a transaction that was refunded before&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const coA1 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;001\&quot; },\n});\nconst coA2 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;002\&quot; },\n});\nawait prismaAccounting.userAccount.createMany({\n  data: [\n    {\n      accountName: \&quot;Jarin\&quot;,\n      identifier: \&quot;01317577237\&quot;,\n      status: \&quot;FULL_ACTIVE\&quot;,\n      dailyLimitAmount: 50000,\n      dailyLimitCount: 200000,\n      monthlyLimitAmount: 5000000,\n      monthlyLimitCount: 600000000,\n      maxWalletAmount: 1000000000,\n      minWalletAmount: 500,\n      chartOfAccount_id: coA1.id,\n    },\n    {\n      accountName: \&quot;Sultana\&quot;,\n      identifier: \&quot;01711106485\&quot;,\n      status: \&quot;FULL_ACTIVE\&quot;,\n      dailyLimitAmount: 50000,\n      dailyLimitCount: 200000,\n      monthlyLimitAmount: 5000000,\n      monthlyLimitCount: 600000000,\n      maxWalletAmount: 1000000000,\n      minWalletAmount: 500,\n      chartOfAccount_id: coA2.id,\n    },\n  ],\n});\nconst adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\nconst token = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst account1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nconst account2 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\nconst createdType = await prismaAccounting.transactionType.findMany({\n  where: { createdByAdminIdentifier: \&quot;11\&quot; },\n});\nconst firstTransaction = await prismaAccounting.transaction.create({\n  data: {\n    fromAccountId: account1.id,\n    toAccountId: account2.id,\n    transactionTypeId: createdType[0].id,\n    amount: 1000,\n    referenceNo: \&quot;qqqqqqqqqq\&quot;,\n    note: \&quot;send money\&quot;,\n    status: \&quot;SUCCESSFUL\&quot;,\n  },\n});\nawait prismaAccounting.ledger.createMany({\n  data: [\n    {\n      accountId: account1.id,\n      transactionId: firstTransaction.id,\n      amount: 1000,\n      description: \&quot;send money transaction\&quot;,\n      type: \&quot;DEBIT\&quot;,\n    },\n    {\n      accountId: account2.id,\n      transactionId: firstTransaction.id,\n      amount: 1000,\n      description: \&quot;send money transaction\&quot;,\n      type: \&quot;CREDIT\&quot;,\n    },\n  ],\n});\nawait prismaAccounting.transaction.create({\n  data: {\n    fromAccountId: account2.id,\n    toAccountId: account1.id,\n    transactionTypeId: createdType[0].id,\n    amount: 1000,\n    referenceNo: \&quot;qqqqqqqqqq\&quot;,\n    note: \&quot;Refund transaction\&quot;,\n    description: \&quot;Refund of transaction: qqqqqqqqqq\&quot;,\n    log: \&quot;Refund of transaction: qqqqqqqqqq is Requested By: admin@ppay.com\&quot;,\n    mainTransactionId: firstTransaction.id,\n    isRefunded: true,\n  },\n});\nawait prismaAccounting.ledger.createMany({\n  data: [\n    {\n      accountId: account1.id,\n      transactionId: firstTransaction.id,\n      amount: 1000,\n      description: \&quot;send money transaction\&quot;,\n      type: \&quot;CREDIT\&quot;,\n    },\n    {\n      accountId: account2.id,\n      transactionId: firstTransaction.id,\n      amount: 1000,\n      description: \&quot;send money transaction\&quot;,\n      type: \&quot;DEBIT\&quot;,\n    },\n  ],\n});\nconst transaction = await prismaAccounting.transaction.findMany({\n  where: { referenceNo: \&quot;qqqqqqqqqq\&quot; },\n});\nconst referenceNo = transaction[0]?.referenceNo;\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.refundTransaction}`)\n  .withJson({\n    code: referenceNo,\n  })\n  .expectStatus(406);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 406\n\n201 !== 406\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 406\n\n201 !== 406\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 406\n&quot;},&quot;uuid&quot;:&quot;709f1298-d975-4478-965a-e1d20713d1eb&quot;,&quot;parentUUID&quot;:&quot;44d16b7b-8cbe-403f-b61f-5d8741862ab2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should check that refund will be done only by the admin user&quot;,&quot;fullTitle&quot;:&quot;Refund Transaction API Balance Check (POST) should check that refund will be done only by the admin user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:27,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const coA1 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;001\&quot; },\n});\nconst coA2 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;002\&quot; },\n});\nawait prismaAccounting.userAccount.createMany({\n  data: [\n    {\n      accountName: \&quot;Jarin\&quot;,\n      identifier: \&quot;01317577237\&quot;,\n      status: \&quot;FULL_ACTIVE\&quot;,\n      dailyLimitAmount: 50000,\n      dailyLimitCount: 200000,\n      monthlyLimitAmount: 5000000,\n      monthlyLimitCount: 600000000,\n      maxWalletAmount: 1000000000,\n      minWalletAmount: 500,\n      chartOfAccount_id: coA1.id,\n    },\n    {\n      accountName: \&quot;Sultana\&quot;,\n      identifier: \&quot;01711106485\&quot;,\n      status: \&quot;FULL_ACTIVE\&quot;,\n      dailyLimitAmount: 50000,\n      dailyLimitCount: 200000,\n      monthlyLimitAmount: 5000000,\n      monthlyLimitCount: 600000000,\n      maxWalletAmount: 1000000000,\n      minWalletAmount: 500,\n      chartOfAccount_id: coA2.id,\n    },\n  ],\n});\nconst appUser = {\n  phoneNumber: \&quot;01711106485\&quot;,\n  pin: \&quot;123458\&quot;,\n};\ntoken = generateUserToken(1, appUser.phoneNumber, \&quot;USER\&quot;);\nconst account1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nconst account2 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\nconst createdType = await prismaAccounting.transactionType.findMany({\n  where: { createdByAdminIdentifier: \&quot;11\&quot; },\n});\nconst firstTransaction = await prismaAccounting.transaction.create({\n  data: {\n    fromAccountId: account1.id,\n    toAccountId: account2.id,\n    transactionTypeId: createdType[0].id,\n    amount: 1000,\n    referenceNo: \&quot;qqqqqqqqqq\&quot;,\n    note: \&quot;send money\&quot;,\n    status: \&quot;SUCCESSFUL\&quot;,\n  },\n});\nawait prismaAccounting.ledger.createMany({\n  data: [\n    {\n      accountId: account1.id,\n      transactionId: firstTransaction.id,\n      amount: 1000,\n      description: \&quot;send money transaction\&quot;,\n      type: \&quot;DEBIT\&quot;,\n    },\n    {\n      accountId: account2.id,\n      transactionId: firstTransaction.id,\n      amount: 1000,\n      description: \&quot;send money transaction\&quot;,\n      type: \&quot;CREDIT\&quot;,\n    },\n  ],\n});\nconst transaction = await prismaAccounting.transaction.findMany({\n  where: { referenceNo: \&quot;qqqqqqqqqq\&quot; },\n});\nconst referenceNo = transaction[0]?.referenceNo;\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.refundTransaction}`)\n  .withJson({\n    code: referenceNo,\n  })\n  .expectStatus(401);\nconst transactionId = transaction[0]?.id;\nconst refundedTransaction = await prismaAccounting.transaction.findMany({\n  where: { mainTransactionId: transactionId },\n});\nexpect(refundedTransaction).to.be.empty;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6241a0b8-21c9-49cc-b881-d8e709f7b3c0&quot;,&quot;parentUUID&quot;:&quot;44d16b7b-8cbe-403f-b61f-5d8741862ab2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6b9b6dc7-6ec1-42e2-89f4-6a63e5ae6bab&quot;,&quot;6241a0b8-21c9-49cc-b881-d8e709f7b3c0&quot;],&quot;failures&quot;:[&quot;c41a1bc5-6c91-43d0-bf30-94c97249a9b6&quot;,&quot;709f1298-d975-4478-965a-e1d20713d1eb&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:160,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;bb95e298-0dcf-4559-adb9-1a42b492439a&quot;,&quot;title&quot;:&quot;Active or Inactive Transaction type API Tests (POST)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/transactionType/changeTrxnTypeStatus.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/transactionType/changeTrxnTypeStatus.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Active or Inactive Transaction type API Tests (POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Active or Inactive Transaction type API Tests (POST) \&quot;before all\&quot; hook in \&quot;Active or Inactive Transaction type API Tests (POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;090e0e20-d91e-4772-bb95-21c9110caeb4&quot;,&quot;parentUUID&quot;:&quot;bb95e298-0dcf-4559-adb9-1a42b492439a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Active or Inactive Transaction type API Tests (POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Active or Inactive Transaction type API Tests (POST) \&quot;before each\&quot; hook in \&quot;Active or Inactive Transaction type API Tests (POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting. transactionLegLog.deleteMany({});\nawait prismaAccounting. transactionLeg.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAccounting.chartOfAccount.createMany({\n  data: [\n    {\n      name: \&quot;Account 1\&quot;,\n      description: \&quot;Description for Account 1\&quot;,\n      transactionType: \&quot;SYSTEM\&quot;,\n      headType: \&quot;ASSET\&quot;,\n      code: \&quot;001\&quot;,\n      onlyParent: false,\n      adminId: 1,\n    },\n    {\n      name: \&quot;Account 2\&quot;,\n      description: \&quot;Description for Account 2\&quot;,\n      transactionType: \&quot;SYSTEM\&quot;,\n      headType: \&quot;ASSET\&quot;,\n      code: \&quot;002\&quot;,\n      onlyParent: true,\n      adminId: 1,\n    },\n  ],\n});\nconst account1 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;001\&quot; },\n});\nconst account2 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;002\&quot; },\n});\nconst createdType = await prismaAccounting.transactionType.create({\n  data: {\n    transactionCode: \&quot;223\&quot;,\n    name: \&quot;TypeA\&quot;,\n    description: \&quot;qqqqqqqqqqqqqqqqq\&quot;,\n    minAmount: 66,\n    maxAmount: 666,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: \&quot;11\&quot;,\n    isActive: true,\n    fromChartOfAccount: {\n      connect: { id: account1.id },\n    },\n    toChartOfAccount: {\n      connect: { id: account2.id },\n    },\n  },\n});\ntypeId = createdType.id;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f4df7ed4-4d63-488e-b9ef-a9d383e5988f&quot;,&quot;parentUUID&quot;:&quot;bb95e298-0dcf-4559-adb9-1a42b492439a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Active or Inactive Transaction type API Tests (POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Active or Inactive Transaction type API Tests (POST) \&quot;after all\&quot; hook in \&quot;Active or Inactive Transaction type API Tests (POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dfead698-6b1a-4726-aea9-2f5518778e98&quot;,&quot;parentUUID&quot;:&quot;bb95e298-0dcf-4559-adb9-1a42b492439a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should inactive a type and log the change&quot;,&quot;fullTitle&quot;:&quot;Active or Inactive Transaction type API Tests (POST) should inactive a type and log the change&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\nconst token = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst initialType = await prismaAccounting.transactionType.findUnique({\n  where: { id: typeId },\n});\nexpect(initialType).to.not.be.null;\nexpect(initialType.isActive).to.be.true;\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(\n    `${ApiUrls.apiBaseUrl}${ApiUrls.changeStatusOfType}${typeId}/toggle-status`\n  )\n  .withJson({ isActive: false })\n  .expectStatus(200);\nconst updatedType = await prismaAccounting.transactionType.findUnique({\n  where: { id: typeId },\n});\nexpect(updatedType).to.not.be.null;\nexpect(updatedType.isActive).to.be.false;\nconst logEntry = await prismaAccounting.transactionTypeChangeLog.findFirst({\n  where: {\n    transactionType_id: typeId,\n    changeType: \&quot;CHANGE_STATUS\&quot;,\n  },\n});\nexpect(logEntry).to.not.be.null;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b8101c70-d8d4-4da2-bbad-76324b5e4327&quot;,&quot;parentUUID&quot;:&quot;bb95e298-0dcf-4559-adb9-1a42b492439a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b8101c70-d8d4-4da2-bbad-76324b5e4327&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:46,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;da116cf5-2096-40c1-b1d6-58971d075c44&quot;,&quot;title&quot;:&quot;Create Trxn type API Tests (POST :/v1/transaction-type)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/transactionType/createTrxnType.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/transactionType/createTrxnType.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Create Trxn type API Tests (POST :/v1/transaction-type)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Create Trxn type API Tests (POST :/v1/transaction-type) \&quot;before all\&quot; hook in \&quot;Create Trxn type API Tests (POST :/v1/transaction-type)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await Promise.all([prismaAccounting.$connect()]);\ntoken = generateToken(\n  ADMIN_ID,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;439f84a2-2104-40d3-adc0-b6bb62b49396&quot;,&quot;parentUUID&quot;:&quot;da116cf5-2096-40c1-b1d6-58971d075c44&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Create Trxn type API Tests (POST :/v1/transaction-type)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Create Trxn type API Tests (POST :/v1/transaction-type) \&quot;before each\&quot; hook in \&quot;Create Trxn type API Tests (POST :/v1/transaction-type)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$transaction([\n  prismaAccounting.ledger.deleteMany(),\n  prismaAccounting.transaction.deleteMany(),\n  prismaAccounting. transactionLegLog.deleteMany(),\n  prismaAccounting. transactionLeg.deleteMany(),\n  prismaAccounting.transactionTypeChangeLog.deleteMany(),\n  prismaAccounting.transactionType.deleteMany(),\n  prismaAccounting.userAccount.deleteMany(),\n  prismaAccounting.chartOfAccountLog.deleteMany(),\n  prismaAccounting.chartOfAccount.deleteMany(),\n]);\nconst charOfAccounts = [\n  sampleCharOfAccount,\n  {\n    ...sampleCharOfAccount,\n    name: \&quot;Account B\&quot;,\n    code: \&quot;002\&quot;,\n    onlyParent: true,\n    adminId: ADMIN_ID,\n    description: \&quot;Description for Account 2\&quot;,\n  },\n];\nawait prismaAccounting.chartOfAccount.createMany({\n  data: charOfAccounts,\n});\n[account1, account2] = await prismaAccounting.chartOfAccount.findMany({\n  orderBy: { code: \&quot;asc\&quot; },\n});\nsampleType = {\n  name: \&quot;Send Money\&quot;,\n  description: \&quot;This is a description for the Transaction Type.\&quot;,\n  fromCoa: account1.id,\n  toCoa: account2.id,\n  transactionCode: \&quot;send-money-1001\&quot;,\n  dailyLimit: { count: 20, amount: 30 },\n  weeklyLimit: { count: 20, amount: 30 },\n  monthlyLimit: { count: 20, amount: 30 },\n};&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b9ea061a-b8a1-4a96-bf65-5ddb9fceafb5&quot;,&quot;parentUUID&quot;:&quot;da116cf5-2096-40c1-b1d6-58971d075c44&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Create Trxn type API Tests (POST :/v1/transaction-type)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Create Trxn type API Tests (POST :/v1/transaction-type) \&quot;after all\&quot; hook in \&quot;Create Trxn type API Tests (POST :/v1/transaction-type)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await Promise.all([prismaAccounting.$disconnect()]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5e8b6e72-a555-4d99-b39a-b2a6f59de2e1&quot;,&quot;parentUUID&quot;:&quot;da116cf5-2096-40c1-b1d6-58971d075c44&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create a new type&quot;,&quot;fullTitle&quot;:&quot;Create Trxn type API Tests (POST :/v1/transaction-type) should create a new type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await makeCreateTypeRequest(sampleType).expectStatus(201);\nconst createdType = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: sampleType.transactionCode },\n});\nexpect(createdType).to.not.be.null;\nexpect(createdType.name).to.equal(sampleType.name);\nexpect(createdType.description).to.equal(sampleType.description);\nexpect(createdType.fromChartOfAccountId).to.equal(account1.id);\nexpect(createdType.toChartOfAccountId).to.equal(account2.id);\nexpect(createdType.fromChartOfAccountId).to.equal(sampleType.fromCoa);\nexpect(createdType.toChartOfAccountId).to.equal(sampleType.toCoa);\nexpect(Number(createdType.dailyLimitCount)).to.equal(sampleType.dailyLimit.count);\nexpect(Number(createdType.dailyLimitAmount)).to.equal(sampleType.dailyLimit.amount);\nexpect(Number(createdType.monthlyLimitCount)).to.equal(sampleType.monthlyLimit.count);\nexpect(Number(createdType.monthlyLimitAmount)).to.equal(sampleType.monthlyLimit.amount);\nexpect(Number(createdType.weeklyLimitCount)).to.equal(sampleType.weeklyLimit.count);\nexpect(Number(createdType.weeklyLimitAmount)).to.equal(sampleType.weeklyLimit.amount);\nexpect(createdType.isActive).to.be.true;\nexpect(createdType.createdByAdminId).to.equal(ADMIN_ID);\nexpect(createdType.createdByAdminIdentifier).to.equal(adminUser.email);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected null not to be null&quot;,&quot;estack&quot;:&quot;AssertionError: expected null not to be null\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/accounting/transactionType/createTrxnType.test.js:129:34)&quot;},&quot;uuid&quot;:&quot;d63437e8-cc71-4030-9a7a-3e90277ae15b&quot;,&quot;parentUUID&quot;:&quot;da116cf5-2096-40c1-b1d6-58971d075c44&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for invalid input of type&quot;,&quot;fullTitle&quot;:&quot;Create Trxn type API Tests (POST :/v1/transaction-type) should return 400 for invalid input of type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const invalidType = {\n  ...sampleType,\n  fromCoa: null,\n};\nawait makeCreateTypeRequest(invalidType).expectStatus(400);\nconst dbTypes = await prismaAccounting.transactionType.findMany({\n  where: {\n    name: invalidType.name,\n    description: invalidType.description,\n    fromChartOfAccountId: invalidType.fromCoa,\n    toChartOfAccountId: invalidType.toCoa,\n    transactionCode: invalidType.transactionCode,\n  },\n});\nexpect(dbTypes).to.have.lengthOf(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;db92187b-9c3d-4827-acc4-d38fd7342043&quot;,&quot;parentUUID&quot;:&quot;da116cf5-2096-40c1-b1d6-58971d075c44&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 419 if the type already exists and cannot be created again&quot;,&quot;fullTitle&quot;:&quot;Create Trxn type API Tests (POST :/v1/transaction-type) should return 419 if the type already exists and cannot be created again&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.transactionType.create({\n  data: getPrismaData(sampleType),\n});\nawait makeCreateTypeRequest(sampleType).expectStatus(419);\nconst createdType = await prismaAccounting.transactionType.findMany({\n  where: { transactionCode: sampleType.transactionCode },\n});\nexpect(createdType).to.have.lengthOf(1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3c20bef3-307a-4786-b140-28724196c9d2&quot;,&quot;parentUUID&quot;:&quot;da116cf5-2096-40c1-b1d6-58971d075c44&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should check the logs for creating a type&quot;,&quot;fullTitle&quot;:&quot;Create Trxn type API Tests (POST :/v1/transaction-type) should check the logs for creating a type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await makeCreateTypeRequest(sampleType).expectStatus(201);\nconst createdType = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: sampleType.transactionCode },\n});\nconst logEntry = await prismaAccounting.transactionTypeChangeLog.findMany({\n  where: { transactionType_id: createdType.id },\n});\nexpect(logEntry[0]).to.have.property(\&quot;changeType\&quot;).to.equal(\&quot;CREATE\&quot;);\nexpect(logEntry[0]).to.have.property(\&quot;oldValue\&quot;).to.be.null;\nexpect(logEntry[0]).to.have.property(\&quot;newValue\&quot;).not.to.be.null;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/accounting/transactionType/createTrxnType.test.js:192:48)&quot;},&quot;uuid&quot;:&quot;bf6cb3ef-8167-4f5d-acc5-b2972e0d06b2&quot;,&quot;parentUUID&quot;:&quot;da116cf5-2096-40c1-b1d6-58971d075c44&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;db92187b-9c3d-4827-acc4-d38fd7342043&quot;,&quot;3c20bef3-307a-4786-b140-28724196c9d2&quot;],&quot;failures&quot;:[&quot;d63437e8-cc71-4030-9a7a-3e90277ae15b&quot;,&quot;bf6cb3ef-8167-4f5d-acc5-b2972e0d06b2&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:83,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ce71f282-b9e6-4816-91e9-35641a33099c&quot;,&quot;title&quot;:&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/transactionType/getTrxnType.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/transactionType/getTrxnType.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Type API Tests (:GET /v1/transaction-type) \&quot;before all\&quot; hook in \&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await Promise.all([prismaAccounting.$connect()]);\ntoken = generateToken(\n  ADMIN_ID,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fbaee468-59b0-4b81-bb81-5d092f4feb84&quot;,&quot;parentUUID&quot;:&quot;ce71f282-b9e6-4816-91e9-35641a33099c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Type API Tests (:GET /v1/transaction-type) \&quot;before each\&quot; hook in \&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$transaction([\n  prismaAccounting.ledger.deleteMany(),\n  prismaAccounting.transaction.deleteMany(),\n  prismaAccounting. transactionLegLog.deleteMany(),\n  prismaAccounting. transactionLeg.deleteMany(),\n  prismaAccounting.transactionTypeChangeLog.deleteMany(),\n  prismaAccounting.transactionType.deleteMany(),\n  prismaAccounting.userAccount.deleteMany(),\n  prismaAccounting.chartOfAccountLog.deleteMany(),\n  prismaAccounting.chartOfAccount.deleteMany(),\n]);\nconst charOfAccounts = [\n  sampleCharOfAccount,\n  {\n    ...sampleCharOfAccount,\n    name: \&quot;Account B\&quot;,\n    code: \&quot;002\&quot;,\n    onlyParent: true,\n    adminId: ADMIN_ID,\n    description: \&quot;Description for Account 2\&quot;,\n  },\n];\nawait prismaAccounting.chartOfAccount.createMany({\n  data: charOfAccounts,\n});\n[account1, account2] = await prismaAccounting.chartOfAccount.findMany({\n  orderBy: { code: \&quot;asc\&quot; },\n});\nsampleType = {\n  name: \&quot;Send Money\&quot;,\n  description: \&quot;This is a description for the Transaction Type.\&quot;,\n  fromChartOfAccountId: account1.id,\n  toChartOfAccountId: account2.id,\n  transactionCode: \&quot;send-money-1001\&quot;,\n  createdByAdminId: ADMIN_ID,\n  createdByAdminIdentifier: ADMIN_IDENTIFIER,\n  isActive: true,\n  minAmount: 100,\n  maxAmount: 1000,\n  dailyLimitCount: 20,\n  dailyLimitAmount: 30,\n  monthlyLimitAmount: 30,\n  monthlyLimitCount: 20,\n  weeklyLimitAmount: 100,\n  weeklyLimitCount: 5000,\n};\nconst types = [\n  sampleType,\n  {\n    ...sampleType,\n    name: \&quot;Top Up\&quot;,\n    description: \&quot;Top Up description\&quot;,\n    transactionCode: \&quot;top-up-2001\&quot;,\n  },\n];\nawait prismaAccounting.transactionType.createMany({\n  data: types,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3377a0e2-b02a-4109-9e01-f6ce38474500&quot;,&quot;parentUUID&quot;:&quot;ce71f282-b9e6-4816-91e9-35641a33099c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Type API Tests (:GET /v1/transaction-type) \&quot;after all\&quot; hook in \&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await Promise.all([prismaAccounting.$disconnect()]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2eb7b647-2310-4cd7-96ce-90bf23a21656&quot;,&quot;parentUUID&quot;:&quot;ce71f282-b9e6-4816-91e9-35641a33099c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return all types&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Type API Tests (:GET /v1/transaction-type) should return all types&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const response = await makeGetTypeRequest().expectStatus(200);\nconst typeDB = await prismaAccounting.transactionType.findUnique({\n  where: {\n    transactionCode: sampleType.transactionCode,\n  },\n});\nexpect(response.body.transactiontypes).to.be.an(\&quot;array\&quot;);\nexpect(response.body.transactiontypes).to.have.lengthOf.at.least(1);\n\nconst firstType = response.body.transactiontypes[0];\nexpect(firstType.name).to.equal(\&quot;Send Money\&quot;);\nexpect(firstType.description).to.equal(\&quot;This is a description for the Transaction Type.\&quot;);\nexpect(firstType.transactioncode).to.equal(\&quot;send-money-1001\&quot;);\nexpect(firstType.isactive).to.equal(typeDB.isActive);\nexpect(Number(typeDB.dailyLimitCount)).to.equal(firstType.dailylimit.count);\nexpect(Number(typeDB.dailyLimitAmount)).to.equal(firstType.dailylimit.amount);\nexpect(Number(typeDB.monthlyLimitCount)).to.equal(firstType.monthlylimit.count);\nexpect(Number(typeDB.monthlyLimitAmount)).to.equal(firstType.monthlylimit.amount);\nexpect(Number(typeDB.weeklyLimitCount)).to.equal(firstType.weeklylimit.count);\nexpect(Number(typeDB.weeklyLimitAmount)).to.equal(firstType.weeklylimit.amount);\nconst secondType = response.body.transactiontypes[1];\nexpect(secondType.name).to.equal(\&quot;Top Up\&quot;);\nexpect(secondType.description).to.equal(\&quot;Top Up description\&quot;);\nexpect(secondType.transactioncode).to.equal(\&quot;top-up-2001\&quot;);\nexpect(secondType.isactive).to.equal(typeDB.isActive);\nexpect(Number(typeDB.dailyLimitCount)).to.equal(secondType.dailylimit.count);\nexpect(Number(typeDB.dailyLimitAmount)).to.equal(secondType.dailylimit.amount);\nexpect(Number(typeDB.monthlyLimitCount)).to.equal(secondType.monthlylimit.count);\nexpect(Number(typeDB.monthlyLimitAmount)).to.equal(secondType.monthlylimit.amount);\nexpect(Number(typeDB.weeklyLimitCount)).to.equal(secondType.weeklylimit.count);\nexpect(Number(typeDB.weeklyLimitAmount)).to.equal(secondType.weeklylimit.amount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b5ff340d-5ca0-43cd-aec9-1b900ba61756&quot;,&quot;parentUUID&quot;:&quot;ce71f282-b9e6-4816-91e9-35641a33099c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b5ff340d-5ca0-43cd-aec9-1b900ba61756&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0a0083a5-7c97-45a3-91a5-762bb783b278&quot;,&quot;title&quot;:&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/transactionType/getTrxnTypeDetails.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/transactionType/getTrxnTypeDetails.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Type API Tests (:GET /v1/transaction-type) \&quot;before all\&quot; hook in \&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ab41051d-fc57-450c-93a2-e6520f6f3e94&quot;,&quot;parentUUID&quot;:&quot;0a0083a5-7c97-45a3-91a5-762bb783b278&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Type API Tests (:GET /v1/transaction-type) \&quot;before each\&quot; hook in \&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAccounting.chartOfAccount.createMany({\n    data: [\n        {\n            name: &#x27;Account 1&#x27;,\n            description: &#x27;Description for Account 1&#x27;,\n            transactionType: &#x27;SYSTEM&#x27;,\n            headType: &#x27;ASSET&#x27;,\n            code: &#x27;001&#x27;,\n            onlyParent: false,\n            adminId: 1\n        },\n        {\n            name: &#x27;Account 2&#x27;,\n            description: &#x27;Description for Account 2&#x27;,\n            transactionType: &#x27;SYSTEM&#x27;,\n            headType: &#x27;ASSET&#x27;,\n            code: &#x27;002&#x27;,\n            onlyParent: true,\n            adminId: 1\n        }\n    ]\n});\nconst account1 = await prismaAccounting.chartOfAccount.findUnique({\n    where: {\n        code: &#x27;001&#x27;\n    }\n});\nconst account2 = await prismaAccounting.chartOfAccount.findUnique({\n    where: {\n        code: &#x27;002&#x27;\n    }\n});\n\nconst createdType = await prismaAccounting.transactionType.create({\n    data: {\n        transactionCode: &#x27;223&#x27;,\n        name: &#x27;TypeA&#x27;,\n        description: &#x27;qqqqqqqqqqqqqqqqq&#x27;,\n        minAmount: 66,\n        maxAmount: 666,\n        createdByAdminId: 1,\n        createdByAdminIdentifier: &#x27;11&#x27;,\n        isActive: true,\n        fromChartOfAccountId: account1.id,\n        toChartOfAccountId: account2.id,\n        minAmount: 100,\n        maxAmount: 1000,\n        dailyLimitCount: 20,\n        dailyLimitAmount: 30,\n        monthlyLimitAmount: 30,\n        monthlyLimitCount: 20,\n        weeklyLimitAmount: 100,\n        weeklyLimitCount: 5000,\n    },\n});\ntypeId = createdType.id;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6b9047be-5213-495c-b3e2-400a78c3a53c&quot;,&quot;parentUUID&quot;:&quot;0a0083a5-7c97-45a3-91a5-762bb783b278&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Type API Tests (:GET /v1/transaction-type) \&quot;after all\&quot; hook in \&quot;GET Trxn Type API Tests (:GET /v1/transaction-type)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dc88e6d7-3113-44e9-a2e1-bf503a46e4b5&quot;,&quot;parentUUID&quot;:&quot;0a0083a5-7c97-45a3-91a5-762bb783b278&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return transaction type detail&quot;,&quot;fullTitle&quot;:&quot;GET Trxn Type API Tests (:GET /v1/transaction-type) should return transaction type detail&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n    email: \&quot;admin@ppay.com\&quot;,\n    roles: \&quot;Admin\&quot;,\n    adminRole: \&quot;ADMIN\&quot;\n};\ntoken = generateToken(1, adminUser.email, adminUser.roles, adminUser.adminRole);\nconst response = await pactum\n    .spec()\n    .withMethod(&#x27;GET&#x27;)\n    .withBearerToken(token)\n    .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.getTypes}/${typeId}`)\n    .expectStatus(200);\nconst typeDB = await prismaAccounting.transactionType.findUnique({\n    where: {\n        transactionCode: &#x27;223&#x27;,\n    },\n});\nexpect(response.body.name).to.equal(typeDB.name);\nexpect(response.body.description).to.equal(typeDB.description);\nexpect(response.body.transactioncode).to.equal(typeDB.transactionCode);\nexpect(response.body.min).to.equal(typeDB.minAmount);\nexpect(response.body.max).to.equal(typeDB.maxAmount);\nexpect(response.body.isactive).to.equal(typeDB.isActive);\nexpect(Number(typeDB.dailyLimitCount)).to.equal(response.body.dailylimit.count);\nexpect(Number(typeDB.dailyLimitAmount)).to.equal(response.body.dailylimit.amount);\nexpect(Number(typeDB.monthlyLimitCount)).to.equal(response.body.monthlylimit.count);\nexpect(Number(typeDB.monthlyLimitAmount)).to.equal(response.body.monthlylimit.amount);\nexpect(Number(typeDB.weeklyLimitCount)).to.equal(response.body.weeklylimit.count);\nexpect(Number(typeDB.weeklyLimitAmount)).to.equal(response.body.weeklylimit.amount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;525a51bb-128e-43cb-8a42-1187143d1e83&quot;,&quot;parentUUID&quot;:&quot;0a0083a5-7c97-45a3-91a5-762bb783b278&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;525a51bb-128e-43cb-8a42-1187143d1e83&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:20,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;96af8ab5-c620-49d3-a7ba-05a7b7bc8f33&quot;,&quot;title&quot;:&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/accounting/transactionType/updateTrxnType.test.js&quot;,&quot;file&quot;:&quot;/src/accounting/transactionType/updateTrxnType.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/) \&quot;before all\&quot; hook in \&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;51c59c6c-f727-4d0b-8dc4-0b046d466d66&quot;,&quot;parentUUID&quot;:&quot;96af8ab5-c620-49d3-a7ba-05a7b7bc8f33&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/) \&quot;before each\&quot; hook in \&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\naccount1 = await prismaAccounting.chartOfAccount.create({\n  data: {\n    name: \&quot;Account 1\&quot;,\n    description: \&quot;Description for Account 1\&quot;,\n    transactionType: \&quot;SYSTEM\&quot;,\n    headType: \&quot;ASSET\&quot;,\n    code: \&quot;001\&quot;,\n    onlyParent: false,\n    adminId: 1,\n  },\n});\naccount2 = await prismaAccounting.chartOfAccount.create({\n  data: {\n    name: \&quot;Account 2\&quot;,\n    description: \&quot;Description for Account 2\&quot;,\n    transactionType: \&quot;SYSTEM\&quot;,\n    headType: \&quot;ASSET\&quot;,\n    code: \&quot;002\&quot;,\n    onlyParent: true,\n    adminId: 1,\n  },\n});\nawait prismaAccounting.transactionType.create({\n  data: {\n    transactionCode: \&quot;223\&quot;,\n    name: \&quot;TypeA\&quot;,\n    description: \&quot;qqqqqqqqqqqqqqqqq\&quot;,\n    minAmount: 66,\n    maxAmount: 666,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: \&quot;11\&quot;,\n    isActive: true,\n    fromChartOfAccountId: account1.id,\n    toChartOfAccountId: account2.id,\n    dailyLimitCount: 20,\n    dailyLimitAmount: 30,\n    monthlyLimitAmount: 30,\n    monthlyLimitCount: 20,\n    weeklyLimitAmount: 100,\n    weeklyLimitCount: 5000,\n  },\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;478d855e-bd41-4c9b-9bc9-f4e766600064&quot;,&quot;parentUUID&quot;:&quot;96af8ab5-c620-49d3-a7ba-05a7b7bc8f33&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/) \&quot;after all\&quot; hook in \&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;16f6b100-7ab3-4170-86fc-b80fedf5d4b2&quot;,&quot;parentUUID&quot;:&quot;96af8ab5-c620-49d3-a7ba-05a7b7bc8f33&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should update a type with valid name, description, transaction code and limits of type&quot;,&quot;fullTitle&quot;:&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/) should update a type with valid name, description, transaction code and limits of type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst type = await prismaAccounting.transactionType.findUnique({\n  where: {\n    transactionCode: \&quot;223\&quot;,\n  },\n});\nconst typeId = type.id;\nconst typeToUpdate = {\n  name: \&quot;NEw NEw Account Name111\&quot;,\n  description: \&quot;New New This is a description for the chart of account.\&quot;,\n  transactionCode: \&quot;3311\&quot;,\n  dailyLimit: {\n    count: 10,\n    amount: 60,\n  },\n  monthlyLimit: {\n    count: 30,\n    amount: 50,\n  },\n  weeklyLimit: {\n    count: 20,\n    amount: 30,\n  },\n};\n\nawait pactum\n  .spec()\n  .withMethod(\&quot;PATCH\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.updateType}${typeId}`)\n  .withJson(typeToUpdate)\n  .expectStatus(200);\nconst updatedTypeRecord = await prismaAccounting.transactionType.findUnique(\n  {\n    where: { id: typeId },\n  }\n);\nexpect(updatedTypeRecord).to.not.be.null;\nexpect(updatedTypeRecord.name).to.equal(typeToUpdate.name);\nexpect(updatedTypeRecord.description).to.equal(typeToUpdate.description);\nexpect(updatedTypeRecord.transactionCode).to.equal(\n  typeToUpdate.transactionCode\n);\nexpect(Number(updatedTypeRecord.dailyLimitCount)).to.equal(\n  typeToUpdate.dailyLimit.count\n);\nexpect(Number(updatedTypeRecord.dailyLimitAmount)).to.equal(\n  typeToUpdate.dailyLimit.amount\n);\nexpect(Number(updatedTypeRecord.monthlyLimitCount)).to.equal(\n  typeToUpdate.monthlyLimit.count\n);\nexpect(Number(updatedTypeRecord.monthlyLimitAmount)).to.equal(\n  typeToUpdate.monthlyLimit.amount\n);\nexpect(Number(updatedTypeRecord.weeklyLimitCount)).to.equal(\n  typeToUpdate.weeklyLimit.count\n);\nexpect(Number(updatedTypeRecord.weeklyLimitAmount)).to.equal(\n  typeToUpdate.weeklyLimit.amount\n);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 200\n\n201 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 200\n\n201 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 200\n&quot;},&quot;uuid&quot;:&quot;ef95e68c-c4a2-421b-8914-3fad802eeb1a&quot;,&quot;parentUUID&quot;:&quot;96af8ab5-c620-49d3-a7ba-05a7b7bc8f33&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should update a type with valid name, description and transaction code of type&quot;,&quot;fullTitle&quot;:&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/) should update a type with valid name, description and transaction code of type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst type = await prismaAccounting.transactionType.findUnique({\n  where: {\n    transactionCode: \&quot;223\&quot;,\n  },\n});\nconst typeId = type.id;\nconst typeToUpdate = {\n  name: \&quot;NEw NEw Account Name111\&quot;,\n  description: \&quot;New New This is a description for the chart of account.\&quot;,\n  transactionCode: \&quot;3311\&quot;,\n  dailyLimitCount: 20,\n  dailyLimitAmount: 30,\n  monthlyLimitAmount: 30,\n  monthlyLimitCount: 20,\n  weeklyLimitAmount: 100,\n  weeklyLimitCount: 5000,\n};\n\nawait pactum\n  .spec()\n  .withMethod(\&quot;PATCH\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.updateType}${typeId}`)\n  .withJson(typeToUpdate)\n  .expectStatus(200);\nconst updatedTypeRecord = await prismaAccounting.transactionType.findUnique(\n  {\n    where: { id: typeId },\n  }\n);\nexpect(updatedTypeRecord).to.not.be.null;\nexpect(updatedTypeRecord.name).to.equal(typeToUpdate.name);\nexpect(updatedTypeRecord.description).to.equal(typeToUpdate.description);\nexpect(updatedTypeRecord.transactionCode).to.equal(\n  typeToUpdate.transactionCode\n);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 201 !== 200\n\n201 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 201 !== 200\n\n201 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 201\n+ 200\n&quot;},&quot;uuid&quot;:&quot;28bfdc42-3a5a-40d2-918c-7a4d00cad657&quot;,&quot;parentUUID&quot;:&quot;96af8ab5-c620-49d3-a7ba-05a7b7bc8f33&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should not let user insert negative value in limits&quot;,&quot;fullTitle&quot;:&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/) should not let user insert negative value in limits&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst type = await prismaAccounting.transactionType.findUnique({\n  where: {\n    transactionCode: \&quot;223\&quot;,\n  },\n});\nconst typeId = type.id;\nconst typeToUpdate = {\n  name: \&quot;NEw NEw Account Name111\&quot;,\n  description: \&quot;New New This is a description for the chart of account.\&quot;,\n  transactionCode: \&quot;3311\&quot;,\n  dailyLimit: {\n    count: -10,\n    amount: -60,\n  },\n  monthlyLimit: {\n    count: -30,\n    amount: -50,\n  },\n  weeklyLimit: {\n    count: -20,\n    amount: -30,\n  },\n};\n\nawait pactum\n  .spec()\n  .withMethod(\&quot;PATCH\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.updateType}${typeId}`)\n  .withJson(typeToUpdate)\n  .expectStatus(400);\nconst updatedTypeRecord = await prismaAccounting.transactionType.findUnique(\n  {\n    where: { id: typeId },\n  }\n);\nexpect(type).to.not.be.null;\nexpect(type.name).to.equal(updatedTypeRecord.name);\nexpect(type.description).to.equal(updatedTypeRecord.description);\nexpect(type.fromChartOfAccountId).to.equal(updatedTypeRecord.fromChartOfAccountId);\nexpect(type.toChartOfAccountId).to.equal(updatedTypeRecord.toChartOfAccountId);\nexpect(type.fromChartOfAccountId).to.equal(updatedTypeRecord.fromChartOfAccountId);\nexpect(type.toChartOfAccountId).to.equal(updatedTypeRecord.toChartOfAccountId);\nexpect(Number(type.dailyLimitCount)).to.equal(Number(updatedTypeRecord.dailyLimitCount));\nexpect(Number(type.dailyLimitAmount)).to.equal(Number(updatedTypeRecord.dailyLimitAmount));\nexpect(Number(type.monthlyLimitCount)).to.equal(Number(updatedTypeRecord.monthlyLimitCount));\nexpect(Number(type.monthlyLimitAmount)).to.equal(Number(updatedTypeRecord.monthlyLimitAmount));\nexpect(Number(type.weeklyLimitCount)).to.equal(Number(updatedTypeRecord.weeklyLimitCount));\nexpect(Number(type.weeklyLimitAmount)).to.equal(Number(updatedTypeRecord.weeklyLimitAmount));\nexpect(type.isActive).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2bb9d6d6-7de4-4d1c-927a-0ebb732fd384&quot;,&quot;parentUUID&quot;:&quot;96af8ab5-c620-49d3-a7ba-05a7b7bc8f33&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if attempting to update non-allowed fields like fromCoa and toCoa&quot;,&quot;fullTitle&quot;:&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/) should return 400 if attempting to update non-allowed fields like fromCoa and toCoa&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst typeWithInvalidFields = {\n  fromChartOfAccountId: account2,\n  toChartOfAccountId: account1,\n  transactionCode: \&quot;3311\&quot;,\n};\nconst type = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;223\&quot; },\n});\nconst typeId = type.id;\nawait pactum\n  .spec()\n  .withMethod(\&quot;PATCH\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.updateType}${typeId}`)\n  .withJson({\n    fromCoa: account1.id,\n    toCoa: account2.id,\n    transactionCode: \&quot;3311\&quot;,\n  })\n  .expectStatus(400);\nconst typeRecord = await prismaAccounting.transactionType.findUnique({\n  where: { id: typeId },\n});\nexpect(typeRecord).to.not.be.null;\nexpect(typeRecord.fromChartOfAccountId).to.not.equal(\n  typeWithInvalidFields.fromChartOfAccountId\n);\nexpect(typeRecord.toChartOfAccountId).to.not.equal(\n  typeWithInvalidFields.toChartOfAccountId\n);\nexpect(typeRecord.transactionCode).to.not.equal(\n  typeWithInvalidFields.transactionCode\n);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b7f2bb1e-b8ff-4d5f-831d-8d1a93d0d2e8&quot;,&quot;parentUUID&quot;:&quot;96af8ab5-c620-49d3-a7ba-05a7b7bc8f33&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should check the logs for updating a type&quot;,&quot;fullTitle&quot;:&quot;Update Transaction Type API Tests (PATCH  :/v1/transaction-type/) should check the logs for updating a type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst type = await prismaAccounting.transactionType.findUnique({\n  where: {\n    transactionCode: \&quot;223\&quot;,\n  },\n});\nconst typeId = type.id;\nconst typeToUpdate = {\n  name: \&quot;NEw NEw Account Name111\&quot;,\n  description: \&quot;New New This is a description for the chart of account.\&quot;,\n  transactionCode: \&quot;3311\&quot;,\n  dailyLimit: {\n    count: 10,\n    amount: 60,\n  },\n  monthlyLimit: {\n    count: 30,\n    amount: 50,\n  },\n  weeklyLimit: {\n    count: 20,\n    amount: 30,\n  },\n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;PATCH\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.updateType}${typeId}`)\n  .withJson(typeToUpdate);\nconst updatedTypeRecord = await prismaAccounting.transactionType.findUnique(\n  {\n    where: { id: typeId },\n  }\n);\nconst logEntry = await prismaAccounting.transactionTypeChangeLog.findMany({\n  where: { transactionType_id: updatedTypeRecord.id },\n});\nexpect(logEntry[0]).to.have.property(\&quot;changeType\&quot;).to.equal(\&quot;UPDATE\&quot;);\nexpect(logEntry[0]).to.have.property(\&quot;oldValue\&quot;).not.to.be.null;\nexpect(logEntry[0]).to.have.property(\&quot;oldValue\&quot;).not.to.be.null;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: Target cannot be null or undefined.&quot;,&quot;estack&quot;:&quot;AssertionError: Target cannot be null or undefined.\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/accounting/transactionType/updateTrxnType.test.js:403:33)&quot;},&quot;uuid&quot;:&quot;e2c60c1b-5653-44a9-9307-4253607a5ff8&quot;,&quot;parentUUID&quot;:&quot;96af8ab5-c620-49d3-a7ba-05a7b7bc8f33&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2bb9d6d6-7de4-4d1c-927a-0ebb732fd384&quot;,&quot;b7f2bb1e-b8ff-4d5f-831d-8d1a93d0d2e8&quot;],&quot;failures&quot;:[&quot;ef95e68c-c4a2-421b-8914-3fad802eeb1a&quot;,&quot;28bfdc42-3a5a-40d2-918c-7a4d00cad657&quot;,&quot;e2c60c1b-5653-44a9-9307-4253607a5ff8&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:85,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2869d615-cd15-471f-84bb-5532f19135d2&quot;,&quot;title&quot;:&quot;API Check: Add Money(POST)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/addMoney/addMoney.test.js&quot;,&quot;file&quot;:&quot;/src/addMoney/addMoney.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;API Check: Add Money(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Add Money(POST) \&quot;before all\&quot; hook in \&quot;API Check: Add Money(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c763670b-9941-45fb-886a-6dec609e1fa2&quot;,&quot;parentUUID&quot;:&quot;2869d615-cd15-471f-84bb-5532f19135d2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;API Check: Add Money(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Add Money(POST) \&quot;before each\&quot; hook in \&quot;API Check: Add Money(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:128,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\ntoken = generateUserToken(userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\ntopUpProvider = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;top-up-providers-01\&quot;\n);\nconst transactionTypes = await setupTransactionTypes(chartOfAccounts);\nawait createUserAccounts(chartOfAccounts);\nsender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nreceiver = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\ngp = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;gp-wallet-01\&quot; },\n});\nteletalk = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;teletalk-wallet-01\&quot; },\n});\nbanglalink = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;bl-wallet-01\&quot; },\n});\nconst type = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;1001\&quot; },\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5e2008aa-2775-432a-b7ba-7f2c59f35e4b&quot;,&quot;parentUUID&quot;:&quot;2869d615-cd15-471f-84bb-5532f19135d2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;API Check: Add Money(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Add Money(POST) \&quot;after all\&quot; hook in \&quot;API Check: Add Money(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nreceiver = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\nonholdUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577238\&quot; }\n});\nmaxwallet = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577210\&quot; }\n});\ndailyLimitAmountUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01715170020\&quot; }\n});\nconst testConfig = {\n  baseUrl: ApiUrls.apiBaseUrl,\n  endpoint: ApiUrls.doAddMoney,\n  token: token,\n  sender: sender,\n  receiver: receiver,\n  type: \&quot;Top Up\&quot;,\n  database: [prismaApi.addMoneyLogs],\n  transactionTypeCode: \&quot;1001\&quot;,\n  userId: userId.id,\n  requestBody: {\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;Jarin\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1001\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n    amount: 50,\n  },\n  requestBodyForNotFullActiveUser: {\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;Jarin\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1001\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n    amount: 50,\n  },\n  requestBodyForMinWalleAmount: {\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;requestBodyForMinWalleAmount\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1001\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n    amount: 9,\n  },\n  requestBodyForMaxWalleAmount: {\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;requestBodyForMaxWalleAmount\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1001\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n    amount: 1001,\n  },\n  requestBodyForDailyLimitAmount: {\n    amount: 100,\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;requestBodyForMaxWalleAmount\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1001\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n  },\n  requestBodyForTypeMinAmount: {\n    amount: 5,\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;requestBodyForMaxWalleAmount\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1001\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n  },\n  requestBodyForTypeMaxAmount: {\n    amount: 1000000,\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;requestBodyForMaxWalleAmount\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1001\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n  },\n}\nawait runTransactionTests(testConfig);\nawait prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f1101e24-24f6-4cd2-8c71-9e49a629b293&quot;,&quot;parentUUID&quot;:&quot;2869d615-cd15-471f-84bb-5532f19135d2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 200 for successful add money from bank and save the transaction&quot;,&quot;fullTitle&quot;:&quot;API Check: Add Money(POST) should return 200 for successful add money from bank and save the transaction&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doAddMoney}`)\n  .withBearerToken(token)\n  .withJson({\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;Jarin\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1001\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n    amount: 50,\n    save: true\n  })\n  .expectStatus(200);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\nawait checkSuccess({\n  groupId: \&quot;topup\&quot;,\n  topic: \&quot;add_money_bank_card_mfs\&quot;,\n  log: &#x27;Add Money: From tcs to 01317577237&#x27;,\n  amount: 50,\n  callback: async () =&gt; {\n    const addMoneyTable = await prismaApi.addMoneyLogs.findMany({\n      where: { userId: userId.id },\n    });\n    const saveAddMoney = await prismaApi.addMoneySave.findMany({\n      where: { addFundId: addMoneyTable.id },\n    });\n    expect(saveAddMoney).to.have.lengthOf(1);\n    expect(saveAddMoney[0].accountNumber).to.include(\&quot;123131324234\&quot;);\n    expect(saveAddMoney[0].accountName).to.equal(\&quot;Jarin\&quot;);\n    expect(saveAddMoney[0].branchName).to.equal(\&quot;Kalabagan\&quot;);\n    expect(saveAddMoney[0].districtName).to.equal(\&quot;Dhaka\&quot;);\n    expect(saveAddMoney[0].accountType).to.equal(\&quot;BANK\&quot;);\n    expect(addMoneyTable[0].status).to.equal(\&quot;SUCCESS\&quot;);\n    expect(addMoneyTable[0].userId).to.equal(userId.id);\n  }\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 400 !== 200\n\n400 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 400 !== 200\n\n400 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 400\n+ 200\n&quot;},&quot;uuid&quot;:&quot;1fda95e1-3f94-405d-9c6b-a25fab029d7e&quot;,&quot;parentUUID&quot;:&quot;2869d615-cd15-471f-84bb-5532f19135d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for successful add money to card and save the transaction&quot;,&quot;fullTitle&quot;:&quot;API Check: Add Money(POST) should return 200 for successful add money to card and save the transaction&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doAddMoney}`)\n  .withBearerToken(token)\n  .withJson({\n    cardNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;Jarin\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1001\&quot;,\n    accountType: \&quot;CARD\&quot;,\n    cardType: \&quot;VISA\&quot;,\n    distributorId: 2,\n    amount: 50,\n  })\n  .expectStatus(200);\nawait checkSuccess({\n  groupId: \&quot;topup\&quot;,\n  topic: \&quot;add_money_bank_card_mfs\&quot;,\n  log: &#x27;Add Money: From tcs-card-visa to 01317577237&#x27;,\n  amount: 50,\n  callback: async () =&gt; {\n    const addMoneyTable = await prismaApi.addMoneyLogs.findMany({\n      where: { userId: userId.id },\n    });\n    const saveAddMoney = await prismaApi.addMoneySave.findMany({\n      where: { topUpId: addMoneyTable.id },\n    });\n    expect(saveAddMoney).to.have.lengthOf(1);\n    expect(addMoneyTable[0].status).to.equal(\&quot;SUCCESS\&quot;);\n    expect(addMoneyTable[0].userId).to.equal(userId.id);\n  }\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 400 !== 200\n\n400 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 400 !== 200\n\n400 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 400\n+ 200\n&quot;},&quot;uuid&quot;:&quot;3de6c347-164d-418b-babf-4d2e2b711420&quot;,&quot;parentUUID&quot;:&quot;2869d615-cd15-471f-84bb-5532f19135d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for successful add money to mfs and save the transaction&quot;,&quot;fullTitle&quot;:&quot;API Check: Add Money(POST) should return 200 for successful add money to mfs and save the transaction&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doAddMoney}`)\n  .withBearerToken(token)\n  .withJson({\n    transactionCode: \&quot;1001\&quot;,\n    accountType: \&quot;MFS\&quot;,\n    distributorId: 3,\n    amount: 50,\n    phone: \&quot;01711106485\&quot;,\n    mfsType: \&quot;BKASH\&quot;,\n  })\n  .expectStatus(200);\nawait checkSuccess({\n  groupId: \&quot;topup\&quot;,\n  topic: \&quot;add_money_bank_card_mfs\&quot;,\n  log: &#x27;Add Money: From tcs-mfs-bkash to 01317577237&#x27;,\n  amount: 50,\n  callback: async () =&gt; {\n    const addMoneyTable = await prismaApi.addMoneyLogs.findMany({\n      where: { userId: userId.id },\n    });\n    const saveAddMoney = await prismaApi.addMoneySave.findMany({\n      where: { topUpId: addMoneyTable.id },\n    });\n    expect(saveAddMoney).to.have.lengthOf(1);\n    expect(addMoneyTable[0].status).to.equal(\&quot;SUCCESS\&quot;);\n    expect(addMoneyTable[0].userId).to.equal(userId.id);\n  }\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 400 !== 200\n\n400 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 400 !== 200\n\n400 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 400\n+ 200\n&quot;},&quot;uuid&quot;:&quot;0893a4c7-8d89-4efd-9f88-e4109e4b6406&quot;,&quot;parentUUID&quot;:&quot;2869d615-cd15-471f-84bb-5532f19135d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if user selects Bank type and do not provide accountNumber and bank distributor in add money&quot;,&quot;fullTitle&quot;:&quot;API Check: Add Money(POST) should return 400 if user selects Bank type and do not provide accountNumber and bank distributor in add money&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doAddMoney}`)\n  .withBearerToken(token)\n  .withJson({\n    accountName: \&quot;Jarin\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1001\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    amount: 50,\n  })\n  .expectStatus(400);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 400\n\n500 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 400\n\n500 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 400\n&quot;},&quot;uuid&quot;:&quot;9f260ccf-2737-4d6e-990e-e7efa087fce9&quot;,&quot;parentUUID&quot;:&quot;2869d615-cd15-471f-84bb-5532f19135d2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;1fda95e1-3f94-405d-9c6b-a25fab029d7e&quot;,&quot;3de6c347-164d-418b-babf-4d2e2b711420&quot;,&quot;0893a4c7-8d89-4efd-9f88-e4109e4b6406&quot;,&quot;9f260ccf-2737-4d6e-990e-e7efa087fce9&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:52,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;b650ab23-028f-4616-b718-4482e3abfef3&quot;,&quot;title&quot;:&quot;Get Saved Transaction After Add Money&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/addMoney/getSaveTrxnAddMoney.test.js&quot;,&quot;file&quot;:&quot;/src/addMoney/getSaveTrxnAddMoney.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Get Saved Transaction After Add Money\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Add Money \&quot;before all\&quot; hook in \&quot;Get Saved Transaction After Add Money\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1cf4e910-9b08-46d0-8d6f-de2069015dad&quot;,&quot;parentUUID&quot;:&quot;b650ab23-028f-4616-b718-4482e3abfef3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook for \&quot;should get saved add money transaction list\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Add Money \&quot;before each\&quot; hook for \&quot;should get saved add money transaction list\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:177,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId1 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\nuserId2 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01711106485\&quot;,\n  },\n});\ntokenUser1 = generateUserToken(userId1.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\ntokenUser2 = generateUserToken(userId2.id, \&quot;01711106485\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\nawait setupTransactionTypes(chartOfAccounts);\nconst addMoneyType = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;1001\&quot; },\n});\naddMoneyTrxnTypeId = addMoneyType.id;\nconst bankToEwalletType = await prismaAccounting.transactionType.findUnique(\n  {\n    where: { transactionCode: \&quot;1000\&quot; },\n  }\n);\nbankToEwalletTrxnTypeId = bankToEwalletType\n  ? bankToEwalletType.id\n  : addMoneyType.id;\nawait createUserAccounts(chartOfAccounts);\ncustomerAccount1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\ndistributorAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;city-tcs-01\&quot; },\n});\newalletAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;ewallet-01\&quot; },\n});\nawait addInitialBalance(distributorAccount, 100000);\nawait addInitialBalance(ewalletAccount, 100000);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;identifier&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;identifier&#x27;)\n    at file:///opt/app/src/utils/addInitialBalance.js:42:106\n    at async Proxy._transactionWithCallback (prisma/generated/accounting/generated/accounting/runtime/library.js:130:7983)\n    at async addInitialBalance (file:///opt/app/src/utils/addInitialBalance.js:27:12)\n    at async Context.&lt;anonymous&gt; (file:///opt/app/src/addMoney/getSaveTrxnAddMoney.test.js:95:5)&quot;},&quot;uuid&quot;:&quot;bd88d23f-0426-4536-ae8d-1d08abbc5690&quot;,&quot;parentUUID&quot;:&quot;b650ab23-028f-4616-b718-4482e3abfef3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Get Saved Transaction After Add Money\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Add Money \&quot;after all\&quot; hook in \&quot;Get Saved Transaction After Add Money\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$disconnect();\nawait prismaApi.$disconnect();\nawait prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cb29225e-809c-406d-80de-8cac29144d1d&quot;,&quot;parentUUID&quot;:&quot;b650ab23-028f-4616-b718-4482e3abfef3&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get saved add money transaction list&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Add Money should get saved add money transaction list&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await insertAddMoneySavedTransaction({\n  accountName: \&quot;John Doe\&quot;,\n  accountNumber: \&quot;1234567890\&quot;,\n  accountType: \&quot;BANK\&quot;,\n  amount: 1000,\n  bankName: \&quot;Example Bank\&quot;,\n  branchName: \&quot;Main Branch\&quot;,\n  cardType: \&quot;VISA\&quot;,\n  districtName: \&quot;Central District\&quot;,\n  fromAccount: \&quot;city-tcs-01\&quot;,\n  toAccount: \&quot;01317577237\&quot;,\n  userId: userId1.id,\n});\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.saveTrxnAddMoney}`)\n  .expectStatus(200);\nconst savedAddMoneyTrxns = await prismaApi.addMoneySave.findMany({});\nexpect(savedAddMoneyTrxns).to.have.lengthOf(1);\nexpect(savedAddMoneyTrxns[0].amount.toString()).to.equal(\&quot;1000\&quot;);\nexpect(savedAddMoneyTrxns[0].isSave).to.be.true;\nexpect(savedAddMoneyTrxns[0].fromAccount).to.equal(\&quot;city-tcs-01\&quot;);\nexpect(savedAddMoneyTrxns[0].toAccount).to.equal(\&quot;01317577237\&quot;);\nexpect(savedAddMoneyTrxns[0].type).to.equal(\&quot;BANK\&quot;);\nexpect(savedAddMoneyTrxns[0].userId.toString()).to.equal(\n  userId1.id.toString()\n);\nexpect(savedAddMoneyTrxns[0].accountName).to.equal(\&quot;John Doe\&quot;);\nexpect(savedAddMoneyTrxns[0].accountNumber).to.equal(\&quot;1234567890\&quot;);\nexpect(savedAddMoneyTrxns[0].bankName).to.equal(\&quot;Example Bank\&quot;);\nexpect(savedAddMoneyTrxns[0].branchName).to.equal(\&quot;Main Branch\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c10b068c-8c5c-49c6-8d44-72b9158abe3e&quot;,&quot;parentUUID&quot;:&quot;b650ab23-028f-4616-b718-4482e3abfef3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should show the first add money transaction of bank account even after multiple transactions with the same bank account&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Add Money should show the first add money transaction of bank account even after multiple transactions with the same bank account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await insertAddMoneySavedTransaction({\n  accountName: \&quot;John Doe\&quot;,\n  accountNumber: \&quot;1234567890\&quot;,\n  accountType: \&quot;BANK\&quot;,\n  amount: 1000,\n  bankName: \&quot;Example Bank\&quot;,\n  branchName: \&quot;Main Branch\&quot;,\n  cardType: \&quot;VISA\&quot;,\n  districtName: \&quot;Central District\&quot;,\n  fromAccount: \&quot;city-tcs-01\&quot;,\n  toAccount: \&quot;01317577237\&quot;,\n  userId: userId1.id,\n});\nawait insertAddMoneySavedTransaction({\n  accountName: \&quot;John Doe\&quot;,\n  accountNumber: \&quot;1234567890\&quot;,\n  accountType: \&quot;BANK\&quot;,\n  amount: 2000,\n  bankName: \&quot;Example Bank\&quot;,\n  branchName: \&quot;Main Branch\&quot;,\n  cardType: \&quot;VISA\&quot;,\n  districtName: \&quot;Central District\&quot;,\n  fromAccount: \&quot;city-tcs-01\&quot;,\n  toAccount: \&quot;01317577237\&quot;,\n  userId: userId1.id,\n});\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.saveTrxnAddMoney}`)\n  .expectStatus(200)\n  .returns(\&quot;body\&quot;);\nconst savedAddMoneyTrxns = await prismaApi.addMoneySave.findMany({});\nexpect(savedAddMoneyTrxns).to.have.lengthOf(1);\nexpect(savedAddMoneyTrxns[0].amount.toString()).to.equal(\&quot;1000\&quot;);\nexpect(savedAddMoneyTrxns[0].accountNumber).to.equal(\&quot;1234567890\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;36806e4f-8028-4654-82f3-4015a15d03c4&quot;,&quot;parentUUID&quot;:&quot;b650ab23-028f-4616-b718-4482e3abfef3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should save only one add money transaction per unique bank account&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Add Money should save only one add money transaction per unique bank account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const bankAccounts = [\n  \&quot;1234567891\&quot;,\n  \&quot;1234567892\&quot;,\n  \&quot;1234567893\&quot;,\n  \&quot;1234567894\&quot;,\n  \&quot;1234567895\&quot;,\n];\nfor (let i = 0; i &lt; 10; i++) {\n  await insertAddMoneySavedTransaction({\n    accountName: `John Doe ${i % 5}`,\n    accountNumber: bankAccounts[i % 5],\n    accountType: \&quot;BANK\&quot;,\n    amount: 2222,\n    bankName: \&quot;Example Bank\&quot;,\n    branchName: \&quot;Main Branch\&quot;,\n    cardType: \&quot;VISA\&quot;,\n    districtName: \&quot;Central District\&quot;,\n    fromAccount: \&quot;city-tcs-01\&quot;,\n    toAccount: \&quot;01317577237\&quot;,\n    userId: userId1.id,\n  });\n}\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.saveTrxnAddMoney}`)\n  .expectStatus(200)\n  .returns(\&quot;body\&quot;);\nconst savedAddMoneyTrxns = await prismaApi.addMoneySave.findMany({});\nexpect(savedAddMoneyTrxns).to.have.lengthOf(5);\nconst savedAccountNumbers = savedAddMoneyTrxns.map(\n  (txn) =&gt; txn.accountNumber\n);\nexpect(savedAccountNumbers).to.have.members(bankAccounts);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2afa8b16-f141-4c99-8b0a-e61a3560e6ec&quot;,&quot;parentUUID&quot;:&quot;b650ab23-028f-4616-b718-4482e3abfef3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should return saved add money transaction list with correct pagination and size&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Add Money should return saved add money transaction list with correct pagination and size&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const bankAccounts = [\n  \&quot;1234567891\&quot;,\n  \&quot;1234567892\&quot;,\n  \&quot;1234567893\&quot;,\n  \&quot;1234567894\&quot;,\n  \&quot;1234567895\&quot;,\n];\nfor (let i = 0; i &lt; 10; i++) {\n  await insertAddMoneySavedTransaction({\n    accountName: `John Doe ${i % 5}`,\n    accountNumber: bankAccounts[i % 5],\n    accountType: \&quot;BANK\&quot;,\n    amount: 1000,\n    bankName: \&quot;Example Bank\&quot;,\n    branchName: \&quot;Main Branch\&quot;,\n    cardType: \&quot;VISA\&quot;,\n    districtName: \&quot;Central District\&quot;,\n    fromAccount: \&quot;city-tcs-01\&quot;,\n    toAccount: \&quot;01317577237\&quot;,\n    userId: userId1.id,\n  });\n}\nconst response = await pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(\n    `${ApiUrls.apiBaseUrl}${ApiUrls.saveTrxnAddMoney}?page=0&amp;size=3`\n  )\n  .expectStatus(200);\nexpect(response.body)\n  .to.have.property(\&quot;saveTransactions\&quot;)\n  .that.is.an(\&quot;array\&quot;);\nexpect(response.body.saveTransactions).to.have.lengthOf(3);\nexpect(response.body.pagination.hasNext).to.equal(true);\nexpect(response.body.pagination.currentPageTotalCount).to.equal(3);\nexpect(response.body.pagination.totalCount).to.equal(5);\nexpect(response.body.pagination.currentPage).to.equal(0);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e594fbfd-ceb7-4d55-8481-a3dcb3221172&quot;,&quot;parentUUID&quot;:&quot;b650ab23-028f-4616-b718-4482e3abfef3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;c10b068c-8c5c-49c6-8d44-72b9158abe3e&quot;,&quot;36806e4f-8028-4654-82f3-4015a15d03c4&quot;,&quot;2afa8b16-f141-4c99-8b0a-e61a3560e6ec&quot;,&quot;e594fbfd-ceb7-4d55-8481-a3dcb3221172&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a66001b7-6c5c-4120-8d5c-c13cbebcfec7&quot;,&quot;title&quot;:&quot;Account Creation From Admin&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/auth/accountCreationAdmin.test.js&quot;,&quot;file&quot;:&quot;/src/auth/accountCreationAdmin.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Account Creation From Admin\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Creation From Admin \&quot;before all\&quot; hook in \&quot;Account Creation From Admin\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;600be6b6-d103-4fb7-ab30-03b949b0aa76&quot;,&quot;parentUUID&quot;:&quot;a66001b7-6c5c-4120-8d5c-c13cbebcfec7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Account Creation From Admin\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Creation From Admin \&quot;before each\&quot; hook in \&quot;Account Creation From Admin\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.accountLog.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAuth.appUser.deleteMany({});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3c30d82a-e93e-4392-99a6-045adf8d0946&quot;,&quot;parentUUID&quot;:&quot;a66001b7-6c5c-4120-8d5c-c13cbebcfec7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Account Creation From Admin\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Creation From Admin \&quot;after all\&quot; hook in \&quot;Account Creation From Admin\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0d935c54-f6cf-4af5-9b1a-a980e62abf06&quot;,&quot;parentUUID&quot;:&quot;a66001b7-6c5c-4120-8d5c-c13cbebcfec7&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create user account successfully from Admin&quot;,&quot;fullTitle&quot;:&quot;Account Creation From Admin should create user account successfully from Admin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:37,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst chartOfAccountData = {\n  name: \&quot;Chart of Account 1\&quot;,\n  description: \&quot;Description for Account 1\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;001\&quot;,\n  onlyParent: false,\n  adminId: 1,\n  minWalletAmount: 100,\n  maxWalletAmount: 10000,\n};\nconst chartOfAccount = await prismaAccounting.chartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst chartOfAccountId = chartOfAccount.id;\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createAccountUrl}`)\n  .withBearerToken(token)\n  .withJson({\n    chartOfAccountId: chartOfAccountId,\n    accountName: \&quot;John\&quot;,\n    identifier: \&quot;01788448853\&quot;,\n    status: \&quot;FULL_ACTIVE\&quot;,\n  })\n  .expectStatus(200);\nconst allAccounts = await prismaAccounting.userAccount.findMany();\nconst createdAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01788448853\&quot; },\n});\nexpect(createdAccount.identifier).to.equal(\&quot;01788448853\&quot;);\nexpect(allAccounts.length).to.equal(1);\nexpect(createdAccount.accountName).to.equal(\&quot;John\&quot;);\nexpect(createdAccount.status).to.equal(\&quot;FULL_ACTIVE\&quot;);\nexpect(createdAccount.chartOfAccount_id).to.equal(chartOfAccountId);\nexpect(createdAccount.dailyLimitAmount).to.equal(null);\nexpect(createdAccount.monthlyLimitAmount).to.equal(null);\nexpect(createdAccount.monthlyLimitCount).to.equal(null);\nexpect(createdAccount.weeklyLimitAmount).to.equal(null);\nexpect(createdAccount.weeklyLimitCount).to.equal(null);\nexpect(createdAccount.dailyLimitCount).to.equal(null);\nexpect(createdAccount.maxWalletAmount).to.equal(null);\nexpect(createdAccount.minWalletAmount).to.equal(null);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;99978609-7359-4ad5-9ae6-6b561e528fe9&quot;,&quot;parentUUID&quot;:&quot;a66001b7-6c5c-4120-8d5c-c13cbebcfec7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error when identifier is not given&quot;,&quot;fullTitle&quot;:&quot;Account Creation From Admin should show error when identifier is not given&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst chartOfAccountData = {\n  name: \&quot;Sample Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: false,\n  dailyLimitAmount: 100,\n};\nconst chartOfAccount = await prismaAccounting.chartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst chartOfAccountId = chartOfAccount.id;\nconst testData = {\n  accountName: \&quot;John\&quot;,\n  status: \&quot;FULL_ACTIVE\&quot;,\n  identifier: \&quot;01788448853\&quot;,\n  chartOfAccountId: chartOfAccountId,\n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createAccountUrl}`)\n  .withBearerToken(token)\n  .withJson({\n    accountName: testData.accountName,\n    status: testData.status,\n    chartOfAccountId: testData.chartOfAccountId,\n  })\n  .expectStatus(400);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f88640e8-4e07-4c84-ac04-e7c7317a6f10&quot;,&quot;parentUUID&quot;:&quot;a66001b7-6c5c-4120-8d5c-c13cbebcfec7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error code with already existing identifier in admin&quot;,&quot;fullTitle&quot;:&quot;Account Creation From Admin should show error code with already existing identifier in admin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst chartOfAccountData = {\n  name: \&quot;Sample Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;LIABILITY\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: false,\n};\nconst chartOfAccount = await prismaAccounting.chartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst chartOfAccountId = chartOfAccount.id;\nconst testData = {\n  accountName: \&quot;John Doe\&quot;,\n  identifier: \&quot;01788448853\&quot;,\n  status: \&quot;FULL_ACTIVE\&quot;,\n  dailyLimitAmount: 50000,\n  dailyLimitCount: 200,\n  monthlyLimitAmount: 5000000,\n  monthlyLimitCount: 6000,\n  maxWalletAmount: 1000000,\n  minWalletAmount: 500,\n  weeklyLimitAmount: 250000,\n  weeklyLimitCount: 1000,\n  chartOfAccount_id: chartOfAccount.id,\n};\nawait prismaAccounting.userAccount.create({\n  data: testData,\n});\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createAccountUrl}`)\n  .withBearerToken(token)\n  .withJson({\n    chartOfAccountId: chartOfAccountId,\n    accountName: testData.accountName,\n    identifier: testData.identifier,\n    status: testData.status,\n  })\n  .expectStatus(409);\nconst result = await prismaAccounting.userAccount.findMany({});\nexpect(result.length).to.equal(1);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 200 !== 409\n\n200 !== 409\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 200 !== 409\n\n200 !== 409\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 200\n+ 409\n&quot;},&quot;uuid&quot;:&quot;12bd8d14-2956-4ff5-b3cf-41aade3653ac&quot;,&quot;parentUUID&quot;:&quot;a66001b7-6c5c-4120-8d5c-c13cbebcfec7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if chart of account Id is not found&quot;,&quot;fullTitle&quot;:&quot;Account Creation From Admin should show error if chart of account Id is not found&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst chartOfAccountData = {\n  name: \&quot;Sample Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: false,\n};\nconst chartOfAccount = await prismaAccounting.chartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst chartOfAccountId = chartOfAccount.id;\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createAccountUrl}`)\n  .withBearerToken(token)\n  .withJson({\n    chartOfAccountId: 9999,\n    accountName: \&quot;Anna\&quot;,\n    identifier: \&quot;01788448853\&quot;,\n    status: \&quot;LIMITED_ACTIVE\&quot;,\n  })\n  .expectStatus(404);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 200 !== 404\n\n200 !== 404\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 200 !== 404\n\n200 !== 404\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 200\n+ 404\n&quot;},&quot;uuid&quot;:&quot;eefff108-0403-478b-800b-c0bbe56928bb&quot;,&quot;parentUUID&quot;:&quot;a66001b7-6c5c-4120-8d5c-c13cbebcfec7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should check the logs for creating a account&quot;,&quot;fullTitle&quot;:&quot;Account Creation From Admin should check the logs for creating a account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:79,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const adminUser = {\n  email: \&quot;admin@ppay.com\&quot;,\n  roles: \&quot;Admin\&quot;,\n  adminRole: \&quot;ADMIN\&quot;,\n};\ntoken = generateToken(\n  1,\n  adminUser.email,\n  adminUser.roles,\n  adminUser.adminRole\n);\nconst chartOfAccountData = {\n  name: \&quot;Sample Account Name\&quot;,\n  adminId: 1,\n  description: \&quot;This is a description for the chart of account.\&quot;,\n  transactionType: \&quot;SYSTEM\&quot;,\n  headType: \&quot;ASSET\&quot;,\n  code: \&quot;ACC-001\&quot;,\n  onlyParent: false,\n  dailyLimitAmount: 100,\n};\nconst chartOfAccount = await prismaAccounting.chartOfAccount.create({\n  data: chartOfAccountData,\n});\nconst chartOfAccountId = chartOfAccount.id;\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.createAccountUrl}`)\n  .withBearerToken(token)\n  .withJson({\n    chartOfAccountId: chartOfAccountId,\n    accountName: \&quot;John\&quot;,\n    identifier: \&quot;01788448853\&quot;,\n    status: \&quot;FULL_ACTIVE\&quot;,\n  })\n  .expectStatus(200);\nconst createdAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01788448853\&quot; },\n});\nawait new Promise((resolve) =&gt; setTimeout(resolve, 50));\nconst logEntry = await prismaAccounting.accountLog.findMany({});\nexpect(logEntry.length).to.equal(1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ef27db4f-2e2e-4468-a296-8e886caf5a8e&quot;,&quot;parentUUID&quot;:&quot;a66001b7-6c5c-4120-8d5c-c13cbebcfec7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;99978609-7359-4ad5-9ae6-6b561e528fe9&quot;,&quot;f88640e8-4e07-4c84-ac04-e7c7317a6f10&quot;,&quot;ef27db4f-2e2e-4468-a296-8e886caf5a8e&quot;],&quot;failures&quot;:[&quot;12bd8d14-2956-4ff5-b3cf-41aade3653ac&quot;,&quot;eefff108-0403-478b-800b-c0bbe56928bb&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:171,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;53e418bc-c802-4ad7-ae7f-6d03cd02c730&quot;,&quot;title&quot;:&quot;Account Creation for P-pay User&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/auth/accountCreationPpay.test.js&quot;,&quot;file&quot;:&quot;/src/auth/accountCreationPpay.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Account Creation for P-pay User\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Creation for P-pay User \&quot;before all\&quot; hook in \&quot;Account Creation for P-pay User\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaApi.$connect();\nawait prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7f3fce7c-b89e-40d7-bf2c-0fe73ea38060&quot;,&quot;parentUUID&quot;:&quot;53e418bc-c802-4ad7-ae7f-6d03cd02c730&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Account Creation for P-pay User\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Creation for P-pay User \&quot;before each\&quot; hook in \&quot;Account Creation for P-pay User\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.accountLog.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAuth.adminUser.deleteMany({});\nawait prismaAuth.appUser.deleteMany({});\nawait prismaApi.adminSetting.deleteMany({});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c1c99eae-7819-4316-aead-599f6dae6094&quot;,&quot;parentUUID&quot;:&quot;53e418bc-c802-4ad7-ae7f-6d03cd02c730&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Account Creation for P-pay User\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Creation for P-pay User \&quot;after all\&quot; hook in \&quot;Account Creation for P-pay User\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaApi.$disconnect();\nawait prismaAuth.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;13509aa5-fa66-4e5c-94bc-28c6225fa678&quot;,&quot;parentUUID&quot;:&quot;53e418bc-c802-4ad7-ae7f-6d03cd02c730&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create user account successfully from P-pay App&quot;,&quot;fullTitle&quot;:&quot;Account Creation for P-pay User should create user account successfully from P-pay App&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const appUser = await prismaAuth.appUser.create({\n  data: {\n    fullname: \&quot;John\&quot;,\n    phone: \&quot;01747538382\&quot;,\n    email: \&quot;johndoe1@example.com\&quot;,\n    password:\n      \&quot;$2a$10$C2JDo6LHB61PTl6mTBdEpeoPNRf7mDCKdbufHd.2uEJzwwm4hbP6q\&quot;,\n    fathername: \&quot;John Doe\&quot;,\n    mothername: \&quot;Jane Doe\&quot;,\n    nidnumber: \&quot;1234567890\&quot;,\n    dob: \&quot;1990-01-01\&quot;,\n    nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n    presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n    district: \&quot;Dhaka\&quot;,\n    hasLiveliness: false,\n    hasNidInfo: true,\n    isEmailVerified: false,\n    isPhoneVerified: false,\n    role: \&quot;USER\&quot;,\n    wrongPinCount: 0\n  },\n});\ntoken = generateUserToken(appUser.id, \&quot;01747538382\&quot;, \&quot;USER\&quot;);\nconst admin = await prismaAuth.adminUser.create({\n  data: {\n    name: \&quot;Admin user\&quot;,\n    email: \&quot;admin@example.com\&quot;,\n    password:\n      \&quot;$2a$10$M6jH9Ky2SbbJ5tu5dV220.PO86QWhef5cllDVNgwrxLWFPlqTYLlC\&quot;,\n    role: 0,\n    isActive: true,\n  },\n});\nconst chartOfAccount = await prismaAccounting.chartOfAccount.create({\n  data: {\n    adminId: admin.id,\n    code: \&quot;001\&quot;,\n    name: \&quot;Customer\&quot;,\n    description: \&quot;Description for Account 1\&quot;,\n    headType: \&quot;LIABILITY\&quot;,\n    minWalletAmount: 100,\n    maxWalletAmount: 100000,\n    transactionType: \&quot;SYSTEM\&quot;,\n    onlyParent: false,\n    monthlyLimitCount: 0,\n    monthlyLimitAmount: 0,\n    weeklyLimitCount: 0,\n    weeklyLimitAmount: 0,\n    dailyLimitCount: 0,\n    dailyLimitAmount: 0,\n  },\n});\nchartOfAccountId = chartOfAccount.id;\nconst verifyChartOfAccount =\n  await prismaAccounting.chartOfAccount.findUnique({\n    where: { id: chartOfAccountId },\n  });\nif (!verifyChartOfAccount) {\n  throw new Error(\n    `Chart of Account with ID ${chartOfAccountId} was not found in the DB!`\n  );\n}\nconst adminSettingData = {\n  data: {\n    id: 1,\n    userType: \&quot;CUSTOMER\&quot;,\n    createdBy: admin.id,\n    info: JSON.stringify({\n      customerWalletCoaId: chartOfAccountId,\n      sendMoneyTrxCode: \&quot;SM001\&quot;,\n      makePaymentTrxCode: \&quot;MP001\&quot;,\n      requestMoneyTrxCode: null,\n      addMoneyTrxCode: null,\n      fundTransferTrxCode: null,\n      topUpTrxCode: \&quot;TP001\&quot;,\n      topUpOperators: {\n        gpAccountId: \&quot;GP001\&quot;,\n        skittoAccountId: \&quot;SK001\&quot;,\n        robiAccountId: \&quot;RB001\&quot;,\n        blAccountId: \&quot;BL001\&quot;,\n        ttAccountId: \&quot;TT001\&quot;,\n        airtelAccountId: \&quot;AT001\&quot;,\n      },\n      billPayTrxCode: \&quot;BP001\&quot;,\n      billerCategories: {\n        descoAccountId: \&quot;DE001\&quot;,\n        pbAccountId: \&quot;PB001\&quot;,\n        wasaAccountId: \&quot;WA001\&quot;,\n        titasAccountId: \&quot;TI001\&quot;,\n        dotNetAccountId: \&quot;DN001\&quot;,\n      },\n    }),\n  },\n};\nawait prismaApi.adminSetting.create(adminSettingData);\nawait prismaApi.adminSetting.findFirst({\n  where: { userType: \&quot;CUSTOMER\&quot; },\n});\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.liveliness_image}`)\n  .withBearerToken(token)\n  .withFile(\n    \&quot;livelinessImage\&quot;,\n    path.resolve(\&quot;/opt/app/test-data/Onamika.jpeg\&quot;)\n  )\n  .expectStatus(200);\nawait new Promise((resolve) =&gt; setTimeout(resolve,50));\nconst createdAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01747538382\&quot; },\n});\nconst allAccounts = await prismaAccounting.userAccount.findMany();\nexpect(createdAccount).to.not.be.null;\nexpect(createdAccount.identifier).to.equal(\&quot;01747538382\&quot;);\nexpect(allAccounts.length).to.equal(1);\nexpect(createdAccount.accountName).to.equal(\&quot;John\&quot;);\nexpect(createdAccount.status).to.equal(\&quot;LIMITED_ACTIVE\&quot;);\nexpect(createdAccount.chartOfAccount_id).to.equal(chartOfAccountId);\nexpect(createdAccount.aitPercentage).to.equal(5);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;PrismaClientKnownRequestError: \nInvalid `prisma.adminUser.create()` invocation:\n\n\nThe column `role` does not exist in the current database.&quot;,&quot;estack&quot;:&quot;PrismaClientKnownRequestError: \nInvalid `prisma.adminUser.create()` invocation:\n\n\nThe column `role` does not exist in the current database.\n    at qn.handleRequestError (prisma/generated/auth/runtime/library.js:121:7315)\n    at qn.handleAndLogRequestError (prisma/generated/auth/runtime/library.js:121:6640)\n    at qn.request (prisma/generated/auth/runtime/library.js:121:6347)\n    at async l (prisma/generated/auth/runtime/library.js:130:9616)\n    at async Context.&lt;anonymous&gt; (file:///opt/app/src/auth/accountCreationPpay.test.js:68:19)&quot;},&quot;uuid&quot;:&quot;d35b9ac4-4c98-4e07-8d80-29676d00c7eb&quot;,&quot;parentUUID&quot;:&quot;53e418bc-c802-4ad7-ae7f-6d03cd02c730&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;d35b9ac4-4c98-4e07-8d80-29676d00c7eb&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:8,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;eaba6d60-a922-45f0-a8e7-ad5f94cf8b0a&quot;,&quot;title&quot;:&quot;Get Saved Transaction After Utility Pay&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/billPay/getSaveTrxnBillPay.test.js&quot;,&quot;file&quot;:&quot;/src/billPay/getSaveTrxnBillPay.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Get Saved Transaction After Utility Pay\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Utility Pay \&quot;before all\&quot; hook in \&quot;Get Saved Transaction After Utility Pay\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ffef8061-bad3-4bf3-a12b-0719b74e88e7&quot;,&quot;parentUUID&quot;:&quot;eaba6d60-a922-45f0-a8e7-ad5f94cf8b0a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Get Saved Transaction After Utility Pay\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Utility Pay \&quot;before each\&quot; hook in \&quot;Get Saved Transaction After Utility Pay\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:137,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId1 = await prismaAuth.appUser.findFirst({\n  where: { phone: \&quot;01317577237\&quot; },\n});\ntokenUser1 = generateUserToken(userId1.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\nawait setupTransactionTypes(chartOfAccounts);\nconst utilityPayType = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;1004\&quot; },\n});\nutilityPayTypeId = utilityPayType.id;\nawait createUserAccounts(chartOfAccounts);\ncustomerAccount1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nbillPayDistributorAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;polli-bidyut-01\&quot; },\n});\nbillerId = await prismaApi.billerCategories.findFirst({\n  where: {\n    accountIdentifier: \&quot;polli-bidyut-01\&quot;,\n    billerType: \&quot;ELECTRICITY\&quot;,\n  },\n});\nbillPayDistributorAccountForWater =\n  await prismaAccounting.userAccount.findUnique({\n    where: { identifier: \&quot;wasa-01\&quot; },\n  });\nbillerIdForWater = await prismaApi.billerCategories.findFirst({\n  where: {\n    accountIdentifier: \&quot;wasa-01\&quot;,\n    billerType: \&quot;WATER\&quot;,\n  },\n});\nbillPayDistributorAccountForGas =\n  await prismaAccounting.userAccount.findUnique({\n    where: { identifier: \&quot;titas-gas-01\&quot; },\n  });\nbillerIdForGas = await prismaApi.billerCategories.findFirst({\n  where: {\n    accountIdentifier: \&quot;titas-gas-01\&quot;,\n    billerType: \&quot;GAS\&quot;,\n  },\n});\nawait addInitialBalance(customerAccount1, 100000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e4147a36-ae95-48c4-bfea-05ec8987ac95&quot;,&quot;parentUUID&quot;:&quot;eaba6d60-a922-45f0-a8e7-ad5f94cf8b0a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Get Saved Transaction After Utility Pay\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Utility Pay \&quot;after all\&quot; hook in \&quot;Get Saved Transaction After Utility Pay\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$disconnect();\nawait prismaApi.$disconnect();\nawait prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ba0161b8-e478-40a5-a459-d17aff3d48df&quot;,&quot;parentUUID&quot;:&quot;eaba6d60-a922-45f0-a8e7-ad5f94cf8b0a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get saved Utility Pay transaction list&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Utility Pay should get saved Utility Pay transaction list&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await insertUtilityPaySavedTransaction({\n  amount: 1000,\n  fromAccount: customerAccount1,\n  toAccount: billPayDistributorAccount,\n  transactionTypeId: utilityPayTypeId,\n  billerId: billerId.id,\n});\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .get(`${ApiUrls.apiBaseUrl}${ApiUrls.savetrxnUtilityPay}`)\n  .expectStatus(200);\nconst savedUtilityTrxns = await prismaApi.utilitySave.findMany({});\nexpect(savedUtilityTrxns).to.have.lengthOf(1);\nexpect(savedUtilityTrxns[0].amount.toString()).to.equal(\&quot;1000\&quot;);\nexpect(savedUtilityTrxns[0].save).to.be.true;\nexpect(savedUtilityTrxns[0].fromAccount).to.equal(\&quot;01317577237\&quot;);\nexpect(savedUtilityTrxns[0].toAccount).to.equal(\&quot;polli-bidyut-01\&quot;);\nexpect(savedUtilityTrxns[0].transactionTypeCode).to.equal(\&quot;1004\&quot;);\nexpect(savedUtilityTrxns[0].billerId.toString()).to.equal(\n  billerId.id.toString()\n);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/billPay/getSaveTrxnBillPay.test.js:155:26)&quot;},&quot;uuid&quot;:&quot;49cf4702-f1ce-45de-b2af-3096c80c3938&quot;,&quot;parentUUID&quot;:&quot;eaba6d60-a922-45f0-a8e7-ad5f94cf8b0a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show the first Utility Pay transaction of bank account even after multiple transactions with the same bank account&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Utility Pay should show the first Utility Pay transaction of bank account even after multiple transactions with the same bank account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await insertUtilityPaySavedTransaction({\n  amount: 1000,\n  fromAccount: customerAccount1,\n  toAccount: billPayDistributorAccount,\n  transactionTypeId: utilityPayTypeId,\n  billerId: billerId.id,\n});\nawait insertUtilityPaySavedTransaction({\n  amount: 2000,\n  fromAccount: customerAccount1,\n  toAccount: billPayDistributorAccount,\n  transactionTypeId: utilityPayTypeId,\n  billerId: billerId.id,\n});\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.savetrxnUtilityPay}`)\n  .expectStatus(200)\n  .returns(\&quot;body\&quot;);\nconst savedUtilityTrxns = await prismaApi.utilitySave.findMany({});\nexpect(savedUtilityTrxns).to.have.lengthOf(1);\nexpect(savedUtilityTrxns[0].amount.toString()).to.equal(\&quot;1000\&quot;);\nexpect(savedUtilityTrxns[0].toAccount).to.equal(\&quot;polli-bidyut-01\&quot;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/billPay/getSaveTrxnBillPay.test.js:183:26)&quot;},&quot;uuid&quot;:&quot;b1d0cef4-ebcc-4b18-a78c-5e2e7b1ca7ba&quot;,&quot;parentUUID&quot;:&quot;eaba6d60-a922-45f0-a8e7-ad5f94cf8b0a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should save only one Utility Pay transaction per unique biller category&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Utility Pay should save only one Utility Pay transaction per unique biller category&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;for (let i = 0; i &lt; 10; i++) {\n  await insertUtilityPaySavedTransaction({\n    amount: 1000,\n    fromAccount: customerAccount1,\n    toAccount: billPayDistributorAccount,\n    transactionTypeId: utilityPayTypeId,\n    billerId: billerId.id,\n  });\n}\nfor (let i = 0; i &lt; 10; i++) {\n  await insertUtilityPaySavedTransaction({\n    amount: 500,\n    fromAccount: customerAccount1,\n    toAccount: billPayDistributorAccountForWater,\n    transactionTypeId: utilityPayTypeId,\n    billerId: billerId.id,\n  });\n}\nfor (let i = 0; i &lt; 10; i++) {\n  await insertUtilityPaySavedTransaction({\n    amount: 2000,\n    fromAccount: customerAccount1,\n    toAccount: billPayDistributorAccountForGas,\n    transactionTypeId: utilityPayTypeId,\n    billerId: billerId.id,\n  });\n}\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.savetrxnUtilityPay}`)\n  .expectStatus(200);\nconst savedUtilityTrxns = await prismaApi.utilitySave.findMany({});\nexpect(savedUtilityTrxns).to.have.lengthOf(3);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/billPay/getSaveTrxnBillPay.test.js:215:28)&quot;},&quot;uuid&quot;:&quot;bdf08904-0ef8-4f67-9b8b-13d01625a444&quot;,&quot;parentUUID&quot;:&quot;eaba6d60-a922-45f0-a8e7-ad5f94cf8b0a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return saved Utility Pay transaction list with correct pagination and size&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Utility Pay should return saved Utility Pay transaction list with correct pagination and size&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;for (let i = 0; i &lt; 10; i++) {\n  await insertUtilityPaySavedTransaction({\n    amount: 1000,\n    fromAccount: customerAccount1,\n    toAccount: billPayDistributorAccount,\n    transactionTypeId: utilityPayTypeId,\n    billerId: billerId.id,\n  });\n}\nfor (let i = 0; i &lt; 10; i++) {\n  await insertUtilityPaySavedTransaction({\n    amount: 500,\n    fromAccount: customerAccount1,\n    toAccount: billPayDistributorAccountForWater,\n    transactionTypeId: utilityPayTypeId,\n    billerId: billerId.id,\n  });\n}\nfor (let i = 0; i &lt; 10; i++) {\n  await insertUtilityPaySavedTransaction({\n    amount: 2000,\n    fromAccount: customerAccount1,\n    toAccount: billPayDistributorAccountForGas,\n    transactionTypeId: utilityPayTypeId,\n    billerId: billerId.id,\n  });\n}\nconst response = await pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(\n    `${ApiUrls.apiBaseUrl}${ApiUrls.savetrxnUtilityPay}?page=0&amp;size=2`\n  )\n  .expectStatus(200);\nexpect(response.body)\n  .to.have.property(\&quot;saveTransactions\&quot;)\n  .that.is.an(\&quot;array\&quot;);\nexpect(response.body.saveTransactions).to.have.lengthOf(2);\nexpect(response.body.pagination.hasNext).to.equal(true);\nexpect(response.body.pagination.currentPageTotalCount).to.equal(2);\nexpect(response.body.pagination.totalCount).to.equal(3);\nexpect(response.body.pagination.currentPage).to.equal(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/billPay/getSaveTrxnBillPay.test.js:256:28)&quot;},&quot;uuid&quot;:&quot;4817a180-f53b-4bb4-b58a-e7f8395fdfbf&quot;,&quot;parentUUID&quot;:&quot;eaba6d60-a922-45f0-a8e7-ad5f94cf8b0a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;49cf4702-f1ce-45de-b2af-3096c80c3938&quot;,&quot;b1d0cef4-ebcc-4b18-a78c-5e2e7b1ca7ba&quot;,&quot;bdf08904-0ef8-4f67-9b8b-13d01625a444&quot;,&quot;4817a180-f53b-4bb4-b58a-e7f8395fdfbf&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ad827b45-add5-4d08-a584-b541e17a1579&quot;,&quot;title&quot;:&quot;API Check: Utility Bill Pay(POST)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/billPay/utilityBillPay.test.js&quot;,&quot;file&quot;:&quot;/src/billPay/utilityBillPay.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;API Check: Utility Bill Pay(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Utility Bill Pay(POST) \&quot;before all\&quot; hook in \&quot;API Check: Utility Bill Pay(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;75fe63e3-da19-43d4-9bb8-50259eac5c76&quot;,&quot;parentUUID&quot;:&quot;ad827b45-add5-4d08-a584-b541e17a1579&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;API Check: Utility Bill Pay(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Utility Bill Pay(POST) \&quot;before each\&quot; hook in \&quot;API Check: Utility Bill Pay(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:146,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\ntoken = generateUserToken(userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\nbiller = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;utility-sys-providers-01\&quot;\n);\nconst transactionTypes = await setupTransactionTypes(chartOfAccounts);\nawait createUserAccounts(chartOfAccounts);\nsender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nreceiver = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;wasa-01\&quot; },\n});\n \nconst type = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;1004\&quot; },\n});\nawait addInitialBalance(sender, 1000000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;80163cff-f569-4185-8062-1883647ea3ea&quot;,&quot;parentUUID&quot;:&quot;ad827b45-add5-4d08-a584-b541e17a1579&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;API Check: Utility Bill Pay(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Utility Bill Pay(POST) \&quot;after all\&quot; hook in \&quot;API Check: Utility Bill Pay(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nreceiver = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01999999999\&quot; },\n});\nonholdUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577238\&quot; }\n});\nmaxwallet = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577210\&quot; }\n});\ndailyLimitAmountUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01715170020\&quot; }\n});\nconst testConfig = {\n  baseUrl: ApiUrls.apiBaseUrl,\n  endpoint: ApiUrls.doUtilityBillPay,\n  token: token,\n  sender: sender,\n  receiver: receiver,\n  type: \&quot;Top Up\&quot;,\n  database: [prismaApi.utilityBillingInfo],\n  transactionTypeCode: \&quot;1004\&quot;,\n  provider: receiver.identifier,\n  userId: userId.id,\n  requestBody: {\n    billerId: 5,\n    amount: 200,\n    chargeFee: 5,\n    transactionTypeCode: \&quot;1004\&quot;,\n    refId: \&quot;11111\&quot;,\n  },\n  requestBodyForNotFullActiveUser: {\n    agentMobile: receiver.identifier,\n    amount: 20,\n    note: \&quot;khabar er taka\&quot;,\n    transactionTypeCode: \&quot;1004\&quot;,\n    referenceNo: \&quot;11111\&quot;,\n  },\n  requestBodyForMinWalleAmount: {\n    billerId: 5,\n    amount: 20,\n    chargeFee: 5,\n    transactionTypeCode: \&quot;1004\&quot;,\n    refId: \&quot;11111\&quot;,\n  },\n  requestBodyForMaxWalleAmount: {\n    billerId: 5,\n    amount: 200,\n    chargeFee: 5,\n    transactionTypeCode: \&quot;1004\&quot;,\n    refId: \&quot;11111\&quot;,\n  },\n  requestBodyForDailyLimitAmount: {\n    billerId: 5,\n    amount: 200,\n    chargeFee: 5,\n    transactionTypeCode: \&quot;1004\&quot;,\n    refId: \&quot;11111\&quot;,\n  },\n  requestBodyForTypeMinAmount: {\n    billerId: 5,\n    amount: 5,\n    chargeFee: 1,\n    transactionTypeCode: \&quot;1004\&quot;,\n    refId: \&quot;11111\&quot;,\n  },\n  requestBodyForTypeMaxAmount: {\n    billerId: 5,\n    amount: 5001,\n    chargeFee: 5,\n    transactionTypeCode: \&quot;1004\&quot;,\n    refId: \&quot;11111\&quot;,\n  },\n}\nawait runTransactionTests(testConfig);\nawait prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a63a2c07-3e9a-43af-b4f4-75e6e37aeb83&quot;,&quot;parentUUID&quot;:&quot;ad827b45-add5-4d08-a584-b541e17a1579&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 200 for successful bill pay and save this payment&quot;,&quot;fullTitle&quot;:&quot;API Check: Utility Bill Pay(POST) should return 200 for successful bill pay and save this payment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doUtilityBillPay}`)\n  .withBearerToken(token)\n  .withJson({\n    billerId: 5,\n    amount: 200,\n    chargeFee: 5,\n    transactionTypeCode: \&quot;1004\&quot;,\n    refId: \&quot;11111\&quot;,\n    save: true\n  })\n  .expectStatus(200);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\n\nawait checkSuccess({\n  groupId: \&quot;topup\&quot;,\n  topic: \&quot;utility_bill_payment_result\&quot;,\n  log: &#x27;Bill Pay: From 01317577237 to wasa-01&#x27;,\n  amount: 200,\n  callback: async () =&gt; {\n    const utilityTable = await prismaApi.utilityBillingInfo.findMany({\n      where: { userId: userId.id },\n    });\n    const saveUtility = await prismaApi.utilitySave.findMany({\n      where: { pay: utilityTable.id },\n    });\n    const transactionTypeId = await prismaAccounting.transactionType.findFirst({\n      where: {\n        transactionCode: \&quot;1004\&quot;,\n      },\n    });\n    expect(saveUtility).to.have.lengthOf(1);\n    expect(saveUtility[0].transactionTypeId).to.equal(transactionTypeId.id);\n    expect(utilityTable[0].status).to.equal(\&quot;SUCCESS\&quot;);\n    expect(utilityTable[0].userId).to.equal(userId.id);\n  }\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 200\n\n500 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 200\n\n500 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 200\n&quot;},&quot;uuid&quot;:&quot;103a4f84-b3e0-4de4-9cad-70e04390f6fc&quot;,&quot;parentUUID&quot;:&quot;ad827b45-add5-4d08-a584-b541e17a1579&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the biller id does not exists&quot;,&quot;fullTitle&quot;:&quot;API Check: Utility Bill Pay(POST) should return 400 if the biller id does not exists&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doTopUp}`)\n  .withBearerToken(token)\n  .withJson({\n    billerId: 9,\n    amount: 200,\n    chargeFee: 5,\n    transactionTypeCode: \&quot;1004\&quot;,\n    refId: \&quot;11111\&quot;,\n  })\n  .expectStatus(400);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fac5cfee-0dd9-49cf-8c57-fd86801b6ea7&quot;,&quot;parentUUID&quot;:&quot;ad827b45-add5-4d08-a584-b541e17a1579&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fac5cfee-0dd9-49cf-8c57-fd86801b6ea7&quot;],&quot;failures&quot;:[&quot;103a4f84-b3e0-4de4-9cad-70e04390f6fc&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:31,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;9907a1cf-96a0-4fb2-80c9-faacf2fb78e2&quot;,&quot;title&quot;:&quot;API Check: Bulk Disbursement(POST)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/bulkDisbursement/bulkDisbursement.test.js&quot;,&quot;file&quot;:&quot;/src/bulkDisbursement/bulkDisbursement.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;API Check: Bulk Disbursement(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Bulk Disbursement(POST) \&quot;before all\&quot; hook in \&quot;API Check: Bulk Disbursement(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d8f53f62-bacc-48c0-b341-145820cb6f2c&quot;,&quot;parentUUID&quot;:&quot;9907a1cf-96a0-4fb2-80c9-faacf2fb78e2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;API Check: Bulk Disbursement(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Bulk Disbursement(POST) \&quot;before each\&quot; hook in \&quot;API Check: Bulk Disbursement(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:151,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01999999999\&quot;,\n  },\n});\ntoken = generateUserToken(userId.id, \&quot;01999999999\&quot;, \&quot;MERCHANT\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\ntopUpProvider = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;top-up-providers-01\&quot;\n);\nconst transactionTypes = await setupTransactionTypes(chartOfAccounts);\nawait createUserAccounts(chartOfAccounts);\nsender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01999999999\&quot; },\n});\nreceiver1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\nreceiver2 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nconst type = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;1001\&quot; },\n});\nawait addInitialBalance(sender, 1000000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fda83eab-317f-4af7-a024-92257abf64a1&quot;,&quot;parentUUID&quot;:&quot;9907a1cf-96a0-4fb2-80c9-faacf2fb78e2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;API Check: Bulk Disbursement(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Bulk Disbursement(POST) \&quot;after all\&quot; hook in \&quot;API Check: Bulk Disbursement(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01999999999\&quot; },\n});\nreceiver1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\nreceiver2 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nonholdUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577238\&quot; }\n});\nmaxwallet = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577210\&quot; }\n});\ndailyLimitAmountUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01715170020\&quot; }\n});\nconst testConfig = {\n  baseUrl: ApiUrls.apiBaseUrl,\n  endpoint: ApiUrls.doBulkDisbursement,\n  token: token,\n  sender: sender,\n  receiver1: receiver1,\n  receiver2: receiver2,\n  type: \&quot;Top Up\&quot;,\n  database: [prismaApi.bulkDisbursement],\n  transactionTypeCode: \&quot;bulk-disbursement-01\&quot;,\n  userId: userId.id,\n  requestBody: {\n    bulks: [\n      {\n        toAccount: receiver1.identifier,\n        amount: 20\n      },\n      {\n        toAccount: receiver2.identifier,\n        amount: 20\n      }\n    ],\n    transactionTypeCode: \&quot;bulk-disbursement-001\&quot;\n  },\n  requestBodyForNotFullActiveUser: {\n    bulks: [\n      {\n        toAccount: receiver1.identifier,\n        amount: 200\n      },\n      {\n        toAccount: receiver2.identifier,\n        amount: 200\n      }\n    ],\n    transactionTypeCode: \&quot;bulk-disbursement-001\&quot;\n  },\n  requestBodyForMinWalleAmount: {\n    bulks: [\n      {\n        toAccount: receiver1.identifier,\n        amount: 40\n      },\n      {\n        toAccount: receiver2.identifier,\n        amount: 40\n      }\n    ],\n    transactionTypeCode: \&quot;bulk-disbursement-001\&quot;\n  },\n  requestBodyForMaxWalleAmount: {\n    bulks: [\n      {\n        toAccount: receiver1.identifier,\n        amount: 1001\n      },\n      {\n        toAccount: receiver2.identifier,\n        amount: 1001\n      }\n    ],\n    transactionTypeCode: \&quot;bulk-disbursement-001\&quot;\n  },\n  requestBodyForDailyLimitAmount: {\n    bulks: [\n      {\n        toAccount: receiver1.identifier,\n        amount: 100\n      },\n      {\n        toAccount: receiver2.identifier,\n        amount: 100\n      }\n    ],\n    transactionTypeCode: \&quot;bulk-disbursement-001\&quot;\n  },\n  requestBodyForTypeMinAmount: {\n    bulks: [\n      {\n        toAccount: receiver1.identifier,\n        amount: 5\n      },\n      {\n        toAccount: receiver2.identifier,\n        amount: 5\n      }\n    ],\n    transactionTypeCode: \&quot;bulk-disbursement-001\&quot;\n  },\n  requestBodyForTypeMaxAmount: {\n    bulks: [\n      {\n        toAccount: receiver1.identifier,\n        amount: 1000000\n      },\n      {\n        toAccount: receiver2.identifier,\n        amount: 1000000\n      }\n    ],\n    transactionTypeCode: \&quot;bulk-disbursement-001\&quot;\n  },\n}\n// await runMerchantTransactionTests(testConfig);\nawait prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;186de1bb-fe0e-4e58-91f0-39434720946e&quot;,&quot;parentUUID&quot;:&quot;9907a1cf-96a0-4fb2-80c9-faacf2fb78e2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 200 for successful bulk disbursement&quot;,&quot;fullTitle&quot;:&quot;API Check: Bulk Disbursement(POST) should return 200 for successful bulk disbursement&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1082,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec().withMethod(\&quot;GET\&quot;)\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doBulkDisbursement}`)\n  .withBearerToken(token)\n  .withJson({\n    bulks: [\n      {\n        toAccount: receiver1.identifier,\n        amount: 50\n      },\n      {\n        toAccount: receiver2.identifier,\n        amount: 60\n      }\n    ],\n    transactionTypeCode: \&quot;bulk-disbursement-001\&quot;\n  })\n  .expectStatus(200);\n// await checkSuccessForMerchant({\n//   groupId: \&quot;topup\&quot;,\n//   topic: \&quot;bulk_disbursement_trxn_result\&quot;,\n//   log: &#x27;Bulk Disbursement: From 01999999999 to 01711106485&#x27;,\n//   amount1: 50,\n//   amount2: 60,\n//   callback: async () =&gt; {\n//   }\n// })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d10947cc-c41e-4ed2-a9e0-0dceb62cc536&quot;,&quot;parentUUID&quot;:&quot;9907a1cf-96a0-4fb2-80c9-faacf2fb78e2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d10947cc-c41e-4ed2-a9e0-0dceb62cc536&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1082,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;fbd881dd-546d-4999-9649-93687e6846aa&quot;,&quot;title&quot;:&quot;API Check: Fund Transfer(POST)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/fundTransfer/fundTransfer.test.js&quot;,&quot;file&quot;:&quot;/src/fundTransfer/fundTransfer.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;API Check: Fund Transfer(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Fund Transfer(POST) \&quot;before all\&quot; hook in \&quot;API Check: Fund Transfer(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d13e199e-1509-497b-b2c7-bf1909506780&quot;,&quot;parentUUID&quot;:&quot;fbd881dd-546d-4999-9649-93687e6846aa&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;API Check: Fund Transfer(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Fund Transfer(POST) \&quot;before each\&quot; hook in \&quot;API Check: Fund Transfer(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:146,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\ntoken = generateUserToken(userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\ntopUpProvider = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;top-up-providers-01\&quot;\n);\nconst transactionTypes = await setupTransactionTypes(chartOfAccounts);\nawait createUserAccounts(chartOfAccounts);\nsender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nreceiver = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\ngp = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;gp-wallet-01\&quot; },\n});\nteletalk = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;teletalk-wallet-01\&quot; },\n});\nbanglalink = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;bl-wallet-01\&quot; },\n});\nconst type = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;1001\&quot; },\n});\nawait addInitialBalance(sender, 1000000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;153e41be-e22c-4c35-879d-e8a5421ba9fd&quot;,&quot;parentUUID&quot;:&quot;fbd881dd-546d-4999-9649-93687e6846aa&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;API Check: Fund Transfer(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Fund Transfer(POST) \&quot;after all\&quot; hook in \&quot;API Check: Fund Transfer(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:149,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nconst chartOfAccounts = await createBasicChartOfAccounts();\nconst transactionTypes = await setupTransactionTypes(chartOfAccounts);\nawait createUserAccounts(chartOfAccounts);\nsender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nreceiver = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\nonholdUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577238\&quot; }\n});\nmaxwallet = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577210\&quot; }\n});\ndailyLimitAmountUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01715170020\&quot; }\n});\nconst testConfig = {\n  baseUrl: ApiUrls.apiBaseUrl,\n  endpoint: ApiUrls.doFundTransfer,\n  token: token,\n  sender: sender,\n  receiver: receiver,\n  type: \&quot;Top Up\&quot;,\n  database: [prismaApi.fundTransferLogs],\n  transactionTypeCode: \&quot;1003\&quot;,\n  userId: userId.id,\n  requestBody: {\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;Jarin\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1003\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n    amount: 50,\n  },\n  requestBodyForNotFullActiveUser: {\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;Jarin\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1003\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n    amount: 50,\n  },\n  requestBodyForMinWalleAmount: {\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;requestBodyForMinWalleAmount\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1003\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n    amount: 9,\n  },\n  requestBodyForMaxWalleAmount: {\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;requestBodyForMaxWalleAmount\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1003\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n    amount: 1001,\n  },\n  requestBodyForDailyLimitAmount: {\n    amount: 100,\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;requestBodyForMaxWalleAmount\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1003\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n  },\n  requestBodyForTypeMinAmount: {\n    amount: 5,\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;requestBodyForMaxWalleAmount\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1003\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n  },\n  requestBodyForTypeMaxAmount: {\n    amount: 1000000,\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;requestBodyForMaxWalleAmount\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1003\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n  },\n}\nawait runTransactionTests(testConfig);\nawait prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;03485c02-e2c7-4037-85eb-09eaaf561530&quot;,&quot;parentUUID&quot;:&quot;fbd881dd-546d-4999-9649-93687e6846aa&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 200 for successful fund transfer to bank and save the transaction&quot;,&quot;fullTitle&quot;:&quot;API Check: Fund Transfer(POST) should return 200 for successful fund transfer to bank and save the transaction&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doFundTransfer}`)\n  .withBearerToken(token)\n  .withJson({\n    accountNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;Jarin\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1003\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    distributorId: 1,\n    amount: 50,\n    save: true\n  })\n  .expectStatus(200);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\nawait checkSuccess({\n  groupId: \&quot;topup\&quot;,\n  topic: \&quot;fund_transfer_bank_card_mfs_result\&quot;,\n  log: &#x27;Fund Transfer: From 01317577237 to city-bank-tcs-01&#x27;,\n  amount: 50,\n  callback: async () =&gt; {\n    const fundTransferTable = await prismaApi.fundTransferLogs.findMany({\n      where: { userId: userId.id },\n    });\n    const saveFundTransfer = await prismaApi.fundTransferSave.findMany({\n      where: { fundTransferId: fundTransferTable.id },\n    });\n    expect(saveFundTransfer).to.have.lengthOf(1);\n    expect(saveFundTransfer[0].accountNumber).to.include(\&quot;123131324234\&quot;);\n    expect(saveFundTransfer[0].accountName).to.equal(\&quot;Jarin\&quot;);\n    expect(saveFundTransfer[0].branchName).to.equal(\&quot;Kalabagan\&quot;);\n    expect(saveFundTransfer[0].districtName).to.equal(\&quot;Dhaka\&quot;);\n    expect(saveFundTransfer[0].accountType).to.equal(\&quot;BANK\&quot;);\n    expect(fundTransferTable[0].status).to.equal(\&quot;SUCCESS\&quot;);\n    expect(fundTransferTable[0].userId).to.equal(userId.id);\n  }\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 400 !== 200\n\n400 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 400 !== 200\n\n400 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 400\n+ 200\n&quot;},&quot;uuid&quot;:&quot;0b1f97dc-0c4f-4c03-87d2-ed5e3c769801&quot;,&quot;parentUUID&quot;:&quot;fbd881dd-546d-4999-9649-93687e6846aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for successful fund transfer to card and save the transaction&quot;,&quot;fullTitle&quot;:&quot;API Check: Fund Transfer(POST) should return 200 for successful fund transfer to card and save the transaction&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doFundTransfer}`)\n  .withBearerToken(token)\n  .withJson({\n    cardNumber: \&quot;123131324234\&quot;,\n    accountName: \&quot;Jarin\&quot;,\n    branchName: \&quot;Kalabagan\&quot;,\n    districtName: \&quot;Dhaka\&quot;,\n    transactionCode: \&quot;1003\&quot;,\n    accountType: \&quot;CARD\&quot;,\n    cardType: \&quot;VISA\&quot;,\n    distributorId: 2,\n    amount: 50,\n  })\n  .expectStatus(200);\n  await checkSuccess({\n    groupId: \&quot;topup\&quot;,\n    topic: \&quot;fund_transfer_bank_card_mfs_result\&quot;,\n    log: &#x27;Fund Transfer: From 01317577237 to visa-card-tcs-01&#x27;,\n    amount: 50,\n    callback: async () =&gt; {\n  \n      const fundTransferTable = await prismaApi.fundTransferLogs.findMany({\n        where: { userId: userId.id },\n      });\n  \n      const saveFundTransfer = await prismaApi.fundTransferSave.findMany({\n        where: { fundTransferId: fundTransferTable.id },\n      });\n      expect(saveFundTransfer).to.have.lengthOf(1);\n  \n      expect(fundTransferTable[0].status).to.equal(\&quot;SUCCESS\&quot;);\n  \n      expect(fundTransferTable[0].userId).to.equal(userId.id);\n    }\n  })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 400 !== 200\n\n400 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 400 !== 200\n\n400 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 400\n+ 200\n&quot;},&quot;uuid&quot;:&quot;3a5d336b-e6b4-42af-abf2-cdb9c60d3569&quot;,&quot;parentUUID&quot;:&quot;fbd881dd-546d-4999-9649-93687e6846aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for successful fund transfer to mfs and save the transaction&quot;,&quot;fullTitle&quot;:&quot;API Check: Fund Transfer(POST) should return 200 for successful fund transfer to mfs and save the transaction&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doFundTransfer}`)\n  .withBearerToken(token)\n  .withJson({\n    transactionCode: \&quot;1003\&quot;,\n    accountType: \&quot;MFS\&quot;,\n    distributorId: 3,\n    amount: 50,\n    phoneNumber: \&quot;01711106485\&quot;,\n    mfsType: \&quot;BKASH\&quot;,\n  })\n  .expectStatus(200);\n  await checkSuccess({\n    groupId: \&quot;topup\&quot;,\n    topic: \&quot;fund_transfer_bank_card_mfs_result\&quot;,\n    log: &#x27;Fund Transfer: From 01317577237 to mfs-bkash-tcs-01&#x27;,\n    amount: 50,\n    callback: async () =&gt; {\n  \n      const fundTransferTable = await prismaApi.fundTransferLogs.findMany({\n        where: { userId: userId.id },\n      });\n  \n      const saveFundTransfer = await prismaApi.fundTransferSave.findMany({\n        where: { fundTransferId: fundTransferTable.id },\n      });\n      expect(saveFundTransfer).to.have.lengthOf(1);\n  \n      expect(fundTransferTable[0].status).to.equal(\&quot;SUCCESS\&quot;);\n  \n      expect(fundTransferTable[0].userId).to.equal(userId.id);\n    }\n  })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 400 !== 200\n\n400 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 400 !== 200\n\n400 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 400\n+ 200\n&quot;},&quot;uuid&quot;:&quot;1689cfda-d589-4ee9-b7f1-1d4510f0e91c&quot;,&quot;parentUUID&quot;:&quot;fbd881dd-546d-4999-9649-93687e6846aa&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;0b1f97dc-0c4f-4c03-87d2-ed5e3c769801&quot;,&quot;3a5d336b-e6b4-42af-abf2-cdb9c60d3569&quot;,&quot;1689cfda-d589-4ee9-b7f1-1d4510f0e91c&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;71c272dd-ccd6-4af4-93ec-94e650f836a1&quot;,&quot;title&quot;:&quot;Get Saved Transaction After Fund Transfer&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/fundTransfer/getSaveTrxnFundTransfer.test.js&quot;,&quot;file&quot;:&quot;/src/fundTransfer/getSaveTrxnFundTransfer.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Get Saved Transaction After Fund Transfer\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Fund Transfer \&quot;before all\&quot; hook in \&quot;Get Saved Transaction After Fund Transfer\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e7b5d9a0-22f8-48f0-aaa6-f833a9964fde&quot;,&quot;parentUUID&quot;:&quot;71c272dd-ccd6-4af4-93ec-94e650f836a1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Get Saved Transaction After Fund Transfer\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Fund Transfer \&quot;before each\&quot; hook in \&quot;Get Saved Transaction After Fund Transfer\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:139,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId1 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\nuserId2 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01711106485\&quot;,\n  },\n});\ntokenUser1 = generateUserToken(userId1.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\ntokenUser2 = generateUserToken(userId2.id, \&quot;01711106485\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\nawait setupTransactionTypes(chartOfAccounts);\nconst fundTransferType = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;1003\&quot; },\n});\nfundTransferTypeId = fundTransferType.id;\nawait createUserAccounts(chartOfAccounts);\ncustomerAccount1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\ndistributorAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;city-tcs-01\&quot; },\n});\n\n\nawait addInitialBalance(customerAccount1, 100000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2987df7c-f9dc-43c2-8bfc-f65b3b626c9f&quot;,&quot;parentUUID&quot;:&quot;71c272dd-ccd6-4af4-93ec-94e650f836a1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Get Saved Transaction After Fund Transfer\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Fund Transfer \&quot;after all\&quot; hook in \&quot;Get Saved Transaction After Fund Transfer\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$disconnect();\nawait prismaApi.$disconnect();\nawait prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5838f9b1-5a36-447a-97b0-b7b6bac10318&quot;,&quot;parentUUID&quot;:&quot;71c272dd-ccd6-4af4-93ec-94e650f836a1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get saved fund Transfer transaction list&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Fund Transfer should get saved fund Transfer transaction list&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await insertFundTransferSavedTransaction({\n  accountName: \&quot;John Doe\&quot;,\n  accountNumber: \&quot;1234567890\&quot;,\n  accountType: \&quot;BANK\&quot;,\n  amount: 1000,\n  bankName: \&quot;Example Bank\&quot;,\n  branchName: \&quot;Main Branch\&quot;,\n  cardType: \&quot;VISA\&quot;,\n  districtName: \&quot;Central District\&quot;,\n  toAccount: \&quot;city-tcs-01\&quot;,\n  fromAccount: \&quot;01317577237\&quot;,\n  userId: userId1.id,\n});\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.saveTrxnFundTransfer}`)\n  .expectStatus(200);\nconst savedFundTransferTrxns = await prismaApi.fundTransferSave.findMany({});\nexpect(savedFundTransferTrxns).to.have.lengthOf(1);\nexpect(savedFundTransferTrxns[0].amount.toString()).to.equal(\&quot;1000\&quot;);\nexpect(savedFundTransferTrxns[0].isSave).to.be.true;\nexpect(savedFundTransferTrxns[0].toAccount).to.equal(\&quot;city-tcs-01\&quot;);\nexpect(savedFundTransferTrxns[0].fromAccount).to.equal(\&quot;01317577237\&quot;);\nexpect(savedFundTransferTrxns[0].type).to.equal(\&quot;BANK\&quot;);\nexpect(savedFundTransferTrxns[0].userId.toString()).to.equal(\n  userId1.id.toString()\n);\nexpect(savedFundTransferTrxns[0].accountName).to.equal(\&quot;John Doe\&quot;);\nexpect(savedFundTransferTrxns[0].accountNumber).to.equal(\&quot;1234567890\&quot;);\nexpect(savedFundTransferTrxns[0].bankName).to.equal(\&quot;Example Bank\&quot;);\nexpect(savedFundTransferTrxns[0].branchName).to.equal(\&quot;Main Branch\&quot;);\nexpect(savedFundTransferTrxns[0].cardType).to.equal(\&quot;VISA\&quot;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)\n    at insertFundTransferSavedTransaction (file:///opt/app/src/fundTransfer/getSaveTrxnFundTransfer.test.js:106:41)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/fundTransfer/getSaveTrxnFundTransfer.test.js:151:11)&quot;},&quot;uuid&quot;:&quot;e23cf49d-73b4-420c-aa2b-201a88aa4339&quot;,&quot;parentUUID&quot;:&quot;71c272dd-ccd6-4af4-93ec-94e650f836a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show the first add money transaction of bank account even after multiple transactions with the same bank account&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Fund Transfer should show the first add money transaction of bank account even after multiple transactions with the same bank account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await insertFundTransferSavedTransaction({\n    accountName: \&quot;John Doe\&quot;,\n    accountNumber: \&quot;1234567890\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    amount: 1000,\n    bankName: \&quot;Example Bank\&quot;,\n    branchName: \&quot;Main Branch\&quot;,\n    cardType: \&quot;VISA\&quot;,\n    districtName: \&quot;Central District\&quot;,\n    toAccount: \&quot;city-tcs-01\&quot;,\n    fromAccount: \&quot;01317577237\&quot;,\n    userId: userId1.id,\n  });\n  \n  await insertFundTransferSavedTransaction({\n    accountName: \&quot;John Doe\&quot;,\n    accountNumber: \&quot;1234567890\&quot;,\n    accountType: \&quot;BANK\&quot;,\n    amount: 2000,\n    bankName: \&quot;Example Bank\&quot;,\n    branchName: \&quot;Main Branch\&quot;,\n    cardType: \&quot;VISA\&quot;,\n    districtName: \&quot;Central District\&quot;,\n    toAccount: \&quot;city-tcs-01\&quot;,\n    fromAccount: \&quot;01317577237\&quot;,\n    userId: userId1.id,\n  });\n  \nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.saveTrxnFundTransfer}`)\n  .expectStatus(200)\n  .returns(\&quot;body\&quot;);\nconst savedFundTransferTrxns = await prismaApi.fundTransferSave.findMany({});\nexpect(savedFundTransferTrxns).to.have.lengthOf(1);\nexpect(savedFundTransferTrxns[0].amount.toString()).to.equal(\&quot;1000\&quot;);\nexpect(savedFundTransferTrxns[0].accountNumber).to.equal(\&quot;1234567890\&quot;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)\n    at insertFundTransferSavedTransaction (file:///opt/app/src/fundTransfer/getSaveTrxnFundTransfer.test.js:106:41)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/fundTransfer/getSaveTrxnFundTransfer.test.js:191:11)&quot;},&quot;uuid&quot;:&quot;5ac5c480-2a9b-4665-b03c-bdd99b7844cb&quot;,&quot;parentUUID&quot;:&quot;71c272dd-ccd6-4af4-93ec-94e650f836a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should save only one add money transaction per unique bank account&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Fund Transfer should save only one add money transaction per unique bank account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const bankAccounts = [\n  \&quot;1234567891\&quot;,\n  \&quot;1234567892\&quot;,\n  \&quot;1234567893\&quot;,\n  \&quot;1234567894\&quot;,\n  \&quot;1234567895\&quot;,\n];\nfor (let i = 0; i &lt; 10; i++) {\n  await insertFundTransferSavedTransaction({\n    accountName: `John Doe ${i % 5}`,\n    accountNumber: bankAccounts[i % 5],\n    accountType: \&quot;BANK\&quot;,\n    amount: 2222,\n    bankName: \&quot;Example Bank\&quot;,\n    branchName: \&quot;Main Branch\&quot;,\n    cardType: \&quot;VISA\&quot;,\n    districtName: \&quot;Central District\&quot;,\n    toAccount: \&quot;city-tcs-01\&quot;,\n    fromAccount: \&quot;01317577237\&quot;,\n    userId: userId1.id,\n  });\n}\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.saveTrxnFundTransfer}`)\n  .expectStatus(200)\n  .returns(\&quot;body\&quot;);\nconst savedFundTransferTrxns = await prismaApi.fundTransferSave.findMany({});\nexpect(savedFundTransferTrxns).to.have.lengthOf(5);\nconst savedAccountNumbers = savedFundTransferTrxns.map(\n  (txn) =&gt; txn.accountNumber\n);\nexpect(savedAccountNumbers).to.have.members(bankAccounts);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)\n    at insertFundTransferSavedTransaction (file:///opt/app/src/fundTransfer/getSaveTrxnFundTransfer.test.js:106:41)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/fundTransfer/getSaveTrxnFundTransfer.test.js:246:13)&quot;},&quot;uuid&quot;:&quot;480401c1-0a6b-4374-97cc-ce6c76f534e4&quot;,&quot;parentUUID&quot;:&quot;71c272dd-ccd6-4af4-93ec-94e650f836a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return saved add money transaction list with correct pagination and size&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Fund Transfer should return saved add money transaction list with correct pagination and size&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const bankAccounts = [\n  \&quot;1234567891\&quot;,\n  \&quot;1234567892\&quot;,\n  \&quot;1234567893\&quot;,\n  \&quot;1234567894\&quot;,\n  \&quot;1234567895\&quot;,\n];\nfor (let i = 0; i &lt; 10; i++) {\n    await insertFundTransferSavedTransaction({\n        accountName: `John Doe ${i % 5}`,\n        accountNumber: bankAccounts[i % 5],\n        accountType: \&quot;BANK\&quot;,\n        amount: 2222,\n        bankName: \&quot;Example Bank\&quot;,\n        branchName: \&quot;Main Branch\&quot;,\n        cardType: \&quot;VISA\&quot;,\n        districtName: \&quot;Central District\&quot;,\n        toAccount: \&quot;city-tcs-01\&quot;,\n        fromAccount: \&quot;01317577237\&quot;,\n        userId: userId1.id,\n      });\n}\nconst response = await pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(\n    `${ApiUrls.apiBaseUrl}${ApiUrls.saveTrxnFundTransfer}?page=0&amp;size=3`\n  )\n  .expectStatus(200);\n  console.log(response.body);\nexpect(response.body)\n  .to.have.property(\&quot;saveTransactions\&quot;)\n  .that.is.an(\&quot;array\&quot;);\nexpect(response.body.saveTransactions).to.have.lengthOf(3);\nexpect(response.body.pagination.hasNext).to.equal(true);\nexpect(response.body.pagination.currentPageTotalCount).to.equal(3);\nexpect(response.body.pagination.totalCount).to.equal(5);\nexpect(response.body.pagination.currentPage).to.equal(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)\n    at insertFundTransferSavedTransaction (file:///opt/app/src/fundTransfer/getSaveTrxnFundTransfer.test.js:106:41)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/fundTransfer/getSaveTrxnFundTransfer.test.js:288:15)&quot;},&quot;uuid&quot;:&quot;43464f21-7217-43d0-a886-da469bc2138b&quot;,&quot;parentUUID&quot;:&quot;71c272dd-ccd6-4af4-93ec-94e650f836a1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;e23cf49d-73b4-420c-aa2b-201a88aa4339&quot;,&quot;5ac5c480-2a9b-4665-b03c-bdd99b7844cb&quot;,&quot;480401c1-0a6b-4374-97cc-ce6c76f534e4&quot;,&quot;43464f21-7217-43d0-a886-da469bc2138b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;195ec4f1-f8e8-46fe-850e-690d459e14c8&quot;,&quot;title&quot;:&quot;Get Saved Transaction After Send Money&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/makePayment/getSaveTrxnMakePayment.test.js&quot;,&quot;file&quot;:&quot;/src/makePayment/getSaveTrxnMakePayment.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Get Saved Transaction After Send Money\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money \&quot;before all\&quot; hook in \&quot;Get Saved Transaction After Send Money\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b1d55eec-e30f-4096-8ba9-464568dd02b3&quot;,&quot;parentUUID&quot;:&quot;195ec4f1-f8e8-46fe-850e-690d459e14c8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Get Saved Transaction After Send Money\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money \&quot;before each\&quot; hook in \&quot;Get Saved Transaction After Send Money\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:220,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId1 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\nuserId2 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01711106485\&quot;,\n  },\n});\ntokenUser1 = generateUserToken(userId1.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\ntokenUser2 = generateUserToken(userId2.id, \&quot;01711106485\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\nawait setupTransactionTypes(chartOfAccounts);\ntype = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;make-payment-001\&quot; },\n});\ntrxnTypeId = type.id;\nawait createUserAccounts(chartOfAccounts);\ncustomerAccount1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nmerchantAccount1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01999999999\&quot; },\n});\nmerchantAccount2 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01999999888\&quot; },\n});\nmerchantAccount3 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01999999880\&quot; },\n});\nmerchantAccount4 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01999999777\&quot; },\n});\nawait addInitialBalance(customerAccount1, 50000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;151f75a0-8e64-4d53-91e2-c6b280c0d0a3&quot;,&quot;parentUUID&quot;:&quot;195ec4f1-f8e8-46fe-850e-690d459e14c8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Get Saved Transaction After Send Money\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money \&quot;after all\&quot; hook in \&quot;Get Saved Transaction After Send Money\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$disconnect();\nawait prismaApi.$disconnect();\nawait prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f29b0d0b-0adf-4c49-8af8-c6bf85636616&quot;,&quot;parentUUID&quot;:&quot;195ec4f1-f8e8-46fe-850e-690d459e14c8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get saved transaction list for Payment&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money should get saved transaction list for Payment&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await insertSavedTransaction({\n  fromAccount: customerAccount1,\n  toAccount: merchantAccount1,\n  transactionTypeId: trxnTypeId,\n  transactionTypeCode: \&quot;make-payment-001\&quot;,\n  amount: 100,\n  agentMobile: merchantAccount1.identifier,\n});\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.savetrxnPayment}`)\n  .expectStatus(200);\nconst paymentID = await prismaApi.payment.findFirst({\n  where: {\n    agentMobile: merchantAccount1.identifier,\n  },\n});\nconst saveTrxnMakePayment = await prismaApi.paymentSave.findMany({});\nexpect(saveTrxnMakePayment).to.have.lengthOf(1);\nexpect(saveTrxnMakePayment[0].amount.toString()).to.equal(\&quot;100\&quot;);\nexpect(saveTrxnMakePayment[0].save).to.be.true;\nexpect(saveTrxnMakePayment[0].fromAccount).to.equal(\&quot;01317577237\&quot;);\nexpect(saveTrxnMakePayment[0].toAccount).to.equal(\&quot;01999999999\&quot;);\nexpect(saveTrxnMakePayment[0].transactionTypeCode).to.equal(\n  \&quot;make-payment-001\&quot;\n);\nexpect(saveTrxnMakePayment[0].transactionTypeId).to.equal(trxnTypeId);\nexpect(saveTrxnMakePayment[0].createdAt).to.not.be.null;\nexpect(saveTrxnMakePayment[0].updatedAt).to.not.be.null;\nexpect(saveTrxnMakePayment[0].agentMobile).to.equal(\&quot;01999999999\&quot;);\nexpect(saveTrxnMakePayment[0].paymentId).to.equal(paymentID.id);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;24123a98-21f1-4488-a7db-98750251ff47&quot;,&quot;parentUUID&quot;:&quot;195ec4f1-f8e8-46fe-850e-690d459e14c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show the first transaction of ToAccount even after multiple transactions to the same account&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money should show the first transaction of ToAccount even after multiple transactions to the same account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await insertSavedTransaction({\n  fromAccount: customerAccount1,\n  toAccount: merchantAccount1,\n  transactionTypeId: trxnTypeId,\n  transactionTypeCode: \&quot;make-payment-001\&quot;,\n  amount: 100,\n  agentMobile: merchantAccount1.identifier,\n});\nawait insertSavedTransaction({\n  fromAccount: customerAccount1,\n  toAccount: merchantAccount1,\n  transactionTypeId: trxnTypeId,\n  transactionTypeCode: \&quot;make-payment-001\&quot;,\n  amount: 500,\n  agentMobile: merchantAccount1.identifier,\n});\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.savetrxnPayment}`)\n  .expectStatus(200);\nconst paymentID = await prismaApi.payment.findFirst({\n  where: {\n    agentMobile: merchantAccount1.identifier,\n  },\n});\nconst saveTrxnMakePayment = await prismaApi.paymentSave.findMany({});\nexpect(saveTrxnMakePayment).to.have.lengthOf(1);\nexpect(saveTrxnMakePayment[0].amount.toString()).to.equal(\&quot;100\&quot;);\nexpect(saveTrxnMakePayment[0].paymentId).to.equal(paymentID.id);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;15551efb-bc34-4095-ad5a-e283e38ea7bb&quot;,&quot;parentUUID&quot;:&quot;195ec4f1-f8e8-46fe-850e-690d459e14c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should save only one transaction per unique toAccount&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money should save only one transaction per unique toAccount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:95,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const uniqueMerchantAccounts = [\n  { identifier: \&quot;01999999999\&quot; },\n  { identifier: \&quot;01999999888\&quot; },\n  { identifier: \&quot;01999999880\&quot; },\n  { identifier: \&quot;01999999777\&quot; },\n];\nfor (let i = 0; i &lt; 10; i++) {\n  await insertSavedTransaction({\n    fromAccount: customerAccount1,\n    toAccount: uniqueMerchantAccounts[i % 4],\n    transactionTypeId: trxnTypeId,\n    transactionTypeCode: \&quot;make-payment-001\&quot;,\n    amount: 100,\n    agentMobile: merchantAccount1.identifier,\n  });\n}\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.savetrxnPayment}`)\n  .expectStatus(200);\nconst savedTransactions = await prismaApi.paymentSave.findMany({}); \nexpect(savedTransactions).to.have.lengthOf(4);\nconst savedToAccounts = savedTransactions.map((txn) =&gt; txn.toAccount);\nconst uniqueIdentifiers = uniqueMerchantAccounts.map(acc =&gt; acc.identifier);\nexpect(savedToAccounts).to.have.members(uniqueIdentifiers);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6c67d2f8-acf1-40c6-a3c3-e0685b843aa6&quot;,&quot;parentUUID&quot;:&quot;195ec4f1-f8e8-46fe-850e-690d459e14c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return correct pagination and size&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money should return correct pagination and size&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:130,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const uniqueMerchantAccounts = [\n  { identifier: \&quot;01999999999\&quot; },\n  { identifier: \&quot;01999999888\&quot; },\n  { identifier: \&quot;01999999880\&quot; },\n  { identifier: \&quot;01999999777\&quot; },\n];\nfor (let i = 0; i &lt; 10; i++) {\n  await insertSavedTransaction({\n    fromAccount: customerAccount1,\n    toAccount: uniqueMerchantAccounts[i % 4],\n    transactionTypeId: trxnTypeId,\n    transactionTypeCode: \&quot;make-payment-001\&quot;,\n    amount: 100,\n    agentMobile: merchantAccount1.identifier,\n  });\n}\nconst response = await pactum\n.spec()\n.withBearerToken(tokenUser1)\n.withMethod(\&quot;GET\&quot;)\n.withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.savetrxnPayment}?page=0&amp;size=3`)\n.expectStatus(200);\n\nexpect(response.body)\n  .to.have.property(\&quot;saveTransactions\&quot;)\n  .that.is.an(\&quot;array\&quot;);\nexpect(response.body.saveTransactions).to.have.lengthOf(3);\nexpect(response.body.saveTransactions[0].toAccount).to.equal(\&quot;01999999777\&quot;);\nexpect(response.body.saveTransactions[1].toAccount).to.equal(\&quot;01999999880\&quot;);\nexpect(response.body.saveTransactions[2].toAccount).to.equal(\&quot;01999999888\&quot;);\nexpect(response.body.pagination.hasNext).to.equal(true);\nexpect(response.body.pagination.currentPageTotalCount).to.equal(3);\nexpect(response.body.pagination.totalCount).to.equal(4);\nexpect(response.body.pagination.currentPage).to.equal(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected undefined to equal true&quot;,&quot;estack&quot;:&quot;AssertionError: expected undefined to equal true\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/makePayment/getSaveTrxnMakePayment.test.js:314:49)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;06f52666-23f0-470a-a345-7d7a947a709b&quot;,&quot;parentUUID&quot;:&quot;195ec4f1-f8e8-46fe-850e-690d459e14c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;24123a98-21f1-4488-a7db-98750251ff47&quot;,&quot;15551efb-bc34-4095-ad5a-e283e38ea7bb&quot;,&quot;6c67d2f8-acf1-40c6-a3c3-e0685b843aa6&quot;],&quot;failures&quot;:[&quot;06f52666-23f0-470a-a345-7d7a947a709b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:295,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7c7c5e9e-f339-405e-aea1-7567d9f13bf1&quot;,&quot;title&quot;:&quot;API Check: Make Payment(POST)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/makePayment/makePayment.test.js&quot;,&quot;file&quot;:&quot;/src/makePayment/makePayment.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;API Check: Make Payment(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Make Payment(POST) \&quot;before all\&quot; hook in \&quot;API Check: Make Payment(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d2799a8f-0a6c-47e0-87c9-430b9c1650b4&quot;,&quot;parentUUID&quot;:&quot;7c7c5e9e-f339-405e-aea1-7567d9f13bf1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;API Check: Make Payment(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Make Payment(POST) \&quot;before each\&quot; hook in \&quot;API Check: Make Payment(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8995,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\ntoken = generateUserToken(userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\nmerchant = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;merchant-01\&quot;\n);\nawait setupTransactionTypes(chartOfAccounts);\nawait createUserAccounts(chartOfAccounts);\nsender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nreceiver = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01999999999\&quot; },\n});\nconst type = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;make-payment-001\&quot; },\n});\nawait addInitialBalance(sender, 1000000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2b08b339-b4cd-4a8d-bd2b-8a34a0e06086&quot;,&quot;parentUUID&quot;:&quot;7c7c5e9e-f339-405e-aea1-7567d9f13bf1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;API Check: Make Payment(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;API Check: Make Payment(POST) \&quot;after all\&quot; hook in \&quot;API Check: Make Payment(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nreceiver = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01999999999\&quot; },\n});\nonholdUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577238\&quot; }\n});\nmaxwallet = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577210\&quot; }\n});\ndailyLimitAmountUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01715170020\&quot; }\n});\nconst testConfig = {\n  baseUrl: ApiUrls.apiBaseUrl,\n  endpoint: ApiUrls.doPayment,\n  token: token,\n  sender: sender,\n  receiver: receiver,\n  type: \&quot;Top Up\&quot;,\n  database: [prismaApi.payment],\n  transactionTypeCode: \&quot;make-payment-001\&quot;,\n  userId: userId.id,\n  requestBody: {\n    agentMobile: receiver.identifier,\n    amount: 60,\n    note: \&quot;khabar er taka\&quot;,\n    transactionTypeCode: \&quot;make-payment-001\&quot;,\n    referenceNo: \&quot;11111\&quot;,\n    save: true\n  },\n  requestBodyForNotFullActiveUser: {\n    agentMobile: receiver.identifier,\n    amount: 20,\n    note: \&quot;khabar er taka\&quot;,\n    transactionTypeCode: \&quot;make-payment-001\&quot;,\n    referenceNo: \&quot;11111\&quot;,\n  },\n  requestBodyForMinWalleAmount: {\n    amount: 4,\n    agentMobile: receiver.identifier,\n    note: \&quot;requestBodyForMinWalleAmount\&quot;,\n    referenceNo: \&quot;1111111111\&quot;,\n    transactionTypeCode: \&quot;make-payment-001\&quot;\n  },\n  requestBodyForMaxWalleAmount: {\n    amount: 200,\n    agentMobile: receiver.identifier,\n    note: \&quot;requestBodyForMaxWalleAmount\&quot;,\n    referenceNo: \&quot;1111111111\&quot;,\n    transactionTypeCode: \&quot;make-payment-001\&quot;\n  },\n  requestBodyForDailyLimitAmount: {\n    amount: 200,\n    agentMobile: receiver.identifier,\n    note: \&quot;requestBodyForMaxWalleAmount\&quot;,\n    referenceNo: \&quot;1111111111\&quot;,\n    transactionTypeCode: \&quot;make-payment-001\&quot;\n  },\n  requestBodyForTypeMinAmount: {\n    amount: 40,\n    agentMobile: receiver.identifier,\n    note: \&quot;requestBodyForTypeMinAmount\&quot;,\n    referenceNo: \&quot;1111111111\&quot;,\n    transactionTypeCode: \&quot;make-payment-001\&quot;\n  },\n  requestBodyForTypeMaxAmount: {\n    amount: 1000000,\n    agentMobile: receiver.identifier,\n    note: \&quot;requestBodyForTypeMinAmount\&quot;,\n    referenceNo: \&quot;1111111111\&quot;,\n    transactionTypeCode: \&quot;make-payment-001\&quot;\n  },\n}\nrunTransactionTests(testConfig);\nawait prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2c062644-3c7b-44cf-bff4-0040a7185cfa&quot;,&quot;parentUUID&quot;:&quot;7c7c5e9e-f339-405e-aea1-7567d9f13bf1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 200 for successful payment and save this payment&quot;,&quot;fullTitle&quot;:&quot;API Check: Make Payment(POST) should return 200 for successful payment and save this payment&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:30001,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doPayment}`)\n  .withBearerToken(token)\n  .withJson({\n    agentMobile: receiver.identifier,\n    amount: 200,\n    note: \&quot;khabar er taka\&quot;,\n    transactionTypeCode: \&quot;make-payment-001\&quot;,\n    referenceNo: \&quot;11111\&quot;,\n    save: true\n  })\n  .expectStatus(200);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\nawait checkSuccess({\n  groupId: \&quot;topup\&quot;,\n  topic: \&quot;payment_result\&quot;,\n  log: &#x27;Make Payment: From 01317577237 to 01999999999&#x27;,\n  amount: 200,\n  callback: async () =&gt; {\n    const paymentTable = await prismaApi.payment.findMany({\n      where: { userId: userId.id },\n    });\n    expect(paymentTable[0].status).to.equal(\&quot;SUCCESS\&quot;);\n    expect(paymentTable[0].userId).to.equal(userId.id);\n    const savePayment = await prismaApi.paymentSave.findMany({\n      where: { paymentId: paymentTable[0].id },\n    });\n    expect(savePayment).to.have.lengthOf(1);\n    console.log(savePayment[0].note);\n    expect(savePayment[0].note).to.equal(\&quot;khabar er taka\&quot;);\n    expect(savePayment[0].paymentId).to.equal(paymentTable[0].id);\n  }\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 30000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/makePayment/makePayment.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 30000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/makePayment/makePayment.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;04d7d5e7-92e5-480c-bf7b-c9af63fb4abe&quot;,&quot;parentUUID&quot;:&quot;7c7c5e9e-f339-405e-aea1-7567d9f13bf1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the reciever is not merchant&quot;,&quot;fullTitle&quot;:&quot;API Check: Make Payment(POST) should return 400 if the reciever is not merchant&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:73,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doPayment}`)\n  .withBearerToken(token)\n  .withJson({\n    agentMobile: \&quot;01711106485\&quot;,\n    amount: 200,\n    note: \&quot;khabar er taka\&quot;,\n    transactionTypeCode: \&quot;make-payment-001\&quot;,\n    referenceNo: \&quot;11111\&quot;,\n    save: true\n  })\n  .expectStatus(400);\n  const apiTable = await prismaApi.payment.findMany({\n    where: { userId: userId.id },\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5a7eadcd-bea3-4d4c-b87c-f10e74c34ddc&quot;,&quot;parentUUID&quot;:&quot;7c7c5e9e-f339-405e-aea1-7567d9f13bf1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5a7eadcd-bea3-4d4c-b87c-f10e74c34ddc&quot;],&quot;failures&quot;:[&quot;04d7d5e7-92e5-480c-bf7b-c9af63fb4abe&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:30074,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;26834f67-5928-47b1-b9dd-80db044c1a87&quot;,&quot;title&quot;:&quot;Account Creation for Merchant User&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/merchant/accountCreationMerchant.test.js&quot;,&quot;file&quot;:&quot;/src/merchant/accountCreationMerchant.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Account Creation for Merchant User\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Creation for Merchant User \&quot;before all\&quot; hook in \&quot;Account Creation for Merchant User\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaApi.$connect();\nawait prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0c5d721a-3b0d-42a9-899e-8a6109d27c37&quot;,&quot;parentUUID&quot;:&quot;26834f67-5928-47b1-b9dd-80db044c1a87&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Account Creation for Merchant User\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Creation for Merchant User \&quot;before each\&quot; hook in \&quot;Account Creation for Merchant User\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.accountLog.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAuth.adminUser.deleteMany({});\nawait prismaAuth.appUser.deleteMany({});\nawait prismaApi.adminSetting.deleteMany({});\nawait prismaApi.merchantUser.deleteMany({});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b4652052-8bce-4e6a-be4d-8438f013b633&quot;,&quot;parentUUID&quot;:&quot;26834f67-5928-47b1-b9dd-80db044c1a87&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Account Creation for Merchant User\&quot;&quot;,&quot;fullTitle&quot;:&quot;Account Creation for Merchant User \&quot;after all\&quot; hook in \&quot;Account Creation for Merchant User\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaApi.$disconnect();\nawait prismaAuth.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1a182c3f-63ef-43b3-a8d3-a8b84a725b28&quot;,&quot;parentUUID&quot;:&quot;26834f67-5928-47b1-b9dd-80db044c1a87&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create Merchant account successfully from Merchant App&quot;,&quot;fullTitle&quot;:&quot;Account Creation for Merchant User should create Merchant account successfully from Merchant App&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const appUser = await prismaAuth.appUser.create({\n  data: {\n    fullname: \&quot;John\&quot;,\n    phone: \&quot;01747538382\&quot;,\n    email: \&quot;johndoe1@example.com\&quot;,\n    password:\n      \&quot;$2a$10$C2JDo6LHB61PTl6mTBdEpeoPNRf7mDCKdbufHd.2uEJzwwm4hbP6q\&quot;,\n    fathername: \&quot;John Doe\&quot;,\n    mothername: \&quot;Jane Doe\&quot;,\n    nidnumber: \&quot;1234567890\&quot;,\n    dob: \&quot;1990-01-01\&quot;,\n    nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n    presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n    district: \&quot;Dhaka\&quot;,\n    hasLiveliness: false,\n    hasNidInfo: true,\n    isEmailVerified: false,\n    isPhoneVerified: false,\n    role: \&quot;MERCHANT\&quot;,\n    wrongPinCount: 0,\n  },\n});\ntoken = generateMerchantToken(Number(appUser.id), \&quot;01747538382\&quot;, [\n  \&quot;MERCHANT\&quot;,\n]);\nconst admin = await prismaAuth.adminUser.create({\n  data: {\n    name: \&quot;Admin user\&quot;,\n    email: \&quot;admin@example.com\&quot;,\n    password:\n      \&quot;$2a$10$M6jH9Ky2SbbJ5tu5dV220.PO86QWhef5cllDVNgwrxLWFPlqTYLlC\&quot;,\n    role: 0,\n    isActive: true,\n  },\n});\nconst chartOfAccount = await prismaAccounting.chartOfAccount.create({\n  data: {\n    adminId: admin.id,\n    code: \&quot;001\&quot;,\n    name: \&quot;Merchant\&quot;,\n    description: \&quot;Description for Account 1\&quot;,\n    headType: \&quot;LIABILITY\&quot;,\n    minWalletAmount: 100,\n    maxWalletAmount: 100000,\n    transactionType: \&quot;MEMBER\&quot;,\n    onlyParent: false,\n    monthlyLimitCount: 0,\n    monthlyLimitAmount: 0,\n    weeklyLimitCount: 0,\n    weeklyLimitAmount: 0,\n    dailyLimitCount: 0,\n    dailyLimitAmount: 0,\n  },\n});\nchartOfAccountId = chartOfAccount.id;\nawait new Promise((resolve) =&gt; setTimeout(resolve, 50));\nconst verifyChartOfAccount =\n  await prismaAccounting.chartOfAccount.findUnique({\n    where: { id: chartOfAccountId },\n  });\nif (!verifyChartOfAccount) {\n  throw new Error(\n    `Chart of Account with ID ${chartOfAccountId} was not found in the DB!`\n  );\n}\nawait prismaApi.adminSetting.create({\n  data: {\n    id: 1,\n    userType: \&quot;MERCHANT\&quot;,\n    createdBy: admin.id,\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    info: JSON.stringify({\n      merchantWalletCoaId: chartOfAccountId,\n      bulkDisbursementTrxType: null,\n      settlementTrxCode: null,\n      sendMoneyTrxCode: null,\n      addMoneyMfsTransferTrxCode: null,\n      addMoneyBankTransferTrxCode: null,\n      addMoneyCardTransferTrxCode: null,\n      addMoneyInfo: null,\n    }),\n  },\n});\nawait prismaApi.adminSetting.findFirst({\n  where: { userType: \&quot;MERCHANT\&quot; },\n});\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.saveLivelinessMerchant}`)\n  .withBearerToken(token)\n  .withFile(\n    \&quot;livelinessImage\&quot;,\n    path.resolve(\&quot;/opt/app/test-data/Onamika.jpeg\&quot;)\n  )\n  .expectStatus(200);\nconst createdAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01747538382\&quot; },\n});\nconst allAccounts = await prismaAccounting.userAccount.findMany();\nexpect(createdAccount).to.not.be.null;\nexpect(createdAccount.identifier).to.equal(\&quot;01747538382\&quot;);\nexpect(allAccounts.length).to.equal(1);\nexpect(createdAccount.accountName).to.equal(\&quot;John\&quot;);\nexpect(createdAccount.status).to.equal(\&quot;LIMITED_ACTIVE\&quot;);\nexpect(createdAccount.chartOfAccount_id).to.equal(chartOfAccountId);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;PrismaClientKnownRequestError: \nInvalid `prisma.adminUser.create()` invocation:\n\n\nThe column `role` does not exist in the current database.&quot;,&quot;estack&quot;:&quot;PrismaClientKnownRequestError: \nInvalid `prisma.adminUser.create()` invocation:\n\n\nThe column `role` does not exist in the current database.\n    at qn.handleRequestError (prisma/generated/auth/runtime/library.js:121:7315)\n    at qn.handleAndLogRequestError (prisma/generated/auth/runtime/library.js:121:6640)\n    at qn.request (prisma/generated/auth/runtime/library.js:121:6347)\n    at async l (prisma/generated/auth/runtime/library.js:130:9616)\n    at async Context.&lt;anonymous&gt; (file:///opt/app/src/merchant/accountCreationMerchant.test.js:71:19)&quot;},&quot;uuid&quot;:&quot;d1322574-b268-4764-a579-a0ce561936d7&quot;,&quot;parentUUID&quot;:&quot;26834f67-5928-47b1-b9dd-80db044c1a87&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;d1322574-b268-4764-a579-a0ce561936d7&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ae51c584-f3ed-4a6f-bb3c-703f19c894de&quot;,&quot;title&quot;:&quot;Bank information for Mechant Onboarding&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/merchant/bankInfo.test.js&quot;,&quot;file&quot;:&quot;/src/merchant/bankInfo.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Bank information for Mechant Onboarding\&quot;&quot;,&quot;fullTitle&quot;:&quot;Bank information for Mechant Onboarding \&quot;before all\&quot; hook in \&quot;Bank information for Mechant Onboarding\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;16acbb9a-37cf-48d5-ab24-ac97c015f21a&quot;,&quot;parentUUID&quot;:&quot;ae51c584-f3ed-4a6f-bb3c-703f19c894de&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Bank information for Mechant Onboarding\&quot;&quot;,&quot;fullTitle&quot;:&quot;Bank information for Mechant Onboarding \&quot;before each\&quot; hook in \&quot;Bank information for Mechant Onboarding\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAuth.appUser.deleteMany({});\nawait prismaApi.MerchantUser.deleteMany({});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d414d865-775f-43c2-a968-302b2c0546d9&quot;,&quot;parentUUID&quot;:&quot;ae51c584-f3ed-4a6f-bb3c-703f19c894de&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Bank information for Mechant Onboarding\&quot;&quot;,&quot;fullTitle&quot;:&quot;Bank information for Mechant Onboarding \&quot;after all\&quot; hook in \&quot;Bank information for Mechant Onboarding\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c92631f3-40b9-45d5-be50-ee0661d9c7aa&quot;,&quot;parentUUID&quot;:&quot;ae51c584-f3ed-4a6f-bb3c-703f19c894de&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should Store bank information successfully&quot;,&quot;fullTitle&quot;:&quot;Bank information for Mechant Onboarding should Store bank information successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.appUser.create({\n  data: {\n    fullname: \&quot;John\&quot;,\n    phone: \&quot;01747538382\&quot;,\n    profilePicture: \&quot;https://example.com/john.jpg\&quot;,\n    email: \&quot;johndoe1@example.com\&quot;,\n    password: \&quot;123458\&quot;,\n    fathername: \&quot;John Doe\&quot;,\n    mothername: \&quot;Jane Doe\&quot;,\n    nidnumber: \&quot;1234567890\&quot;,\n    dob: \&quot;1990-01-01\&quot;,\n    nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n    presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n    district: \&quot;Dhaka\&quot;,\n    hasLiveliness: true,\n    hasNidInfo: true,\n    isEmailVerified: false,\n    isPhoneVerified: false,\n    role: \&quot;MERCHANT\&quot;,\n    wrongPinCount: 0,\n  },\n});\nconst userFromDb = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01747538382\&quot;,\n  },\n});\nif (!userFromDb) {\n  throw new Error(\&quot;User not found after creation\&quot;);\n}\nconst merchantUser = await prismaApi.MerchantUser.create({\n  data: {\n    userId: userFromDb.id,\n    settlementFrequency: \&quot;MONTHLY\&quot;\n  },\n});\nif (!merchantUser) {\n  throw new Error(\&quot;Merchant user not created\&quot;);\n}\nconst token = generateMerchantToken(Number(userFromDb.id), \&quot;01747538382\&quot;, [\n  \&quot;MERCHANT\&quot;,\n]);\nconst bankInfo = {\n  bankAccountNo: \&quot;1234567890\&quot;,\n  bankAccountName: \&quot;aaaaaa\&quot;,\n  bankName: \&quot;City Bank\&quot;,\n  bankBranchName: \&quot;Mirpur\&quot;,\n  settlementFrequency: \&quot;MONTHLY\&quot; \n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.bankInformation}`)\n  .withJson(bankInfo)\n  .expectStatus(200);\nconst bankInfoFromDb = await prismaApi.merchantUser.findMany({\n  where: {\n    userId: userFromDb.id,\n    settlementFrequency: \&quot;MONTHLY\&quot;\n  },\n});\nif (!bankInfoFromDb) {\n  throw new Error(\&quot;Bank information not found in database after creation\&quot;);\n}\nexpect(bankInfoFromDb[0]).to.not.be.null;\nexpect(bankInfoFromDb[0].bankAccountNo).to.equal(\&quot;1234567890\&quot;);\nexpect(bankInfoFromDb[0].bankAccountName).to.equal(\&quot;aaaaaa\&quot;);\nexpect(bankInfoFromDb[0].bankName).to.equal(\&quot;City Bank\&quot;);\nexpect(bankInfoFromDb[0].bankBranchName).to.equal(\&quot;Mirpur\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;61051729-fc2f-475f-a9cf-e9e978ebee2b&quot;,&quot;parentUUID&quot;:&quot;ae51c584-f3ed-4a6f-bb3c-703f19c894de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if the user is not logged In&quot;,&quot;fullTitle&quot;:&quot;Bank information for Mechant Onboarding should show error if the user is not logged In&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.appUser.create({\n  data: {\n    fullname: \&quot;John\&quot;,\n    phone: \&quot;01747538382\&quot;,\n    profilePicture: \&quot;https://example.com/john.jpg\&quot;,\n    email: \&quot;johndoe1@example.com\&quot;,\n    password: \&quot;123458\&quot;,\n    fathername: \&quot;John Doe\&quot;,\n    mothername: \&quot;Jane Doe\&quot;,\n    nidnumber: \&quot;1234567890\&quot;,\n    dob: \&quot;1990-01-01\&quot;,\n    nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n    presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n    district: \&quot;Dhaka\&quot;,\n    hasLiveliness: true,\n    hasNidInfo: true,\n    isEmailVerified: false,\n    isPhoneVerified: false,\n    role: \&quot;MERCHANT\&quot;,\n    wrongPinCount: 0,\n  },\n});\nconst userFromDb = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01747538382\&quot;,\n  },\n});\nawait prismaApi.MerchantUser.create({\n  data: {\n    userId: userFromDb.id,\n    settlementFrequency: \&quot;MONTHLY\&quot;\n  },\n});\nconst bankInfo = {\n  bankAccountNo: \&quot;1234567890\&quot;,\n  bankAccountName: \&quot;aaaaaa\&quot;,\n  bankName: \&quot;City Bank\&quot;,\n  bankBranchName: \&quot;Mirpur\&quot;,\n  settlementFrequency: \&quot;MONTHLY\&quot; \n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.bankInformation}`)\n  .withJson(bankInfo)\n  .expectStatus(403);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5297609f-7fd9-4ae1-a184-094afcc722fb&quot;,&quot;parentUUID&quot;:&quot;ae51c584-f3ed-4a6f-bb3c-703f19c894de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if mechant doesnt exist&quot;,&quot;fullTitle&quot;:&quot;Bank information for Mechant Onboarding should show error if mechant doesnt exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.appUser.create({\n  data: {\n    fullname: \&quot;John\&quot;,\n    phone: \&quot;01747538382\&quot;,\n    profilePicture: \&quot;https://example.com/john.jpg\&quot;,\n    email: \&quot;johndoe1@example.com\&quot;,\n    password: \&quot;123458\&quot;,\n    fathername: \&quot;John Doe\&quot;,\n    mothername: \&quot;Jane Doe\&quot;,\n    nidnumber: \&quot;1234567890\&quot;,\n    dob: \&quot;1990-01-01\&quot;,\n    nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n    presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n    district: \&quot;Dhaka\&quot;,\n    hasLiveliness: true,\n    hasNidInfo: true,\n    isEmailVerified: false,\n    isPhoneVerified: false,\n    role: \&quot;MERCHANT\&quot;,\n    wrongPinCount: 0,\n  },\n});\nconst userFromDb = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01747538382\&quot;,\n  },\n});\nawait prismaApi.MerchantUser.create({\n  data: {\n    userId: userFromDb.id,\n    settlementFrequency: \&quot;MONTHLY\&quot;\n  },\n});\nconst bankInfo = {\n  bankAccountNo: \&quot;1234567890\&quot;,\n  bankAccountName: \&quot;aaaaaa\&quot;,\n  bankName: \&quot;City Bank\&quot;,\n  bankBranchName: \&quot;Mirpur\&quot;,\n  settlementFrequency: \&quot;MONTHLY\&quot; \n};\nconst invalidToken = generateMerchantToken(Number(5555), \&quot;01747538382\&quot;, [\n  \&quot;MERCHANT\&quot;,\n]);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(invalidToken)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.bankInformation}`)\n  .withJson(bankInfo)\n  .expectStatus(400);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;470897ba-5664-460f-a0b8-2ec5f9dbed89&quot;,&quot;parentUUID&quot;:&quot;ae51c584-f3ed-4a6f-bb3c-703f19c894de&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;61051729-fc2f-475f-a9cf-e9e978ebee2b&quot;,&quot;5297609f-7fd9-4ae1-a184-094afcc722fb&quot;,&quot;470897ba-5664-460f-a0b8-2ec5f9dbed89&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:49,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;a46322a6-b126-4f25-9754-2cc1968ae0ec&quot;,&quot;title&quot;:&quot;Business information for Mechant Onboarding&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/merchant/businessInfo.test.js&quot;,&quot;file&quot;:&quot;/src/merchant/businessInfo.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Business information for Mechant Onboarding\&quot;&quot;,&quot;fullTitle&quot;:&quot;Business information for Mechant Onboarding \&quot;before all\&quot; hook in \&quot;Business information for Mechant Onboarding\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2b71ad65-4f56-4b4d-a0fe-18fb8a092ed7&quot;,&quot;parentUUID&quot;:&quot;a46322a6-b126-4f25-9754-2cc1968ae0ec&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Business information for Mechant Onboarding\&quot;&quot;,&quot;fullTitle&quot;:&quot;Business information for Mechant Onboarding \&quot;before each\&quot; hook in \&quot;Business information for Mechant Onboarding\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAuth.appUser.deleteMany({});\nawait prismaApi.MerchantUser.deleteMany({});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9a0034e6-f248-423e-b4a3-62f2855368c4&quot;,&quot;parentUUID&quot;:&quot;a46322a6-b126-4f25-9754-2cc1968ae0ec&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Business information for Mechant Onboarding\&quot;&quot;,&quot;fullTitle&quot;:&quot;Business information for Mechant Onboarding \&quot;after all\&quot; hook in \&quot;Business information for Mechant Onboarding\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;24a6492e-26db-462b-878d-ce15234c5a9d&quot;,&quot;parentUUID&quot;:&quot;a46322a6-b126-4f25-9754-2cc1968ae0ec&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should Store Business information successfully&quot;,&quot;fullTitle&quot;:&quot;Business information for Mechant Onboarding should Store Business information successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.appUser.create({\n  data: {\n    fullname: \&quot;John\&quot;,\n    phone: \&quot;01747538382\&quot;,\n    profilePicture: \&quot;https://example.com/john.jpg\&quot;,\n    email: \&quot;johndoe1@example.com\&quot;,\n    password: \&quot;123458\&quot;,\n    fathername: \&quot;John Doe\&quot;,\n    mothername: \&quot;Jane Doe\&quot;,\n    nidnumber: \&quot;1234567890\&quot;,\n    dob: \&quot;1990-01-01\&quot;,\n    nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n    presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n    district: \&quot;Dhaka\&quot;,\n    hasLiveliness: true,\n    hasNidInfo: true,\n    isEmailVerified: false,\n    isPhoneVerified: false,\n    role: \&quot;MERCHANT\&quot;,\n    wrongPinCount: 0,\n  },\n});\nconst userFromDb = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01747538382\&quot;,\n  },\n});\nif (!userFromDb) {\n  throw new Error(\&quot;User not found after creation\&quot;);\n}\nconst merchantUser = await prismaApi.MerchantUser.create({\n  data: {\n    userId: userFromDb.id,\n    settlementFrequency: \&quot;MONTHLY\&quot;\n  },\n});\nif (!merchantUser) {\n  throw new Error(\&quot;Merchant user not created\&quot;);\n}\nconst token = generateMerchantToken(Number(userFromDb.id), \&quot;01747538382\&quot;, [\n  \&quot;MERCHANT\&quot;,\n]);\nconst businessInfo = {\n  tinNumber: \&quot;1234567887\&quot;,\n  organizationType: \&quot;Private Limited\&quot;,\n  organizationName: \&quot;Shukhee Private Limited\&quot;,\n  organizationAddress: \&quot;Agargaon, Dhaka\&quot;,\n  email: \&quot;shukhee@gmail.com\&quot;,\n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.businessInformation}`)\n  .withJson(businessInfo)\n  .expectStatus(200);\nconst businessInfoFromDb = await prismaApi.merchantUser.findMany({\n  where: {\n    userId: userFromDb.id,\n  },\n});\nif (!businessInfoFromDb) {\n  throw new Error(\n    \&quot;Business information not found in database after creation\&quot;\n  );\n}\nexpect(businessInfoFromDb[0]).to.not.be.null;\nexpect(businessInfoFromDb[0].tinNumber).to.equal(\&quot;1234567887\&quot;);\nexpect(businessInfoFromDb[0].organizationType).to.equal(\&quot;Private Limited\&quot;);\nexpect(businessInfoFromDb[0].organizationName).to.equal(\n  \&quot;Shukhee Private Limited\&quot;\n);\nexpect(businessInfoFromDb[0].organizationAddress).to.equal(\n  \&quot;Agargaon, Dhaka\&quot;\n);\nexpect(businessInfoFromDb[0].email).to.equal(\&quot;shukhee@gmail.com\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;11fc7ba7-5ffa-4013-8b67-f5c59596cae8&quot;,&quot;parentUUID&quot;:&quot;a46322a6-b126-4f25-9754-2cc1968ae0ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if the user is not logged In&quot;,&quot;fullTitle&quot;:&quot;Business information for Mechant Onboarding should show error if the user is not logged In&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.appUser.create({\n  data: {\n    fullname: \&quot;John\&quot;,\n    phone: \&quot;01747538382\&quot;,\n    profilePicture: \&quot;https://example.com/john.jpg\&quot;,\n    email: \&quot;johndoe1@example.com\&quot;,\n    password: \&quot;123458\&quot;,\n    fathername: \&quot;John Doe\&quot;,\n    mothername: \&quot;Jane Doe\&quot;,\n    nidnumber: \&quot;1234567890\&quot;,\n    dob: \&quot;1990-01-01\&quot;,\n    nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n    presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n    district: \&quot;Dhaka\&quot;,\n    hasLiveliness: true,\n    hasNidInfo: true,\n    isEmailVerified: false,\n    isPhoneVerified: false,\n    role: \&quot;MERCHANT\&quot;,\n    wrongPinCount: 0,\n  },\n});\nconst userFromDb = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01747538382\&quot;,\n  },\n});\nawait prismaApi.MerchantUser.create({\n  data: {\n    userId: userFromDb.id,\n    settlementFrequency: \&quot;MONTHLY\&quot;\n  },\n});\nconst businessInfo = {\n  tinNumber: \&quot;1234567887\&quot;,\n  organizationType: \&quot;Private Limited\&quot;,\n  organizationName: \&quot;Shukhee Private Limited\&quot;,\n  organizationAddress: \&quot;Agargaon, Dhaka\&quot;,\n  email: \&quot;shukhee@gmail.com\&quot;,\n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.businessInformation}`)\n  .withJson(businessInfo)\n  .expectStatus(403);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6e5a9867-530c-44db-a05b-a9e426ec0937&quot;,&quot;parentUUID&quot;:&quot;a46322a6-b126-4f25-9754-2cc1968ae0ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if mechant doesnt exist&quot;,&quot;fullTitle&quot;:&quot;Business information for Mechant Onboarding should show error if mechant doesnt exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.appUser.create({\n  data: {\n    fullname: \&quot;John\&quot;,\n    phone: \&quot;01747538382\&quot;,\n    profilePicture: \&quot;https://example.com/john.jpg\&quot;,\n    email: \&quot;johndoe1@example.com\&quot;,\n    password: \&quot;123458\&quot;,\n    fathername: \&quot;John Doe\&quot;,\n    mothername: \&quot;Jane Doe\&quot;,\n    nidnumber: \&quot;1234567890\&quot;,\n    dob: \&quot;1990-01-01\&quot;,\n    nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n    presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n    district: \&quot;Dhaka\&quot;,\n    hasLiveliness: true,\n    hasNidInfo: true,\n    isEmailVerified: false,\n    isPhoneVerified: false,\n    role: \&quot;MERCHANT\&quot;,\n    wrongPinCount: 0,\n  },\n});\nconst userFromDb = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01747538382\&quot;,\n  },\n});\nawait prismaApi.MerchantUser.create({\n  data: {\n    userId: userFromDb.id,\n    settlementFrequency: \&quot;MONTHLY\&quot;\n  },\n});\nconst businessInfo = {\n  tinNumber: \&quot;1234567887\&quot;,\n  organizationType: \&quot;Private Limited\&quot;,\n  organizationName: \&quot;Shukhee Private Limited\&quot;,\n  organizationAddress: \&quot;Agargaon, Dhaka\&quot;,\n  email: \&quot;shukhee@gmail.com\&quot;,\n};\nconst invalidToken = generateMerchantToken(Number(5555), \&quot;01747538382\&quot;, [\n  \&quot;MERCHANT\&quot;,\n]);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(invalidToken)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.businessInformation}`)\n  .withJson(businessInfo)\n  .expectStatus(400);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0336d457-f047-44e1-a872-920a6a105e95&quot;,&quot;parentUUID&quot;:&quot;a46322a6-b126-4f25-9754-2cc1968ae0ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error with Invalid Email&quot;,&quot;fullTitle&quot;:&quot;Business information for Mechant Onboarding should show error with Invalid Email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.appUser.create({\n  data: {\n    fullname: \&quot;John\&quot;,\n    phone: \&quot;01747538382\&quot;,\n    profilePicture: \&quot;https://example.com/john.jpg\&quot;,\n    email: \&quot;johndoe1@example.com\&quot;,\n    password: \&quot;123458\&quot;,\n    fathername: \&quot;John Doe\&quot;,\n    mothername: \&quot;Jane Doe\&quot;,\n    nidnumber: \&quot;1234567890\&quot;,\n    dob: \&quot;1990-01-01\&quot;,\n    nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n    presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n    district: \&quot;Dhaka\&quot;,\n    hasLiveliness: true,\n    hasNidInfo: true,\n    isEmailVerified: false,\n    isPhoneVerified: false,\n    role: \&quot;MERCHANT\&quot;,\n    wrongPinCount: 0,\n  },\n});\nconst userFromDb = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01747538382\&quot;,\n  },\n});\nif (!userFromDb) {\n  throw new Error(\&quot;User not found after creation\&quot;);\n}\nconst merchantUser = await prismaApi.MerchantUser.create({\n  data: {\n    userId: userFromDb.id,\n    settlementFrequency: \&quot;MONTHLY\&quot;\n  },\n});\nif (!merchantUser) {\n  throw new Error(\&quot;Merchant user not created\&quot;);\n}\nconst token = generateMerchantToken(Number(userFromDb.id), \&quot;01747538382\&quot;, [\n  \&quot;MERCHANT\&quot;,\n]);\nconst businessInfo = {\n  tinNumber: \&quot;1234567887\&quot;,\n  organizationType: \&quot;Private Limited\&quot;,\n  organizationName: \&quot;Shukhee Private Limited\&quot;,\n  organizationAddress: \&quot;Agargaon, Dhaka\&quot;,\n  email: \&quot;shukhee\&quot;,\n};\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.businessInformation}`)\n  .withJson(businessInfo)\n  .expectStatus(400);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;297e307f-158a-4bd1-ab33-2174b0cdc8fb&quot;,&quot;parentUUID&quot;:&quot;a46322a6-b126-4f25-9754-2cc1968ae0ec&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;11fc7ba7-5ffa-4013-8b67-f5c59596cae8&quot;,&quot;6e5a9867-530c-44db-a05b-a9e426ec0937&quot;,&quot;0336d457-f047-44e1-a872-920a6a105e95&quot;,&quot;297e307f-158a-4bd1-ab33-2174b0cdc8fb&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:74,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6abbdcd0-881f-4573-b0f7-cb615b1e10f2&quot;,&quot;title&quot;:&quot;Merchant Registration&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/merchant/merchantRegistration.test.js&quot;,&quot;file&quot;:&quot;/src/merchant/merchantRegistration.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Merchant Registration\&quot;&quot;,&quot;fullTitle&quot;:&quot;Merchant Registration \&quot;before all\&quot; hook in \&quot;Merchant Registration\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaApi.$connect();\nawait prismaAccounting.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1c2aef3b-ced5-4346-aea1-1b25e1f488a1&quot;,&quot;parentUUID&quot;:&quot;6abbdcd0-881f-4573-b0f7-cb615b1e10f2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Merchant Registration\&quot;&quot;,&quot;fullTitle&quot;:&quot;Merchant Registration \&quot;before each\&quot; hook in \&quot;Merchant Registration\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaApi.MerchantUser.deleteMany({});\nawait prismaAuth.appUser.deleteMany({});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3946188f-9ff7-4f73-8a8d-fe824785d604&quot;,&quot;parentUUID&quot;:&quot;6abbdcd0-881f-4573-b0f7-cb615b1e10f2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Merchant Registration\&quot;&quot;,&quot;fullTitle&quot;:&quot;Merchant Registration \&quot;after all\&quot; hook in \&quot;Merchant Registration\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;71d2f5df-b5e1-42ba-a001-765f9cf58748&quot;,&quot;parentUUID&quot;:&quot;6abbdcd0-881f-4573-b0f7-cb615b1e10f2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should register merchant with Valid Phone Number&quot;,&quot;fullTitle&quot;:&quot;Merchant Registration should register merchant with Valid Phone Number&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1147,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await new Promise((resolve) =&gt; setTimeout(resolve, 1000));\n    const res = await pactum\n      .spec()\n      .withMethod(\&quot;POST\&quot;)\n      .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.registerMerchant}`)\n      .withJson({\n        phoneNumber: \&quot;01788448853\&quot;\n      })\n      .expectStatus(200);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 200\n\n502 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 200\n\n502 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 200\n&quot;},&quot;uuid&quot;:&quot;76076cb0-5dc5-4802-96e4-0cee1bfafeb9&quot;,&quot;parentUUID&quot;:&quot;6abbdcd0-881f-4573-b0f7-cb615b1e10f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error when phone number is invalid&quot;,&quot;fullTitle&quot;:&quot;Merchant Registration should show error when phone number is invalid&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const phoneNumber = \&quot;0184565164\&quot;;\nconst body = { phoneNumber };\nconst res = await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.registerMerchant}`)\n  .withJson(body)\n  .expectStatus(400);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;994092e2-1ded-4da9-beb7-bb431f45314d&quot;,&quot;parentUUID&quot;:&quot;6abbdcd0-881f-4573-b0f7-cb615b1e10f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error when phone Number Contains Special Character&quot;,&quot;fullTitle&quot;:&quot;Merchant Registration should show error when phone Number Contains Special Character&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const phoneNumber = \&quot;0184565#&amp;@*\&quot;;\nconst body = { phoneNumber };\nconst res = await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.registerMerchant}`)\n  .withJson(body)\n  .expectStatus(400);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6d3b9bdc-98e9-4224-9ad2-894b9138d583&quot;,&quot;parentUUID&quot;:&quot;6abbdcd0-881f-4573-b0f7-cb615b1e10f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error when phone Number Contains Text&quot;,&quot;fullTitle&quot;:&quot;Merchant Registration should show error when phone Number Contains Text&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const phoneNumber = \&quot;0184565164s\&quot;;\nconst body = { phoneNumber };\nconst res = await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.registerMerchant}`)\n  .withJson(body)\n  .expectStatus(400);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5a243cc7-0b2e-4ff6-8c12-7a3d6dada3a6&quot;,&quot;parentUUID&quot;:&quot;6abbdcd0-881f-4573-b0f7-cb615b1e10f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error for duplicate phone Number&quot;,&quot;fullTitle&quot;:&quot;Merchant Registration should show error for duplicate phone Number&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:544,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.appUser.create({\n      data: {\n        fullname: \&quot;John Doe\&quot;,\n        phone: \&quot;01747538382\&quot;,\n        profilePicture: \&quot;https://example.com/john.jpg\&quot;,\n        password:\&quot;$2a$10$O.OzJsabGv4YyKPCwntAEeBIg8O67pIZbLOLBlZGp5Ss.8Ce6sEbS\&quot;,\n        email: \&quot;johndoe1@example.com\&quot;,\n        fathername: \&quot;John Doe\&quot;,\n        mothername: \&quot;Jane Doe\&quot;,\n        hasLiveliness: true,\n        hasNidInfo:true,\n        isEmailVerified: true,\n        isPhoneVerified: true,\n        role: \&quot;MERCHANT\&quot;,\n        wrongPinCount: 0,\n      },\n    });\n    \n    const user = await prismaAuth.appUser.findUnique({\n      where: {\n        phone: \&quot;01747538382\&quot;,\n      }\n    });\n    const phoneNumber = \&quot;01747538382\&quot;;\n    const body = { phoneNumber };\n    const res = await pactum\n    .spec()\n    .withMethod(\&quot;POST\&quot;)\n    .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.registerMerchant}`)\n    .withJson(body)\n    .expectStatus(409);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;639a1287-e1e3-40c2-8872-cebaded280f9&quot;,&quot;parentUUID&quot;:&quot;6abbdcd0-881f-4573-b0f7-cb615b1e10f2&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;994092e2-1ded-4da9-beb7-bb431f45314d&quot;,&quot;6d3b9bdc-98e9-4224-9ad2-894b9138d583&quot;,&quot;5a243cc7-0b2e-4ff6-8c12-7a3d6dada3a6&quot;,&quot;639a1287-e1e3-40c2-8872-cebaded280f9&quot;],&quot;failures&quot;:[&quot;76076cb0-5dc5-4802-96e4-0cee1bfafeb9&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1699,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;1fdc8b3e-2f86-4564-a778-5ba89036242c&quot;,&quot;title&quot;:&quot;Trade License for Mechant Onboarding&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/merchant/saveTradeLicense.test.js&quot;,&quot;file&quot;:&quot;/src/merchant/saveTradeLicense.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Trade License for Mechant Onboarding\&quot;&quot;,&quot;fullTitle&quot;:&quot;Trade License for Mechant Onboarding \&quot;before all\&quot; hook in \&quot;Trade License for Mechant Onboarding\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;012d9692-9ef2-437b-97ff-9506b5058d46&quot;,&quot;parentUUID&quot;:&quot;1fdc8b3e-2f86-4564-a778-5ba89036242c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Trade License for Mechant Onboarding\&quot;&quot;,&quot;fullTitle&quot;:&quot;Trade License for Mechant Onboarding \&quot;before each\&quot; hook in \&quot;Trade License for Mechant Onboarding\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1354,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAuth.appUser.deleteMany({});\nawait prismaApi.MerchantUser.deleteMany({});\nawait prismaAuth.appUser.create({\n  data: {\n    fullname: \&quot;John\&quot;,\n    phone: \&quot;01747538382\&quot;,\n    profilePicture: \&quot;https://example.com/john.jpg\&quot;,\n    email: \&quot;johndoe1@example.com\&quot;,\n    password: \&quot;123458\&quot;,\n    fathername: \&quot;John Doe\&quot;,\n    mothername: \&quot;Jane Doe\&quot;,\n    nidnumber: \&quot;1234567890\&quot;,\n    dob: \&quot;1990-01-01\&quot;,\n    nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n    presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n    district: \&quot;Dhaka\&quot;,\n    hasLiveliness: true,\n    hasNidInfo: true,\n    isEmailVerified: false,\n    isPhoneVerified: false,\n    role: \&quot;MERCHANT\&quot;,\n    wrongPinCount: 0,\n  },\n});\nlet userFromDb = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01747538382\&quot;,\n  },\n});\nidfromUser = userFromDb.id;\nawait prismaApi.MerchantUser.create({\n  data: {\n    userId: idfromUser,\n    bankAccountNo: \&quot;1234567890\&quot;,\n    bankAccountName: \&quot;aaaaaa\&quot;,\n    bankName: \&quot;City Bank\&quot;,\n    bankBranchName: \&quot;Mirpur\&quot;,\n    tinNumber: \&quot;1234567887\&quot;,\n    organizationType: \&quot;Private Limited\&quot;,\n    organizationName: \&quot;Shukhee Private Limited\&quot;,\n    organizationAddress: \&quot;Agargaon, Dhaka\&quot;,\n    email: \&quot;shukhee@gmail.com\&quot;,\n    settlementFrequency: \&quot;MONTHLY\&quot;\n  },\n});\ntoken = generateMerchantToken(Number(userFromDb.id), \&quot;01747538382\&quot;, [\n  \&quot;MERCHANT\&quot;,\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f2f5515d-85bb-4feb-80b2-5c7b5a262a5f&quot;,&quot;parentUUID&quot;:&quot;1fdc8b3e-2f86-4564-a778-5ba89036242c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Trade License for Mechant Onboarding\&quot;&quot;,&quot;fullTitle&quot;:&quot;Trade License for Mechant Onboarding \&quot;after all\&quot; hook in \&quot;Trade License for Mechant Onboarding\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;abe86dc0-d96c-4e0c-84df-a0ede760e9e0&quot;,&quot;parentUUID&quot;:&quot;1fdc8b3e-2f86-4564-a778-5ba89036242c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should Save trade license image successfully&quot;,&quot;fullTitle&quot;:&quot;Trade License for Mechant Onboarding should Save trade license image successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:748,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const formData = new FormData();\nconst imagePath = path.resolve(\&quot;/opt/app/test-data/trade_license.jpeg\&quot;);\nif (!fs.existsSync(imagePath)) {\n  throw new Error(`Test image not found at path: ${imagePath}`);\n}\nformData.append(\&quot;file\&quot;, fs.createReadStream(imagePath), {\n  filename: \&quot;trade_license.jpeg\&quot;,\n  contentType: \&quot;image/jpeg\&quot;,\n});\nconst res = await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.tradeLicenseImageSave}`)\n  .withFile(\n    \&quot;tradeLicenseImage\&quot;,\n    path.resolve(\&quot;/opt/app/test-data/trade_license.jpeg\&quot;)\n  )\n  .expectStatus(200);\nconst businessInfoFromDb = await prismaApi.merchantUser.findFirst({\n  where: {\n    userId: idfromUser,\n  },\n});\nexpect(businessInfoFromDb).to.not.be.null;\nexpect(businessInfoFromDb.tradeLicense).to.not.be.null;\nexpect(businessInfoFromDb.tradeLicense).to.be.string;&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 400 !== 200\n\n400 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 400 !== 200\n\n400 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 400\n+ 200\n&quot;},&quot;uuid&quot;:&quot;807b0c6c-3695-47fa-bfad-62e2d1ff12d8&quot;,&quot;parentUUID&quot;:&quot;1fdc8b3e-2f86-4564-a778-5ba89036242c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should Save trade license image successfully and verify in MinIO&quot;,&quot;fullTitle&quot;:&quot;Trade License for Mechant Onboarding should Save trade license image successfully and verify in MinIO&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const bucketName = \&quot;ppay\&quot;;\nconst imagePath = \&quot;/opt/app/test-data/trade_license.jpeg\&quot;;\nconst userPhone = \&quot;01747538382\&quot;;\nconst response = await pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.tradeLicenseImageSave}`)\n  .withBearerToken(token)\n  .withFile(\&quot;tradeLicenseImage\&quot;, imagePath)\n  .expectStatus(200);\nconst exists = await minioClient.bucketExists(bucketName);\nexpect(exists).to.be.true;\nconst fileNamePattern = `trade_licenses/${userPhone}_*.trade_license.jpeg`;\nconst objects = [];\nconst stream = minioClient.listObjects(bucketName, \&quot;trade_licenses/\&quot;, true);\nfor await (const obj of stream) {\n  objects.push(obj);\n}\nconst regex = new RegExp(`^trade_licenses/${userPhone}.*trade_license.*$`);\nlet fileFound = false;\nfor (const obj of objects) {\n  if (regex.test(obj.name)) {\n    fileFound = true;\n    break;\n  }\n}\nexpect(fileFound).to.be.true;\nconst foundObjectName = objects.find((obj) =&gt; regex.test(obj.name))?.name;\nif (foundObjectName) {\n  const stat = await minioClient.statObject(bucketName, foundObjectName);\n  expect(stat).to.not.be.null;\n  expect(stat.size).to.be.greaterThan(0);\n} else {\n  throw new Error(\&quot;File not found in the bucket.\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 400 !== 200\n\n400 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 400 !== 200\n\n400 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 400\n+ 200\n&quot;},&quot;uuid&quot;:&quot;a6887e4f-cfc7-48ac-a002-934e908ebe27&quot;,&quot;parentUUID&quot;:&quot;1fdc8b3e-2f86-4564-a778-5ba89036242c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;807b0c6c-3695-47fa-bfad-62e2d1ff12d8&quot;,&quot;a6887e4f-cfc7-48ac-a002-934e908ebe27&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:776,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f508b82c-ddd5-4027-b409-9d130ffcbeb6&quot;,&quot;title&quot;:&quot;Set Pin for Mechant Onboarding&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/merchant/setPin.test.js&quot;,&quot;file&quot;:&quot;/src/merchant/setPin.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Set Pin for Mechant Onboarding\&quot;&quot;,&quot;fullTitle&quot;:&quot;Set Pin for Mechant Onboarding \&quot;before all\&quot; hook in \&quot;Set Pin for Mechant Onboarding\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cb695407-a40a-4884-b3c6-d4634d5db8a0&quot;,&quot;parentUUID&quot;:&quot;f508b82c-ddd5-4027-b409-9d130ffcbeb6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Set Pin for Mechant Onboarding\&quot;&quot;,&quot;fullTitle&quot;:&quot;Set Pin for Mechant Onboarding \&quot;before each\&quot; hook in \&quot;Set Pin for Mechant Onboarding\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:671,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.accountLog.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaAuth.appUser.deleteMany({});\nawait prismaApi.MerchantUser.deleteMany({});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1bf27d6a-fe2c-4464-a78a-07310cd183b4&quot;,&quot;parentUUID&quot;:&quot;f508b82c-ddd5-4027-b409-9d130ffcbeb6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Set Pin for Mechant Onboarding\&quot;&quot;,&quot;fullTitle&quot;:&quot;Set Pin for Mechant Onboarding \&quot;after all\&quot; hook in \&quot;Set Pin for Mechant Onboarding\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;002063ad-f257-491f-8467-ca876f75ae33&quot;,&quot;parentUUID&quot;:&quot;f508b82c-ddd5-4027-b409-9d130ffcbeb6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should check the user is stored in the DB after setting Pin&quot;,&quot;fullTitle&quot;:&quot;Set Pin for Mechant Onboarding should check the user is stored in the DB after setting Pin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1205,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const phoneNumber = \&quot;01788448853\&quot;;\ntoken = generateTokenForSetPin(phoneNumber);\nconst res = await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.setPin}`)\n  .withJson({\n    token: token,\n    pin: \&quot;123459\&quot;,\n  })\n  .expectStatus(200);\nconst userInDb = await prismaAuth.appUser.findUnique({\n  where: { phone: phoneNumber },\n});\nexpect(userInDb.phone).to.equal(phoneNumber);\nexpect(userInDb.role).to.equal(\&quot;MERCHANT\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bb7ec3a5-422e-4e44-a2ba-57e92c33cf43&quot;,&quot;parentUUID&quot;:&quot;f508b82c-ddd5-4027-b409-9d130ffcbeb6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bb7ec3a5-422e-4e44-a2ba-57e92c33cf43&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1205,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;d6467096-47af-4596-b4ad-72686bd60363&quot;,&quot;title&quot;:&quot;Add Nominee (POST :/user/nominee)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/nominee/addNominee.test.js&quot;,&quot;file&quot;:&quot;/src/nominee/addNominee.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Add Nominee (POST :/user/nominee)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Add Nominee (POST :/user/nominee) \&quot;before all\&quot; hook in \&quot;Add Nominee (POST :/user/nominee)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;14b3c5f4-c6dd-442c-be69-5ec82a261cba&quot;,&quot;parentUUID&quot;:&quot;d6467096-47af-4596-b4ad-72686bd60363&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Add Nominee (POST :/user/nominee)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Add Nominee (POST :/user/nominee) \&quot;before each\&quot; hook in \&quot;Add Nominee (POST :/user/nominee)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1637,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId = await prismaAuth.appUser.findFirst({\n    where: {\n        phone: \&quot;01317577237\&quot;,\n    },\n});\ntoken = generateUserToken(userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d711e85b-7121-4414-8df6-1e5198861abc&quot;,&quot;parentUUID&quot;:&quot;d6467096-47af-4596-b4ad-72686bd60363&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Add Nominee (POST :/user/nominee)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Add Nominee (POST :/user/nominee) \&quot;after all\&quot; hook in \&quot;Add Nominee (POST :/user/nominee)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$disconnect();\nawait prismaAccounting.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1da35e14-1623-4cb3-a9cf-78992a012f0e&quot;,&quot;parentUUID&quot;:&quot;d6467096-47af-4596-b4ad-72686bd60363&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should create a new nominee&quot;,&quot;fullTitle&quot;:&quot;Add Nominee (POST :/user/nominee) should create a new nominee&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:375,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n    .spec()\n    .withMethod(\&quot;POST\&quot;)\n    .withBearerToken(token)\n    .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.addNominee}`)\n    .withJson(requesBodyNominee).expectStatus(200);\nconst createdNominee = await prismaAuth.nominee.findUnique({\n    where: { userId: userId.id },\n});\nexpect(createdNominee.name).to.equal(\&quot;John Doe\&quot;);\nexpect(createdNominee.nidNumber).to.equal(\&quot;123456789\&quot;);\nexpect(createdNominee.relation).to.equal(\&quot;Brother\&quot;);\nexpect(createdNominee.phoneNumber).to.equal(\&quot;01718984384\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5f66588c-8508-41bc-ad8e-badf27cb691b&quot;,&quot;parentUUID&quot;:&quot;d6467096-47af-4596-b4ad-72686bd60363&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should 400 if any data is missing&quot;,&quot;fullTitle&quot;:&quot;Add Nominee (POST :/user/nominee) should 400 if any data is missing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await pactum\n    .spec()\n    .withMethod(\&quot;POST\&quot;)\n    .withBearerToken(token)\n    .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.addNominee}`)\n    .withJson({\n        ...requesBodyNominee,\n        name: \&quot;\&quot;\n    }).expectStatus(400);\nconst createdNominee = await prismaAuth.nominee.findUnique({\n    where: { userId: userId.id },\n});\nexpect(createdNominee).to.be.null;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;04a4cc15-5fd8-4804-b74d-1ff4343a8e20&quot;,&quot;parentUUID&quot;:&quot;d6467096-47af-4596-b4ad-72686bd60363&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5f66588c-8508-41bc-ad8e-badf27cb691b&quot;,&quot;04a4cc15-5fd8-4804-b74d-1ff4343a8e20&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:388,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;fb19c267-e596-4c5e-9954-d0293f90c467&quot;,&quot;title&quot;:&quot;Get Nominee (GET :/user/nominee)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/nominee/getNominee.test.js&quot;,&quot;file&quot;:&quot;/src/nominee/getNominee.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Get Nominee (GET :/user/nominee)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Nominee (GET :/user/nominee) \&quot;before all\&quot; hook in \&quot;Get Nominee (GET :/user/nominee)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e0c6b662-f92b-477b-b4b9-440d3fd6974f&quot;,&quot;parentUUID&quot;:&quot;fb19c267-e596-4c5e-9954-d0293f90c467&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Get Nominee (GET :/user/nominee)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Nominee (GET :/user/nominee) \&quot;before each\&quot; hook in \&quot;Get Nominee (GET :/user/nominee)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1121,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId = await prismaAuth.appUser.findFirst({\n    where: {\n        phone: \&quot;01317577237\&quot;,\n    },\n});\ntoken = generateUserToken(userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\nconst nomineeData = {\n    name: \&quot;John Doe\&quot;,\n    nidNumber: \&quot;123456789\&quot;,\n    relation: \&quot;Brother\&quot;,\n    phoneNumber: \&quot;01718984384\&quot;,\n    birthDate: \&quot;25-02-2020\&quot;,\n    userId: userId.id\n};\nawait prismaAuth.nominee.create({\n    data: nomineeData,\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d0fa5a24-eead-4bf1-84c5-c809633a4e4a&quot;,&quot;parentUUID&quot;:&quot;fb19c267-e596-4c5e-9954-d0293f90c467&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Get Nominee (GET :/user/nominee)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Nominee (GET :/user/nominee) \&quot;after all\&quot; hook in \&quot;Get Nominee (GET :/user/nominee)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$disconnect();\nawait prismaAccounting.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;17a73d78-2b43-48f1-8007-83da262f4faa&quot;,&quot;parentUUID&quot;:&quot;fb19c267-e596-4c5e-9954-d0293f90c467&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get a new nominee&quot;,&quot;fullTitle&quot;:&quot;Get Nominee (GET :/user/nominee) should get a new nominee&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const getNominee = await pactum\n            .spec()\n            .withMethod(\&quot;GET\&quot;)\n            .withBearerToken(token)\n            .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.addNominee}`)\n            .expectStatus(200);\n        const createdNominee = await prismaAuth.nominee.findUnique({\n            where: { userId: userId.id },\n        });\n        expect(createdNominee.name).to.equal(getNominee.body.nominee.name);\n        expect(createdNominee.nidNumber).to.equal(getNominee.body.nominee.nidnumber);\n        expect(createdNominee.relation).to.equal(getNominee.body.nominee.relation);\n        expect(createdNominee.phoneNumber).to.equal(getNominee.body.nominee.phonenumber);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e70a72af-5189-4616-b1d0-c666c75492aa&quot;,&quot;parentUUID&quot;:&quot;fb19c267-e596-4c5e-9954-d0293f90c467&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e70a72af-5189-4616-b1d0-c666c75492aa&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:29,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;9d0185a6-a4ec-4591-b35f-d406a022a955&quot;,&quot;title&quot;:&quot;Merchant Add Information For QR Generation&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/QR/addInforForQR.test.js&quot;,&quot;file&quot;:&quot;/src/QR/addInforForQR.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Merchant Add Information For QR Generation\&quot;&quot;,&quot;fullTitle&quot;:&quot;Merchant Add Information For QR Generation \&quot;before all\&quot; hook in \&quot;Merchant Add Information For QR Generation\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5a058402-e776-4e81-9449-b1faa55ba3c3&quot;,&quot;parentUUID&quot;:&quot;9d0185a6-a4ec-4591-b35f-d406a022a955&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook for \&quot;should successfully add information\&quot;&quot;,&quot;fullTitle&quot;:&quot;Merchant Add Information For QR Generation \&quot;before each\&quot; hook for \&quot;should successfully add information\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait prismaAuth.appUser.create({\n  data: {\n    fullname: \&quot;Mosharof Hossain\&quot;,\n    phone: \&quot;01999999999\&quot;,\n    profilePicture: \&quot;https://example.com/Jarin.jpg\&quot;,\n    email: \&quot;mosharof@example.com\&quot;,\n    password:\n      \&quot;$2a$10$C2JDo6LHB61PTl6mTBdEpeoPNRf7mDCKdbufHd.2uEJzwwm4hbP6q\&quot;,\n    fathername: \&quot;John Jarin re\&quot;,\n    mothername: \&quot;Jarin Doe pe\&quot;,\n    nidnumber: \&quot;1234566899\&quot;,\n    dob: \&quot;1990-01-01\&quot;,\n    nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n    presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n    district: \&quot;Dhaka\&quot;,\n    hasLiveliness: true,\n    hasNidInfo: true,\n    isEmailVerified: false,\n    isPhoneVerified: false,\n    nidBack: \&quot;https://example.com/nid_back.jpg\&quot;,\n    nidFront: \&quot;https://example.com/nid_front.jpg\&quot;,\n    role: \&quot;MERCHANT\&quot;,\n    wrongPinCount: 0\n  },\n});\nmerchantUser = await prismaAuth.appUser.findUnique({\n  where: { phone: \&quot;01999999999\&quot; },\n});\nconst adminUser = await prismaAuth.adminUser.findUnique({\n    where: { email: \&quot;admin@example.com\&quot; },\n  });\n\ntoken = generateToken(adminUser.id, \&quot;admin@example.com\&quot;, \&quot;ADMIN\&quot;, \&quot;ADMIN\&quot; );\nmerchantToken =  generateMerchantToken(merchantUser.id, merchantUser.phone, [\n    \&quot;MERCHANT\&quot;,\n  ]);\nconst chartOfAccounts = await createBasicChartOfAccounts();\nawait createUserAccounts(chartOfAccounts);\nawait prismaApi.merchantUser.create({\n    data: {\n      userId: merchantUser.id,\n      billNumber: \&quot;dsjk\&quot;,\n      merchantName: \&quot;GREHOSUKH\&quot;,\n      merchantCity: \&quot;RAJSHAHI\&quot;,\n      tid: \&quot;23100157\&quot;,\n      panMastercard: \&quot;511629555133965\&quot;,\n      bankAccountName: \&quot;GREHOSUKH\&quot;,\n      bankAccountNo: \&quot;1234567890\&quot;,\n      bankName: \&quot;City Bank\&quot;,\n      bankBranchName: \&quot;Mirpur\&quot;,\n      settlementFrequency: \&quot;MONTHLY\&quot;\n    }\n  });\nmerchantAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01999999999\&quot; },\n});&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;PrismaClientKnownRequestError: \nInvalid `prisma.adminUser.findUnique()` invocation:\n\n\nThe column `p_pay_auth.admin_users.role` does not exist in the current database.&quot;,&quot;estack&quot;:&quot;PrismaClientKnownRequestError: \nInvalid `prisma.adminUser.findUnique()` invocation:\n\n\nThe column `p_pay_auth.admin_users.role` does not exist in the current database.\n    at qn.handleRequestError (prisma/generated/auth/runtime/library.js:121:7315)\n    at qn.handleAndLogRequestError (prisma/generated/auth/runtime/library.js:121:6640)\n    at qn.request (prisma/generated/auth/runtime/library.js:121:6347)\n    at async l (prisma/generated/auth/runtime/library.js:130:9616)\n    at async Context.&lt;anonymous&gt; (file:///opt/app/src/QR/addInforForQR.test.js:58:23)&quot;},&quot;uuid&quot;:&quot;637a2264-120d-4141-b153-8ae3e5fb7748&quot;,&quot;parentUUID&quot;:&quot;9d0185a6-a4ec-4591-b35f-d406a022a955&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Merchant Add Information For QR Generation\&quot;&quot;,&quot;fullTitle&quot;:&quot;Merchant Add Information For QR Generation \&quot;after all\&quot; hook in \&quot;Merchant Add Information For QR Generation\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$disconnect();\nawait prismaApi.$disconnect();\nawait prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;00bc8488-7ee1-4d1f-91a0-7878d41230e9&quot;,&quot;parentUUID&quot;:&quot;9d0185a6-a4ec-4591-b35f-d406a022a955&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should successfully add information&quot;,&quot;fullTitle&quot;:&quot;Merchant Add Information For QR Generation should successfully add information&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const dataForQR={\n       userId: merchantUser.id,\n       panVisa: \&quot;1234567890123456\&quot;,\n       mid: \&quot;MID123456\&quot;,\n       mcc: \&quot;5411\&quot;,\n     }; \n   await pactum\n     .spec()\n     .withMethod(\&quot;POST\&quot;)\n     .withBearerToken(token)\n     .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.addInfoQR}`)\n     .withJson(dataForQR)\n     .expectStatus(200);\n   const merchantUserFromDb = await prismaApi.merchantUser.findFirst({\n     where: {\n       userId: merchantUser.id,\n     },\n   });\n   expect(merchantUserFromDb).to.not.be.null;\n   expect(merchantUserFromDb.panVisa).to.equal(\&quot;1234567890123456\&quot;);\n   expect(merchantUserFromDb.mid).to.equal(\&quot;MID123456\&quot;);\n   expect(merchantUserFromDb.mcc).to.equal(\&quot;5411\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8f6c9e92-04de-4674-8c53-bc9f21e05c71&quot;,&quot;parentUUID&quot;:&quot;9d0185a6-a4ec-4591-b35f-d406a022a955&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true},{&quot;title&quot;:&quot;should show error if any other user except Admin tries to add information&quot;,&quot;fullTitle&quot;:&quot;Merchant Add Information For QR Generation should show error if any other user except Admin tries to add information&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const dataForQR={\n        userId: merchantUser.id,\n        panVisa: \&quot;1234567890123456\&quot;,\n        mid: \&quot;MID123456\&quot;,\n        mcc: \&quot;5411\&quot;,\n      }; \n    await pactum\n      .spec()\n      .withMethod(\&quot;POST\&quot;)\n      .withBearerToken(merchantToken)\n      .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.addInfoQR}`)\n      .withJson(dataForQR)\n      .expectStatus(401);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e375950f-b2a5-4350-8aa0-31484a8d7347&quot;,&quot;parentUUID&quot;:&quot;9d0185a6-a4ec-4591-b35f-d406a022a955&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:true}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[&quot;8f6c9e92-04de-4674-8c53-bc9f21e05c71&quot;,&quot;e375950f-b2a5-4350-8aa0-31484a8d7347&quot;],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;811844f3-6b90-4068-b226-9cf0cade99e1&quot;,&quot;title&quot;:&quot;Merchant QR Code Generation&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/QR/generateQR.test.js&quot;,&quot;file&quot;:&quot;/src/QR/generateQR.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Merchant QR Code Generation\&quot;&quot;,&quot;fullTitle&quot;:&quot;Merchant QR Code Generation \&quot;before all\&quot; hook in \&quot;Merchant QR Code Generation\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bd1bdb76-29cd-4bc8-8efa-cf26b463b911&quot;,&quot;parentUUID&quot;:&quot;811844f3-6b90-4068-b226-9cf0cade99e1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Merchant QR Code Generation\&quot;&quot;,&quot;fullTitle&quot;:&quot;Merchant QR Code Generation \&quot;before each\&quot; hook in \&quot;Merchant QR Code Generation\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:78,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait prismaAuth.appUser.create({\n  data: {\n    fullname: \&quot;Mosharof Hossain\&quot;,\n    phone: \&quot;01999999999\&quot;,\n    profilePicture: \&quot;https://example.com/Jarin.jpg\&quot;,\n    email: \&quot;mosharof@example.com\&quot;,\n    password:\n      \&quot;$2a$10$C2JDo6LHB61PTl6mTBdEpeoPNRf7mDCKdbufHd.2uEJzwwm4hbP6q\&quot;,\n    fathername: \&quot;John Jarin re\&quot;,\n    mothername: \&quot;Jarin Doe pe\&quot;,\n    nidnumber: \&quot;1234566899\&quot;,\n    dob: \&quot;1990-01-01\&quot;,\n    nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n    presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n    district: \&quot;Dhaka\&quot;,\n    hasLiveliness: true,\n    hasNidInfo: true,\n    isEmailVerified: false,\n    isPhoneVerified: false,\n    nidBack: \&quot;https://example.com/nid_back.jpg\&quot;,\n    nidFront: \&quot;https://example.com/nid_front.jpg\&quot;,\n    role: \&quot;MERCHANT\&quot;,\n    wrongPinCount: 0\n  },\n});\nmerchantUser = await prismaAuth.appUser.findUnique({\n  where: { phone: \&quot;01999999999\&quot; },\n});\ntoken = generateMerchantToken(merchantUser.id, merchantUser.phone, [\n  \&quot;MERCHANT\&quot;,\n]);\nconst chartOfAccounts = await createBasicChartOfAccounts();\nawait createUserAccounts(chartOfAccounts);\nmerchantAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01999999999\&quot; },\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f020e041-ce3f-487f-a506-c95158c98199&quot;,&quot;parentUUID&quot;:&quot;811844f3-6b90-4068-b226-9cf0cade99e1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Merchant QR Code Generation\&quot;&quot;,&quot;fullTitle&quot;:&quot;Merchant QR Code Generation \&quot;after all\&quot; hook in \&quot;Merchant QR Code Generation\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$disconnect();\nawait prismaApi.$disconnect();\nawait prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8b5e8cff-9486-4cb7-b976-b0b6a2a6bdbc&quot;,&quot;parentUUID&quot;:&quot;811844f3-6b90-4068-b226-9cf0cade99e1&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should generate a valid QR code&quot;,&quot;fullTitle&quot;:&quot;Merchant QR Code Generation should generate a valid QR code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaApi.merchantUser.create({\n  data: {\n    userId: merchantUser.id,\n    panVisa: \&quot;1234567890123456\&quot;,\n    mid: \&quot;MID123456\&quot;,\n    mcc: \&quot;5411\&quot;,\n    settlementFrequency: \&quot;MONTHLY\&quot;\n  },\n});\n\n   const response =  await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.generateQR}`)\n  .expectStatus(200)\n  .expectJsonLike({\n    qr: /000201.+/,\n  });\nexpect((response) =&gt; {\n  const qr = response.json.qr;\n  expect(qr).to.contain(\&quot;1234567890123456\&quot;);\n  expect(qr).to.contain(\&quot;MID123456\&quot;);\n  expect(qr).to.contain(\&quot;5411\&quot;);\n});\nconst qrString = response.body.qr;  \nconst parsedQR = parseBanglaQR(qrString);  \nif (parsedQR === \&quot;Invalid Bangla QR Structure\&quot;) {\n    throw new Error(\&quot;QR validation failed: Invalid Bangla QR structure\&quot;);\n}\nexpect(validateBanglaQR(qrString, parsedQR)).to.equal(true);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7f790bf5-6ab3-42ed-bf56-2a2ef33c51ac&quot;,&quot;parentUUID&quot;:&quot;811844f3-6b90-4068-b226-9cf0cade99e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should generate QR with only Phone Number if PanVisa, MCC, MID not provided &quot;,&quot;fullTitle&quot;:&quot;Merchant QR Code Generation should generate QR with only Phone Number if PanVisa, MCC, MID not provided &quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaApi.merchantUser.create({\n    data: {\n      userId: merchantUser.id,\n      billNumber: \&quot;dsjk\&quot;,\n      merchantName: \&quot;GREHOSUKH\&quot;,\n      merchantCity: \&quot;RAJSHAHI\&quot;,\n      tid: \&quot;23100157\&quot;,\n      panMastercard: \&quot;511629555133965\&quot;,\n      panUnionPay: \&quot;3649005036490050116020149000008\&quot;,\n      settlementFrequency: \&quot;MONTHLY\&quot;\n    },\n  });\n \n  const response =  await pactum\n    .spec()\n    .withMethod(\&quot;POST\&quot;)\n    .withBearerToken(token)\n    .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.generateQR}`)\n    .expectStatus(200);\n    expect((response) =&gt; {\n      const qr = response.json.qr;\n      expect(qr).to.contain(\&quot;01999999999\&quot;);\n    });&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8d68eea1-41ce-4950-9ebb-b35b575abe4a&quot;,&quot;parentUUID&quot;:&quot;811844f3-6b90-4068-b226-9cf0cade99e1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7f790bf5-6ab3-42ed-bf56-2a2ef33c51ac&quot;,&quot;8d68eea1-41ce-4950-9ebb-b35b575abe4a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e2441005-e542-4d14-b8e6-c535f7f517e6&quot;,&quot;title&quot;:&quot;Request Money &quot;,&quot;fullFile&quot;:&quot;/opt/app/src/requestMoney/requestMoney.test.js&quot;,&quot;file&quot;:&quot;/src/requestMoney/requestMoney.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Request Money \&quot;&quot;,&quot;fullTitle&quot;:&quot;Request Money  \&quot;before all\&quot; hook in \&quot;Request Money \&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;27e2045a-76a5-47f8-9fc6-7f56fcff7c16&quot;,&quot;parentUUID&quot;:&quot;e2441005-e542-4d14-b8e6-c535f7f517e6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Request Money \&quot;&quot;,&quot;fullTitle&quot;:&quot;Request Money  \&quot;before each\&quot; hook in \&quot;Request Money \&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\nawait prismaAccounting.transaction.deleteMany({});\nawait prismaAccounting.transactionTypeChangeLog.deleteMany({});\nawait prismaAccounting.transactionType.deleteMany({});\nawait prismaAccounting.transactionLegLog.deleteMany({});\nawait prismaAccounting.transactionLeg.deleteMany({});\nawait prismaAccounting.userAccount.deleteMany({});\nawait prismaAccounting.chartOfAccountLog.deleteMany({});\nawait prismaAccounting.chartOfAccount.deleteMany({});\nawait prismaApi.RequestMoney.deleteMany({});\nawait prismaAuth.appUser.deleteMany({});\nawait prismaAuth.appUser.createMany({\n  data: [\n    {\n      fullname: \&quot;Onamika\&quot;,\n      phone: \&quot;01747538382\&quot;,\n      profilePicture: \&quot;https://example.com/onamika.jpg\&quot;,\n      email: \&quot;johndoe1@example.com\&quot;,\n      password: \&quot;123458\&quot;,\n      fathername: \&quot;John Doe\&quot;,\n      mothername: \&quot;Jane Doe\&quot;,\n      nidnumber: \&quot;1234567890\&quot;,\n      dob: \&quot;1990-01-01\&quot;,\n      nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n      presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n      district: \&quot;Dhaka\&quot;,\n      hasLiveliness: true,\n      hasNidInfo: true,\n      isEmailVerified: false,\n      isPhoneVerified: false,\n      nidBack: \&quot;https://example.com/nid_back.jpg\&quot;,\n      nidFront: \&quot;https://example.com/nid_front.jpg\&quot;,\n      presentAddress: \&quot;https://example.com/present_address.jpg\&quot;,\n      role:\&quot;USER\&quot;,\n      wrongPinCount: 0\n    },\n    {\n      fullname: \&quot;Jarin\&quot;,\n      phone: \&quot;01711106999\&quot;,\n      profilePicture: \&quot;https://example.com/Jarin.jpg\&quot;,\n      email: \&quot;Jarin@example.com\&quot;,\n      password: \&quot;123458\&quot;,\n      fathername: \&quot;John Jarin\&quot;,\n      mothername: \&quot;Jarin Doe\&quot;,\n      nidnumber: \&quot;1234566890\&quot;,\n      dob: \&quot;1990-01-01\&quot;,\n      nidaddress: \&quot;House 123, Street 456, City, District\&quot;,\n      presentAddress: \&quot;House 789, Street 321, City, District\&quot;,\n      district: \&quot;Dhaka\&quot;,\n      hasLiveliness: true,\n      hasNidInfo: true,\n      isEmailVerified: false,\n      isPhoneVerified: false,\n      nidBack: \&quot;https://example.com/nid_back.jpg\&quot;,\n      nidFront: \&quot;https://example.com/nid_front.jpg\&quot;,\n      role:\&quot;USER\&quot;,\n      wrongPinCount: 0\n    },\n  ],\n});\nappUser1 = await prismaAuth.appUser.findUnique({\n  where: { phone: \&quot;01747538382\&quot; },\n});\nappUser2 = await prismaAuth.appUser.findUnique({\n  where: { phone: \&quot;01711106999\&quot; },\n});\nawait prismaAccounting.chartOfAccount.createMany({\n  data: [\n    {\n      name: \&quot;Chart of Account 1\&quot;,\n      description: \&quot;Description for Account 1\&quot;,\n      transactionType: \&quot;SYSTEM\&quot;,\n      headType: \&quot;ASSET\&quot;,\n      code: \&quot;001\&quot;,\n      onlyParent: true,\n      adminId: 1,\n      minWalletAmount: 100,\n      maxWalletAmount: 10000,\n    },\n    {\n      name: \&quot;Chart of Account 2\&quot;,\n      description: \&quot;Description for Account 2\&quot;,\n      transactionType: \&quot;SYSTEM\&quot;,\n      headType: \&quot;ASSET\&quot;,\n      code: \&quot;002\&quot;,\n      onlyParent: true,\n      adminId: 1,\n      minWalletAmount: 100,\n      maxWalletAmount: 10000,\n    },\n    {\n      name: \&quot;Chart of Account 3\&quot;,\n      description: \&quot;Description for Account 3\&quot;,\n      transactionType: \&quot;SYSTEM\&quot;,\n      headType: \&quot;LIABILITY\&quot;,\n      code: \&quot;003\&quot;,\n      onlyParent: true,\n      adminId: 1,\n      minWalletAmount: 100,\n      maxWalletAmount: 10000,\n    },\n    {\n      name: \&quot;Chart of Account 4\&quot;,\n      description: \&quot;Description for Account 4\&quot;,\n      transactionType: \&quot;SYSTEM\&quot;,\n      headType: \&quot;EXPENSE\&quot;,\n      code: \&quot;004\&quot;,\n      onlyParent: true,\n      adminId: 1,\n      minWalletAmount: 100,\n      maxWalletAmount: 10000,\n    },\n  ],\n});\nconst coA1 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;001\&quot; },\n});\nconst coA2 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;002\&quot; },\n});\nconst coA3 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;003\&quot; },\n});\nconst coA4 = await prismaAccounting.chartOfAccount.findUnique({\n  where: { code: \&quot;004\&quot; },\n});\nawait prismaAccounting.userAccount.createMany({\n  data: [\n    {\n      accountName: appUser1.fullname,\n      identifier: appUser1.phone,\n      status: \&quot;FULL_ACTIVE\&quot;,\n      dailyLimitAmount: 50000,\n      dailyLimitCount: 200000,\n      monthlyLimitAmount: 5000000,\n      monthlyLimitCount: 600000000,\n      maxWalletAmount: 1000000000,\n      minWalletAmount: 0,\n      chartOfAccount_id: coA1.id,\n    },\n    {\n      accountName: appUser2.fullname,\n      identifier: appUser2.phone,\n      dailyLimitAmount: 50000,\n      dailyLimitCount: 200000,\n      monthlyLimitAmount: 5000000,\n      monthlyLimitCount: 600000000,\n      maxWalletAmount: 1000000000,\n      minWalletAmount: 0,\n      status: \&quot;FULL_ACTIVE\&quot;,\n      chartOfAccount_id: coA2.id,\n    },\n  ],\n});\naccount1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01747538382\&quot; },\n});\naccount2 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106999\&quot; },\n});\nconst transactionTypes = [\n  {\n    transactionCode: \&quot;223\&quot;,\n    name: \&quot;Send Money\&quot;,\n    description: \&quot;Send money between accounts\&quot;,\n    minAmount: 50,\n    maxAmount: 5000,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: \&quot;11\&quot;,\n    isActive: true,\n    fromChartOfAccount: { connect: { id: coA1.id } },\n    toChartOfAccount: { connect: { id: coA2.id } },\n  },\n  {\n    transactionCode: \&quot;TOPUP\&quot;,\n    name: \&quot;Top-up\&quot;,\n    description: \&quot;Top-up wallet balance\&quot;,\n    minAmount: 10,\n    maxAmount: 10000,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: \&quot;11\&quot;,\n    isActive: true,\n    fromChartOfAccount: { connect: { id: coA1.id } },\n    toChartOfAccount: { connect: { id: coA3.id } },\n  },\n  {\n    transactionCode: \&quot;UTILITY\&quot;,\n    name: \&quot;Utility Payment\&quot;,\n    description: \&quot;Pay utility bills\&quot;,\n    minAmount: 100,\n    maxAmount: 2000,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: \&quot;11\&quot;,\n    isActive: true,\n    fromChartOfAccount: { connect: { id: coA2.id } },\n    toChartOfAccount: { connect: { id: coA4.id } },\n  },\n  {\n    transactionCode: \&quot;CASHOUT\&quot;,\n    name: \&quot;Cash-out\&quot;,\n    description: \&quot;Withdraw money\&quot;,\n    minAmount: 100,\n    maxAmount: 3000,\n    createdByAdminId: 1,\n    createdByAdminIdentifier: \&quot;11\&quot;,\n    isActive: true,\n    fromChartOfAccount: { connect: { id: coA3.id } },\n    toChartOfAccount: { connect: { id: coA4.id } },\n  },\n];\nfor (const transactionType of transactionTypes) {\n  await prismaAccounting.transactionType.create({ data: transactionType });\n}\ncreatedType = await prismaAccounting.transactionType.findMany({\n  where: { createdByAdminIdentifier: \&quot;11\&quot; },\n});\nconst addMoneyTransactionToAccount1 =\n  await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: account1.id,\n      toAccountId: account2.id,\n      transactionTypeId: createdType[0].id,\n      amount: Number(100),\n      referenceNo: \&quot;Initial Funding\&quot;,\n      note: \&quot;Adding initial balance to sender&#x27;s account\&quot;,\n    },\n  });\nawait prismaAccounting.ledger.create({\n  data: {\n    accountId: account1.id,\n    transactionId: addMoneyTransactionToAccount1.id,\n    amount: Number(100),\n    description: \&quot;Add money transaction\&quot;,\n    type: \&quot;CREDIT\&quot;,\n  },\n});\nconst addMoneyTransactionToAccount2 =\n  await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: account2.id,\n      toAccountId: account1.id,\n      transactionTypeId: createdType[0].id,\n      amount: Number(50),\n      referenceNo: \&quot;Initial Funding\&quot;,\n      note: \&quot;Adding initial balance to sender&#x27;s account\&quot;,\n    },\n  });\nawait prismaAccounting.ledger.create({\n  data: {\n    accountId: account2.id,\n    transactionId: addMoneyTransactionToAccount2.id,\n    amount: Number(50),\n    description: \&quot;Add money transaction\&quot;,\n    type: \&quot;CREDIT\&quot;,\n  },\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5bd32806-03dc-40f1-8c71-d6cd403ed6b4&quot;,&quot;parentUUID&quot;:&quot;e2441005-e542-4d14-b8e6-c535f7f517e6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Request Money \&quot;&quot;,&quot;fullTitle&quot;:&quot;Request Money  \&quot;after all\&quot; hook in \&quot;Request Money \&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;732688b5-2540-4798-9430-76b6ec5268a5&quot;,&quot;parentUUID&quot;:&quot;e2441005-e542-4d14-b8e6-c535f7f517e6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should request money successfully for all valid scenarios&quot;,&quot;fullTitle&quot;:&quot;Request Money  should request money successfully for all valid scenarios&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:145,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const requestData = {\n  requestedNumber: appUser2.phone,\n  requestAmount: 50,\n  transactionTypeCode: createdType[0].transactionCode,\n};\ntoken = generateUserToken(appUser1.id, appUser1.phone, \&quot;USER\&quot;);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.requestMoney}`)\n  .withJson(requestData)\n  .expectStatus(200);\nconst requestsInDb = await prismaApi.requestMoney.findMany({});\nexpect(requestsInDb.length).to.be.equal(1);\nexpect(requestsInDb[0].requestSenderNumber).to.be.equal(appUser1.phone);\nexpect(requestsInDb[0].requestReceiverNumber).to.be.equal(appUser2.phone);\nexpect(Number(requestsInDb[0].requestedAmount)).to.be.equal(50);\nexpect(requestsInDb[0].requesterId).to.be.equal(appUser1.id);\nconst token2 = generateUserToken(appUser2.id, appUser2.phone, \&quot;USER\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e06f6353-71d2-4105-a9ac-8532aed71aa4&quot;,&quot;parentUUID&quot;:&quot;e2441005-e542-4d14-b8e6-c535f7f517e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if the requested Number is not P-pay user&quot;,&quot;fullTitle&quot;:&quot;Request Money  should show error if the requested Number is not P-pay user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const requestData = {\n  requestedNumber: \&quot;01711626600\&quot;,\n  requestAmount: 50,\n  transactionTypeCode: createdType[0].transactionCode,\n};\ntoken = generateUserToken(appUser1.id, appUser1.phone, \&quot;USER\&quot;);\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.requestMoney}`)\n  .withJson(requestData)\n  .expectStatus(400);\nexpect(response.body.error).to.equal(\&quot;Receiver Doesn&#x27;t exist\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;faf8ad9f-57fa-4846-b569-17bba4ebe3e6&quot;,&quot;parentUUID&quot;:&quot;e2441005-e542-4d14-b8e6-c535f7f517e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if the user requests negative amount&quot;,&quot;fullTitle&quot;:&quot;Request Money  should show error if the user requests negative amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const requestData = {\n  requestedNumber: appUser2.phone,\n  requestAmount: -50,\n  transactionTypeCode: createdType[0].transactionCode,\n};\ntoken = generateUserToken(appUser1.id, appUser1.phone, \&quot;USER\&quot;);\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.requestMoney}`)\n  .withJson(requestData)\n  .expectStatus(400);\nexpect(response.body.errors.requestAmount).to.equal(\n  \&quot;Count must be at least 1\&quot;\n);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f3d4dba6-b315-426d-8000-8adf77b932ab&quot;,&quot;parentUUID&quot;:&quot;e2441005-e542-4d14-b8e6-c535f7f517e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if user tries to request money to his number&quot;,&quot;fullTitle&quot;:&quot;Request Money  should show error if user tries to request money to his number&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const requestData = {\n  requestedNumber: appUser1.phone,\n  requestAmount: 50,\n  transactionTypeCode: createdType[0].transactionCode,\n};\ntoken = generateUserToken(appUser1.id, appUser1.phone, \&quot;USER\&quot;);\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.requestMoney}`)\n  .withJson(requestData)\n  .expectStatus(500);\nexpect(response.body.error).to.equal(\&quot;Can&#x27;t request money to own account\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;75252915-2acc-44d3-9811-40622f1736ea&quot;,&quot;parentUUID&quot;:&quot;e2441005-e542-4d14-b8e6-c535f7f517e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if requestedAmount is less than Min Amount of Transaction Type&quot;,&quot;fullTitle&quot;:&quot;Request Money  should show error if requestedAmount is less than Min Amount of Transaction Type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { transactionType } = await createTrxnTypeWithMinAmount(50);\nconst requestData = {\n  requestedNumber: appUser2.phone,\n  requestAmount: 49,\n  transactionTypeCode: transactionType.transactionCode,\n};\ntoken = generateUserToken(appUser1.id, appUser1.phone, \&quot;USER\&quot;);\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.requestMoney}`)\n  .withJson(requestData)\n  .expectStatus(400);\nexpect(response.body.error).to.equal(\n  \&quot;Transaction amount is less than minimum amount for this transaction type\&quot;\n);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8f0682fd-8682-46fe-a6f9-00fc98eb6481&quot;,&quot;parentUUID&quot;:&quot;e2441005-e542-4d14-b8e6-c535f7f517e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if the requestedAmount is more than Max Amount of Transaction Type&quot;,&quot;fullTitle&quot;:&quot;Request Money  should show error if the requestedAmount is more than Max Amount of Transaction Type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const { transactionType } = await createTrxnTypeWithMaxAmount(50);\n    const requestData = {\n      requestedNumber: appUser2.phone,\n      requestAmount: 5001,\n      transactionTypeCode: transactionType.transactionCode,\n    };\n    token = generateUserToken(appUser1.id, appUser1.phone, \&quot;USER\&quot;);\n    const response = await pactum\n      .spec()\n      .withMethod(\&quot;POST\&quot;)\n      .withBearerToken(token)\n      .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.requestMoney}`)\n      .withJson(requestData)\n      .expectStatus(400);\n    expect(response.body.error).to.equal(\n      \&quot;Transaction amount is more than maximum amount for this transaction type\&quot;\n    );\n    expect(requestData.requestAmount).to.greaterThan(createdType[0].maxAmount);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;98dd87ed-456d-443d-9d69-57aee0d870e4&quot;,&quot;parentUUID&quot;:&quot;e2441005-e542-4d14-b8e6-c535f7f517e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error for Invalid Transaction Type Code&quot;,&quot;fullTitle&quot;:&quot;Request Money  should show error for Invalid Transaction Type Code&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const requestData = {\n  requestedNumber: appUser2.phone,\n  requestAmount: 50,\n  transactionTypeCode: 444444444,\n};\ntoken = generateUserToken(appUser1.id, appUser1.phone, \&quot;USER\&quot;);\nconst response = await pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.requestMoney}`)\n  .withJson(requestData)\n  .expectStatus(406);\nexpect(response.body.error).to.equal(\n  \&quot;Transaction Type not found with Transaction code: 4444\&quot;\n);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Transaction Type not found with Trans…&#x27; to equal &#x27;Transaction Type not found with Trans…&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Transaction Type not found with Trans…&#x27; to equal &#x27;Transaction Type not found with Trans…&#x27;\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/requestMoney/requestMoney.test.js:451:36)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- Transaction Type not found with Transaction Code: 444444444\n+ Transaction Type not found with Transaction code: 4444\n&quot;},&quot;uuid&quot;:&quot;70c55880-61c6-4fca-b985-3ac83414dbe7&quot;,&quot;parentUUID&quot;:&quot;e2441005-e542-4d14-b8e6-c535f7f517e6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e06f6353-71d2-4105-a9ac-8532aed71aa4&quot;,&quot;faf8ad9f-57fa-4846-b569-17bba4ebe3e6&quot;,&quot;f3d4dba6-b315-426d-8000-8adf77b932ab&quot;,&quot;75252915-2acc-44d3-9811-40622f1736ea&quot;,&quot;8f0682fd-8682-46fe-a6f9-00fc98eb6481&quot;,&quot;98dd87ed-456d-443d-9d69-57aee0d870e4&quot;],&quot;failures&quot;:[&quot;70c55880-61c6-4fca-b985-3ac83414dbe7&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:236,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;3726486f-7ba7-4399-8be7-43d41f89cef6&quot;,&quot;title&quot;:&quot;Get Saved Transaction After Send Money&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/sendMoney/getSaveTrxnSendMoney.test.js&quot;,&quot;file&quot;:&quot;/src/sendMoney/getSaveTrxnSendMoney.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Get Saved Transaction After Send Money\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money \&quot;before all\&quot; hook in \&quot;Get Saved Transaction After Send Money\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0a720845-9206-4f1c-bca2-f0a8f50f92cf&quot;,&quot;parentUUID&quot;:&quot;3726486f-7ba7-4399-8be7-43d41f89cef6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Get Saved Transaction After Send Money\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money \&quot;before each\&quot; hook in \&quot;Get Saved Transaction After Send Money\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:177,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId1 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\nuserId2 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01711106485\&quot;,\n  },\n});\ntokenUser1 = generateUserToken(userId1.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\ntokenUser2 = generateUserToken(userId2.id, \&quot;01711106485\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\nawait setupTransactionTypes(chartOfAccounts);\ntype = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;1002\&quot; },\n});\ntrxnTypeId = type.id;\nawait createUserAccounts(chartOfAccounts);\ncustomerAccount1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\ncustomerAccount2 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\ncustomerAccount3 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01717084774\&quot; },\n});\ncustomerAccount4 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01717084775\&quot; },\n});\ncustomerAccount5 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01717084776\&quot; },\n});\ncustomerAccount6 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01717084777\&quot; },\n});\ncustomerAccount7 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01717084778\&quot; },\n});\nawait addInitialBalance(customerAccount1, 50000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0873e527-52da-4a57-b2f2-0cc06b933bfb&quot;,&quot;parentUUID&quot;:&quot;3726486f-7ba7-4399-8be7-43d41f89cef6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Get Saved Transaction After Send Money\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money \&quot;after all\&quot; hook in \&quot;Get Saved Transaction After Send Money\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$disconnect();\nawait prismaApi.$disconnect();\nawait prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6797b639-e851-43d7-9c8e-fbfb51bbffa3&quot;,&quot;parentUUID&quot;:&quot;3726486f-7ba7-4399-8be7-43d41f89cef6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get saved transaction list&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money should get saved transaction list&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await insertSavedTransaction({\n  fromAccount: customerAccount1,\n  toAccount: customerAccount2,\n  transactionTypeId: trxnTypeId,\n  amount: 100,\n  userId: userId1,\n});\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.saveTrxnSendMoney}`)\n  .expectStatus(200);\nconst saveTrxnSendMoney = await prismaApi.sendMoneySave.findMany({});\nexpect(saveTrxnSendMoney).to.have.lengthOf(1);\nexpect(saveTrxnSendMoney[0].amount.toString()).to.equal(\&quot;100\&quot;);\nexpect(saveTrxnSendMoney[0].save).to.be.true;\nexpect(saveTrxnSendMoney[0].fromAccount).to.equal(\&quot;01317577237\&quot;);\nexpect(saveTrxnSendMoney[0].toAccount).to.equal(\&quot;01711106485\&quot;);\nexpect(saveTrxnSendMoney[0].transactionTypeCode).to.equal(\&quot;1002\&quot;);\nexpect(saveTrxnSendMoney[0].userId.toString()).to.equal(\n  userId1.id.toString()\n);\nexpect(saveTrxnSendMoney[0].createdAt).to.not.be.null;\nexpect(saveTrxnSendMoney[0].updatedAt).to.not.be.null;\nexpect(saveTrxnSendMoney[0].receiverPhone).to.equal(\&quot;01711106485\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e4f1404c-9bda-4c54-9f1a-82fa3d1af5fe&quot;,&quot;parentUUID&quot;:&quot;3726486f-7ba7-4399-8be7-43d41f89cef6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show the first transaction of ToAccount even after multiple transactions to the same account&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money should show the first transaction of ToAccount even after multiple transactions to the same account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await insertSavedTransaction({\n  fromAccount: customerAccount1,\n  toAccount: customerAccount2,\n  transactionTypeId: trxnTypeId,\n  amount: 100,\n  userId: userId1,\n});\nawait insertSavedTransaction({\n  fromAccount: customerAccount1,\n  toAccount: customerAccount2,\n  transactionTypeId: trxnTypeId,\n  amount: 200,\n  userId: userId1,\n});\nawait pactum\n.spec()\n.withBearerToken(tokenUser1)\n.withMethod(\&quot;GET\&quot;)\n.withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.saveTrxnSendMoney}`)\n.expectStatus(200);\nconst saveTrxnSendMoney = await prismaApi.sendMoneySave.findMany({});\nexpect(saveTrxnSendMoney).to.have.lengthOf(1);\nexpect(saveTrxnSendMoney[0].amount.toString()).to.equal(\&quot;100\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d1f85d65-416c-4400-998c-1b34d56ac394&quot;,&quot;parentUUID&quot;:&quot;3726486f-7ba7-4399-8be7-43d41f89cef6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should save only one transaction per unique toAccount&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money should save only one transaction per unique toAccount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:75,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const uniqueToAccounts = [\n  \&quot;01717084774\&quot;,\n  \&quot;01717084775\&quot;,\n  \&quot;01717084776\&quot;,\n  \&quot;01717084777\&quot;,\n  \&quot;01717084778\&quot;,\n];\nfor (let i = 0; i &lt; 10; i++) {\n  await insertSavedTransaction({\n    fromAccount: customerAccount1,\n    toAccount: { identifier: uniqueToAccounts[i % 5] },\n    transactionTypeId: trxnTypeId,\n    amount: 100,\n    userId: userId1,\n  });\n}\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.saveTrxnSendMoney}`)\n  .expectStatus(200)\n  .returns(\&quot;body\&quot;);\nconst savedTransactions = await prismaApi.sendMoneySave.findMany({});\nexpect(savedTransactions).to.have.lengthOf(5);\nconst savedToAccounts = savedTransactions.map((txn) =&gt; txn.toAccount);\nexpect(savedToAccounts).to.have.members(uniqueToAccounts);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d7789696-70ed-40f8-afb2-d834fc7398a7&quot;,&quot;parentUUID&quot;:&quot;3726486f-7ba7-4399-8be7-43d41f89cef6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return correct pagination and size&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Send Money should return correct pagination and size&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:82,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const uniqueToAccounts = [\n  \&quot;01717084774\&quot;,\n  \&quot;01717084775\&quot;,\n  \&quot;01717084776\&quot;,\n  \&quot;01717084777\&quot;,\n  \&quot;01717084778\&quot;,\n];\nfor (let i = 0; i &lt; 10; i++) {\n  await insertSavedTransaction({\n    fromAccount: customerAccount1,\n    toAccount: { identifier: uniqueToAccounts[i % 5] },\n    transactionTypeId: trxnTypeId,\n    amount: 100,\n    userId: userId1,\n  });\n}\nconst response = await pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(\n    `${ApiUrls.apiBaseUrl}${ApiUrls.saveTrxnSendMoney}?page=0&amp;size=3`\n  )\n  .expectStatus(200);\nexpect(response.body)\n  .to.have.property(\&quot;saveTransactions\&quot;)\n  .that.is.an(\&quot;array\&quot;);\nexpect(response.body.saveTransactions).to.have.lengthOf(3);\nexpect(response.body.saveTransactions[0].toAccount).to.equal(\&quot;01717084778\&quot;);\nexpect(response.body.saveTransactions[1].toAccount).to.equal(\&quot;01717084777\&quot;);\nexpect(response.body.saveTransactions[2].toAccount).to.equal(\&quot;01717084776\&quot;);\nexpect(response.body.pagination.hasNext).to.equal(true);\nexpect(response.body.pagination.currentPageTotalCount).to.equal(3);\nexpect(response.body.pagination.totalCount).to.equal(5);\nexpect(response.body.pagination.currentPage).to.equal(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected undefined to equal true&quot;,&quot;estack&quot;:&quot;AssertionError: expected undefined to equal true\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/sendMoney/getSaveTrxnSendMoney.test.js:290:49)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;},&quot;uuid&quot;:&quot;d0d43000-0ca7-4493-a23c-de02f3d647cb&quot;,&quot;parentUUID&quot;:&quot;3726486f-7ba7-4399-8be7-43d41f89cef6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e4f1404c-9bda-4c54-9f1a-82fa3d1af5fe&quot;,&quot;d1f85d65-416c-4400-998c-1b34d56ac394&quot;,&quot;d7789696-70ed-40f8-afb2-d834fc7398a7&quot;],&quot;failures&quot;:[&quot;d0d43000-0ca7-4493-a23c-de02f3d647cb&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:201,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;37611abd-a029-4ca6-8884-6a97deaf4fab&quot;,&quot;title&quot;:&quot;Send Money API Check:(POST)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/sendMoney/sendMoney.test.js&quot;,&quot;file&quot;:&quot;/src/sendMoney/sendMoney.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook: send money in \&quot;Send Money API Check:(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Send Money API Check:(POST) \&quot;before all\&quot; hook: send money in \&quot;Send Money API Check:(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();\nawait redisClient.connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;afd71259-e15f-4a68-88ce-7fbec50ef6d8&quot;,&quot;parentUUID&quot;:&quot;37611abd-a029-4ca6-8884-6a97deaf4fab&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook: send money in \&quot;Send Money API Check:(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Send Money API Check:(POST) \&quot;before each\&quot; hook: send money in \&quot;Send Money API Check:(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:147,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\ntoken = generateUserToken(userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\ntopUpProvider = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;top-up-providers-01\&quot;\n);\nconst transactionTypes = await setupTransactionTypes(chartOfAccounts);\nawait createUserAccounts(chartOfAccounts);\nsender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nreceiver = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\ngp = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;gp-wallet-01\&quot; },\n});\nteletalk = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;teletalk-wallet-01\&quot; },\n});\nbanglalink = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;bl-wallet-01\&quot; },\n});\nconst type = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;1001\&quot; },\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a392c626-e1b0-4f23-a947-c5b150ea9776&quot;,&quot;parentUUID&quot;:&quot;37611abd-a029-4ca6-8884-6a97deaf4fab&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook: send money in \&quot;Send Money API Check:(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Send Money API Check:(POST) \&quot;after all\&quot; hook: send money in \&quot;Send Money API Check:(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:136,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\ntoken = generateUserToken(userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\ntopUpProvider = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;top-up-providers-01\&quot;\n);\nconst transactionTypes = await setupTransactionTypes(chartOfAccounts);\nawait createUserAccounts(chartOfAccounts);\nsender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nreceiver = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\nonholdUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577238\&quot; }\n});\nmaxwallet = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577210\&quot; }\n});\ndailyLimitAmountUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01715170020\&quot; }\n});\nconst testConfig = {\n  baseUrl: ApiUrls.apiBaseUrl,\n  endpoint: ApiUrls.doSendMoney,\n  token: token,\n  sender: sender,\n  receiver: receiver,\n  transactionTypeCode: \&quot;1002\&quot;,\n  userId: userId.id,\n  requestBody: {\n    amount: 100,\n    receiverPhone: receiver.identifier,\n    transactionTypeCode: \&quot;1002\&quot;,\n    verifiedPinToken: verifiedPinToken\n  },\n  requestBodyForNotFullActiveUser: {\n    amount: 200,\n    receiverPhone: receiver.identifier,\n    transactionTypeCode: \&quot;1002\&quot;,\n    verifiedPinToken: verifiedPinToken\n  },\n  requestBodyForMinWalleAmount: {\n    amount: 4,\n    receiverPhone: receiver.identifier,\n    transactionTypeCode: \&quot;1002\&quot;,\n    verifiedPinToken: verifiedPinToken\n  },\n  requestBodyForMaxWalleAmount: {\n    amount: 200,\n    receiverPhone: receiver.identifier,\n    transactionTypeCode: \&quot;1002\&quot;,\n    verifiedPinToken: verifiedPinToken\n  },\n  requestBodyForDailyLimitAmount: {\n    amount: 100,\n    receiverPhone: receiver.identifier,\n    transactionTypeCode: \&quot;1002\&quot;,\n    verifiedPinToken: verifiedPinToken\n  },\n  requestBodyForTypeMinAmount: {\n    amount: 9,\n    receiverPhone: receiver.identifier,\n    transactionTypeCode: \&quot;1002\&quot;,\n    verifiedPinToken: verifiedPinToken\n  },\n  requestBodyForTypeMaxAmount: {\n    amount: 1000000,\n    receiverPhone: receiver.identifier,\n    transactionTypeCode: \&quot;1002\&quot;,\n    verifiedPinToken: verifiedPinToken\n  },\n}\nawait runTransactionTests(testConfig);\n\nawait prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();\nawait redisClient.disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c54d3292-b0e9-4c8d-b027-83cc16faaaf4&quot;,&quot;parentUUID&quot;:&quot;37611abd-a029-4ca6-8884-6a97deaf4fab&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: send money in \&quot;Send Money API Check:(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Send Money API Check:(POST) \&quot;after each\&quot; hook: send money in \&quot;Send Money API Check:(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait redisClient.FLUSHALL();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ad80c896-2c1f-447e-b788-890b0c7d0b51&quot;,&quot;parentUUID&quot;:&quot;37611abd-a029-4ca6-8884-6a97deaf4fab&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 200 for successful send money and save this transaction&quot;,&quot;fullTitle&quot;:&quot;Send Money API Check:(POST) should return 200 for successful send money and save this transaction&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addInitialBalance(sender, 1000000);\n  \n  const verifiedPinToken = generateVerifyPinToken(\&quot;1002\&quot;, userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\n    await redisClient.FLUSHALL();\n\n    await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedPinToken);\n\n    await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n\n    await pactum\n.spec()\n.post(`${ApiUrls.apiBaseUrl}${ApiUrls.doSendMoney}`)\n.withBearerToken(token)\n.withJson({\n  amount: 100,\n  receiverPhone: receiver.identifier,\n  transactionTypeCode: \&quot;1002\&quot;,\n  save: true,\n  verifiedPinToken: verifiedPinToken\n})\n.expectStatus(200);\n\n    await checkSuccess({\ngroupId: \&quot;topup\&quot;,\ntopic: \&quot;send_money_account_complete\&quot;,\nlog: &#x27;Send Money: From 01317577237 to 01711106485&#x27;,\namount: 100,\ncallback: async () =&gt; {\n}\n    })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 400 !== 200\n\n400 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 400 !== 200\n\n400 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 400\n+ 200\n&quot;},&quot;uuid&quot;:&quot;e568de22-a4e8-4697-9ed0-406966260c2f&quot;,&quot;parentUUID&quot;:&quot;37611abd-a029-4ca6-8884-6a97deaf4fab&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;e568de22-a4e8-4697-9ed0-406966260c2f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:46,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;66269584-6da6-446c-b03d-792d01025921&quot;,&quot;title&quot;:&quot;Split Bill&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/splitBill/splitBill.test.js&quot;,&quot;file&quot;:&quot;/src/splitBill/splitBill.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Split Bill\&quot;&quot;,&quot;fullTitle&quot;:&quot;Split Bill \&quot;before all\&quot; hook in \&quot;Split Bill\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;77273cee-6849-465f-a179-1e869a036f02&quot;,&quot;parentUUID&quot;:&quot;66269584-6da6-446c-b03d-792d01025921&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Split Bill\&quot;&quot;,&quot;fullTitle&quot;:&quot;Split Bill \&quot;before each\&quot; hook in \&quot;Split Bill\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:168,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nconst userId1 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\nconst userId2 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01711106485\&quot;,\n  },\n});\nconst userId3 = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577238\&quot;,\n  },\n});\nconst merchantUser = await prismaAuth.appUser.findUnique({\n  where: { phone: \&quot;01999999999\&quot; },\n});\ntokenUser1 = generateUserToken(userId1.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\ntokenUser2 = generateUserToken(userId2.id, \&quot;01711106485\&quot;, \&quot;USER\&quot;);\ntokenUser3 = generateUserToken(userId3.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\nawait setupTransactionTypes(chartOfAccounts);\ntype = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;make-payment-001\&quot; },\n});\ntrxnTypeId = type.id;\nawait createUserAccounts(chartOfAccounts);\ncustomerAccount1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\ncustomerAccount2 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\ncustomerAccount3 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577238\&quot; },\n});\nawait prismaApi.merchantUser.create({\n  data: {\n    userId: merchantUser.id,\n    settlementFrequency: \&quot;MONTHLY\&quot;,\n  },\n});\nmerchantAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01999999999\&quot; },\n});\nawait addInitialBalance(customerAccount1, 50000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d87b598d-adaf-4514-911c-eef20ac25031&quot;,&quot;parentUUID&quot;:&quot;66269584-6da6-446c-b03d-792d01025921&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Split Bill\&quot;&quot;,&quot;fullTitle&quot;:&quot;Split Bill \&quot;after all\&quot; hook in \&quot;Split Bill\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$disconnect();\nawait prismaApi.$disconnect();\nawait prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d9e71591-4fdd-4ce6-b7d9-8568a9d5c56c&quot;,&quot;parentUUID&quot;:&quot;66269584-6da6-446c-b03d-792d01025921&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should split bill successfully for all valid scenarios&quot;,&quot;fullTitle&quot;:&quot;Split Bill should split bill successfully for all valid scenarios&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:199,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;this.timeout(7000);\nconst splitBillData = {\n  totalAmount: 100,\n  merchantNumber: \&quot;01999999999\&quot;,\n  requestedTo: [\n    { phone: \&quot;01711106485\&quot;, amount: 50 },\n    { phone: \&quot;01317577238\&quot;, amount: 50 },\n  ],\n  transactionTypeCode: \&quot;make-payment-001\&quot;,\n  note: \&quot;Dinner with friends\&quot;,\n};\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.splitBill}`)\n  .withJson(splitBillData)\n  .expectStatus(200);\nconst splitBillTransaction = await prismaApi.splitBill.findFirst({\n  where: { requestReceiverNumber: \&quot;01999999999\&quot; },\n});\nexpect(splitBillTransaction).to.not.be.null;\nexpect(splitBillTransaction.status).to.equal(\&quot;SUCCESS\&quot;);\nrefNumber = splitBillTransaction.referenceNumber;\nconst reqMoney = await prismaApi.requestMoney.findMany({\n  where: { splitBillId: splitBillTransaction.id.toString() },\n});\nawait checkSuccess({\n  groupId: \&quot;splitbill\&quot;,\n  topic: \&quot;split_bill_payment_result\&quot;,\n  log: \&quot;Make Payment: From 01317577237 to 01999999999\&quot;,\n  amount: 100,\n  message: {\n    value: JSON.stringify({\n      referenceNo: refNumber,\n      status: \&quot;SUCCESSFUL\&quot;,\n      totalAmount: 100,\n      note: \&quot;Dinner with friends\&quot;,\n      totalAmountPaid: 100,\n      requestedTo: [\n        { phone: \&quot;01711106485\&quot;, amount: 50 },\n        { phone: \&quot;01317577238\&quot;, amount: 50 },\n      ],\n    }),\n  },\n  callback: async () =&gt; {\n    const transactionFromDB = await prismaAccounting.transaction.findFirst({\n      where: { referenceNo: refNumber },\n    });\n    expect(transactionFromDB).to.not.be.null;\n    expect(transactionFromDB.status).to.equal(\&quot;SUCCESSFUL\&quot;);\n    expect(transactionFromDB.amount).to.equal(100);\n    const splitBillTransaction = await prismaApi.splitBill.findFirst({\n      where: { requestReceiverNumber: \&quot;01999999999\&quot; },\n    });\n    expect(splitBillTransaction).to.not.be.null;\n    expect(splitBillTransaction.status).to.equal(\&quot;SUCCESS\&quot;);\n  },\n});&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;PENDING&#x27; to equal &#x27;SUCCESS&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;PENDING&#x27; to equal &#x27;SUCCESS&#x27;\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/splitBill/splitBill.test.js:206:44)&quot;,&quot;diff&quot;:&quot;- PENDING\n+ SUCCESS\n&quot;},&quot;uuid&quot;:&quot;f3fb41f0-5127-4d29-84ed-bf7485e5e452&quot;,&quot;parentUUID&quot;:&quot;66269584-6da6-446c-b03d-792d01025921&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if the merchant doesnt exist&quot;,&quot;fullTitle&quot;:&quot;Split Bill should show error if the merchant doesnt exist&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const splitBillData = {\n  totalAmount: 100,\n  merchantNumber: \&quot;01787878787\&quot;,\n  requestedTo: [\n    { phone: \&quot;01711106485\&quot;, amount: 50 },\n    { phone: \&quot;01317577238\&quot;, amount: 50 },\n  ],\n  transactionTypeCode: \&quot;make-payment-001\&quot;,\n  note: \&quot;Dinner with friends\&quot;,\n};\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.splitBill}`)\n  .withJson(splitBillData)\n  .expectStatus(400);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;2f0f0684-8d20-45b7-a507-3b0341f2f7c9&quot;,&quot;parentUUID&quot;:&quot;66269584-6da6-446c-b03d-792d01025921&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show error if the user requests in his own account for Split Bill&quot;,&quot;fullTitle&quot;:&quot;Split Bill should show error if the user requests in his own account for Split Bill&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:113,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const splitBillData = {\n  totalAmount: 100,\n  merchantNumber: \&quot;01999999999\&quot;,\n  requestedTo: [\n    { phone: \&quot;01317577237\&quot;, amount: 50 },\n    { phone: \&quot;01317577238\&quot;, amount: 50 },\n  ],\n  transactionTypeCode: \&quot;make-payment-001\&quot;,\n  note: \&quot;Dinner with friends\&quot;,\n};\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;POST\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.splitBill}`)\n  .withJson(splitBillData)\n  .expectStatus(500);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3e1c857b-081f-414c-82a5-f3a7728a60cc&quot;,&quot;parentUUID&quot;:&quot;66269584-6da6-446c-b03d-792d01025921&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3e1c857b-081f-414c-82a5-f3a7728a60cc&quot;],&quot;failures&quot;:[&quot;f3fb41f0-5127-4d29-84ed-bf7485e5e452&quot;,&quot;2f0f0684-8d20-45b7-a507-3b0341f2f7c9&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:327,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:7000},{&quot;uuid&quot;:&quot;d0bbef18-4856-4909-acb3-d95e28e9768c&quot;,&quot;title&quot;:&quot;Get Saved Transaction After Top Up&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/topUp/getSaveTrxnTopUp.test.js&quot;,&quot;file&quot;:&quot;/src/topUp/getSaveTrxnTopUp.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Get Saved Transaction After Top Up\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Top Up \&quot;before all\&quot; hook in \&quot;Get Saved Transaction After Top Up\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9b31959d-90df-4124-8ab9-63d230b55847&quot;,&quot;parentUUID&quot;:&quot;d0bbef18-4856-4909-acb3-d95e28e9768c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Get Saved Transaction After Top Up\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Top Up \&quot;before each\&quot; hook in \&quot;Get Saved Transaction After Top Up\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:156,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId1 = await prismaAuth.appUser.findFirst({\n  where: { phone: \&quot;01317577237\&quot; },\n});\ntokenUser1 = generateUserToken(userId1.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\nawait setupTransactionTypes(chartOfAccounts);\nconst TopUpType = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;1005\&quot; },\n});\nTopUpTypeId = TopUpType.id;\nawait createUserAccounts(chartOfAccounts);\ncustomerAccount1 = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\noperatorAccountForGrameenphone =\n  await prismaAccounting.userAccount.findUnique({\n    where: { identifier: \&quot;gp-wallet-01\&quot; },\n  });\noperatorIdForGrameenphone = await prismaApi.operator.findFirst({\n  where: {\n    accountIdentifier: \&quot;gp-wallet-01\&quot;,\n  type: \&quot;GRAMEENPHONE\&quot;,\n  },\n});\noperatorAccountForBanglalink =\n  await prismaAccounting.userAccount.findUnique({\n    where: { identifier: \&quot;bl-wallet-01\&quot; },\n  });\noperatorIdForBanglalink = await prismaApi.operator.findFirst({\n  where: {\n    accountIdentifier: \&quot;bl-wallet-01\&quot;,\n   type: \&quot;BANGLALINK\&quot;,\n  },\n});\noperatorAccountForTeletalk = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;teletalk-wallet-01\&quot; },\n});\noperatorIdForTeletalk = await prismaApi.operator.findFirst({\n  where: {\n    accountIdentifier: \&quot;teletalk-wallet-01\&quot;,\n   type: \&quot;TELETALK\&quot;,\n  },\n});\nawait addInitialBalance(customerAccount1, 100000);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;179e89c8-ce57-4dd3-82cb-4bb4223b31cf&quot;,&quot;parentUUID&quot;:&quot;d0bbef18-4856-4909-acb3-d95e28e9768c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Get Saved Transaction After Top Up\&quot;&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Top Up \&quot;after all\&quot; hook in \&quot;Get Saved Transaction After Top Up\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:15,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$disconnect();\nawait prismaApi.$disconnect();\nawait prismaAccounting.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9d696c23-043e-4e33-95d3-507f52d73e82&quot;,&quot;parentUUID&quot;:&quot;d0bbef18-4856-4909-acb3-d95e28e9768c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get saved Top Up transaction list&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Top Up should get saved Top Up transaction list&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await insertTopUpSavedTransaction({\n      amount: 1000,\n      fromAccount: customerAccount1,\n      toAccount: operatorAccountForGrameenphone,\n      transactionTypeId: TopUpTypeId,\n      transactionTypeCode: \&quot;1005\&quot;,\n      operatorId: operatorIdForGrameenphone.id,\n      operatorType: \&quot;GRAMEENPHONE\&quot;,\n      topUpId: 1,\n    });\n    await pactum\n      .spec()\n      .withBearerToken(tokenUser1)\n      .get(`${ApiUrls.apiBaseUrl}${ApiUrls.savetrxnTopUp}`)\n      .expectStatus(200);\n    const savedTopUpTrxns = await prismaApi.topUpSave.findMany({});\n    expect(savedTopUpTrxns).to.have.lengthOf(1);\n    expect(savedTopUpTrxns[0].amount.toString()).to.equal(\&quot;1000\&quot;);\n    expect(savedTopUpTrxns[0].save).to.be.true;\n    expect(savedTopUpTrxns[0].fromAccount).to.equal(\&quot;01317577237\&quot;);\n    expect(savedTopUpTrxns[0].toAccount).to.equal(\&quot;gp-wallet-01\&quot;);\n    expect(savedTopUpTrxns[0].transactionTypeCode).to.equal(\&quot;1005\&quot;);\n    expect(savedTopUpTrxns[0].operatorId.toString()).to.equal(\n      operatorIdForGrameenphone.id.toString()\n    );&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/topUp/getSaveTrxnTopUp.test.js:182:45)&quot;},&quot;uuid&quot;:&quot;b7f366b9-72a0-476f-ba99-7c837d111b82&quot;,&quot;parentUUID&quot;:&quot;d0bbef18-4856-4909-acb3-d95e28e9768c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should show the first Utility Pay transaction of bank account even after multiple transactions with the same bank account&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Top Up should show the first Utility Pay transaction of bank account even after multiple transactions with the same bank account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await insertTopUpSavedTransaction({\n  amount: 1000,\n  fromAccount: customerAccount1,\n  toAccount: operatorAccountForGrameenphone,\n  transactionTypeId: TopUpTypeId,\n  transactionTypeCode: \&quot;1005\&quot;,\n  operatorId: operatorIdForGrameenphone.id,\n  operatorType: \&quot;GRAMEENPHONE\&quot;,\n  topUpId: 1,\n});\nawait insertTopUpSavedTransaction({\n  amount: 2000,\n  fromAccount: customerAccount1,\n  toAccount: operatorAccountForGrameenphone,\n  transactionTypeId: TopUpTypeId,\n  transactionTypeCode: \&quot;1005\&quot;,\n  operatorId: operatorIdForGrameenphone.id,\n  operatorType: \&quot;GRAMEENPHONE\&quot;,\n  topUpId: 1,\n});\n\nawait pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.savetrxnTopUp}`)\n  .expectStatus(200)\n  .returns(\&quot;body\&quot;);\nconst savedTopUpTrxns = await prismaApi.topUpSave.findMany({});\nexpect(savedTopUpTrxns).to.have.lengthOf(1);\nexpect(savedTopUpTrxns[0].amount.toString()).to.equal(\&quot;1000\&quot;);\nexpect(savedTopUpTrxns[0].toAccount).to.equal(\&quot;gp-wallet-01\&quot;);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/topUp/getSaveTrxnTopUp.test.js:213:45)&quot;},&quot;uuid&quot;:&quot;36ef7e22-881d-4bd8-9a13-40056d09b42d&quot;,&quot;parentUUID&quot;:&quot;d0bbef18-4856-4909-acb3-d95e28e9768c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should save only one add money transaction per unique bank account&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Top Up should save only one add money transaction per unique bank account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;for (let i = 0; i &lt; 10; i++) {\n      await insertTopUpSavedTransaction({\n        amount: 2000,\n        fromAccount: customerAccount1,\n        toAccount: operatorAccountForBanglalink,\n        transactionTypeId: TopUpTypeId,\n        transactionTypeCode: \&quot;1005\&quot;,\n        operatorId: operatorIdForBanglalink.id,\n        operatorType: \&quot;BANGLALINK\&quot;,\n        topUpId: 1,\n      });\n    }\n    for (let i = 0; i &lt; 10; i++) {\n      await insertTopUpSavedTransaction({\n        amount: 2000,\n        fromAccount: customerAccount1,\n        toAccount: operatorAccountForGrameenphone,\n        transactionTypeId: TopUpTypeId,\n        transactionTypeCode: \&quot;1005\&quot;,\n        operatorId: operatorIdForGrameenphone.id,\n        operatorType: \&quot;GRAMEENPHONE\&quot;,\n        topUpId: 1,\n      });\n    }\n    for (let i = 0; i &lt; 10; i++) {\n      await insertTopUpSavedTransaction({\n        amount: 2000,\n        fromAccount: customerAccount1,\n        toAccount: operatorAccountForTeletalk,\n        transactionTypeId: TopUpTypeId,\n        transactionTypeCode: \&quot;1005\&quot;,\n        operatorId: operatorIdForTeletalk.id,\n        operatorType: \&quot;TELETALK\&quot;,\n        topUpId: 1,\n      });\n    }\n    await pactum\n      .spec()\n      .withBearerToken(tokenUser1)\n      .withMethod(\&quot;GET\&quot;)\n      .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.savetrxnTopUp}`)\n      .expectStatus(200)\n      .returns(\&quot;body\&quot;);\n    const savedTopUpTrxns = await prismaApi.topUpSave.findMany({});\n    expect(savedTopUpTrxns).to.have.lengthOf(3);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/topUp/getSaveTrxnTopUp.test.js:253:45)&quot;},&quot;uuid&quot;:&quot;7c7b9690-36ae-45b5-bcdf-2201f243ded5&quot;,&quot;parentUUID&quot;:&quot;d0bbef18-4856-4909-acb3-d95e28e9768c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return saved add money transaction list with correct pagination and size&quot;,&quot;fullTitle&quot;:&quot;Get Saved Transaction After Top Up should return saved add money transaction list with correct pagination and size&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await insertTopUpSavedTransaction({\n    amount: 2000,\n    fromAccount: customerAccount1,\n    toAccount: operatorAccountForBanglalink,\n    transactionTypeId: TopUpTypeId,\n    transactionTypeCode: \&quot;1005\&quot;,\n    operatorId: operatorIdForBanglalink.id,\n    operatorType: \&quot;BANGLALINK\&quot;,\n    topUpId: 1,\n  });\n  await insertTopUpSavedTransaction({\n    amount: 2000,\n    fromAccount: customerAccount1,\n    toAccount: operatorAccountForGrameenphone,\n    transactionTypeId: TopUpTypeId,\n    transactionTypeCode: \&quot;1005\&quot;,\n    operatorId: operatorIdForGrameenphone.id,\n    operatorType: \&quot;GRAMEENPHONE\&quot;,\n    topUpId: 1,\n  });\n\n  await insertTopUpSavedTransaction({\n    amount: 1000,\n    fromAccount: customerAccount1,\n    toAccount: operatorAccountForTeletalk,\n    transactionTypeId: TopUpTypeId,\n    transactionTypeCode: \&quot;1005\&quot;,\n    operatorId: operatorIdForTeletalk.id,\n    operatorType: \&quot;TELETALK\&quot;,\n    topUpId: 1,\n  });\nconst response = await pactum\n  .spec()\n  .withBearerToken(tokenUser1)\n  .withMethod(\&quot;GET\&quot;)\n  .withPath(`${ApiUrls.apiBaseUrl}${ApiUrls.savetrxnTopUp}?page=0&amp;size=2`)\n  .expectStatus(200);\nexpect(response.body)\n  .to.have.property(\&quot;saveTransactions\&quot;)\n  .that.is.an(\&quot;array\&quot;);\nexpect(response.body.saveTransactions).to.have.lengthOf(2);\nexpect(response.body.pagination.hasNext).to.equal(true);\nexpect(response.body.pagination.currentPageTotalCount).to.equal(2);\nexpect(response.body.pagination.totalCount).to.equal(3);\nexpect(response.body.pagination.currentPage).to.equal(0);&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of null (reading &#x27;id&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/topUp/getSaveTrxnTopUp.test.js:304:45)&quot;},&quot;uuid&quot;:&quot;b24fbf2c-d5de-4233-961d-ce9c59b0c289&quot;,&quot;parentUUID&quot;:&quot;d0bbef18-4856-4909-acb3-d95e28e9768c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;b7f366b9-72a0-476f-ba99-7c837d111b82&quot;,&quot;36ef7e22-881d-4bd8-9a13-40056d09b42d&quot;,&quot;7c7b9690-36ae-45b5-bcdf-2201f243ded5&quot;,&quot;b24fbf2c-d5de-4233-961d-ce9c59b0c289&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;6abfa6af-2ffa-41d8-b1b3-c885c387e107&quot;,&quot;title&quot;:&quot;Do Recharge API Check: TOPUP(POST)&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/topUp/topup.test.js&quot;,&quot;file&quot;:&quot;/src/topUp/topup.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Do Recharge API Check: TOPUP(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Recharge API Check: TOPUP(POST) \&quot;before all\&quot; hook in \&quot;Do Recharge API Check: TOPUP(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAuth.$connect();\nawait prismaAccounting.$connect();\nawait prismaApi.$connect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;146f8fb9-95d4-4bf9-af07-241bf535a468&quot;,&quot;parentUUID&quot;:&quot;6abfa6af-2ffa-41d8-b1b3-c885c387e107&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Do Recharge API Check: TOPUP(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Recharge API Check: TOPUP(POST) \&quot;before each\&quot; hook in \&quot;Do Recharge API Check: TOPUP(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:109,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\ntoken = generateUserToken(userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\ntopUpProvider = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;top-up-providers-01\&quot;\n);\nawait setupTransactionTypes(chartOfAccounts);\nawait createUserAccounts(chartOfAccounts);\nsender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nreceiver = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\ngp = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;gp-wallet-01\&quot; },\n});\nteletalk = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;teletalk-wallet-01\&quot; },\n});\nbanglalink = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;bl-wallet-01\&quot; },\n});\nconst type = await prismaAccounting.transactionType.findUnique({\n  where: { transactionCode: \&quot;1001\&quot; },\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6c9d1f8d-f9f5-492e-b0f7-b55a639ea7bf&quot;,&quot;parentUUID&quot;:&quot;6abfa6af-2ffa-41d8-b1b3-c885c387e107&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook: topup in \&quot;Do Recharge API Check: TOPUP(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Recharge API Check: TOPUP(POST) \&quot;after all\&quot; hook: topup in \&quot;Do Recharge API Check: TOPUP(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:148,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();\nawait createAppUserAccounts();\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\ntoken = generateUserToken(userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\nconst chartOfAccounts = await createBasicChartOfAccounts();\ncustomer = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;customer-01\&quot;\n);\ntopUpProvider = chartOfAccounts.find(\n  (account) =&gt; account.code === \&quot;top-up-providers-01\&quot;\n);\nconst transactionTypes = await setupTransactionTypes(chartOfAccounts);\nawait createUserAccounts(chartOfAccounts);\nsender = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577237\&quot; },\n});\nreceiver = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01711106485\&quot; },\n});\nonholdUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577238\&quot; }\n});\nmaxwallet = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01317577210\&quot; }\n});\ndailyLimitAmountUser = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: \&quot;01715170020\&quot; }\n});\nconst testConfig = {\n  baseUrl: ApiUrls.apiBaseUrl,\n  endpoint: ApiUrls.doTopUp,\n  token: token,\n  sender: sender,\n  receiver: receiver,\n  type: \&quot;Top Up\&quot;,\n  database: [prismaApi.topUp],\n  transactionTypeCode: \&quot;1005\&quot;,\n  provider: gp.identifier,\n  userId: userId.id,\n  requestBody: {\n    amount: 20,\n    phone: receiver.identifier,\n    operatorId: 2,\n    rechargeType: \&quot;PREPAID\&quot;,\n    transactionTypeCode: \&quot;1005\&quot;\n  },\n  requestBodyForNotFullActiveUser: {\n    amount: 200,\n    phone: receiver.identifier,\n    operatorId: 2,\n    rechargeType: \&quot;PREPAID\&quot;,\n    transactionTypeCode: \&quot;1005\&quot;\n  },\n  requestBodyForMinWalleAmount: {\n    amount: 40,\n    phone: receiver.identifier,\n    operatorId: 2,\n    rechargeType: \&quot;PREPAID\&quot;,\n    transactionTypeCode: \&quot;1005\&quot;\n  },\n  requestBodyForMaxWalleAmount: {\n    amount: 1001,\n    phone: maxwallet.identifier,\n    operatorId: 5,\n    rechargeType: \&quot;PREPAID\&quot;,\n    transactionTypeCode: \&quot;1005\&quot;\n  },\n  requestBodyForDailyLimitAmount: {\n    amount: 100,\n    phone: dailyLimitAmountUser.identifier,\n    operatorId: 2,\n    rechargeType: \&quot;PREPAID\&quot;,\n    transactionTypeCode: \&quot;1005\&quot;\n  },\n  requestBodyForTypeMinAmount: {\n    amount: 5,\n    phone: receiver.identifier,\n    operatorId: 2,\n    rechargeType: \&quot;PREPAID\&quot;,\n    transactionTypeCode: \&quot;1005\&quot;\n  },\n  requestBodyForTypeMaxAmount: {\n    amount: 1000000,\n    phone: receiver.identifier,\n    operatorId: 2,\n    rechargeType: \&quot;PREPAID\&quot;,\n    transactionTypeCode: \&quot;1005\&quot;\n  },\n}\nawait runTransactionTests(testConfig);\nawait prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;56a167d8-a2b5-46a0-ad2b-470bafa142c7&quot;,&quot;parentUUID&quot;:&quot;6abfa6af-2ffa-41d8-b1b3-c885c387e107&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;after each\&quot; hook: topup in \&quot;Do Recharge API Check: TOPUP(POST)\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Recharge API Check: TOPUP(POST) \&quot;after each\&quot; hook: topup in \&quot;Do Recharge API Check: TOPUP(POST)\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await clearAllDatabases();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8fd12c42-f204-4899-9ce8-6e10b1aaef2d&quot;,&quot;parentUUID&quot;:&quot;6abfa6af-2ffa-41d8-b1b3-c885c387e107&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 200 for successful topup and save this topup&quot;,&quot;fullTitle&quot;:&quot;Do Recharge API Check: TOPUP(POST) should return 200 for successful topup and save this topup&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addInitialBalance(sender, 1000000);\nawait pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doTopUp}`)\n  .withBearerToken(token)\n  .withJson({\n    amount: 50,\n    phone: receiver.identifier,\n    operatorId: 2,\n    rechargeType: \&quot;PREPAID\&quot;,\n    transactionTypeCode: \&quot;1005\&quot;,\n    save: true\n  })\n  .expectStatus(200);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01317577237\&quot;,\n  },\n});\nawait checkSuccess({\n  groupId: \&quot;topup\&quot;,\n  topic: \&quot;top_up_payment_result\&quot;,\n  log: &#x27;Top Up: From 01317577237 to gp-wallet-01&#x27;,\n  amount: 50,\n  callback: async () =&gt; {\n    const topUpTable = await prismaApi.topUp.findMany({\n      where: { userId: userId.id },\n    });\n    const saveTopUp = await prismaApi.topUpSave.findMany({\n      where: { topUpId: topUpTable.id },\n    });\n    expect(saveTopUp).to.have.lengthOf(1);\n    expect(topUpTable[0].status).to.equal(\&quot;SUCCESS\&quot;);\n    expect(topUpTable[0].userId).to.equal(userId.id);\n  }\n})&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 400 !== 200\n\n400 !== 200\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 400 !== 200\n\n400 !== 200\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 400\n+ 200\n&quot;},&quot;uuid&quot;:&quot;fcf967c8-35d4-4585-863e-539a404ff432&quot;,&quot;parentUUID&quot;:&quot;6abfa6af-2ffa-41d8-b1b3-c885c387e107&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the operator id does not exists in topup&quot;,&quot;fullTitle&quot;:&quot;Do Recharge API Check: TOPUP(POST) should return 400 if the operator id does not exists in topup&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await addInitialBalance(sender, 1000000);\nawait pactum\n  .spec()\n  .post(`${ApiUrls.apiBaseUrl}${ApiUrls.doTopUp}`)\n  .withBearerToken(token)\n  .withJson({\n    amount: validTopUpAmount,\n    phone: receiver.identifier,\n    operatorId: 9,\n    rechargeType: \&quot;PREPAID\&quot;,\n    transactionTypeCode: \&quot;1005\&quot;,\n  })\n  .expectStatus(400);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9ea80563-d155-495b-a5fe-946e19e00aff&quot;,&quot;parentUUID&quot;:&quot;6abfa6af-2ffa-41d8-b1b3-c885c387e107&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9ea80563-d155-495b-a5fe-946e19e00aff&quot;],&quot;failures&quot;:[&quot;fcf967c8-35d4-4585-863e-539a404ff432&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:40,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:30000},{&quot;uuid&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;title&quot;:&quot;Do Transaction API Check (POST) - Type: 1001&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/topUp/topup.test.js&quot;,&quot;file&quot;:&quot;/src/topUp/topup.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1001\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 \&quot;before each\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1001\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const senderIdentifier = sender?.identifier;\nconst receiverIdentifier = receiver?.identifier;\nconst senderAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: senderIdentifier },\n});\nconst receiverAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: receiverIdentifier },\n});\ncreatedType = await prismaAccounting.transactionType.findMany({\n  where: { transactionCode: transactionTypeCode },\n});\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  await database[0].deleteMany({});\n}\nif (!redisClient.isOpen) {\n  await redisClient.connect();\n}\nawait redisClient.FLUSHALL();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0f4e4747-e3d6-40ad-9b38-466446c86e74&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1001\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 \&quot;after all\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1001\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:18,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cc9e9a4f-048f-4aa9-8a8c-df4830e1cf3f&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 if sender&#x27;s account balance is less than the transaction amount&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if sender&#x27;s account balance is less than the transaction amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\n      await prismaAccounting.transaction.deleteMany({});\n      userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      });\n      if (transactionTypeCode === &#x27;1001&#x27;) { return; }\n      const verifiedPinToken = generateVerifyPinToken(transactionTypeCode, userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedPinToken);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        await database[0].deleteMany({});\n      }\n      const res = await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(token)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBody,\n          verifiedPinToken: verifiedPinToken\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        const transactionsFromDB = await prismaAccounting.transaction.findMany({\n          where: { referenceNo: apiTable.referenceNumber },\n        });\n        expect(transactionsFromDB).to.be.empty;\n        const ledgerEntries = await prismaAccounting.ledger.findMany({\n          where: { transactionId: transactionsFromDB.id },\n        });\n        expect(ledgerEntries).to.be.empty;\n      }&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1c84397c-cff9-4571-900c-c072bde7ddf4&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the sender&#x27;s status is anything but FULL_ACTIVE&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the sender&#x27;s status is anything but FULL_ACTIVE&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: \&quot;01317577238\&quot;,\n        },\n      });\n      const accountingUser = await prismaAccounting.userAccount.findFirst({\n        where: {\n          identifier: \&quot;01317577238\&quot;,\n        },\n      });\n      const onholdUserToken = generateUserToken(userId.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\n      const onholdUserTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, onholdUserTokenPin);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      if (transactionTypeCode != &#x27;1001&#x27;) {\n        await addInitialBalance(accountingUser, 500000);\n      }\n      await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(onholdUserToken)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBody,\n          verifiedPinToken: onholdUserTokenPin\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        // const transactionsFromDB = await prismaAccounting.transaction.findMany({\n        //   where: { referenceNo: apiTable.referenceNumber },\n        // });\n        // expect(transactionsFromDB).to.have.lengthOf(2);\n        // const ledgerEntries = await prismaAccounting.ledger.findMany({\n        //   where: { transactionId: transactionsFromDB[0].id },\n        // });\n        // expect(ledgerEntries).to.have.lengthOf(2);\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:172:28)&quot;},&quot;uuid&quot;:&quot;fb8397d7-c21a-4a25-b4b6-1bf277d1b16e&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the balance after transaction amount is less than min Wallet Amount of sender account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the balance after transaction amount is less than min Wallet Amount of sender account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      });\n      if (transactionTypeCode != &#x27;1001&#x27;) {\n        await addInitialBalance(sender, 1000000);\n      }\n      const verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(token)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBodyForMinWalleAmount,\n          verifiedPinToken: verifiedTokenPin\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        const transactionsFromDB = await prismaAccounting.transaction.findMany({\n          where: { referenceNo: apiTable.referenceNumber },\n        });\n        if (transactionTypeCode != &#x27;1001&#x27;) {\n          // expect(transactionsFromDB).to.have.lengthOf(2);\n          // const ledgerEntries = await prismaAccounting.ledger.findMany({\n          //   where: { transactionId: transactionsFromDB[0].id },\n          // });\n          // expect(ledgerEntries).to.have.lengthOf(2);\n          // const ledgerEntries1 = await prismaAccounting.ledger.findMany({\n          //   where: { transactionId: transactionsFromDB[1].id },\n          // });\n          // expect(ledgerEntries1).to.have.lengthOf(2);\n        }\n        else {\n          expect(transactionsFromDB).to.be.empty;\n        }\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:225:28)&quot;},&quot;uuid&quot;:&quot;b9d326ba-a7c7-4d5f-a5d8-036a1f76d7ec&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the balance after transaction is greater than max Wallet Amount of receiver account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the balance after transaction is greater than max Wallet Amount of receiver account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const maxWalletUser = await prismaAuth.appUser.findUnique({\n  where: { phone: \&quot;01317577210\&quot; }\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01317577210\&quot;,\n  },\n});\nconst maxWalletUserToken = generateUserToken(maxWalletUser.id, \&quot;01317577210\&quot;, \&quot;USER\&quot;);\nif (transactionTypeCode != &#x27;1001&#x27;) {\n  await addInitialBalance(accountingUser, 500000);\n  await addInitialBalance(receiver, 500);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, maxWalletUser.id, maxWalletUser.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(maxWalletUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForMaxWalleAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: \&quot;01317577210\&quot;,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:293:28)&quot;},&quot;uuid&quot;:&quot;6b7c72c0-138b-48e2-a073-87196c53ae7b&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily count is greater than daily limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the daily count is greater than daily limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nawait addInitialBalance(sender, 500000);\n\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170025\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170025\&quot;,\n  },\n});\nconst dailyLimitCountUser = generateUserToken(userId.id, \&quot;01715170025\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nconst dailyLimitCount = accountingUser.dailyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(dailyLimitCountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d915df2e-daa5-48dc-8b52-e606f8501648&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction amount is greater than daily limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the daily transaction amount is greater than daily limit amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170020\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170020\&quot;,\n  },\n});\nconst dailyLimitAmountUser = generateUserToken(userId.id, \&quot;01715170020\&quot;, \&quot;USER\&quot;);\nif (transactionTypeCode != &#x27;1001&#x27;) {\n  await addInitialBalance(accountingUser, 500000);\n}\nconst dailyLimitAmount = accountingUser.dailyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; dailyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(dailyLimitAmountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForDailyLimitAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;20b1be9e-6821-4264-af8d-9905b21a18fa&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly count is greater than maximum monthly limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the monthly count is greater than maximum monthly limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nawait addInitialBalance(sender, 500000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170021\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170021\&quot;,\n  },\n});\nconst monthlyLimitCountCountUser = generateUserToken(userId.id, \&quot;01715170021\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst monthlyLimitCount = accountingUser.monthlyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; monthlyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(monthlyLimitCountCountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedPinToken: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5cd249aa-3ccc-486f-8f31-60912a5635fe&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly transaction amount is greater than monthly limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the monthly transaction amount is greater than monthly limit amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170021\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170021\&quot;,\n  },\n});\nconst monthlyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170021\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst monthlyLimitAmount = accountingUser.monthlyLimitAmount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; monthlyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(monthlyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedPinToken: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;96e7208b-34d5-4542-ad49-7128cf582c4a&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly count is greater than maximum weekly limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the weekly count is greater than maximum weekly limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170105\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170105\&quot;,\n  },\n});\nconst weeklyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170105\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst weeklyLimitAmount = accountingUser.weeklyLimitAmount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; weeklyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(weeklyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;771c291b-c209-4bdc-955d-732eac90ce57&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction amount is greater than weekly limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the weekly transaction amount is greater than weekly limit amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170105\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170105\&quot;,\n  },\n});\nconst weeklyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170105\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst weeklyLimitCount = accountingUser.weeklyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; weeklyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(weeklyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a554f42c-97c7-480b-87be-1915740bb183&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the transaction amount is less than transaction type min amount&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the transaction amount is less than transaction type min amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01915170011\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01915170011\&quot;,\n  },\n});\nconst transactionTypeMinUserToken = generateUserToken(userId.id, \&quot;01915170011\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(transactionTypeMinUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForTypeMinAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:926:28)&quot;},&quot;uuid&quot;:&quot;d366383f-f422-4262-b24e-6ddea7addf19&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the transaction amount is greater than transaction type max amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the transaction amount is greater than transaction type max amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01915170011\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01915170011\&quot;,\n  },\n});\nconst transactionTypeMinUserToken = generateUserToken(userId.id, \&quot;01915170011\&quot;, \&quot;USER\&quot;);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait addInitialBalance(accountingUser, 1000000);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(transactionTypeMinUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForTypeMaxAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:972:28)&quot;},&quot;uuid&quot;:&quot;72a04987-36bb-4690-a3d5-5fcb3358a191&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction amount is greater than daily limit amount of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the daily transaction amount is greater than daily limit amount of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:563,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, dailyLimitAmount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst dailyLimitCount = Number(typeId.dailyLimitAmount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:1074:28)&quot;},&quot;uuid&quot;:&quot;0c701cc7-be63-49e1-a4c8-7a82a952e08f&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction count is greater than daily limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the daily transaction count is greater than daily limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:232,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, dailyLimitCount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 5000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst dailyLimitCount = Number(typeId.dailyLimitCount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:1175:28)&quot;},&quot;uuid&quot;:&quot;916b57d3-b746-4f0f-b064-163ccc532219&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction amount is greater than weekly limit amount of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the weekly transaction amount is greater than weekly limit amount of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, weeklyLimitAmount: true },\n  }),\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst weeklyLimitAmountType = Number(typeId.weeklyLimitAmount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; weeklyLimitAmountType / 100; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:1277:28)&quot;},&quot;uuid&quot;:&quot;538d4af6-bee8-468c-91e3-beb82acfc931&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction count is greater than weekly limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the weekly transaction count is greater than weekly limit count of the transaction type&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:1999,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, weeklyLimitCount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst weeklyLimitCountType = Number(typeId.weeklyLimitCount);\nconst batchSize = 5;\nfor (let i = 0; i &lt; weeklyLimitCountType; i += batchSize) {\n  const batchPromises = [];\n  const end = Math.min(i + batchSize, weeklyLimitCountType);\n  for (let j = i; j &lt; end; j++) {\n    const promise = prismaAccounting.transaction.create({\n      data: {\n        fromAccountId: (await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })).id,\n        toAccountId: (await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })).id,\n        transactionTypeId: typeId.id,\n        amount: 100,\n        referenceNo: `Transaction ${j + 1}`,\n        note: `Test transaction ${j + 1}`,\n      },\n    }).then(async transaction =&gt; {\n      return Promise.all([\n        prismaAccounting.ledger.create({\n          data: {\n            accountId: (await prismaAccounting.userAccount.findUnique({\n              where: { identifier: sender.identifier },\n            })).id,\n            transactionId: transaction.id,\n            amount: 100,\n            description: `Ledger entry for transaction ${j + 1}`,\n            type: \&quot;DEBIT\&quot;,\n          },\n        }),\n        prismaAccounting.ledger.create({\n          data: {\n            accountId: (await prismaAccounting.userAccount.findUnique({\n              where: { identifier: receiver.identifier },\n            })).id,\n            transactionId: transaction.id,\n            amount: 100,\n            description: `Ledger entry for transaction ${j + 1}`,\n            type: \&quot;CREDIT\&quot;,\n          },\n        })\n      ]);\n    });\n    batchPromises.push(promise);\n  }\n  await Promise.all(batchPromises);\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const senderUser = await prismaAuth.appUser.findFirst({\n    where: { phone: sender.identifier },\n    select: { id: true }\n  });\n  const [apiTable] = await  database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  expect(apiTable.status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;50870d42-c032-43ce-a76e-02348ba931d0&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly transaction count is greater than monthly limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1001 should return 400 if the monthly transaction count is greater than monthly limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:408,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n  })\n]);\nconst monthlyLimitCountType = Number(typeId.monthlyLimitCount);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nfor (let i = 0; i &lt; monthlyLimitCountType; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:1477:28)&quot;},&quot;uuid&quot;:&quot;65e2f996-982a-4442-b6c7-5cf1b2db4ae4&quot;,&quot;parentUUID&quot;:&quot;acab592f-7034-4ba7-be83-5eafebf463b8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1c84397c-cff9-4571-900c-c072bde7ddf4&quot;,&quot;d915df2e-daa5-48dc-8b52-e606f8501648&quot;,&quot;20b1be9e-6821-4264-af8d-9905b21a18fa&quot;,&quot;5cd249aa-3ccc-486f-8f31-60912a5635fe&quot;,&quot;96e7208b-34d5-4542-ad49-7128cf582c4a&quot;,&quot;771c291b-c209-4bdc-955d-732eac90ce57&quot;,&quot;a554f42c-97c7-480b-87be-1915740bb183&quot;],&quot;failures&quot;:[&quot;fb8397d7-c21a-4a25-b4b6-1bf277d1b16e&quot;,&quot;b9d326ba-a7c7-4d5f-a5d8-036a1f76d7ec&quot;,&quot;6b7c72c0-138b-48e2-a073-87196c53ae7b&quot;,&quot;d366383f-f422-4262-b24e-6ddea7addf19&quot;,&quot;72a04987-36bb-4690-a3d5-5fcb3358a191&quot;,&quot;0c701cc7-be63-49e1-a4c8-7a82a952e08f&quot;,&quot;916b57d3-b746-4f0f-b064-163ccc532219&quot;,&quot;538d4af6-bee8-468c-91e3-beb82acfc931&quot;,&quot;50870d42-c032-43ce-a76e-02348ba931d0&quot;,&quot;65e2f996-982a-4442-b6c7-5cf1b2db4ae4&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3313,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;title&quot;:&quot;Do Transaction API Check (POST) - Type: 1004&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/topUp/topup.test.js&quot;,&quot;file&quot;:&quot;/src/topUp/topup.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1004\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 \&quot;before each\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1004\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const senderIdentifier = sender?.identifier;\nconst receiverIdentifier = receiver?.identifier;\nconst senderAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: senderIdentifier },\n});\nconst receiverAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: receiverIdentifier },\n});\ncreatedType = await prismaAccounting.transactionType.findMany({\n  where: { transactionCode: transactionTypeCode },\n});\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  await database[0].deleteMany({});\n}\nif (!redisClient.isOpen) {\n  await redisClient.connect();\n}\nawait redisClient.FLUSHALL();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c26facf8-0f71-4cd4-aa8a-2dc80695f516&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1004\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 \&quot;after all\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1004\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6d29a7f0-46b3-44b0-b947-7f874c32eda1&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 if sender&#x27;s account balance is less than the transaction amount&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if sender&#x27;s account balance is less than the transaction amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\n      await prismaAccounting.transaction.deleteMany({});\n      userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      });\n      if (transactionTypeCode === &#x27;1001&#x27;) { return; }\n      const verifiedPinToken = generateVerifyPinToken(transactionTypeCode, userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedPinToken);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        await database[0].deleteMany({});\n      }\n      const res = await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(token)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBody,\n          verifiedPinToken: verifiedPinToken\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        const transactionsFromDB = await prismaAccounting.transaction.findMany({\n          where: { referenceNo: apiTable.referenceNumber },\n        });\n        expect(transactionsFromDB).to.be.empty;\n        const ledgerEntries = await prismaAccounting.ledger.findMany({\n          where: { transactionId: transactionsFromDB.id },\n        });\n        expect(ledgerEntries).to.be.empty;\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;PrismaClientKnownRequestError: \nInvalid `prisma.transaction.deleteMany()` invocation:\n\n\nForeign key constraint violated: `transactionId`&quot;,&quot;estack&quot;:&quot;PrismaClientKnownRequestError: \nInvalid `prisma.transaction.deleteMany()` invocation:\n\n\nForeign key constraint violated: `transactionId`\n    at qn.handleRequestError (prisma/generated/accounting/generated/accounting/runtime/library.js:121:7315)\n    at qn.handleAndLogRequestError (prisma/generated/accounting/generated/accounting/runtime/library.js:121:6640)\n    at qn.request (prisma/generated/accounting/generated/accounting/runtime/library.js:121:6347)\n    at async l (prisma/generated/accounting/generated/accounting/runtime/library.js:130:9616)\n    at async Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:66:7)&quot;},&quot;uuid&quot;:&quot;c29309d7-0fa5-42da-8c5b-5f1dd78c68e5&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the sender&#x27;s status is anything but FULL_ACTIVE&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the sender&#x27;s status is anything but FULL_ACTIVE&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: \&quot;01317577238\&quot;,\n        },\n      });\n      const accountingUser = await prismaAccounting.userAccount.findFirst({\n        where: {\n          identifier: \&quot;01317577238\&quot;,\n        },\n      });\n      const onholdUserToken = generateUserToken(userId.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\n      const onholdUserTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, onholdUserTokenPin);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      if (transactionTypeCode != &#x27;1001&#x27;) {\n        await addInitialBalance(accountingUser, 500000);\n      }\n      await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(onholdUserToken)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBody,\n          verifiedPinToken: onholdUserTokenPin\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        // const transactionsFromDB = await prismaAccounting.transaction.findMany({\n        //   where: { referenceNo: apiTable.referenceNumber },\n        // });\n        // expect(transactionsFromDB).to.have.lengthOf(2);\n        // const ledgerEntries = await prismaAccounting.ledger.findMany({\n        //   where: { transactionId: transactionsFromDB[0].id },\n        // });\n        // expect(ledgerEntries).to.have.lengthOf(2);\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;3a6b3ddf-8700-44c7-a637-a3892cf02aa5&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the balance after transaction amount is less than min Wallet Amount of sender account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the balance after transaction amount is less than min Wallet Amount of sender account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:26,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      });\n      if (transactionTypeCode != &#x27;1001&#x27;) {\n        await addInitialBalance(sender, 1000000);\n      }\n      const verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(token)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBodyForMinWalleAmount,\n          verifiedPinToken: verifiedTokenPin\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        const transactionsFromDB = await prismaAccounting.transaction.findMany({\n          where: { referenceNo: apiTable.referenceNumber },\n        });\n        if (transactionTypeCode != &#x27;1001&#x27;) {\n          // expect(transactionsFromDB).to.have.lengthOf(2);\n          // const ledgerEntries = await prismaAccounting.ledger.findMany({\n          //   where: { transactionId: transactionsFromDB[0].id },\n          // });\n          // expect(ledgerEntries).to.have.lengthOf(2);\n          // const ledgerEntries1 = await prismaAccounting.ledger.findMany({\n          //   where: { transactionId: transactionsFromDB[1].id },\n          // });\n          // expect(ledgerEntries1).to.have.lengthOf(2);\n        }\n        else {\n          expect(transactionsFromDB).to.be.empty;\n        }\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;4f9822a1-2937-4978-974f-1fb39cbe5e40&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the balance after transaction is greater than max Wallet Amount of receiver account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the balance after transaction is greater than max Wallet Amount of receiver account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const maxWalletUser = await prismaAuth.appUser.findUnique({\n  where: { phone: \&quot;01317577210\&quot; }\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01317577210\&quot;,\n  },\n});\nconst maxWalletUserToken = generateUserToken(maxWalletUser.id, \&quot;01317577210\&quot;, \&quot;USER\&quot;);\nif (transactionTypeCode != &#x27;1001&#x27;) {\n  await addInitialBalance(accountingUser, 500000);\n  await addInitialBalance(receiver, 500);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, maxWalletUser.id, maxWalletUser.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(maxWalletUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForMaxWalleAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: \&quot;01317577210\&quot;,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 400\n\n500 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 400\n\n500 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 400\n&quot;},&quot;uuid&quot;:&quot;e3299511-67da-4af9-bde4-f1011e7cc9df&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily count is greater than daily limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the daily count is greater than daily limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:391,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nawait addInitialBalance(sender, 500000);\n\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170025\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170025\&quot;,\n  },\n});\nconst dailyLimitCountUser = generateUserToken(userId.id, \&quot;01715170025\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nconst dailyLimitCount = accountingUser.dailyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(dailyLimitCountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 400\n\n500 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 400\n\n500 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 400\n&quot;},&quot;uuid&quot;:&quot;d5018adc-3b23-402f-9c8d-108cf93417cc&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction amount is greater than daily limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the daily transaction amount is greater than daily limit amount of the source account&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:2000,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170020\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170020\&quot;,\n  },\n});\nconst dailyLimitAmountUser = generateUserToken(userId.id, \&quot;01715170020\&quot;, \&quot;USER\&quot;);\nif (transactionTypeCode != &#x27;1001&#x27;) {\n  await addInitialBalance(accountingUser, 500000);\n}\nconst dailyLimitAmount = accountingUser.dailyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; dailyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(dailyLimitAmountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForDailyLimitAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;cb22118d-e4d7-48fb-b301-2da77560c1a5&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly count is greater than maximum monthly limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the monthly count is greater than maximum monthly limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:424,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nawait addInitialBalance(sender, 500000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170021\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170021\&quot;,\n  },\n});\nconst monthlyLimitCountCountUser = generateUserToken(userId.id, \&quot;01715170021\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst monthlyLimitCount = accountingUser.monthlyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; monthlyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(monthlyLimitCountCountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedPinToken: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;5bbfda74-4e24-47cc-a67e-024972407d46&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly transaction amount is greater than monthly limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the monthly transaction amount is greater than monthly limit amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8873,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170021\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170021\&quot;,\n  },\n});\nconst monthlyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170021\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst monthlyLimitAmount = accountingUser.monthlyLimitAmount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; monthlyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(monthlyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedPinToken: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;bb6db151-e428-40d7-9c89-2ee56644f63c&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly count is greater than maximum weekly limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the weekly count is greater than maximum weekly limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6944,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170105\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170105\&quot;,\n  },\n});\nconst weeklyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170105\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst weeklyLimitAmount = accountingUser.weeklyLimitAmount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; weeklyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(weeklyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 400\n\n500 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 400\n\n500 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 400\n&quot;},&quot;uuid&quot;:&quot;e728ccea-648f-4815-9c0e-15c82bf2265a&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction amount is greater than weekly limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the weekly transaction amount is greater than weekly limit amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:112,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170105\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170105\&quot;,\n  },\n});\nconst weeklyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170105\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst weeklyLimitCount = accountingUser.weeklyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; weeklyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(weeklyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 400\n\n500 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 400\n\n500 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 400\n&quot;},&quot;uuid&quot;:&quot;43ec4ced-c0f5-4016-8147-be2d3a42a191&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the transaction amount is less than transaction type min amount&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the transaction amount is less than transaction type min amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01915170011\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01915170011\&quot;,\n  },\n});\nconst transactionTypeMinUserToken = generateUserToken(userId.id, \&quot;01915170011\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(transactionTypeMinUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForTypeMinAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 400\n\n500 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 400\n\n500 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 400\n&quot;},&quot;uuid&quot;:&quot;6a4096fe-038e-4ba5-8e43-ee491df12411&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the transaction amount is greater than transaction type max amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the transaction amount is greater than transaction type max amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:20,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01915170011\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01915170011\&quot;,\n  },\n});\nconst transactionTypeMinUserToken = generateUserToken(userId.id, \&quot;01915170011\&quot;, \&quot;USER\&quot;);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait addInitialBalance(accountingUser, 1000000);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(transactionTypeMinUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForTypeMaxAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 400\n\n500 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 400\n\n500 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 400\n&quot;},&quot;uuid&quot;:&quot;61176b9e-e536-4656-b3d5-672536a94c95&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction amount is greater than daily limit amount of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the daily transaction amount is greater than daily limit amount of the transaction type&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:1999,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, dailyLimitAmount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst dailyLimitCount = Number(typeId.dailyLimitAmount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;949074c2-3f19-49c7-ba0e-9fe93f054b64&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction count is greater than daily limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the daily transaction count is greater than daily limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:279,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, dailyLimitCount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 5000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst dailyLimitCount = Number(typeId.dailyLimitCount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 400\n\n500 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 400\n\n500 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 400\n&quot;},&quot;uuid&quot;:&quot;824e8a19-81d8-45ef-a642-0abac5130259&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction amount is greater than weekly limit amount of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the weekly transaction amount is greater than weekly limit amount of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:532,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, weeklyLimitAmount: true },\n  }),\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst weeklyLimitAmountType = Number(typeId.weeklyLimitAmount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; weeklyLimitAmountType / 100; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 400\n\n500 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 400\n\n500 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 400\n&quot;},&quot;uuid&quot;:&quot;cefc00b3-d8b1-408d-a7fd-c1fbdbd2a8f9&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction count is greater than weekly limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the weekly transaction count is greater than weekly limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:161,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, weeklyLimitCount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst weeklyLimitCountType = Number(typeId.weeklyLimitCount);\nconst batchSize = 5;\nfor (let i = 0; i &lt; weeklyLimitCountType; i += batchSize) {\n  const batchPromises = [];\n  const end = Math.min(i + batchSize, weeklyLimitCountType);\n  for (let j = i; j &lt; end; j++) {\n    const promise = prismaAccounting.transaction.create({\n      data: {\n        fromAccountId: (await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })).id,\n        toAccountId: (await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })).id,\n        transactionTypeId: typeId.id,\n        amount: 100,\n        referenceNo: `Transaction ${j + 1}`,\n        note: `Test transaction ${j + 1}`,\n      },\n    }).then(async transaction =&gt; {\n      return Promise.all([\n        prismaAccounting.ledger.create({\n          data: {\n            accountId: (await prismaAccounting.userAccount.findUnique({\n              where: { identifier: sender.identifier },\n            })).id,\n            transactionId: transaction.id,\n            amount: 100,\n            description: `Ledger entry for transaction ${j + 1}`,\n            type: \&quot;DEBIT\&quot;,\n          },\n        }),\n        prismaAccounting.ledger.create({\n          data: {\n            accountId: (await prismaAccounting.userAccount.findUnique({\n              where: { identifier: receiver.identifier },\n            })).id,\n            transactionId: transaction.id,\n            amount: 100,\n            description: `Ledger entry for transaction ${j + 1}`,\n            type: \&quot;CREDIT\&quot;,\n          },\n        })\n      ]);\n    });\n    batchPromises.push(promise);\n  }\n  await Promise.all(batchPromises);\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const senderUser = await prismaAuth.appUser.findFirst({\n    where: { phone: sender.identifier },\n    select: { id: true }\n  });\n  const [apiTable] = await  database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  expect(apiTable.status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 400\n\n500 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 400\n\n500 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 400\n&quot;},&quot;uuid&quot;:&quot;a77e00b6-323a-4732-a5f7-a0694a501d59&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly transaction count is greater than monthly limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1004 should return 400 if the monthly transaction count is greater than monthly limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:415,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n  })\n]);\nconst monthlyLimitCountType = Number(typeId.monthlyLimitCount);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nfor (let i = 0; i &lt; monthlyLimitCountType; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 500 !== 400\n\n500 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 500 !== 400\n\n500 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 500\n+ 400\n&quot;},&quot;uuid&quot;:&quot;a795d3d0-fb47-4fe2-bc86-8dc914fa9717&quot;,&quot;parentUUID&quot;:&quot;439f151f-bd68-4466-bcc5-e7ee288bdde8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;c29309d7-0fa5-42da-8c5b-5f1dd78c68e5&quot;,&quot;3a6b3ddf-8700-44c7-a637-a3892cf02aa5&quot;,&quot;4f9822a1-2937-4978-974f-1fb39cbe5e40&quot;,&quot;e3299511-67da-4af9-bde4-f1011e7cc9df&quot;,&quot;d5018adc-3b23-402f-9c8d-108cf93417cc&quot;,&quot;cb22118d-e4d7-48fb-b301-2da77560c1a5&quot;,&quot;5bbfda74-4e24-47cc-a67e-024972407d46&quot;,&quot;bb6db151-e428-40d7-9c89-2ee56644f63c&quot;,&quot;e728ccea-648f-4815-9c0e-15c82bf2265a&quot;,&quot;43ec4ced-c0f5-4016-8147-be2d3a42a191&quot;,&quot;6a4096fe-038e-4ba5-8e43-ee491df12411&quot;,&quot;61176b9e-e536-4656-b3d5-672536a94c95&quot;,&quot;949074c2-3f19-49c7-ba0e-9fe93f054b64&quot;,&quot;824e8a19-81d8-45ef-a642-0abac5130259&quot;,&quot;cefc00b3-d8b1-408d-a7fd-c1fbdbd2a8f9&quot;,&quot;a77e00b6-323a-4732-a5f7-a0694a501d59&quot;,&quot;a795d3d0-fb47-4fe2-bc86-8dc914fa9717&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22328,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;title&quot;:&quot;Do Transaction API Check (POST) - Type: 1003&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/topUp/topup.test.js&quot;,&quot;file&quot;:&quot;/src/topUp/topup.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1003\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 \&quot;before each\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1003\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const senderIdentifier = sender?.identifier;\nconst receiverIdentifier = receiver?.identifier;\nconst senderAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: senderIdentifier },\n});\nconst receiverAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: receiverIdentifier },\n});\ncreatedType = await prismaAccounting.transactionType.findMany({\n  where: { transactionCode: transactionTypeCode },\n});\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  await database[0].deleteMany({});\n}\nif (!redisClient.isOpen) {\n  await redisClient.connect();\n}\nawait redisClient.FLUSHALL();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;921938bc-fc2f-4309-b08e-8998b2487e2d&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1003\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 \&quot;after all\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1003\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:23,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;25a2da8c-8530-431e-afdc-5083c835a004&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 if sender&#x27;s account balance is less than the transaction amount&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if sender&#x27;s account balance is less than the transaction amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:220,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\n      await prismaAccounting.transaction.deleteMany({});\n      userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      });\n      if (transactionTypeCode === &#x27;1001&#x27;) { return; }\n      const verifiedPinToken = generateVerifyPinToken(transactionTypeCode, userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedPinToken);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        await database[0].deleteMany({});\n      }\n      const res = await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(token)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBody,\n          verifiedPinToken: verifiedPinToken\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        const transactionsFromDB = await prismaAccounting.transaction.findMany({\n          where: { referenceNo: apiTable.referenceNumber },\n        });\n        expect(transactionsFromDB).to.be.empty;\n        const ledgerEntries = await prismaAccounting.ledger.findMany({\n          where: { transactionId: transactionsFromDB.id },\n        });\n        expect(ledgerEntries).to.be.empty;\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;PrismaClientKnownRequestError: \nInvalid `prisma.transaction.deleteMany()` invocation:\n\n\nForeign key constraint violated: `transactionId`&quot;,&quot;estack&quot;:&quot;PrismaClientKnownRequestError: \nInvalid `prisma.transaction.deleteMany()` invocation:\n\n\nForeign key constraint violated: `transactionId`\n    at qn.handleRequestError (prisma/generated/accounting/generated/accounting/runtime/library.js:121:7315)\n    at qn.handleAndLogRequestError (prisma/generated/accounting/generated/accounting/runtime/library.js:121:6640)\n    at qn.request (prisma/generated/accounting/generated/accounting/runtime/library.js:121:6347)\n    at async l (prisma/generated/accounting/generated/accounting/runtime/library.js:130:9616)\n    at async Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:66:7)&quot;},&quot;uuid&quot;:&quot;fdf1581a-efb1-46ae-b2c3-33e4be1d3697&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the sender&#x27;s status is anything but FULL_ACTIVE&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the sender&#x27;s status is anything but FULL_ACTIVE&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: \&quot;01317577238\&quot;,\n        },\n      });\n      const accountingUser = await prismaAccounting.userAccount.findFirst({\n        where: {\n          identifier: \&quot;01317577238\&quot;,\n        },\n      });\n      const onholdUserToken = generateUserToken(userId.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\n      const onholdUserTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, onholdUserTokenPin);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      if (transactionTypeCode != &#x27;1001&#x27;) {\n        await addInitialBalance(accountingUser, 500000);\n      }\n      await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(onholdUserToken)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBody,\n          verifiedPinToken: onholdUserTokenPin\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        // const transactionsFromDB = await prismaAccounting.transaction.findMany({\n        //   where: { referenceNo: apiTable.referenceNumber },\n        // });\n        // expect(transactionsFromDB).to.have.lengthOf(2);\n        // const ledgerEntries = await prismaAccounting.ledger.findMany({\n        //   where: { transactionId: transactionsFromDB[0].id },\n        // });\n        // expect(ledgerEntries).to.have.lengthOf(2);\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;8c26d945-a211-4d79-807f-7fd9163b7b4e&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the balance after transaction amount is less than min Wallet Amount of sender account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the balance after transaction amount is less than min Wallet Amount of sender account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:28,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      });\n      if (transactionTypeCode != &#x27;1001&#x27;) {\n        await addInitialBalance(sender, 1000000);\n      }\n      const verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(token)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBodyForMinWalleAmount,\n          verifiedPinToken: verifiedTokenPin\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        const transactionsFromDB = await prismaAccounting.transaction.findMany({\n          where: { referenceNo: apiTable.referenceNumber },\n        });\n        if (transactionTypeCode != &#x27;1001&#x27;) {\n          // expect(transactionsFromDB).to.have.lengthOf(2);\n          // const ledgerEntries = await prismaAccounting.ledger.findMany({\n          //   where: { transactionId: transactionsFromDB[0].id },\n          // });\n          // expect(ledgerEntries).to.have.lengthOf(2);\n          // const ledgerEntries1 = await prismaAccounting.ledger.findMany({\n          //   where: { transactionId: transactionsFromDB[1].id },\n          // });\n          // expect(ledgerEntries1).to.have.lengthOf(2);\n        }\n        else {\n          expect(transactionsFromDB).to.be.empty;\n        }\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;10149a76-b840-4843-9ead-4070025fb0bb&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the balance after transaction is greater than max Wallet Amount of receiver account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the balance after transaction is greater than max Wallet Amount of receiver account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const maxWalletUser = await prismaAuth.appUser.findUnique({\n  where: { phone: \&quot;01317577210\&quot; }\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01317577210\&quot;,\n  },\n});\nconst maxWalletUserToken = generateUserToken(maxWalletUser.id, \&quot;01317577210\&quot;, \&quot;USER\&quot;);\nif (transactionTypeCode != &#x27;1001&#x27;) {\n  await addInitialBalance(accountingUser, 500000);\n  await addInitialBalance(receiver, 500);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, maxWalletUser.id, maxWalletUser.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(maxWalletUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForMaxWalleAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: \&quot;01317577210\&quot;,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:293:28)&quot;},&quot;uuid&quot;:&quot;06408a6f-6d0e-4999-851e-4cde3e24d162&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily count is greater than daily limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the daily count is greater than daily limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:303,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nawait addInitialBalance(sender, 500000);\n\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170025\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170025\&quot;,\n  },\n});\nconst dailyLimitCountUser = generateUserToken(userId.id, \&quot;01715170025\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nconst dailyLimitCount = accountingUser.dailyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(dailyLimitCountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:395:28)&quot;},&quot;uuid&quot;:&quot;59e171d1-e7b9-4a48-b1e6-93acf6f5d32b&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction amount is greater than daily limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the daily transaction amount is greater than daily limit amount of the source account&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:2001,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170020\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170020\&quot;,\n  },\n});\nconst dailyLimitAmountUser = generateUserToken(userId.id, \&quot;01715170020\&quot;, \&quot;USER\&quot;);\nif (transactionTypeCode != &#x27;1001&#x27;) {\n  await addInitialBalance(accountingUser, 500000);\n}\nconst dailyLimitAmount = accountingUser.dailyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; dailyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(dailyLimitAmountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForDailyLimitAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;fb6d4bf7-2838-4f07-b084-0504684b0786&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly count is greater than maximum monthly limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the monthly count is greater than maximum monthly limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:353,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nawait addInitialBalance(sender, 500000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170021\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170021\&quot;,\n  },\n});\nconst monthlyLimitCountCountUser = generateUserToken(userId.id, \&quot;01715170021\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst monthlyLimitCount = accountingUser.monthlyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; monthlyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(monthlyLimitCountCountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedPinToken: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;16202cbe-ccf4-4436-9018-29fa83742786&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly transaction amount is greater than monthly limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the monthly transaction amount is greater than monthly limit amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6638,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170021\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170021\&quot;,\n  },\n});\nconst monthlyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170021\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst monthlyLimitAmount = accountingUser.monthlyLimitAmount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; monthlyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(monthlyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedPinToken: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;72f83479-2a16-407f-b4a3-7e638d47f5b8&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly count is greater than maximum weekly limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the weekly count is greater than maximum weekly limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6668,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170105\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170105\&quot;,\n  },\n});\nconst weeklyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170105\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst weeklyLimitAmount = accountingUser.weeklyLimitAmount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; weeklyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(weeklyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:786:28)&quot;},&quot;uuid&quot;:&quot;1123e112-0c46-473c-b2ef-681cb431522b&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction amount is greater than weekly limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the weekly transaction amount is greater than weekly limit amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:153,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170105\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170105\&quot;,\n  },\n});\nconst weeklyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170105\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst weeklyLimitCount = accountingUser.weeklyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; weeklyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(weeklyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:880:28)&quot;},&quot;uuid&quot;:&quot;8d0e87db-0997-41d3-8984-4a76fd170dc2&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the transaction amount is less than transaction type min amount&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the transaction amount is less than transaction type min amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01915170011\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01915170011\&quot;,\n  },\n});\nconst transactionTypeMinUserToken = generateUserToken(userId.id, \&quot;01915170011\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(transactionTypeMinUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForTypeMinAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:926:28)&quot;},&quot;uuid&quot;:&quot;02362709-bdd0-48f9-8760-4a7fa25937a9&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the transaction amount is greater than transaction type max amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the transaction amount is greater than transaction type max amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01915170011\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01915170011\&quot;,\n  },\n});\nconst transactionTypeMinUserToken = generateUserToken(userId.id, \&quot;01915170011\&quot;, \&quot;USER\&quot;);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait addInitialBalance(accountingUser, 1000000);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(transactionTypeMinUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForTypeMaxAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:972:28)&quot;},&quot;uuid&quot;:&quot;f4393577-dd4a-426f-b2b1-774410840bd3&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction amount is greater than daily limit amount of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the daily transaction amount is greater than daily limit amount of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:686,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, dailyLimitAmount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst dailyLimitCount = Number(typeId.dailyLimitAmount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:1074:28)&quot;},&quot;uuid&quot;:&quot;21650ce3-c91b-4ce5-8ba4-6532fed76da6&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction count is greater than daily limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the daily transaction count is greater than daily limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:276,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, dailyLimitCount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 5000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst dailyLimitCount = Number(typeId.dailyLimitCount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:1175:28)&quot;},&quot;uuid&quot;:&quot;2e46c119-86a5-4f7d-b5cd-9b908e1dcddb&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction amount is greater than weekly limit amount of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the weekly transaction amount is greater than weekly limit amount of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, weeklyLimitAmount: true },\n  }),\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst weeklyLimitAmountType = Number(typeId.weeklyLimitAmount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; weeklyLimitAmountType / 100; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:1277:28)&quot;},&quot;uuid&quot;:&quot;73fd1d12-eafa-41b4-9f3c-5c97326c49aa&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction count is greater than weekly limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the weekly transaction count is greater than weekly limit count of the transaction type&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:1999,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, weeklyLimitCount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst weeklyLimitCountType = Number(typeId.weeklyLimitCount);\nconst batchSize = 5;\nfor (let i = 0; i &lt; weeklyLimitCountType; i += batchSize) {\n  const batchPromises = [];\n  const end = Math.min(i + batchSize, weeklyLimitCountType);\n  for (let j = i; j &lt; end; j++) {\n    const promise = prismaAccounting.transaction.create({\n      data: {\n        fromAccountId: (await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })).id,\n        toAccountId: (await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })).id,\n        transactionTypeId: typeId.id,\n        amount: 100,\n        referenceNo: `Transaction ${j + 1}`,\n        note: `Test transaction ${j + 1}`,\n      },\n    }).then(async transaction =&gt; {\n      return Promise.all([\n        prismaAccounting.ledger.create({\n          data: {\n            accountId: (await prismaAccounting.userAccount.findUnique({\n              where: { identifier: sender.identifier },\n            })).id,\n            transactionId: transaction.id,\n            amount: 100,\n            description: `Ledger entry for transaction ${j + 1}`,\n            type: \&quot;DEBIT\&quot;,\n          },\n        }),\n        prismaAccounting.ledger.create({\n          data: {\n            accountId: (await prismaAccounting.userAccount.findUnique({\n              where: { identifier: receiver.identifier },\n            })).id,\n            transactionId: transaction.id,\n            amount: 100,\n            description: `Ledger entry for transaction ${j + 1}`,\n            type: \&quot;CREDIT\&quot;,\n          },\n        })\n      ]);\n    });\n    batchPromises.push(promise);\n  }\n  await Promise.all(batchPromises);\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const senderUser = await prismaAuth.appUser.findFirst({\n    where: { phone: sender.identifier },\n    select: { id: true }\n  });\n  const [apiTable] = await  database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  expect(apiTable.status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;08d4413f-055f-4913-a5a6-6965edf06a23&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly transaction count is greater than monthly limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1003 should return 400 if the monthly transaction count is greater than monthly limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:407,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n  })\n]);\nconst monthlyLimitCountType = Number(typeId.monthlyLimitCount);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nfor (let i = 0; i &lt; monthlyLimitCountType; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)&quot;,&quot;estack&quot;:&quot;TypeError: Cannot read properties of undefined (reading &#x27;status&#x27;)\n    at Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:1477:28)&quot;},&quot;uuid&quot;:&quot;d57cb290-a1b4-469f-9cb3-66d854a5452b&quot;,&quot;parentUUID&quot;:&quot;98a54949-54e6-4eb9-ad7d-6256f45001c6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;fdf1581a-efb1-46ae-b2c3-33e4be1d3697&quot;,&quot;8c26d945-a211-4d79-807f-7fd9163b7b4e&quot;,&quot;10149a76-b840-4843-9ead-4070025fb0bb&quot;,&quot;06408a6f-6d0e-4999-851e-4cde3e24d162&quot;,&quot;59e171d1-e7b9-4a48-b1e6-93acf6f5d32b&quot;,&quot;fb6d4bf7-2838-4f07-b084-0504684b0786&quot;,&quot;16202cbe-ccf4-4436-9018-29fa83742786&quot;,&quot;72f83479-2a16-407f-b4a3-7e638d47f5b8&quot;,&quot;1123e112-0c46-473c-b2ef-681cb431522b&quot;,&quot;8d0e87db-0997-41d3-8984-4a76fd170dc2&quot;,&quot;02362709-bdd0-48f9-8760-4a7fa25937a9&quot;,&quot;f4393577-dd4a-426f-b2b1-774410840bd3&quot;,&quot;21650ce3-c91b-4ce5-8ba4-6532fed76da6&quot;,&quot;2e46c119-86a5-4f7d-b5cd-9b908e1dcddb&quot;,&quot;73fd1d12-eafa-41b4-9f3c-5c97326c49aa&quot;,&quot;08d4413f-055f-4913-a5a6-6965edf06a23&quot;,&quot;d57cb290-a1b4-469f-9cb3-66d854a5452b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:19886,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;title&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/topUp/topup.test.js&quot;,&quot;file&quot;:&quot;/src/topUp/topup.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: make-payment-001\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 \&quot;before each\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: make-payment-001\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const senderIdentifier = sender?.identifier;\nconst receiverIdentifier = receiver?.identifier;\nconst senderAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: senderIdentifier },\n});\nconst receiverAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: receiverIdentifier },\n});\ncreatedType = await prismaAccounting.transactionType.findMany({\n  where: { transactionCode: transactionTypeCode },\n});\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  await database[0].deleteMany({});\n}\nif (!redisClient.isOpen) {\n  await redisClient.connect();\n}\nawait redisClient.FLUSHALL();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;09ef82ab-b00f-438c-913f-f4e3554c0fc4&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: make-payment-001\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 \&quot;after all\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: make-payment-001\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b479107b-0e6d-4d5d-b78e-0e4a3747bcd2&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 if sender&#x27;s account balance is less than the transaction amount&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if sender&#x27;s account balance is less than the transaction amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:292,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\n      await prismaAccounting.transaction.deleteMany({});\n      userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      });\n      if (transactionTypeCode === &#x27;1001&#x27;) { return; }\n      const verifiedPinToken = generateVerifyPinToken(transactionTypeCode, userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedPinToken);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        await database[0].deleteMany({});\n      }\n      const res = await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(token)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBody,\n          verifiedPinToken: verifiedPinToken\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        const transactionsFromDB = await prismaAccounting.transaction.findMany({\n          where: { referenceNo: apiTable.referenceNumber },\n        });\n        expect(transactionsFromDB).to.be.empty;\n        const ledgerEntries = await prismaAccounting.ledger.findMany({\n          where: { transactionId: transactionsFromDB.id },\n        });\n        expect(ledgerEntries).to.be.empty;\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;PrismaClientKnownRequestError: \nInvalid `prisma.transaction.deleteMany()` invocation:\n\n\nForeign key constraint violated: `transactionId`&quot;,&quot;estack&quot;:&quot;PrismaClientKnownRequestError: \nInvalid `prisma.transaction.deleteMany()` invocation:\n\n\nForeign key constraint violated: `transactionId`\n    at qn.handleRequestError (prisma/generated/accounting/generated/accounting/runtime/library.js:121:7315)\n    at qn.handleAndLogRequestError (prisma/generated/accounting/generated/accounting/runtime/library.js:121:6640)\n    at qn.request (prisma/generated/accounting/generated/accounting/runtime/library.js:121:6347)\n    at async l (prisma/generated/accounting/generated/accounting/runtime/library.js:130:9616)\n    at async Context.&lt;anonymous&gt; (file:///opt/app/src/utils/doTransaction.js:66:7)&quot;},&quot;uuid&quot;:&quot;cf638cb6-c6bc-408c-962c-784f2c4939a2&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the sender&#x27;s status is anything but FULL_ACTIVE&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the sender&#x27;s status is anything but FULL_ACTIVE&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:38,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: \&quot;01317577238\&quot;,\n        },\n      });\n      const accountingUser = await prismaAccounting.userAccount.findFirst({\n        where: {\n          identifier: \&quot;01317577238\&quot;,\n        },\n      });\n      const onholdUserToken = generateUserToken(userId.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\n      const onholdUserTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, onholdUserTokenPin);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      if (transactionTypeCode != &#x27;1001&#x27;) {\n        await addInitialBalance(accountingUser, 500000);\n      }\n      await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(onholdUserToken)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBody,\n          verifiedPinToken: onholdUserTokenPin\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        // const transactionsFromDB = await prismaAccounting.transaction.findMany({\n        //   where: { referenceNo: apiTable.referenceNumber },\n        // });\n        // expect(transactionsFromDB).to.have.lengthOf(2);\n        // const ledgerEntries = await prismaAccounting.ledger.findMany({\n        //   where: { transactionId: transactionsFromDB[0].id },\n        // });\n        // expect(ledgerEntries).to.have.lengthOf(2);\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;a6d0eedc-196c-4b4f-8367-e4f1d52c7fc4&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the balance after transaction amount is less than min Wallet Amount of sender account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the balance after transaction amount is less than min Wallet Amount of sender account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:29,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      });\n      if (transactionTypeCode != &#x27;1001&#x27;) {\n        await addInitialBalance(sender, 1000000);\n      }\n      const verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(token)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBodyForMinWalleAmount,\n          verifiedPinToken: verifiedTokenPin\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        const transactionsFromDB = await prismaAccounting.transaction.findMany({\n          where: { referenceNo: apiTable.referenceNumber },\n        });\n        if (transactionTypeCode != &#x27;1001&#x27;) {\n          // expect(transactionsFromDB).to.have.lengthOf(2);\n          // const ledgerEntries = await prismaAccounting.ledger.findMany({\n          //   where: { transactionId: transactionsFromDB[0].id },\n          // });\n          // expect(ledgerEntries).to.have.lengthOf(2);\n          // const ledgerEntries1 = await prismaAccounting.ledger.findMany({\n          //   where: { transactionId: transactionsFromDB[1].id },\n          // });\n          // expect(ledgerEntries1).to.have.lengthOf(2);\n        }\n        else {\n          expect(transactionsFromDB).to.be.empty;\n        }\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;0602e837-0171-4117-b167-d90a157f27fe&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the balance after transaction is greater than max Wallet Amount of receiver account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the balance after transaction is greater than max Wallet Amount of receiver account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:112,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const maxWalletUser = await prismaAuth.appUser.findUnique({\n  where: { phone: \&quot;01317577210\&quot; }\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01317577210\&quot;,\n  },\n});\nconst maxWalletUserToken = generateUserToken(maxWalletUser.id, \&quot;01317577210\&quot;, \&quot;USER\&quot;);\nif (transactionTypeCode != &#x27;1001&#x27;) {\n  await addInitialBalance(accountingUser, 500000);\n  await addInitialBalance(receiver, 500);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, maxWalletUser.id, maxWalletUser.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(maxWalletUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForMaxWalleAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: \&quot;01317577210\&quot;,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7a1de767-e4bb-4aea-9a1b-ed6f166f855a&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily count is greater than daily limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the daily count is greater than daily limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:486,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nawait addInitialBalance(sender, 500000);\n\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170025\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170025\&quot;,\n  },\n});\nconst dailyLimitCountUser = generateUserToken(userId.id, \&quot;01715170025\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nconst dailyLimitCount = accountingUser.dailyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(dailyLimitCountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6afe5d14-4bb7-4444-9a6b-348d01862e8d&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction amount is greater than daily limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the daily transaction amount is greater than daily limit amount of the source account&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:2000,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170020\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170020\&quot;,\n  },\n});\nconst dailyLimitAmountUser = generateUserToken(userId.id, \&quot;01715170020\&quot;, \&quot;USER\&quot;);\nif (transactionTypeCode != &#x27;1001&#x27;) {\n  await addInitialBalance(accountingUser, 500000);\n}\nconst dailyLimitAmount = accountingUser.dailyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; dailyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(dailyLimitAmountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForDailyLimitAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;6b0a3c27-36ad-42f1-b6cd-bd213dcb9fdd&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly count is greater than maximum monthly limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the monthly count is greater than maximum monthly limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:412,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nawait addInitialBalance(sender, 500000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170021\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170021\&quot;,\n  },\n});\nconst monthlyLimitCountCountUser = generateUserToken(userId.id, \&quot;01715170021\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst monthlyLimitCount = accountingUser.monthlyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; monthlyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(monthlyLimitCountCountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedPinToken: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;fad0063d-a276-4876-a73b-0602d6522d77&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly transaction amount is greater than monthly limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the monthly transaction amount is greater than monthly limit amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9607,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170021\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170021\&quot;,\n  },\n});\nconst monthlyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170021\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst monthlyLimitAmount = accountingUser.monthlyLimitAmount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; monthlyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(monthlyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedPinToken: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;8ac09d16-999e-4430-a2e6-4b91992889ce&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly count is greater than maximum weekly limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the weekly count is greater than maximum weekly limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:19376,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170105\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170105\&quot;,\n  },\n});\nconst weeklyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170105\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst weeklyLimitAmount = accountingUser.weeklyLimitAmount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; weeklyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(weeklyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2a5c2063-66d0-4ad2-bbe4-1d4c1dbcc52c&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction amount is greater than weekly limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the weekly transaction amount is greater than weekly limit amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:342,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170105\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170105\&quot;,\n  },\n});\nconst weeklyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170105\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst weeklyLimitCount = accountingUser.weeklyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; weeklyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(weeklyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;37b7b821-6f78-46f6-b2a5-71230ca7b857&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the transaction amount is less than transaction type min amount&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the transaction amount is less than transaction type min amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:76,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01915170011\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01915170011\&quot;,\n  },\n});\nconst transactionTypeMinUserToken = generateUserToken(userId.id, \&quot;01915170011\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(transactionTypeMinUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForTypeMinAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0abb7810-671d-463b-bf7c-d2f116dc47ef&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the transaction amount is greater than transaction type max amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the transaction amount is greater than transaction type max amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:83,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01915170011\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01915170011\&quot;,\n  },\n});\nconst transactionTypeMinUserToken = generateUserToken(userId.id, \&quot;01915170011\&quot;, \&quot;USER\&quot;);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait addInitialBalance(accountingUser, 1000000);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(transactionTypeMinUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForTypeMaxAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;189533da-a960-47ce-861f-416049e7a8ba&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction amount is greater than daily limit amount of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the daily transaction amount is greater than daily limit amount of the transaction type&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:2001,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, dailyLimitAmount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst dailyLimitCount = Number(typeId.dailyLimitAmount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;17aef4a0-8ac3-4cbe-ab18-88e8d3a158c4&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction count is greater than daily limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the daily transaction count is greater than daily limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:490,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, dailyLimitCount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 5000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst dailyLimitCount = Number(typeId.dailyLimitCount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;34c9bc51-3812-4772-8126-fb5a4ab381f5&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction amount is greater than weekly limit amount of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the weekly transaction amount is greater than weekly limit amount of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:202,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, weeklyLimitAmount: true },\n  }),\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst weeklyLimitAmountType = Number(typeId.weeklyLimitAmount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; weeklyLimitAmountType / 100; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d49ec67e-e075-4e67-8ed5-35f0286368d4&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction count is greater than weekly limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the weekly transaction count is greater than weekly limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:404,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, weeklyLimitCount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst weeklyLimitCountType = Number(typeId.weeklyLimitCount);\nconst batchSize = 5;\nfor (let i = 0; i &lt; weeklyLimitCountType; i += batchSize) {\n  const batchPromises = [];\n  const end = Math.min(i + batchSize, weeklyLimitCountType);\n  for (let j = i; j &lt; end; j++) {\n    const promise = prismaAccounting.transaction.create({\n      data: {\n        fromAccountId: (await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })).id,\n        toAccountId: (await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })).id,\n        transactionTypeId: typeId.id,\n        amount: 100,\n        referenceNo: `Transaction ${j + 1}`,\n        note: `Test transaction ${j + 1}`,\n      },\n    }).then(async transaction =&gt; {\n      return Promise.all([\n        prismaAccounting.ledger.create({\n          data: {\n            accountId: (await prismaAccounting.userAccount.findUnique({\n              where: { identifier: sender.identifier },\n            })).id,\n            transactionId: transaction.id,\n            amount: 100,\n            description: `Ledger entry for transaction ${j + 1}`,\n            type: \&quot;DEBIT\&quot;,\n          },\n        }),\n        prismaAccounting.ledger.create({\n          data: {\n            accountId: (await prismaAccounting.userAccount.findUnique({\n              where: { identifier: receiver.identifier },\n            })).id,\n            transactionId: transaction.id,\n            amount: 100,\n            description: `Ledger entry for transaction ${j + 1}`,\n            type: \&quot;CREDIT\&quot;,\n          },\n        })\n      ]);\n    });\n    batchPromises.push(promise);\n  }\n  await Promise.all(batchPromises);\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const senderUser = await prismaAuth.appUser.findFirst({\n    where: { phone: sender.identifier },\n    select: { id: true }\n  });\n  const [apiTable] = await  database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  expect(apiTable.status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;49c5f5bf-4081-4b56-983b-45244e8a3793&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly transaction count is greater than monthly limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: make-payment-001 should return 400 if the monthly transaction count is greater than monthly limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1063,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n  })\n]);\nconst monthlyLimitCountType = Number(typeId.monthlyLimitCount);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nfor (let i = 0; i &lt; monthlyLimitCountType; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;447def6d-020f-4c47-85d3-b4e9723b639e&quot;,&quot;parentUUID&quot;:&quot;ca22f5e8-c6a9-40c6-9546-9c34e4b0b66c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7a1de767-e4bb-4aea-9a1b-ed6f166f855a&quot;,&quot;6afe5d14-4bb7-4444-9a6b-348d01862e8d&quot;,&quot;2a5c2063-66d0-4ad2-bbe4-1d4c1dbcc52c&quot;,&quot;37b7b821-6f78-46f6-b2a5-71230ca7b857&quot;,&quot;0abb7810-671d-463b-bf7c-d2f116dc47ef&quot;,&quot;189533da-a960-47ce-861f-416049e7a8ba&quot;,&quot;34c9bc51-3812-4772-8126-fb5a4ab381f5&quot;,&quot;d49ec67e-e075-4e67-8ed5-35f0286368d4&quot;,&quot;49c5f5bf-4081-4b56-983b-45244e8a3793&quot;,&quot;447def6d-020f-4c47-85d3-b4e9723b639e&quot;],&quot;failures&quot;:[&quot;cf638cb6-c6bc-408c-962c-784f2c4939a2&quot;,&quot;a6d0eedc-196c-4b4f-8367-e4f1d52c7fc4&quot;,&quot;0602e837-0171-4117-b167-d90a157f27fe&quot;,&quot;6b0a3c27-36ad-42f1-b6cd-bd213dcb9fdd&quot;,&quot;fad0063d-a276-4876-a73b-0602d6522d77&quot;,&quot;8ac09d16-999e-4430-a2e6-4b91992889ce&quot;,&quot;17aef4a0-8ac3-4cbe-ab18-88e8d3a158c4&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:37013,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;title&quot;:&quot;Do Transaction API Check (POST) - Type: 1002&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/topUp/topup.test.js&quot;,&quot;file&quot;:&quot;/src/topUp/topup.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1002\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 \&quot;before each\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1002\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const senderIdentifier = sender?.identifier;\nconst receiverIdentifier = receiver?.identifier;\nconst senderAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: senderIdentifier },\n});\nconst receiverAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: receiverIdentifier },\n});\ncreatedType = await prismaAccounting.transactionType.findMany({\n  where: { transactionCode: transactionTypeCode },\n});\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  await database[0].deleteMany({});\n}\nif (!redisClient.isOpen) {\n  await redisClient.connect();\n}\nawait redisClient.FLUSHALL();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;27d155c8-858f-46a0-9de9-ecbc5187a090&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1002\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 \&quot;after all\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1002\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7a26c651-20ba-4e0c-9652-937671b5975c&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 if sender&#x27;s account balance is less than the transaction amount&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if sender&#x27;s account balance is less than the transaction amount&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:2000,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\n      await prismaAccounting.transaction.deleteMany({});\n      userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      });\n      if (transactionTypeCode === &#x27;1001&#x27;) { return; }\n      const verifiedPinToken = generateVerifyPinToken(transactionTypeCode, userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedPinToken);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        await database[0].deleteMany({});\n      }\n      const res = await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(token)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBody,\n          verifiedPinToken: verifiedPinToken\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        const transactionsFromDB = await prismaAccounting.transaction.findMany({\n          where: { referenceNo: apiTable.referenceNumber },\n        });\n        expect(transactionsFromDB).to.be.empty;\n        const ledgerEntries = await prismaAccounting.ledger.findMany({\n          where: { transactionId: transactionsFromDB.id },\n        });\n        expect(ledgerEntries).to.be.empty;\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;5241e1d0-dbd4-40f4-9a21-de4024fc8e39&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the sender&#x27;s status is anything but FULL_ACTIVE&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the sender&#x27;s status is anything but FULL_ACTIVE&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1573,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: \&quot;01317577238\&quot;,\n        },\n      });\n      const accountingUser = await prismaAccounting.userAccount.findFirst({\n        where: {\n          identifier: \&quot;01317577238\&quot;,\n        },\n      });\n      const onholdUserToken = generateUserToken(userId.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\n      const onholdUserTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, onholdUserTokenPin);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      if (transactionTypeCode != &#x27;1001&#x27;) {\n        await addInitialBalance(accountingUser, 500000);\n      }\n      await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(onholdUserToken)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBody,\n          verifiedPinToken: onholdUserTokenPin\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        // const transactionsFromDB = await prismaAccounting.transaction.findMany({\n        //   where: { referenceNo: apiTable.referenceNumber },\n        // });\n        // expect(transactionsFromDB).to.have.lengthOf(2);\n        // const ledgerEntries = await prismaAccounting.ledger.findMany({\n        //   where: { transactionId: transactionsFromDB[0].id },\n        // });\n        // expect(ledgerEntries).to.have.lengthOf(2);\n      }&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ed4cf5b4-9d2e-4533-aac7-c949d18406af&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the balance after transaction amount is less than min Wallet Amount of sender account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the balance after transaction amount is less than min Wallet Amount of sender account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:428,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      });\n      if (transactionTypeCode != &#x27;1001&#x27;) {\n        await addInitialBalance(sender, 1000000);\n      }\n      const verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(token)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBodyForMinWalleAmount,\n          verifiedPinToken: verifiedTokenPin\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        const transactionsFromDB = await prismaAccounting.transaction.findMany({\n          where: { referenceNo: apiTable.referenceNumber },\n        });\n        if (transactionTypeCode != &#x27;1001&#x27;) {\n          // expect(transactionsFromDB).to.have.lengthOf(2);\n          // const ledgerEntries = await prismaAccounting.ledger.findMany({\n          //   where: { transactionId: transactionsFromDB[0].id },\n          // });\n          // expect(ledgerEntries).to.have.lengthOf(2);\n          // const ledgerEntries1 = await prismaAccounting.ledger.findMany({\n          //   where: { transactionId: transactionsFromDB[1].id },\n          // });\n          // expect(ledgerEntries1).to.have.lengthOf(2);\n        }\n        else {\n          expect(transactionsFromDB).to.be.empty;\n        }\n      }&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8a83db4f-ecdb-485c-a835-f6652b3a093d&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the balance after transaction is greater than max Wallet Amount of receiver account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the balance after transaction is greater than max Wallet Amount of receiver account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1203,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const maxWalletUser = await prismaAuth.appUser.findUnique({\n  where: { phone: \&quot;01317577210\&quot; }\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01317577210\&quot;,\n  },\n});\nconst maxWalletUserToken = generateUserToken(maxWalletUser.id, \&quot;01317577210\&quot;, \&quot;USER\&quot;);\nif (transactionTypeCode != &#x27;1001&#x27;) {\n  await addInitialBalance(accountingUser, 500000);\n  await addInitialBalance(receiver, 500);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, maxWalletUser.id, maxWalletUser.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(maxWalletUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForMaxWalleAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: \&quot;01317577210\&quot;,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5d635ffb-e319-4397-abfd-15f8e50875a1&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily count is greater than daily limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the daily count is greater than daily limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4779,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nawait addInitialBalance(sender, 500000);\n\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170025\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170025\&quot;,\n  },\n});\nconst dailyLimitCountUser = generateUserToken(userId.id, \&quot;01715170025\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nconst dailyLimitCount = accountingUser.dailyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(dailyLimitCountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ade2f489-c45e-415c-a034-8b7decbb85c5&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction amount is greater than daily limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the daily transaction amount is greater than daily limit amount of the source account&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:1999,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170020\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170020\&quot;,\n  },\n});\nconst dailyLimitAmountUser = generateUserToken(userId.id, \&quot;01715170020\&quot;, \&quot;USER\&quot;);\nif (transactionTypeCode != &#x27;1001&#x27;) {\n  await addInitialBalance(accountingUser, 500000);\n}\nconst dailyLimitAmount = accountingUser.dailyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; dailyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(dailyLimitAmountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForDailyLimitAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;6b13b59c-2c4f-4d2b-9f07-b505b6e899ef&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly count is greater than maximum monthly limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the monthly count is greater than maximum monthly limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:307,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nawait addInitialBalance(sender, 500000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170021\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170021\&quot;,\n  },\n});\nconst monthlyLimitCountCountUser = generateUserToken(userId.id, \&quot;01715170021\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst monthlyLimitCount = accountingUser.monthlyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; monthlyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(monthlyLimitCountCountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedPinToken: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4a6f7e50-8937-47eb-b8ee-9151e1073c63&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly transaction amount is greater than monthly limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the monthly transaction amount is greater than monthly limit amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6387,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170021\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170021\&quot;,\n  },\n});\nconst monthlyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170021\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst monthlyLimitAmount = accountingUser.monthlyLimitAmount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; monthlyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(monthlyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedPinToken: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;526f30e4-c340-421a-a16c-e094f056ba34&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly count is greater than maximum weekly limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the weekly count is greater than maximum weekly limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5755,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170105\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170105\&quot;,\n  },\n});\nconst weeklyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170105\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst weeklyLimitAmount = accountingUser.weeklyLimitAmount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; weeklyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(weeklyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ca8a383c-1b08-4107-a34a-ae68aaca6372&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction amount is greater than weekly limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the weekly transaction amount is greater than weekly limit amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:173,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170105\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170105\&quot;,\n  },\n});\nconst weeklyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170105\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst weeklyLimitCount = accountingUser.weeklyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; weeklyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(weeklyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;55a266c2-3749-41f0-9214-1965a76b9b5f&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the transaction amount is less than transaction type min amount&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the transaction amount is less than transaction type min amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:50,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01915170011\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01915170011\&quot;,\n  },\n});\nconst transactionTypeMinUserToken = generateUserToken(userId.id, \&quot;01915170011\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(transactionTypeMinUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForTypeMinAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0c3d7c68-e0a8-46c0-95f2-87b96ba319a9&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the transaction amount is greater than transaction type max amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the transaction amount is greater than transaction type max amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:49,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01915170011\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01915170011\&quot;,\n  },\n});\nconst transactionTypeMinUserToken = generateUserToken(userId.id, \&quot;01915170011\&quot;, \&quot;USER\&quot;);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait addInitialBalance(accountingUser, 1000000);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(transactionTypeMinUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForTypeMaxAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b0f5e0d9-e6ed-4aaf-b2af-ad375773c6bb&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction amount is greater than daily limit amount of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the daily transaction amount is greater than daily limit amount of the transaction type&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:2000,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, dailyLimitAmount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst dailyLimitCount = Number(typeId.dailyLimitAmount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;cc244bd0-5718-4a19-8901-c35428c0b00f&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction count is greater than daily limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the daily transaction count is greater than daily limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:230,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, dailyLimitCount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 5000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst dailyLimitCount = Number(typeId.dailyLimitCount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f1715f3e-eba2-48d9-a07c-561db49ff0f9&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction amount is greater than weekly limit amount of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the weekly transaction amount is greater than weekly limit amount of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:125,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, weeklyLimitAmount: true },\n  }),\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst weeklyLimitAmountType = Number(typeId.weeklyLimitAmount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; weeklyLimitAmountType / 100; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0b58b3e2-b3d5-4318-9339-7b6681cb9adc&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction count is greater than weekly limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the weekly transaction count is greater than weekly limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:144,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, weeklyLimitCount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst weeklyLimitCountType = Number(typeId.weeklyLimitCount);\nconst batchSize = 5;\nfor (let i = 0; i &lt; weeklyLimitCountType; i += batchSize) {\n  const batchPromises = [];\n  const end = Math.min(i + batchSize, weeklyLimitCountType);\n  for (let j = i; j &lt; end; j++) {\n    const promise = prismaAccounting.transaction.create({\n      data: {\n        fromAccountId: (await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })).id,\n        toAccountId: (await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })).id,\n        transactionTypeId: typeId.id,\n        amount: 100,\n        referenceNo: `Transaction ${j + 1}`,\n        note: `Test transaction ${j + 1}`,\n      },\n    }).then(async transaction =&gt; {\n      return Promise.all([\n        prismaAccounting.ledger.create({\n          data: {\n            accountId: (await prismaAccounting.userAccount.findUnique({\n              where: { identifier: sender.identifier },\n            })).id,\n            transactionId: transaction.id,\n            amount: 100,\n            description: `Ledger entry for transaction ${j + 1}`,\n            type: \&quot;DEBIT\&quot;,\n          },\n        }),\n        prismaAccounting.ledger.create({\n          data: {\n            accountId: (await prismaAccounting.userAccount.findUnique({\n              where: { identifier: receiver.identifier },\n            })).id,\n            transactionId: transaction.id,\n            amount: 100,\n            description: `Ledger entry for transaction ${j + 1}`,\n            type: \&quot;CREDIT\&quot;,\n          },\n        })\n      ]);\n    });\n    batchPromises.push(promise);\n  }\n  await Promise.all(batchPromises);\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const senderUser = await prismaAuth.appUser.findFirst({\n    where: { phone: sender.identifier },\n    select: { id: true }\n  });\n  const [apiTable] = await  database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  expect(apiTable.status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;49c98740-18b0-46ae-bd87-11f3d4e9d152&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly transaction count is greater than monthly limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1002 should return 400 if the monthly transaction count is greater than monthly limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:329,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n  })\n]);\nconst monthlyLimitCountType = Number(typeId.monthlyLimitCount);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nfor (let i = 0; i &lt; monthlyLimitCountType; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d8b4fe98-4b63-40f2-b9ed-643c0c963e2b&quot;,&quot;parentUUID&quot;:&quot;0169f73c-90a5-4116-a5c4-1872aa7034f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ed4cf5b4-9d2e-4533-aac7-c949d18406af&quot;,&quot;8a83db4f-ecdb-485c-a835-f6652b3a093d&quot;,&quot;5d635ffb-e319-4397-abfd-15f8e50875a1&quot;,&quot;ade2f489-c45e-415c-a034-8b7decbb85c5&quot;,&quot;4a6f7e50-8937-47eb-b8ee-9151e1073c63&quot;,&quot;526f30e4-c340-421a-a16c-e094f056ba34&quot;,&quot;ca8a383c-1b08-4107-a34a-ae68aaca6372&quot;,&quot;55a266c2-3749-41f0-9214-1965a76b9b5f&quot;,&quot;0c3d7c68-e0a8-46c0-95f2-87b96ba319a9&quot;,&quot;b0f5e0d9-e6ed-4aaf-b2af-ad375773c6bb&quot;,&quot;f1715f3e-eba2-48d9-a07c-561db49ff0f9&quot;,&quot;0b58b3e2-b3d5-4318-9339-7b6681cb9adc&quot;,&quot;49c98740-18b0-46ae-bd87-11f3d4e9d152&quot;,&quot;d8b4fe98-4b63-40f2-b9ed-643c0c963e2b&quot;],&quot;failures&quot;:[&quot;5241e1d0-dbd4-40f4-9a21-de4024fc8e39&quot;,&quot;6b13b59c-2c4f-4d2b-9f07-b505b6e899ef&quot;,&quot;cc244bd0-5718-4a19-8901-c35428c0b00f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:27531,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;title&quot;:&quot;Do Transaction API Check (POST) - Type: 1005&quot;,&quot;fullFile&quot;:&quot;/opt/app/src/topUp/topup.test.js&quot;,&quot;file&quot;:&quot;/src/topUp/topup.test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1005\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 \&quot;before each\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1005\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const senderIdentifier = sender?.identifier;\nconst receiverIdentifier = receiver?.identifier;\nconst senderAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: senderIdentifier },\n});\nconst receiverAccount = await prismaAccounting.userAccount.findUnique({\n  where: { identifier: receiverIdentifier },\n});\ncreatedType = await prismaAccounting.transactionType.findMany({\n  where: { transactionCode: transactionTypeCode },\n});\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  await database[0].deleteMany({});\n}\nif (!redisClient.isOpen) {\n  await redisClient.connect();\n}\nawait redisClient.FLUSHALL();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f892fdeb-4aea-421b-8ebb-287f3c5d65d1&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1005\&quot;&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 \&quot;after all\&quot; hook in \&quot;Do Transaction API Check (POST) - Type: 1005\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.$disconnect();\nawait prismaAuth.$disconnect();\nawait prismaApi.$disconnect();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ddaa12e0-b367-4305-b14a-8be0fe6268eb&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 if sender&#x27;s account balance is less than the transaction amount&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if sender&#x27;s account balance is less than the transaction amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;await prismaAccounting.ledger.deleteMany({});\n      await prismaAccounting.transaction.deleteMany({});\n      userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      });\n      if (transactionTypeCode === &#x27;1001&#x27;) { return; }\n      const verifiedPinToken = generateVerifyPinToken(transactionTypeCode, userId.id, \&quot;01317577237\&quot;, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedPinToken);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        await database[0].deleteMany({});\n      }\n      const res = await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(token)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBody,\n          verifiedPinToken: verifiedPinToken\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        const transactionsFromDB = await prismaAccounting.transaction.findMany({\n          where: { referenceNo: apiTable.referenceNumber },\n        });\n        expect(transactionsFromDB).to.be.empty;\n        const ledgerEntries = await prismaAccounting.ledger.findMany({\n          where: { transactionId: transactionsFromDB.id },\n        });\n        expect(ledgerEntries).to.be.empty;\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;1b50c78f-ddd4-412c-b585-317af4f02636&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the sender&#x27;s status is anything but FULL_ACTIVE&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the sender&#x27;s status is anything but FULL_ACTIVE&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: \&quot;01317577238\&quot;,\n        },\n      });\n      const accountingUser = await prismaAccounting.userAccount.findFirst({\n        where: {\n          identifier: \&quot;01317577238\&quot;,\n        },\n      });\n      const onholdUserToken = generateUserToken(userId.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\n      const onholdUserTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, \&quot;01317577238\&quot;, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, onholdUserTokenPin);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      if (transactionTypeCode != &#x27;1001&#x27;) {\n        await addInitialBalance(accountingUser, 500000);\n      }\n      await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(onholdUserToken)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBody,\n          verifiedPinToken: onholdUserTokenPin\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        // const transactionsFromDB = await prismaAccounting.transaction.findMany({\n        //   where: { referenceNo: apiTable.referenceNumber },\n        // });\n        // expect(transactionsFromDB).to.have.lengthOf(2);\n        // const ledgerEntries = await prismaAccounting.ledger.findMany({\n        //   where: { transactionId: transactionsFromDB[0].id },\n        // });\n        // expect(ledgerEntries).to.have.lengthOf(2);\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;37d5cb28-b934-49fe-83d0-6e11241d4c03&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the balance after transaction amount is less than min Wallet Amount of sender account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the balance after transaction amount is less than min Wallet Amount of sender account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:21,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      });\n      if (transactionTypeCode != &#x27;1001&#x27;) {\n        await addInitialBalance(sender, 1000000);\n      }\n      const verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\n      await redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\n      await redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\n      await pactum\n        .spec()\n        .withMethod(\&quot;POST\&quot;)\n        .withBearerToken(token)\n        .withPath(`${baseUrl}${endpoint}`)\n        .withJson({\n          ...requestBodyForMinWalleAmount,\n          verifiedPinToken: verifiedTokenPin\n        })\n        .expectStatus(400);\n      if (transactionTypeCode != &#x27;1002&#x27;) {\n        const apiTable = await database[0].findMany({\n          where: {\n            userId: await prismaAuth.appUser.findFirst({\n              where: {\n                phone: sender.identifier,\n              },\n            })\n          }.id,\n        });\n        expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n        const transactionsFromDB = await prismaAccounting.transaction.findMany({\n          where: { referenceNo: apiTable.referenceNumber },\n        });\n        if (transactionTypeCode != &#x27;1001&#x27;) {\n          // expect(transactionsFromDB).to.have.lengthOf(2);\n          // const ledgerEntries = await prismaAccounting.ledger.findMany({\n          //   where: { transactionId: transactionsFromDB[0].id },\n          // });\n          // expect(ledgerEntries).to.have.lengthOf(2);\n          // const ledgerEntries1 = await prismaAccounting.ledger.findMany({\n          //   where: { transactionId: transactionsFromDB[1].id },\n          // });\n          // expect(ledgerEntries1).to.have.lengthOf(2);\n        }\n        else {\n          expect(transactionsFromDB).to.be.empty;\n        }\n      }&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;76dbf3e1-cfbf-42b7-b7a2-56b15b74949e&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the balance after transaction is greater than max Wallet Amount of receiver account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the balance after transaction is greater than max Wallet Amount of receiver account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const maxWalletUser = await prismaAuth.appUser.findUnique({\n  where: { phone: \&quot;01317577210\&quot; }\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01317577210\&quot;,\n  },\n});\nconst maxWalletUserToken = generateUserToken(maxWalletUser.id, \&quot;01317577210\&quot;, \&quot;USER\&quot;);\nif (transactionTypeCode != &#x27;1001&#x27;) {\n  await addInitialBalance(accountingUser, 500000);\n  await addInitialBalance(receiver, 500);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, maxWalletUser.id, maxWalletUser.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(maxWalletUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForMaxWalleAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: \&quot;01317577210\&quot;,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f76b5af4-81ce-44c5-bbbc-cc6b5e786f4e&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily count is greater than daily limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the daily count is greater than daily limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:267,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nawait addInitialBalance(sender, 500000);\n\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170025\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170025\&quot;,\n  },\n});\nconst dailyLimitCountUser = generateUserToken(userId.id, \&quot;01715170025\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nconst dailyLimitCount = accountingUser.dailyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(dailyLimitCountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7f8cbc50-b447-495b-a07f-b036c7d02504&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction amount is greater than daily limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the daily transaction amount is greater than daily limit amount of the source account&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:2001,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170020\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170020\&quot;,\n  },\n});\nconst dailyLimitAmountUser = generateUserToken(userId.id, \&quot;01715170020\&quot;, \&quot;USER\&quot;);\nif (transactionTypeCode != &#x27;1001&#x27;) {\n  await addInitialBalance(accountingUser, 500000);\n}\nconst dailyLimitAmount = accountingUser.dailyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; dailyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(dailyLimitAmountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForDailyLimitAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;1fafd933-e2f5-4e20-a80a-3bbb117e2f57&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly count is greater than maximum monthly limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the monthly count is greater than maximum monthly limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:288,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nawait addInitialBalance(sender, 500000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170021\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170021\&quot;,\n  },\n});\nconst monthlyLimitCountCountUser = generateUserToken(userId.id, \&quot;01715170021\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst monthlyLimitCount = accountingUser.monthlyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; monthlyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(monthlyLimitCountCountUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedPinToken: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;16b80036-7f92-4039-b09b-0dc2d9025b42&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly transaction amount is greater than monthly limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the monthly transaction amount is greater than monthly limit amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5573,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170021\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170021\&quot;,\n  },\n});\nconst monthlyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170021\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst monthlyLimitAmount = accountingUser.monthlyLimitAmount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; monthlyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(monthlyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedPinToken: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: HTTP status 502 !== 400\n\n502 !== 400\n&quot;,&quot;estack&quot;:&quot;AssertionError [ERR_ASSERTION]: HTTP status 502 !== 400\n\n502 !== 400\n\n    at Expect._validateStatus (node_modules/pactum/src/models/expect.js:106:14)\n    at Expect.validate (node_modules/pactum/src/models/expect.js:47:10)\n    at Tosser.validateResponse (node_modules/pactum/src/models/Tosser.js:249:23)\n    at Tosser.validate (node_modules/pactum/src/models/Tosser.js:214:18)\n    at Tosser.toss (node_modules/pactum/src/models/Tosser.js:46:18)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,&quot;diff&quot;:&quot;- 502\n+ 400\n&quot;},&quot;uuid&quot;:&quot;283391f5-5296-43b9-ba4f-63f5d2a1411b&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly count is greater than maximum weekly limit count of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the weekly count is greater than maximum weekly limit count of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5567,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nthis.timeout(120000);\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170105\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170105\&quot;,\n  },\n});\nconst weeklyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170105\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst weeklyLimitAmount = accountingUser.weeklyLimitAmount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; weeklyLimitAmount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(weeklyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ca660b90-3376-4689-8f7e-3e330fbd498a&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction amount is greater than weekly limit amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the weekly transaction amount is greater than weekly limit amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:98,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;if (transactionTypeCode === &#x27;1001&#x27;) { return; }\nuserId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01715170105\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01715170105\&quot;,\n  },\n});\nconst weeklyLimitAmounttUser = generateUserToken(userId.id, \&quot;01715170105\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst weeklyLimitCount = accountingUser.weeklyLimitCount;\nconst typeId = await prismaAccounting.transactionType.findFirst({\n  where: { transactionCode: transactionTypeCode }\n});\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nfor (let i = 0; i &lt; weeklyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier }\n      })).id,\n      toAccountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: sender.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (await prismaAccounting.userAccount.findUnique({\n        where: { identifier: receiver.identifier },\n      })).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(weeklyLimitAmounttUser)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;106645c5-007e-4c8e-a6a7-149ce1ae46ff&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the transaction amount is less than transaction type min amount&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the transaction amount is less than transaction type min amount&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01915170011\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01915170011\&quot;,\n  },\n});\nconst transactionTypeMinUserToken = generateUserToken(userId.id, \&quot;01915170011\&quot;, \&quot;USER\&quot;);\nawait addInitialBalance(accountingUser, 500000);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(transactionTypeMinUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForTypeMinAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;da6ad3f2-ac79-4c54-9229-c014e3e9579c&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the transaction amount is greater than transaction type max amount of the source account&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the transaction amount is greater than transaction type max amount of the source account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:22,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;userId = await prismaAuth.appUser.findFirst({\n  where: {\n    phone: \&quot;01915170011\&quot;,\n  },\n});\nconst accountingUser = await prismaAccounting.userAccount.findFirst({\n  where: {\n    identifier: \&quot;01915170011\&quot;,\n  },\n});\nconst transactionTypeMinUserToken = generateUserToken(userId.id, \&quot;01915170011\&quot;, \&quot;USER\&quot;);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, &#x27;token&#x27;, verifiedTokenPin);\nawait redisClient.HGET(`token:${userId.phone}`, &#x27;token&#x27;);\nawait addInitialBalance(accountingUser, 1000000);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(transactionTypeMinUserToken)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBodyForTypeMaxAmount,\n    verifiedTokenPin: verifiedTokenPin\n  })\n  .expectStatus(400);\nif (transactionTypeCode != &#x27;1002&#x27;) {\n  const apiTable = await database[0].findMany({\n    where: {\n      userId: await prismaAuth.appUser.findFirst({\n        where: {\n          phone: sender.identifier,\n        },\n      })\n    }.id,\n  });\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c634cd04-174a-413c-ad27-5cc160b88e29&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction amount is greater than daily limit amount of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the daily transaction amount is greater than daily limit amount of the transaction type&quot;,&quot;timedOut&quot;:true,&quot;duration&quot;:2001,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, dailyLimitAmount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst dailyLimitCount = Number(typeId.dailyLimitAmount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)&quot;,&quot;estack&quot;:&quot;Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure \&quot;done()\&quot; is called; if returning a Promise, ensure it resolves. (/opt/app/src/topUp/topup.test.js)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)&quot;},&quot;uuid&quot;:&quot;fe4f87eb-6dd6-40e3-a924-27702dc09916&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the daily transaction count is greater than daily limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the daily transaction count is greater than daily limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:157,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, dailyLimitCount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 5000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst dailyLimitCount = Number(typeId.dailyLimitCount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; dailyLimitCount; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b24df78e-531f-4ff6-8d20-3168558faabf&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction amount is greater than weekly limit amount of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the weekly transaction amount is greater than weekly limit amount of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, weeklyLimitAmount: true },\n  }),\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst weeklyLimitAmountType = Number(typeId.weeklyLimitAmount);\nconst transactionPromises = [];\nfor (let i = 0; i &lt; weeklyLimitAmountType / 100; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nawait Promise.all(transactionPromises);\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bb7a9536-61a4-4ff3-bdad-eab2710dca59&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the weekly transaction count is greater than weekly limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the weekly transaction count is greater than weekly limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:98,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n    select: { id: true, weeklyLimitCount: true },\n  })\n]);\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nconst weeklyLimitCountType = Number(typeId.weeklyLimitCount);\nconst batchSize = 5;\nfor (let i = 0; i &lt; weeklyLimitCountType; i += batchSize) {\n  const batchPromises = [];\n  const end = Math.min(i + batchSize, weeklyLimitCountType);\n  for (let j = i; j &lt; end; j++) {\n    const promise = prismaAccounting.transaction.create({\n      data: {\n        fromAccountId: (await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })).id,\n        toAccountId: (await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })).id,\n        transactionTypeId: typeId.id,\n        amount: 100,\n        referenceNo: `Transaction ${j + 1}`,\n        note: `Test transaction ${j + 1}`,\n      },\n    }).then(async transaction =&gt; {\n      return Promise.all([\n        prismaAccounting.ledger.create({\n          data: {\n            accountId: (await prismaAccounting.userAccount.findUnique({\n              where: { identifier: sender.identifier },\n            })).id,\n            transactionId: transaction.id,\n            amount: 100,\n            description: `Ledger entry for transaction ${j + 1}`,\n            type: \&quot;DEBIT\&quot;,\n          },\n        }),\n        prismaAccounting.ledger.create({\n          data: {\n            accountId: (await prismaAccounting.userAccount.findUnique({\n              where: { identifier: receiver.identifier },\n            })).id,\n            transactionId: transaction.id,\n            amount: 100,\n            description: `Ledger entry for transaction ${j + 1}`,\n            type: \&quot;CREDIT\&quot;,\n          },\n        })\n      ]);\n    });\n    batchPromises.push(promise);\n  }\n  await Promise.all(batchPromises);\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const senderUser = await prismaAuth.appUser.findFirst({\n    where: { phone: sender.identifier },\n    select: { id: true }\n  });\n  const [apiTable] = await  database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  expect(apiTable.status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e99deb98-9774-4af4-8ddb-16fdc0c66a73&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the monthly transaction count is greater than monthly limit count of the transaction type&quot;,&quot;fullTitle&quot;:&quot;Do Transaction API Check (POST) - Type: 1005 should return 400 if the monthly transaction count is greater than monthly limit count of the transaction type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:243,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const [userId, typeId] = await Promise.all([\n  prismaAuth.appUser.findFirst({\n    where: { phone: \&quot;01317577237\&quot; },\n    select: { id: true, phone: true },\n  }),\n  prismaAccounting.transactionType.findFirst({\n    where: { transactionCode: transactionTypeCode },\n  })\n]);\nconst monthlyLimitCountType = Number(typeId.monthlyLimitCount);\nconst verifiedTokenPin = generateVerifyPinToken(transactionTypeCode, userId.id, userId.phone, \&quot;USER\&quot;);\nawait redisClient.HSET(`token:${userId.phone}`, \&quot;token\&quot;, verifiedTokenPin);\nfor (let i = 0; i &lt; monthlyLimitCountType; i++) {\n  const transaction = await prismaAccounting.transaction.create({\n    data: {\n      fromAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      toAccountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionTypeId: typeId.id,\n      amount: 100,\n      referenceNo: `Transaction ${i + 1}`,\n      note: `Test transaction ${i + 1}`,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: sender.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;DEBIT\&quot;,\n    },\n  });\n  await prismaAccounting.ledger.create({\n    data: {\n      accountId: (\n        await prismaAccounting.userAccount.findUnique({\n          where: { identifier: receiver.identifier },\n        })\n      ).id,\n      transactionId: transaction.id,\n      amount: 100,\n      description: `Ledger entry for transaction ${i + 1}`,\n      type: \&quot;CREDIT\&quot;,\n    },\n  });\n}\nif (transactionTypeCode != \&quot;1001\&quot;) {\n  await addInitialBalance(sender, 500000);\n}\nawait pactum\n  .spec()\n  .withMethod(\&quot;POST\&quot;)\n  .withBearerToken(token)\n  .withPath(`${baseUrl}${endpoint}`)\n  .withJson({\n    ...requestBody,\n    verifiedTokenPin: verifiedTokenPin,\n  })\n  .expectStatus(400);\nif (transactionTypeCode != \&quot;1002\&quot;) {\n  const [apiTable] = await Promise.all([\n    await database[0].findMany({\n      where: {\n        userId: await prismaAuth.appUser.findFirst({\n          where: {\n            phone: sender.identifier,\n          }, select: { id: true, phone: true },\n        })\n      }.id,\n    })\n  ]);\n  expect(apiTable[0].status).to.equal(\&quot;TODO\&quot;);\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;105464a1-99de-4f3c-b7e2-ba8a72aaea8a&quot;,&quot;parentUUID&quot;:&quot;b7082267-573c-4d3a-952d-a6528fcb1833&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f76b5af4-81ce-44c5-bbbc-cc6b5e786f4e&quot;,&quot;7f8cbc50-b447-495b-a07f-b036c7d02504&quot;,&quot;ca660b90-3376-4689-8f7e-3e330fbd498a&quot;,&quot;106645c5-007e-4c8e-a6a7-149ce1ae46ff&quot;,&quot;da6ad3f2-ac79-4c54-9229-c014e3e9579c&quot;,&quot;c634cd04-174a-413c-ad27-5cc160b88e29&quot;,&quot;b24df78e-531f-4ff6-8d20-3168558faabf&quot;,&quot;bb7a9536-61a4-4ff3-bdad-eab2710dca59&quot;,&quot;e99deb98-9774-4af4-8ddb-16fdc0c66a73&quot;,&quot;105464a1-99de-4f3c-b7e2-ba8a72aaea8a&quot;],&quot;failures&quot;:[&quot;1b50c78f-ddd4-412c-b585-317af4f02636&quot;,&quot;37d5cb28-b934-49fe-83d0-6e11241d4c03&quot;,&quot;76dbf3e1-cfbf-42b7-b7a2-56b15b74949e&quot;,&quot;1fafd933-e2f5-4e20-a80a-3bbb117e2f57&quot;,&quot;16b80036-7f92-4039-b09b-0dc2d9025b42&quot;,&quot;283391f5-5296-43b9-ba4f-63f5d2a1411b&quot;,&quot;fe4f87eb-6dd6-40e3-a924-27702dc09916&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:16544,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.8.2&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;app&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report/assets&quot;,&quot;jsonFile&quot;:&quot;/opt/app/mochawesome-report/mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;/opt/app/mochawesome-report/mochawesome.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>